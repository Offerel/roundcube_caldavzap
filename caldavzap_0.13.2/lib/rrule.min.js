(function(e){var t="undefined"!=typeof module&&module.exports,n=function(){if(!n._nlp)if(t)n._nlp=require("./nlp");else if(!(n._nlp=e._RRuleNLP))throw new Error("You need to include rrule/nlp.js for fromText/toText to work.");return n._nlp},r={MONTH_DAYS:[31,28,31,30,31,30,31,31,30,31,30,31],ONE_DAY:864e5,MAXYEAR:9999,ORDINAL_BASE:new Date(1970,0,1),PY_WEEKDAYS:[6,0,1,2,3,4,5],getYearDay:function(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate());return Math.ceil((t-new Date(e.getFullYear(),0,1))/r.ONE_DAY)+1},isLeapYear:function(e){return e instanceof Date&&(e=e.getFullYear()),e%4===0&&e%100!==0||e%400===0},tzOffset:function(e){return 60*e.getTimezoneOffset()*1e3},daysBetween:function(e,t){var n=e.getTime()-r.tzOffset(e),a=t.getTime()-r.tzOffset(t),i=Math.abs(n-a);return Math.round(i/r.ONE_DAY)},toOrdinal:function(e){return r.daysBetween(e,r.ORDINAL_BASE)},fromOrdinal:function(e){var t=e*r.ONE_DAY;return new Date(r.ORDINAL_BASE.getTime()-r.tzOffset(r.ORDINAL_BASE)+t+r.tzOffset(new Date(t)))},monthRange:function(e,t){var n=new Date(e,t,1);return[r.getWeekday(n),r.getMonthDays(n)]},getMonthDays:function(e){var t=e.getMonth();return 1==t&&r.isLeapYear(e)?29:r.MONTH_DAYS[t]},getWeekday:function(e){return r.PY_WEEKDAYS[e.getDay()]},combine:function(e,t){return t=t||e,new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes(),t.getSeconds())},clone:function(e){var t=new Date(e.getTime());return t.setMilliseconds(0),t},cloneDates:function(e){for(var t=[],n=0;n<e.length;n++)t.push(r.clone(e[n]));return t},sort:function(e){e.sort(function(e,t){return e.getTime()-t.getTime()})},timeToUntilString:function(e){for(var t,n=new Date(e),r=[n.getUTCFullYear(),n.getUTCMonth()+1,n.getUTCDate(),"T",n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds(),"Z"],a=0;a<r.length;a++)t=r[a],!/[TZ]/.test(t)&&t<10&&(r[a]="0"+String(t));return r.join("")},untilStringToDate:function(e){var t=/^(\d{4})(\d{2})(\d{2})(T(\d{2})(\d{2})(\d{2})Z)?$/,n=t.exec(e);if(!n)throw new Error("Invalid UNTIL value: "+e);return new Date(Date.UTC(n[1],n[2]-1,n[3],n[5]||0,n[6]||0,n[7]||0))}};r.Time=function(e,t,n){this.hour=e,this.minute=t,this.second=n},r.Time.prototype={getHours:function(){return this.hour},getMinutes:function(){return this.minute},getSeconds:function(){return this.second},getTime:function(){return 1e3*(60*this.hour*60+60*this.minute+this.second)}};var a=function(e,t){1===arguments.length&&(t=e,e=0);for(var n=[],r=e;r<t;r++)n.push(r);return n},i=function(e,t){var n=0,r=[];if(e instanceof Array)for(;n<t;n++)r[n]=[].concat(e);else for(;n<t;n++)r[n]=e;return r},o=function(e,t){var n=e%t;return n*t<0?n+t:n},s=function(e,t){return{div:Math.floor(e/t),mod:o(e,t)}},l=function(e){return!(e instanceof Array&&0==e.length)&&Boolean(e)},h=function(e,t){return e.indexOf(t)!=-1},u=[].concat(i(1,31),i(2,28),i(3,31),i(4,30),i(5,31),i(6,30),i(7,31),i(8,31),i(9,30),i(10,31),i(11,30),i(12,31),i(1,7)),y=[].concat(i(1,31),i(2,29),i(3,31),i(4,30),i(5,31),i(6,30),i(7,31),i(8,31),i(9,30),i(10,31),i(11,30),i(12,31),i(1,7)),f=a(1,29),c=a(1,30),d=a(1,31),b=a(1,32),m=[].concat(b,c,b,d,b,d,b,b,d,b,d,b,b.slice(0,7)),w=[].concat(b,f,b,d,b,d,b,b,d,b,d,b,b.slice(0,7));f=a(-28,0),c=a(-29,0),d=a(-30,0),b=a(-31,0);var p=[].concat(b,c,b,d,b,d,b,b,d,b,d,b,b.slice(0,7)),g=[].concat(b,f,b,d,b,d,b,b,d,b,d,b,b.slice(0,7)),k=[0,31,60,91,121,152,182,213,244,274,305,335,366],v=[0,31,59,90,120,151,181,212,243,273,304,334,365],Y=function(){for(var e=[],t=0;t<55;t++)e=e.concat(a(7));return e}(),T=function(e,t){if(0===t)throw new Error("Can't create weekday with n == 0");this.weekday=e,this.n=t};T.prototype={nth:function(e){return this.n==e?this:new T(this.weekday,e)},equals:function(e){return this.weekday==e.weekday&&this.n==e.n},toString:function(){var e=["MO","TU","WE","TH","FR","SA","SU"][this.weekday];return this.n&&(e=(this.n>0?"+":"")+String(this.n)+e),e},getJsWeekday:function(){return 6==this.weekday?0:this.weekday+1}};var D=function(e,t){this._string=null,e=e||{},this._cache=t?null:{all:!1,before:[],after:[],between:[]},this.origOptions={};var n=[],a=Object.keys(e),i=Object.keys(D.DEFAULT_OPTIONS);if(a.forEach(function(t){this.origOptions[t]=e[t],h(i,t)||n.push(t)},this),n.length)throw new Error("Invalid options: "+n.join(", "));if(!D.FREQUENCIES[e.freq]&&null===e.byeaster)throw new Error("Invalid frequency: "+String(e.freq));i.forEach(function(t){h(a,t)||(e[t]=D.DEFAULT_OPTIONS[t])});var o=this.options=e;if(null!==o.byeaster&&(o.freq=D.YEARLY),o.dtstart||(o.dtstart=new Date,o.dtstart.setMilliseconds(0)),null===o.wkst?o.wkst=D.MO.weekday:"number"==typeof o.wkst||(o.wkst=o.wkst.weekday),null!==o.bysetpos){"number"==typeof o.bysetpos&&(o.bysetpos=[o.bysetpos]);for(var s=0;s<o.bysetpos.length;s++){var u=o.bysetpos[s];if(0==u||!(-366<=u&&u<=366))throw new Error("bysetpos must be between 1 and 366, or between -366 and -1")}}if(!(l(o.byweekno)||l(o.byyearday)||l(o.bymonthday)||null!==o.byweekday||null!==o.byeaster))switch(o.freq){case D.YEARLY:o.bymonth||(o.bymonth=o.dtstart.getMonth()+1),o.bymonthday=o.dtstart.getDate();break;case D.MONTHLY:o.bymonthday=o.dtstart.getDate();break;case D.WEEKLY:o.byweekday=r.getWeekday(o.dtstart)}if(null===o.bymonth||o.bymonth instanceof Array||(o.bymonth=[o.bymonth]),null===o.byyearday||o.byyearday instanceof Array||(o.byyearday=[o.byyearday]),null===o.bymonthday)o.bymonthday=[],o.bynmonthday=[];else if(o.bymonthday instanceof Array){var y=[],f=[];for(s=0;s<o.bymonthday.length;s++){var u=o.bymonthday[s];u>0?y.push(u):u<0&&f.push(u)}o.bymonthday=y,o.bynmonthday=f}else o.bymonthday<0?(o.bynmonthday=[o.bymonthday],o.bymonthday=[]):(o.bynmonthday=[],o.bymonthday=[o.bymonthday]);if(null===o.byweekno||o.byweekno instanceof Array||(o.byweekno=[o.byweekno]),null===o.byweekday)o.bynweekday=null;else if("number"==typeof o.byweekday)o.byweekday=[o.byweekday],o.bynweekday=null;else if(o.byweekday instanceof T)!o.byweekday.n||o.freq>D.MONTHLY?(o.byweekday=[o.byweekday.weekday],o.bynweekday=null):(o.bynweekday=[[o.byweekday.weekday,o.byweekday.n]],o.byweekday=null);else{var c=[],d=[];for(s=0;s<o.byweekday.length;s++){var b=o.byweekday[s];"number"==typeof b?c.push(b):!b.n||o.freq>D.MONTHLY?c.push(b.weekday):d.push([b.weekday,b.n])}o.byweekday=l(c)?c:null,o.bynweekday=l(d)?d:null}if(null===o.byhour?o.byhour=o.freq<D.HOURLY?[o.dtstart.getHours()]:null:"number"==typeof o.byhour&&(o.byhour=[o.byhour]),null===o.byminute?o.byminute=o.freq<D.MINUTELY?[o.dtstart.getMinutes()]:null:"number"==typeof o.byminute&&(o.byminute=[o.byminute]),null===o.bysecond?o.bysecond=o.freq<D.SECONDLY?[o.dtstart.getSeconds()]:null:"number"==typeof o.bysecond&&(o.bysecond=[o.bysecond]),o.freq>=D.HOURLY)this.timeset=null;else{for(this.timeset=[],s=0;s<o.byhour.length;s++)for(var m=o.byhour[s],w=0;w<o.byminute.length;w++)for(var p=o.byminute[w],g=0;g<o.bysecond.length;g++){var k=o.bysecond[g];this.timeset.push(new r.Time(m,p,k))}r.sort(this.timeset)}};D.FREQUENCIES=["YEARLY","MONTHLY","WEEKLY","DAILY","HOURLY","MINUTELY","SECONDLY"],D.YEARLY=0,D.MONTHLY=1,D.WEEKLY=2,D.DAILY=3,D.HOURLY=4,D.MINUTELY=5,D.SECONDLY=6,D.MO=new T(0),D.TU=new T(1),D.WE=new T(2),D.TH=new T(3),D.FR=new T(4),D.SA=new T(5),D.SU=new T(6),D.DEFAULT_OPTIONS={freq:null,dtstart:null,interval:1,wkst:D.MO,count:null,until:null,bysetpos:null,bymonth:null,bymonthday:null,byyearday:null,byweekno:null,byweekday:null,byhour:null,byminute:null,bysecond:null,byeaster:null},D.parseText=function(e,t){return n().parseText(e,t)},D.fromText=function(e,t){return n().fromText(e,t)},D.optionsToString=function(e){var t,n,a,i,o,s=[];n=Object.keys(e),a=Object.keys(D.DEFAULT_OPTIONS);for(var l=0;l<n.length;l++)if(h(a,n[l])&&(t=n[l].toUpperCase(),i=e[n[l]],o=[],!(null===i||i instanceof Array&&!i.length))){switch(t){case"FREQ":i=D.FREQUENCIES[e.freq];break;case"WKST":i=i.toString();break;case"BYWEEKDAY":t="BYDAY",i instanceof Array||(i=[i]);for(var u,y=0;y<i.length;y++)u=i[y],u instanceof T||(u=u instanceof Array?new T(u[0],u[1]):new T(u)),o[y]=u.toString();i=o;break;case"DTSTART":case"UNTIL":i=r.timeToUntilString(i);break;default:if(i instanceof Array){for(var y=0;y<i.length;y++)o[y]=String(i[y]);i=o}else i=String(i)}s.push([t,i])}for(var f=[],l=0;l<s.length;l++){var c=s[l];f.push(c[0]+"="+c[1].toString())}return f.join(";")},D.prototype={all:function(e){if(e)return this._iter(new A("all",{},e));var t=this._cacheGet("all");return t===!1&&(t=this._iter(new O("all",{})),this._cacheAdd("all",t)),t},between:function(e,t,n,r){var a={before:t,after:e,inc:n};if(r)return this._iter(new A("between",a,r));var i=this._cacheGet("between",a);return i===!1&&(i=this._iter(new O("between",a)),this._cacheAdd("between",i,a)),i},before:function(e,t){var n={dt:e,inc:t},r=this._cacheGet("before",n);return r===!1&&(r=this._iter(new O("before",n)),this._cacheAdd("before",r,n)),r},after:function(e,t){var n={dt:e,inc:t},r=this._cacheGet("after",n);return r===!1&&(r=this._iter(new O("after",n)),this._cacheAdd("after",r,n)),r},count:function(){return this.all().length},toString:function(){return D.optionsToString(this.origOptions)},toText:function(e,t){return n().toText(this,e,t)},isFullyConvertibleToText:function(){return n().isFullyConvertible(this)},_cacheAdd:function(e,t,n){this._cache&&(t&&(t=t instanceof Date?r.clone(t):r.cloneDates(t)),"all"==e?this._cache.all=t:(n._value=t,this._cache[e].push(n)))},_cacheGet:function(e,t){if(!this._cache)return!1;var n=!1;if("all"==e)n=this._cache.all;else e:for(var a,i=0;i<this._cache[e].length;i++){a=this._cache[e][i];for(var o in t)if(t.hasOwnProperty(o)&&String(t[o])!=String(a[o]))continue e;n=a._value;break}if(!n&&this._cache.all){for(var s=new O(e,t),i=0;i<this._cache.all.length&&s.accept(this._cache.all[i]);i++);n=s.getValue(),this._cacheAdd(e,n,t)}return n instanceof Array?r.cloneDates(n):n instanceof Date?r.clone(n):n},clone:function(){return new D(this.origOptions)},_iter:function(e){var t=this.options.dtstart,n=t.getFullYear(),a=t.getMonth()+1,i=t.getDate(),u=t.getHours(),y=t.getMinutes(),f=t.getSeconds(),c=r.getWeekday(t),d=(r.getYearDay(t),this.options.freq),b=this.options.interval,m=this.options.wkst,w=this.options.until,p=this.options.bymonth,g=this.options.byweekno,k=this.options.byyearday,v=this.options.byweekday,Y=this.options.byeaster,T=this.options.bymonthday,O=this.options.bynmonthday,A=this.options.bysetpos,_=this.options.byhour,L=this.options.byminute,M=this.options.bysecond,S=new E(this);S.rebuild(n,a);var N={};N[D.YEARLY]=S.ydayset,N[D.MONTHLY]=S.mdayset,N[D.WEEKLY]=S.wdayset,N[D.DAILY]=S.ddayset,N[D.HOURLY]=S.ddayset,N[D.MINUTELY]=S.ddayset,N[D.SECONDLY]=S.ddayset,N=N[d];var R;if(d<D.HOURLY)R=this.timeset;else{var U={};U[D.HOURLY]=S.htimeset,U[D.MINUTELY]=S.mtimeset,U[D.SECONDLY]=S.stimeset,U=U[d],R=d>=D.HOURLY&&l(_)&&!h(_,u)||d>=D.MINUTELY&&l(L)&&!h(L,y)||d>=D.SECONDLY&&l(M)&&!h(M,y)?[]:U.call(S,u,y,f)}for(var I,H,C,x,W,q,B,F,V,K,P,j,z,G=0,Q=this.options.count;;){for(F=N.call(S,n,a,i),K=F[0],P=F[1],j=F[2],I=!1,C=P;C<j;C++)H=K[C],(l(p)&&!h(p,S.mmask[H])||l(g)&&!S.wnomask[H]||l(v)&&!h(v,S.wdaymask[H])||l(S.nwdaymask)&&!S.nwdaymask[H]||null!==Y&&!h(S.eastermask,H)||(l(T)||l(O))&&!h(T,S.mdaymask[H])&&!h(O,S.nmdaymask[H])||l(k)&&(H<S.yearlen&&!h(k,H+1)&&!h(k,-S.yearlen+H)||H>=S.yearlen&&!h(k,H+1-S.yearlen)&&!h(k,-S.nextyearlen+H-S.yearlen)))&&(K[H]=null,I=!0);if(l(A)&&l(R)){var $,X,Z=[];for(C=0;C<A.length;C++){var V=A[C];V<0?($=Math.floor(V/R.length),X=o(V,R.length)):($=Math.floor((V-1)/R.length),X=o(V-1,R.length));try{for(F=[],x=P;x<j;x++){var J=K[x];null!==J&&F.push(J)}H=$<0?F.slice($)[0]:F[$];var ee=R[X],te=r.fromOrdinal(S.yearordinal+H),ne=r.combine(te,ee);h(Z,ne)||Z.push(ne)}catch(e){}}for(r.sort(Z),C=0;C<Z.length;C++){var ne=Z[C];if(w&&ne>w)return this._len=G,e.getValue();if(ne>=t){if(++G,!e.accept(ne))return e.getValue();if(Q&&(--Q,!Q))return this._len=G,e.getValue()}}}else for(C=P;C<j;C++)if(H=K[C],null!==H){var te=r.fromOrdinal(S.yearordinal+H);for(x=0;x<R.length;x++){var ee=R[x],ne=r.combine(te,ee);if(w&&ne>w)return this._len=G,e.getValue();if(ne>=t){if(++G,!e.accept(ne))return e.getValue();if(Q&&(--Q,!Q))return this._len=G,e.getValue()}}}if(z=!1,d==D.YEARLY){if(n+=b,n>r.MAXYEAR)return this._len=G,e.getValue();S.rebuild(n,a)}else if(d==D.MONTHLY){if(a+=b,a>12&&(q=Math.floor(a/12),B=o(a,12),a=B,n+=q,0==a&&(a=12,--n),n>r.MAXYEAR))return this._len=G,e.getValue();S.rebuild(n,a)}else if(d==D.WEEKLY)i+=m>c?-(c+1+(6-m))+7*b:-(c-m)+7*b,c=m,z=!0;else if(d==D.DAILY)i+=b,z=!0;else if(d==D.HOURLY){for(I&&(u+=Math.floor((23-u)/b)*b);;)if(u+=b,W=s(u,24),q=W.div,B=W.mod,q&&(u=B,i+=q,z=!0),!l(_)||h(_,u))break;R=U.call(S,u,y,f)}else if(d==D.MINUTELY){for(I&&(y+=Math.floor((1439-(60*u+y))/b)*b);;)if(y+=b,W=s(y,60),q=W.div,B=W.mod,q&&(y=B,u+=q,W=s(u,24),q=W.div,B=W.mod,q&&(u=B,i+=q,z=!0,I=!1)),(!l(_)||h(_,u))&&(!l(L)||h(L,y)))break;R=U.call(S,u,y,f)}else if(d==D.SECONDLY){for(I&&(f+=Math.floor((86399-(3600*u+60*y+f))/b)*b);;)if(f+=b,W=s(f,60),q=W.div,B=W.mod,q&&(f=B,y+=q,W=s(y,60),q=W.div,B=W.mod,q&&(y=B,u+=q,W=s(u,24),q=W.div,B=W.mod,q&&(u=B,i+=q,z=!0))),(!l(_)||h(_,u))&&(!l(L)||h(L,y))&&(!l(M)||h(M,f)))break;R=U.call(S,u,y,f)}if(z&&i>28){var re=r.monthRange(n,a-1)[1];if(i>re){for(;i>re;){if(i-=re,++a,13==a&&(a=1,++n,n>r.MAXYEAR))return this._len=G,e.getValue();re=r.monthRange(n,a-1)[1]}S.rebuild(n,a)}}}}},D.parseString=function(e){if(e=e.replace(/^\s+|\s+$/,""),!e.length)return null;var t,n,a,i,o,s=e.split(";"),l={};for(t=0;t<s.length;t++)switch(o=s[t].split("="),a=o[0],i=o[1],a){case"FREQ":l.freq=D[i];break;case"WKST":l.wkst=D[i];break;case"COUNT":case"INTERVAL":case"BYSETPOS":case"BYMONTH":case"BYMONTHDAY":case"BYYEARDAY":case"BYWEEKNO":case"BYHOUR":case"BYMINUTE":case"BYSECOND":if(i.indexOf(",")!=-1)for(i=i.split(","),n=0;n<i.length;n++)/^[+-]?\d+$/.test(i[n])&&(i[n]=Number(i[n]));else/^[+-]?\d+$/.test(i)&&(i=Number(i));a=a.toLowerCase(),l[a]=i;break;case"BYDAY":var h,u,y,f=i.split(",");for(l.byweekday=[],n=0;n<f.length;n++)y=f[n],2==y.length?(u=D[y],l.byweekday.push(u)):(y=y.match(/^([+-]?\d)([A-Z]{2})$/),h=Number(y[1]),u=y[2],u=D[u].weekday,l.byweekday.push(new T(u,h)));break;case"DTSTART":l.dtstart=r.untilStringToDate(i);break;case"UNTIL":l.until=r.untilStringToDate(i);break;case"BYEASTER":l.byeaster=Number(i);break;default:throw new Error("Unknown RRULE property '"+a+"'")}return l},D.fromString=function(e){return new D(D.parseString(e))};var E=function(e){this.rrule=e,this.lastyear=null,this.lastmonth=null,this.yearlen=null,this.nextyearlen=null,this.yearordinal=null,this.yearweekday=null,this.mmask=null,this.mrange=null,this.mdaymask=null,this.nmdaymask=null,this.wdaymask=null,this.wnomask=null,this.nwdaymask=null,this.eastermask=null};E.prototype.easter=function(e,t){t=t||0;var n=e%19,r=Math.floor(e/100),a=e%100,i=Math.floor(r/4),o=r%4,s=Math.floor((r+8)/25),l=Math.floor((r-s+1)/3),h=Math.floor(19*n+r-i-l+15)%30,u=Math.floor(a/4),y=a%4,f=Math.floor(32+2*o+2*u-h-y)%7,c=Math.floor((n+11*h+22*f)/451),d=Math.floor((h+f-7*c+114)/31),b=(h+f-7*c+114)%31+1,m=Date.UTC(e,d-1,b+t),w=Date.UTC(e,0,1);return[Math.ceil((m-w)/864e5)]},E.prototype.rebuild=function(e,t){var n=this.rrule;if(e!=this.lastyear){this.yearlen=r.isLeapYear(e)?366:365,this.nextyearlen=r.isLeapYear(e+1)?366:365;var a=new Date(e,0,1);this.yearordinal=r.toOrdinal(a),this.yearweekday=r.getWeekday(a);var s=r.getWeekday(new Date(e,0,1));if(365==this.yearlen?(this.mmask=[].concat(u),this.mdaymask=[].concat(w),this.nmdaymask=[].concat(g),this.wdaymask=Y.slice(s),this.mrange=[].concat(v)):(this.mmask=[].concat(y),this.mdaymask=[].concat(m),this.nmdaymask=[].concat(p),this.wdaymask=Y.slice(s),this.mrange=[].concat(k)),l(n.options.byweekno)){this.wnomask=i(0,this.yearlen+7);var f,c,d;f=c=o(7-this.yearweekday+n.options.wkst,7),f>=4?(f=0,d=this.yearlen+o(this.yearweekday-n.options.wkst,7)):d=this.yearlen-f;for(var b,T,E=Math.floor(d/7),O=o(d,7),A=Math.floor(E+O/4),_=0;_<n.options.byweekno.length;_++)if(b=n.options.byweekno[_],b<0&&(b+=A+1),0<b&&b<=A){b>1?(T=f+7*(b-1),f!=c&&(T-=7-c)):T=f;for(var L=0;L<7&&(this.wnomask[T]=1,T++,this.wdaymask[T]!=n.options.wkst);L++);}if(h(n.options.byweekno,1)){var T=f+7*A;if(f!=c&&(T-=7-c),T<this.yearlen)for(var _=0;_<7&&(this.wnomask[T]=1,T+=1,this.wdaymask[T]!=n.options.wkst);_++);}if(f){var M;if(h(n.options.byweekno,-1))M=-1;else{var S=r.getWeekday(new Date(e-1,0,1)),N=o(7-S+n.options.wkst,7),R=r.isLeapYear(e-1)?366:365;N>=4?(N=0,M=Math.floor(52+o(R+o(S-n.options.wkst,7),7)/4)):M=Math.floor(52+o(this.yearlen-f,7)/4)}if(h(n.options.byweekno,M))for(var T=0;T<f;T++)this.wnomask[T]=1}}else this.wnomask=null}if(l(n.options.bynweekday)&&(t!=this.lastmonth||e!=this.lastyear)){var U=[];if(n.options.freq==D.YEARLY)if(l(n.options.bymonth))for(_=0;_<n.options.bymonth.length;_++)t=n.options.bymonth[_],U.push(this.mrange.slice(t-1,t+1));else U=[[0,this.yearlen]];else n.options.freq==D.MONTHLY&&(U=[this.mrange.slice(t-1,t+1)]);if(l(U)){this.nwdaymask=i(0,this.yearlen);for(var _=0;_<U.length;_++){var I=U[_],H=I[0],C=I[1];C-=1;for(var L=0;L<n.options.bynweekday.length;L++){var s=n.options.bynweekday[L][0],b=n.options.bynweekday[L][1];b<0?(T=C+7*(b+1),T-=o(this.wdaymask[T]-s,7)):(T=H+7*(b-1),T+=o(7-this.wdaymask[T]+s,7)),H<=T&&T<=C&&(this.nwdaymask[T]=1)}}}this.lastyear=e,this.lastmonth=t}null!==n.options.byeaster&&(this.eastermask=this.easter(e,n.options.byeaster))},E.prototype.ydayset=function(e,t,n){return[a(this.yearlen),0,this.yearlen]},E.prototype.mdayset=function(e,t,n){for(var r=i(null,this.yearlen),a=this.mrange[t-1],o=this.mrange[t],s=a;s<o;s++)r[s]=s;return[r,a,o]},E.prototype.wdayset=function(e,t,n){for(var a=i(null,this.yearlen+7),o=r.toOrdinal(new Date(e,t-1,n))-this.yearordinal,s=o,l=0;l<7&&(a[o]=o,++o,this.wdaymask[o]!=this.rrule.options.wkst);l++);return[a,s,o]},E.prototype.ddayset=function(e,t,n){var a=i(null,this.yearlen),o=r.toOrdinal(new Date(e,t-1,n))-this.yearordinal;return a[o]=o,[a,o,o+1]},E.prototype.htimeset=function(e,t,n){for(var a=[],i=this.rrule,o=0;o<i.options.byminute.length;o++){t=i.options.byminute[o];for(var s=0;s<i.options.bysecond.length;s++)n=i.options.bysecond[s],a.push(new r.Time(e,t,n))}return r.sort(a),a},E.prototype.mtimeset=function(e,t,n){for(var a=[],i=this.rrule,o=0;o<i.options.bysecond.length;o++)n=i.options.bysecond[o],a.push(new r.Time(e,t,n));return r.sort(a),a},E.prototype.stimeset=function(e,t,n){return[new r.Time(e,t,n)]};var O=function(e,t){this.init(e,t)};O.prototype={init:function(e,t){this.method=e,this.args=t,this._result=[],this.minDate=null,this.maxDate=null,"between"==e?(this.maxDate=t.inc?t.before:new Date(t.before.getTime()-1),this.minDate=t.inc?t.after:new Date(t.after.getTime()+1)):"before"==e?this.maxDate=t.inc?t.dt:new Date(t.dt.getTime()-1):"after"==e&&(this.minDate=t.inc?t.dt:new Date(t.dt.getTime()+1))},accept:function(e){var t=this.minDate&&e<this.minDate,n=this.maxDate&&e>this.maxDate;if("between"==this.method){if(t)return!0;if(n)return!1}else if("before"==this.method){if(n)return!1}else if("after"==this.method)return!!t||(this.add(e),!1);return this.add(e)},add:function(e){return this._result.push(e),!0},getValue:function(){switch(this.method){case"all":case"between":return this._result;case"before":case"after":return this._result.length?this._result[this._result.length-1]:null}}};var A=function(e,t,n){var r=["all","between"];if(!h(r,e))throw new Error('Invalid method "'+e+'". Only all and between works with iterator.');this.add=function(e){return!!n(e,this._result.length)&&(this._result.push(e),!0)},this.init(e,t)};A.prototype=O.prototype,t&&(module.exports={RRule:D}),"undefined"==typeof ender&&(e.RRule=D),"function"==typeof define&&define.amd&&define("rrule",[],function(){return D})})(this);