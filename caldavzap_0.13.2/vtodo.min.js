function AppleSupportNextDateArray(){this.nextDates={},this.reset=function(){this.nextDates={}}}function addAndEditTODO(e){var a="";if(""!=$("#uidTODO").val())var l=globalResourceCalDAVList.getTodoCollectionByUID($("#uidTODO").val().substring(0,$("#uidTODO").val().lastIndexOf("/")+1));else var l=globalResourceCalDAVList.getTodoCollectionByUID($("#todo_calendar").val());var n=getAccount(l.accountUID),r=n.href.match(vCalendar.pre.hrefRex),t=r[1]+n.userAuth.userName+"@"+r[2];if(""!=$("#etagTODO").val())a=$("#uidTODO").val();else{if("choose"==$("#todo_calendar").val())return!1;a=$("#todo_calendar").val()+""}todoToVcalendar("EDIT",t,a,$("#etagTODO").val(),"",e)}function interResourceEditTODO(e,a){var l="";if(""!=$("#uidTODO").val())var n=globalResourceCalDAVList.getTodoCollectionByUID($("#uidTODO").val().substring(0,$("#uidTODO").val().lastIndexOf("/")+1));else var n=globalResourceCalDAVList.getTodoCollectionByUID($("#todo_calendar").val());var r=getAccount(n.accountUID),t=r.href.match(vCalendar.pre.hrefRex),s=t[1]+r.userAuth.userName+"@"+t[2];"MOVE_IN"!=e&&$("#etagTODO").val("");var p=$("#uidTODO").val().substring($("#uidTODO").val().lastIndexOf("/")+1,$("#uidTODO").val().length);l=$("#todo_calendar").val()+p,todoToVcalendar(e,s,l,"",a,!1)}function saveTodo(e){$("#todo_details_template").scrollTop(0);var a=$("#uidTODO").val().substring(0,$("#uidTODO").val().lastIndexOf("/")),l=$("#todo_calendar").val().substring(0,$("#todo_calendar").val().length-1);if($("#todo_details_template").find("img[data-type=invalidVerySmall],img[data-type=invalidSmall]").filter(function(){return"none"!=this.style.display}).length>0)return show_editor_loader_messageCalendar("vtodo","message_error",localization[globalInterfaceLanguage].txtErorInputTodo),!1;if("choose"!=$("#todo_calendar").val()){if(""==$("#nameTODO").val()&&$("#name").val(localization[globalInterfaceLanguage].pholderNewTODO),"start"==$("#todo_type").val()||"due"==$("#todo_type").val()||"both"==$("#todo_type").val()){if(""!=$("#date_toTODO").val()&&""!=$("#date_fromTODO").val()){var n=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_fromTODO").val()),r=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_toTODO").val()),t=$.fullCalendar.formatDate(n,"yyyy-MM-dd"),s=$.fullCalendar.formatDate(r,"yyyy-MM-dd"),p="00:00",c="00:00";if(""!=$("#time_fromTODO").val()&&""!=$("#time_toTODO").val()&&(p=new Date(Date.parse("01/02/1990, "+$("#time_fromTODO").val())),p=$.fullCalendar.formatDate(p,"HH:mm"),c=new Date(Date.parse("01/02/1990, "+$("#time_toTODO").val())),c=$.fullCalendar.formatDate(c,"HH:mm")),"both"==$("#todo_type").val()&&$.fullCalendar.parseDate(t+"T"+p+"Z")>$.fullCalendar.parseDate(s+"T"+c+"Z"))return show_editor_loader_messageCalendar("vtodo","message_error",localization[globalInterfaceLanguage].txtErrorDatesTodo),!1}if(""!=$("#date_toTODO").val()||""!=$("#date_fromTODO").val()){if(l==a||""==$("#etagTODO").val())addAndEditTODO(e);else if(""!=$("#etagTODO").val()){var d=$("#uidTODO").val();interResourceEditTODO("MOVE_OTHER",d)}}else show_editor_loader_messageCalendar("vtodo","message_error",localization[globalInterfaceLanguage].txtDateTimeErrorTodo)}else if(l==a||""==$("#etagTODO").val())addAndEditTODO(e);else if(""!=$("#etagTODO").val()){var d=$("#uidTODO").val();interResourceEditTODO("MOVE_OTHER",d)}}else show_editor_loader_messageCalendar("vtodo","message_error",localization[globalInterfaceLanguage].txtNotChooseTodo)}function deleteTodo(){var e=$("#uidTODO").val();""!=e&&deleteVcalendarFromCollection(e,"vtodo")}function getRepeatTodoObject(e){var a=!1,l=new Array,n="",r=!1,t="",s=e.vCalendarText,p="",c=jQuery.grep(globalEventList.displayTodosArray[e.rid],function(a){if(a.id==e.uidTodo&&(globalSettings.appleremindersmode.value||a.repeatCount<2||!a.repeatCount))return!0});globalSettings.appleremindersmode.value&&1==c.length&&(""==e.recurrenceId&&""==e.futureStart||(a=!0));for(var d=0;d<c.length;d++)if(l.indexOf(c[d].timeZone)==-1){if(!a&&e.deleteMode&&e.vcalendarHash==String(CryptoJS.SHA256(c[d].vcalendar)))continue;var o=buildTimezoneComponent(c[d].timeZone);""!=o&&e.vcalendarHash!=String(CryptoJS.SHA256(c[d].vcalendar))?(l[l.length]=c[d].timeZone,n+=o,n.lastIndexOf("\r\n")!=n.length-2&&(n+="\r\n"),r=!0):""!=o&&e.vcalendarHash==String(CryptoJS.SHA256(c[d].vcalendar))&&(t+=o)}r&&(s.lastIndexOf("\r\n")!=s.length-2&&(s+="\r\n"),s+=n);var i=s,v="",_="",m="",T=new Array;if(c.length>0){var u=e.uidTodo.substring(0,e.uidTodo.lastIndexOf("/")+1);for(u&&void 0!=globalEventList.todos[u][e.uidTodo].uid&&(m=globalEventList.todos[u][e.uidTodo].vcalendar);null!=m.match(vCalendar.pre.vtodo);){if("\r\n"==m.substring(m.indexOf("BEGIN:VTODO")-2,m.indexOf("BEGIN:VTODO"))){var g=m.substring(m.indexOf("BEGIN:VTODO")-2,m.indexOf("END:VTODO")+"END:VTODO".length);m=m.replace(g,"")}else{var g=m.substring(m.indexOf("BEGIN:VTODO"),m.indexOf("END:VTODO")+"END:VTODO".length);m=m.replace(g,""),g+="\r\n"}T[T.length]=g}}for(var C=s,O=!1,f=0;f<c.length;f++)if(T.splice(T.indexOf(c[f].vcalendar),1),""==e.futureStart&&e.vcalendarHash!=String(CryptoJS.SHA256(c[f].vcalendar))||c[f].rec_id!=e.recurrenceId){var D=c[f].vcalendar.match(vCalendar.pre.contentline_UID);if(null!=D&&(D=D[0].match(vCalendar.pre.contentline_parse)[4]),e.deleteMode&&e.vcalendarHash==String(CryptoJS.SHA256(c[f].vcalendar))||e.deleteMode&&!c[f].rec_id&&e.vcalendarUID==D||a){var E=c[f].vcalendar.match(vCalendar.pre.contentline_RRULE2);v=E;var V=c[f].start,M=vCalendar.tplC.VTcontentline_EXDATE;if(M=M.replace("##:::##group_wd##:::##",""),M=M.replace("##:::##params_wsc##:::##",""),V=e.recurrenceId.parseComnpactISO8601(),globalSettings.timezonesupport.value&&(p=e.timezoneTODO),"local"!=p){var h=getOffsetByTZ(p,V),A=h.getSecondsFromOffset()*-1;V=new Date(V.setSeconds(A))}else V=new Date(V.setSeconds(getLocalOffset(V)));V=$.fullCalendar.formatDate(V,"yyyyMMdd'T'HHmmss'Z'"),M=M.replace("##:::##AllDay##:::##",vcalendarEscapeValue("")),M=M.replace("##:::##TZID##:::##",""),M=M.replace("##:::##value##:::##",vcalendarEscapeValue(V)),c[f].finalString.length>2,c[f].vcalendar=c[f].vcalendar.replace(E,E+c[f].finalString.substring(2,c[f].finalString.length)),a||(c[f].vcalendar=c[f].vcalendar.replace(E,E+M))}else{var R=(c[f].vcalendar+"\r\n").match(vCalendar.pre.endVTODO);null!=R&&c[f].finalString.length>2&&(c[f].vcalendar=c[f].vcalendar.replace(R[0].substring(0,R[0].length-2),c[f].finalString+R[0].substring(2,R[0].length)))}var S=c[f].vcalendar;if(a&&"undefined"!=typeof globalAppleSupport.nextDates[c[f].id]){var b="",R="";null!=S.match(vCalendar.pre.contentline_DTSTART)&&null!=S.match(vCalendar.pre.contentline_DUE)&&(b=S.match(vCalendar.pre.contentline_DTSTART)[0].match(vCalendar.pre.contentline_parse)[4],R=S.match(vCalendar.pre.contentline_DUE)[0].match(vCalendar.pre.contentline_parse)[4]);var I=!1;globalSettings.timezonesupport.value&&(p=e.timezoneTODO),"UTC"==p&&(I=!0);var x=new Date(globalAppleSupport.nextDates[c[f].id].getTime()),h=getOffsetByTZ(p,x),A="";A="undefined"!=typeof globalSessionTimeZone&&null!=globalSessionTimeZone&&""!=globalSessionTimeZone?getOffsetByTZ(globalSessionTimeZone,x).getSecondsFromOffset():60*x.getTimezoneOffset()*-1,A=h.getSecondsFromOffset()-A,x.setSeconds(A);var w=$.fullCalendar.formatDate(x,"yyyyMMdd'T'HHmmss");c[f].vcalendar=c[f].vcalendar.replace(R,vcalendarEscapeValue(w+(I?"Z":""))),c[f].vcalendar=c[f].vcalendar.replace(b,vcalendarEscapeValue(w+(I?"Z":""))),""!=c[f].after&&(c[f].vcalendar=changeRuleForFuture(c[f],c[f].after)),S=c[f].vcalendar}s+=0==S.indexOf("\r\n")&&s.lastIndexOf("\r\n")==s.length-2?S.substring(2,S.length):0==S.indexOf("\r\n")&&s.lastIndexOf("\r\n")!=s.length-2||0!=S.indexOf("\r\n")&&s.lastIndexOf("\r\n")==s.length-2?S:"\r\n"+S}else if(""!=e.futureStart.split(";")[0]&&e.futureStart.split(";")[1]!=c[f].start&&e.futureStart.split(";")[1]!=c[f].end){var E=c[f].vcalendar.match(vCalendar.pre.contentline_RRULE2);c[f].finalString.length>2,c[f].vcalendar=c[f].vcalendar.replace(E,E+c[f].finalString.substring(2,c[f].finalString.length)),e.futureStart.split(";")[0]>1&&e.vcalendarHash==String(CryptoJS.SHA256(c[f].vcalendar))&&(c[f].vcalendar=changeRuleForFuture(c[f],e.futureStart.split(";")[0])),s+=0==c[f].vcalendar.indexOf("\r\n")&&s.lastIndexOf("\r\n")==s.length-2?c[f].vcalendar.substring(2,c[f].vcalendar.length):0==c[f].vcalendar.indexOf("\r\n")&&s.lastIndexOf("\r\n")!=s.length-2||0!=c[f].vcalendar.indexOf("\r\n")&&s.lastIndexOf("\r\n")==s.length-2?c[f].vcalendar:"\r\n"+c[f].vcalendar,O=!0}else if(!e.deleteMode||""==e.futureStart.split(";")[0]||e.futureStart.split(";")[1]!=c[f].start&&e.futureStart.split(";")[1]!=c[f].end)_=c[f];else{var E=c[f].vcalendar.match(vCalendar.pre.contentline_RRULE2);c[f].finalString.length>2,c[f].vcalendar=c[f].vcalendar.replace(E,E+c[f].finalString.substring(2,c[f].finalString.length)),e.vcalendarHash==String(CryptoJS.SHA256(c[f].vcalendar))&&(c[f].vcalendar=changeRuleForFuture(c[f],2)),s+=0==c[f].vcalendar.indexOf("\r\n")&&s.lastIndexOf("\r\n")==s.length-2?c[f].vcalendar.substring(2,c[f].vcalendar.length):0==c[f].vcalendar.indexOf("\r\n")&&s.lastIndexOf("\r\n")!=s.length-2||0!=c[f].vcalendar.indexOf("\r\n")&&s.lastIndexOf("\r\n")==s.length-2?c[f].vcalendar:"\r\n"+c[f].vcalendar}if(s=s.replace(_.vcalendar,""),!a)for(var y=0;y<T.length;y++)s+=0==T[y].indexOf("\r\n")&&s.lastIndexOf("\r\n")==s.length-2?T[y].substring(2,T[y].length):0==T[y].indexOf("\r\n")&&s.lastIndexOf("\r\n")!=s.length-2||0!=T[y].indexOf("\r\n")&&s.lastIndexOf("\r\n")==s.length-2?T[y]:"\r\n"+T[y];return{tzArray:l,tzString:n,isTimeZone:r,origTimezone:t,vCalendarText:s,realTodo:_,sel_option:p,futureMode:O,appleTodoMode:a,newFirst:i,beginVcalendar:C}}function todoToVcalendar(e,a,l,n,r,t){var s=!1,p="",c=0,d="form";if(""!=r)var o=r.substring(0,r.lastIndexOf("/")+1);else var o=l.substring(0,l.lastIndexOf("/")+1);null!=vCalendar.tplM.VTbegin[d]&&void 0!=(process_elem=vCalendar.tplM.VTbegin[d][0])?p+=vCalendar.tplM.VTbegin[d][0]:(process_elem=vCalendar.tplC.VTbegin,process_elem=process_elem.replace("##:::##group_wd##:::##",""),p+=process_elem),null!=vCalendar.tplM.VTcontentline_VERSION[d]&&void 0!=(process_elem=vCalendar.tplM.VTcontentline_VERSION[d][0])?(Ne=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2))):(process_elem=vCalendar.tplC.VTcontentline_VERSION,process_elem=process_elem.replace("##:::##group_wd##:::##","")),process_elem=process_elem.replace("##:::##version##:::##","2.0"),p+=process_elem,null!=vCalendar.tplM.VTcontentline_CALSCALE[d]&&void 0!=(process_elem=vCalendar.tplM.VTcontentline_CALSCALE[d][0])?(Ne=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2))):(process_elem=vCalendar.tplC.VTcontentline_CALSCALE,process_elem=process_elem.replace("##:::##group_wd##:::##","")),process_elem=process_elem.replace("##:::##calscale##:::##","GREGORIAN"),p+=process_elem;var i=getRepeatTodoObject({rid:o,uidTodo:$("#uidTODO").val(),vcalendarHash:$("#vcalendarHashTODO").val(),vcalendarUID:$("#vcalendarUIDTODO").val(),recurrenceId:$("#recurrenceIDTODO").val(),timezoneTODO:$("#timezoneTODO").val(),futureStart:$("#futureStartTODO").val(),deleteMode:t,vCalendarText:p});p=i.vCalendarText;var v=i.tzArray,_=(i.tzString,i.isTimeZone),m=i.origTimezone,T=i.appleTodoMode,u=i.realTodo,g=i.newFirst,C=i.sel_option,O="";if(t||i.futureMode){if(p.lastIndexOf("\r\n")!=p.length-2&&(p+="\r\n"),!_&&(T||i.futureMode&&""!=m)&&(p+=m,p.lastIndexOf("\r\n")!=p.length-2&&(p+="\r\n")),null!=vCalendar.tplM.VTcontentline_PRODID[d]&&void 0!=(process_elem=vCalendar.tplM.VTcontentline_PRODID[d][0])?(Ne=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2))):(process_elem=vCalendar.tplC.VTcontentline_PRODID,process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##","")),process_elem=process_elem.replace("##:::##value##:::##","-//Inf-IT//"+globalAppName+" "+globalVersion+"//EN"),p+=process_elem,"undefined"!=typeof vCalendar.tplM.VTunprocessed[d]&&""!=vCalendar.tplM.VTunprocessed[d]&&null!=vCalendar.tplM.VTunprocessed[d]&&(p+=vCalendar.tplM.VTunprocessed[d].replace(RegExp("^\r\n"),"")),vCalendar.tplM.VTunprocessed[d]=new Array,null!=vCalendar.tplM.VTend[d]&&void 0!=(process_elem=vCalendar.tplM.VTend[d][0])?p+=vCalendar.tplM.VTend[d][0]:(process_elem=vCalendar.tplC.VTend,process_elem=process_elem.replace("##:::##group_wd##:::##",""),p+=process_elem),t){var f=checkAndFixMultipleUID(p,!1),D=f[0];return f.splice(0,1),putVcalendarToCollection(a,l,n,D,r,"vtodo",!1,t,f)}i.futureMode&&(O=p,p=i.beginVcalendar)}var E="";"undefined"!=typeof globalSessionTimeZone&&globalSessionTimeZone&&(C=globalSessionTimeZone);var V=!1,M=p;T&&(p=""),"none"!=$("#todo_type").val()&&(globalSettings.timezonesupport.value&&(C=$("#timezoneTODO").val()),"UTC"==C?(V=!0,E=""):E="local"==C?"":"custom"==C?";"+vcalendarEscapeValue("TZID="+u.timeZone):";"+vcalendarEscapeValue("TZID="+C),p.lastIndexOf("\r\n")!=p.length-2&&(p+="\r\n"),globalSettings.rewritetimezonecomponent.value||!vCalendar.tplM.VTunprocessedVTIMEZONE[d]?v.indexOf(C)==-1&&(p+=buildTimezoneComponent(C)):p+=vCalendar.tplM.VTunprocessedVTIMEZONE[d]),M+=p,null!=vCalendar.tplM.VTbeginVTODO[d]&&void 0!=(process_elem=vCalendar.tplM.VTbeginVTODO[d][0])?p+=vCalendar.tplM.VTbeginVTODO[d][0]:(process_elem=vCalendar.tplC.VTbeginVTODO,process_elem=process_elem.replace("##:::##group_wd##:::##",""),p+=process_elem,s=!0);var h,A;h=new Date,A=h.getUTCFullYear()+(h.getUTCMonth()+1<10?"0":"")+(h.getUTCMonth()+1)+(h.getUTCDate()<10?"0":"")+h.getUTCDate()+"T"+(h.getUTCHours()<10?"0":"")+h.getUTCHours()+(h.getUTCMinutes()<10?"0":"")+h.getUTCMinutes()+(h.getUTCSeconds()<10?"0":"")+h.getUTCSeconds()+"Z";if(""==$("#recurrenceIDTODO").val())var R="orig";else var R=$("#recurrenceIDTODO").val();var S="";for(vev in vCalendar.tplM.VTcontentline_CREATED[d])vev==R&&(S=vCalendar.tplM.VTcontentline_CREATED[d][vev]);""!=S?(process_elem=S,Ne=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2))):(process_elem=vCalendar.tplC.VTcontentline_CREATED,process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##",""),process_elem=process_elem.replace("##:::##value##:::##",vcalendarEscapeValue(A))),p+=process_elem,null!=vCalendar.tplM.VTcontentline_LM[d]&&void 0!=(process_elem=vCalendar.tplM.VTcontentline_LM[d][0])?(Ne=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2))):(process_elem=vCalendar.tplC.VTcontentline_LM,process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##","")),process_elem=process_elem.replace("##:::##value##:::##",vcalendarEscapeValue(A)),p+=process_elem,null!=vCalendar.tplM.VTcontentline_DTSTAMP[d]&&void 0!=(process_elem=vCalendar.tplM.VTcontentline_DTSTAMP[d][0])?(Ne=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2))):(process_elem=vCalendar.tplC.VTcontentline_DTSTAMP,process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##","")),process_elem=process_elem.replace("##:::##value##:::##",vcalendarEscapeValue(A)),p+=process_elem,T||""!=$("#futureStartTODO").val()||"MOVE_IN"==e||"MOVE_OTHER"==e||null==vCalendar.tplM.VTcontentline_UID[d]||void 0==(process_elem=vCalendar.tplM.VTcontentline_UID[d][0])?(process_elem=vCalendar.tplC.VTcontentline_UID,process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##","")):(Ne=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2)));var b=globalEventList.getNewUID();if(process_elem=process_elem.replace("##:::##uid##:::##",b),p+=process_elem,null!=vCalendar.tplM.VTcontentline_SUMMARY[d]&&void 0!=(process_elem=vCalendar.tplM.VTcontentline_SUMMARY[d][0])?(Ne=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2))):(process_elem=vCalendar.tplC.VTcontentline_SUMMARY,process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##","")),""==$("#nameTODO").val()?process_elem=process_elem.replace("##:::##value##:::##",vcalendarEscapeValue("New TODO")):process_elem=process_elem.replace("##:::##value##:::##",vcalendarEscapeValue($("#nameTODO").val())),p+=process_elem,"NONE"!=$("#statusTODO").val()&&(null!=vCalendar.tplM.VTcontentline_STATUS[d]&&void 0!=(process_elem=vCalendar.tplM.VTcontentline_STATUS[d][0])?(Ne=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2))):(process_elem=vCalendar.tplC.VTcontentline_STATUS,process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##","")),process_elem=process_elem.replace("##:::##value##:::##",vcalendarEscapeValue($("#statusTODO").val())),p+=process_elem),""!=$("#percenteCompleteValue").val()&&(null!=vCalendar.tplM["VTcontentline_PERCENT-COMPLETE"][d]&&void 0!=(process_elem=vCalendar.tplM["VTcontentline_PERCENT-COMPLETE"][d][0])?(Ne=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2))):(process_elem=vCalendar.tplC["VTcontentline_PERCENT-COMPLETE"],process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##","")),process_elem=process_elem.replace("##:::##value##:::##",vcalendarEscapeValue($("#percenteCompleteValue").val())),p+=process_elem),"0"!=$("#priority_TODO").val()&&(null!=vCalendar.tplM.VTcontentline_PRIORITY[d]&&void 0!=(process_elem=vCalendar.tplM.VTcontentline_PRIORITY[d][0])?(Ne=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2))):(process_elem=vCalendar.tplC.VTcontentline_PRIORITY,process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##","")),process_elem=process_elem.replace("##:::##value##:::##",vcalendarEscapeValue($("#priority_TODO").val())),p+=process_elem),""!=$("#noteTODO").val()&&(null!=vCalendar.tplM.VTcontentline_NOTE[d]&&void 0!=(process_elem=vCalendar.tplM.VTcontentline_NOTE[d][0])?(Ne=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2))):(process_elem=vCalendar.tplC.VTcontentline_NOTE,process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##","")),process_elem=process_elem.replace("##:::##value##:::##",vcalendarEscapeValue($("#noteTODO").val())),p+=process_elem),""!=$("#typeTODO").val()&&(null!=vCalendar.tplM.VTcontentline_CLASS[d]&&void 0!=(process_elem=vCalendar.tplM.VTcontentline_CLASS[d][0])?(Ne=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2))):(process_elem=vCalendar.tplC.VTcontentline_CLASS,process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##",""),"undefined"!=typeof vCalendar.tplM.VTcontentline_CLASS[d]&&null!=vCalendar.tplM.VTcontentline_CLASS[d]&&0!=vCalendar.tplM.VTcontentline_CLASS[d].length||(process_elem="")),"none"!=$(".row_typeTODO").css("display")&&(process_elem=vCalendar.tplC.VTcontentline_CLASS,process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##",""),process_elem=process_elem.replace("##:::##value##:::##",vcalendarEscapeValue($("#typeTODO").val().toUpperCase()))),p+=process_elem),""!=$("#url_TODO").val()&&(null!=vCalendar.tplM.VTcontentline_URL[d]&&void 0!=(process_elem=vCalendar.tplM.VTcontentline_URL[d][0])?(Ne=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2))):(process_elem=vCalendar.tplC.VTcontentline_URL,process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##","")),process_elem=process_elem.replace("##:::##value##:::##",vcalendarEscapeValue($("#url_TODO").val())),p+=process_elem),null!=vCalendar.tplM.VTcontentline_LOCATION[d]&&void 0!=(process_elem=vCalendar.tplM.VTcontentline_LOCATION[d][0])?(Ne=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2))):(process_elem=vCalendar.tplC.VTcontentline_LOCATION,process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##","")),""!=$("#location_TODO").val()&&(process_elem=process_elem.replace("##:::##value##:::##",vcalendarEscapeValue($("#location_TODO").val())),p+=process_elem),"no-repeat"!=$("#repeat_TODO").val()){var I=$("#repeat_interval_detail_TODO").val(),x="",w=!1,y="",L="",N="";I=1==I||""==I?"":";INTERVAL="+$("#repeat_interval_detail_TODO").val();var U=$("#repeat_TODO").val();if("TWO_WEEKLY"==U)U="WEEKLY",I=";INTERVAL=2";else if("BUSINESS"==U){if(U="WEEKLY",x=";BYDAY=",globalSettings.weekenddays.value.length>0){for(var P=0;P<7;P++)globalSettings.weekenddays.value.indexOf(P)==-1&&(x+=P+",");x=x.substring(0,x.length-1),x=x.replace(1,"MO").replace(2,"TU").replace(3,"WE").replace(4,"TH").replace(5,"FR").replace(6,"SA").replace(0,"SU")}else x="SA,SU";I=""}else if("WEEKEND"==U){if(U="WEEKLY",x=";BYDAY=",globalSettings.weekenddays.value.length>0){for(var P=0;P<globalSettings.weekenddays.value.length;P++)x+=globalSettings.weekenddays.value[P]+",";x=x.substring(0,x.length-1),x=x.replace(1,"MO").replace(2,"TU").replace(3,"WE").replace(4,"TH").replace(5,"FR").replace(6,"SA").replace(0,"SU")}else x="SA,SU";I=""}else if("CUSTOM_WEEKLY"==U){U="WEEKLY";var H=$("#week_custom_TODO .customTable td.selected");if(H.length>0){x=";BYDAY=";for(var Z=0;Z<H.length;Z++)x+=$(H[Z]).attr("data-type")+",";x=x.substring(0,x.length-1),x=x.replace(1,"MO").replace(2,"TU").replace(3,"WE").replace(4,"TH").replace(5,"FR").replace(6,"SA").replace(0,"SU"),null!=globalSettings.mozillasupport.value&&globalSettings.mozillasupport.value||(""!=u?""!=u.wkst&&(N=";WKST="+u.wkst.replace(1,"MO").replace(2,"TU").replace(3,"WE").replace(4,"TH").replace(5,"FR").replace(6,"SA").replace(0,"SU")):N=";WKST="+globalSettings.datepickerfirstdayofweek.value.toString().replace(1,"MO").replace(2,"TU").replace(3,"WE").replace(4,"TH").replace(5,"FR").replace(6,"SA").replace(0,"SU"))}}else if("CUSTOM_MONTHLY"==U){U="MONTHLY";var Y="",k=$("#repeat_month_custom_select_TODO").val();if("custom"!=k&&"DAY"!=$("#repeat_month_custom_select2_TODO").val()){switch(""!=k&&(x=";BYDAY="),k){case"every":Y="";break;case"first":Y="1";break;case"second":Y="2";break;case"third":Y="3";break;case"fourth":Y="4";break;case"fifth":Y="5";break;case"last":Y="-1";break;default:Y=""}x+=Y+$("#repeat_month_custom_select2_TODO").val()}else if("custom"!=k&&"DAY"==$("#repeat_month_custom_select2_TODO").val())switch(x="",k){case"every":y=";BYMONTHDAY=";for(var B=1;B<32;B++)y+=B+",";y=y.substring(0,y.length-1);break;case"first":y=";BYMONTHDAY=1";break;case"second":y=";BYMONTHDAY=2";break;case"third":y=";BYMONTHDAY=3";break;case"fourth":y=";BYMONTHDAY=4";break;case"fifth":y=";BYMONTHDAY=5";break;case"last":y=";BYMONTHDAY=-1";break;default:Y="",y=""}else{var z=$("#month_custom2_TODO .selected");if(z.length>0){y=";BYMONTHDAY=";for(var Z=0;Z<z.length;Z++)y+=$(z[Z]).attr("data-type")+",";y=y.substring(0,y.length-1)}}}else if("CUSTOM_YEARLY"==U){U="YEARLY";var Y="",k=$("#repeat_year_custom_select1_TODO").val(),G=$("#year_custom3_TODO .selected");if(G.length>0){L=";BYMONTH=";for(var Z=0;Z<G.length;Z++){var F=parseInt($(G[Z]).attr("data-type"),10);isNaN(F)||(L+=F+1+",")}L=L.substring(0,L.length-1)}if("custom"!=k&&"DAY"!=$("#repeat_year_custom_select2_TODO").val()){switch(""!=k&&(x=";BYDAY="),k){case"every":Y="";break;case"first":Y="1";break;case"second":Y="2";break;case"third":Y="3";break;case"fourth":Y="4";break;case"fifth":Y="5";break;case"last":Y="-1";break;default:Y=""}x+=Y+$("#repeat_month_custom_select2_TODO").val()}else if("custom"!=k&&"DAY"==$("#repeat_year_custom_select2_TODO").val())switch(x="",k){case"every":y=";BYMONTHDAY=";for(var B=1;B<32;B++)y+=B+",";y=y.substring(0,y.length-1);break;case"first":y=";BYMONTHDAY=1";break;case"second":y=";BYMONTHDAY=2";break;case"third":y=";BYMONTHDAY=3";break;case"fourth":y=";BYMONTHDAY=4";break;case"fifth":y=";BYMONTHDAY=5";break;case"last":y=";BYMONTHDAY=-1";break;default:Y="",y=""}else{var z=$("#year_custom1_TODO .selected");if(z.length>0){y=";BYMONTHDAY=";for(var Z=0;Z<z.length;Z++)y+=$(z[Z]).attr("data-type")+",";y=y.substring(0,y.length-1)}}}else"custom_repeat"==$("#repeat_TODO option:selected").attr("data-type")&&(w=!0);if(null!=vCalendar.tplM.VTcontentline_RRULE[d]&&void 0!=(process_elem=vCalendar.tplM.VTcontentline_RRULE[d][0])?(Ne=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2))):(process_elem=vCalendar.tplC.VTcontentline_RRULE,process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##","")),w)process_elem=process_elem.replace("##:::##value##:::##",$("#repeat_TODO").val());else if("on_date"==$("#repeat_end_details_TODO").val()){var X=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#repeat_end_date_TODO").val()),W="";if("start"==$("#todo_type").val())var K=new Date(Date.parse("01/02/1990, "+$("#time_fromTODO").val()));else var K=new Date(Date.parse("01/02/1990, "+$("#time_toTODO").val()));if(X.setHours(K.getHours()),X.setMinutes(K.getMinutes()),X.setSeconds(K.getSeconds()),globalSettings.timezonesupport.value&&C in timezones)var Q=getOffsetByTZ(C,X);if(Q){var j=1e3*Q.getSecondsFromOffset()*-1;X.setTime(X.getTime()+j)}W=$.fullCalendar.formatDate(X,"yyyyMMdd'T'HHmmss'Z'"),process_elem=process_elem.replace("##:::##value##:::##",vcalendarEscapeValue("FREQ="+U)+I+";UNTIL="+W+L+y+x+N)}else"after"==$("#repeat_end_details_TODO").val()?process_elem=process_elem.replace("##:::##value##:::##",vcalendarEscapeValue("FREQ="+U)+I+";COUNT="+parseInt($("#repeat_end_after_TODO").val())+L+y+x+N):process_elem=process_elem.replace("##:::##value##:::##",vcalendarEscapeValue("FREQ="+U)+I+L+y+x+N);if(p+=process_elem,u.repeatStart||u.repeatEnd){if(u.repeatStart)var J=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_fromTODO").val());else var J=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_toTODO").val());if(u.repeatStart)var q=u.repeatStart;else var q=u.repeatEnd;var ee=new Date(1970,1,1,0,0,0);ee=u.repeatStart?new Date(Date.parse("01/02/1990, "+$("#time_fromTODO").val())):new Date(Date.parse("01/02/1990, "+$("#time_toTODO").val())),J.setHours(ee.getHours()),J.setMinutes(ee.getMinutes()),J.setSeconds(ee.getSeconds());var ae=J-q;for(var le in vCalendar.tplM.VTcontentline_EXDATE[d])if(!isNaN(le)){var ne=("\r\n"+vCalendar.tplM.VTcontentline_EXDATE[d][le]).match(vCalendar.pre.contentline_parse),re=ne[4].parseComnpactISO8601();if(re){if(ne[4].indexOf("T")==-1){if(u.repeatStart){new Date(Date.parse("01/02/1990, "+$("#time_fromTODO").val()))}else{new Date(Date.parse("01/02/1990, "+$("#time_toTODO").val()))}var te=$.fullCalendar.formatDate(ee,"HHmmss");if(re=(ne[4]+"T"+te).parseComnpactISO8601(),"local"!=C){var Q=getOffsetByTZ(C,re),j=Q.getSecondsFromOffset()*-1;re=new Date(re.setSeconds(j))}}else if(ne[4].indexOf("T")!=-1)if("local"!=C){var Q=getOffsetByTZ(C,re),se=getOffsetByTZ(u.timeZone,re),j=(Q.getSecondsFromOffset()-se.getSecondsFromOffset())*-1;re=new Date(re.setSeconds(j))}else{var se=getOffsetByTZ(u.timeZone,re);re=new Date(re.setSeconds(se.getSecondsFromOffset()))}var pe=new Date(re.getTime()+ae);process_elem=vCalendar.tplC.VTcontentline_EXDATE,process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##",""),Ce=$.fullCalendar.formatDate(pe,"yyyyMMdd'T'HHmmss")+("local"!=C?"Z":""),process_elem=process_elem.replace("##:::##AllDay##:::##",vcalendarEscapeValue("")),process_elem=process_elem.replace("##:::##TZID##:::##",vcalendarEscapeValue("")),process_elem=process_elem.replace("##:::##value##:::##",vcalendarEscapeValue(Ce)),p+=process_elem}}}}if($("#recurrenceIDTODO").val()&&!T){null!=vCalendar.tplM.VTcontentline_REC_ID[d]&&void 0!=(process_elem=vCalendar.tplM.VTcontentline_REC_ID[d][0])?(Ne=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2))):(process_elem=vCalendar.tplC.VTcontentline_REC_ID,process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##",""));var ce=$("#recurrenceIDTODO").val();ce.indexOf("T")==-1?(process_elem=process_elem.replace("##:::##AllDay##:::##",";"+vcalendarEscapeValue("VALUE=DATE")),process_elem=process_elem.replace("##:::##TZID##:::##",vcalendarEscapeValue("")),process_elem=process_elem.replace("##:::##value##:::##",vcalendarEscapeValue(ce))):(process_elem=process_elem.replace("##:::##AllDay##:::##",vcalendarEscapeValue("")),process_elem=process_elem.replace("##:::##TZID##:::##",E),V&&"Z"!=ce.charAt(ce.length-1)&&(ce+="Z"),process_elem=process_elem.replace("##:::##value##:::##",vcalendarEscapeValue(ce))),p+=process_elem}for(var J=$("#todoDetailsTable").find("tr[data-id]"),de=0,P=0;P<J[J.length-1].attributes.length;P++)if("data-id"==J[J.length-1].attributes[P].nodeName){de=J[J.length-1].attributes[P].value;break}for(var oe=new Array,ie=0;ie<de;ie++)if($(".alertTODO[data-id="+(ie+1)+"]").length>0){var ve="";if("none"!=$(".alertTODO[data-id="+(ie+1)+"]").val()){if(null!=vCalendar.tplM.VTbeginVALARM[d]&&void 0!=(process_elem=vCalendar.tplM.VTbeginVALARM[d][0])?ve+=vCalendar.tplM.VTbeginVALARM[d][0]:(process_elem=vCalendar.tplC.VTbeginVALARM,process_elem=process_elem.replace("##:::##group_wd##:::##",""),ve+=process_elem,vevent=!0),"message"==$(".alertTODO[data-id="+(ie+1)+"]").val()){if("on_date"==$(".alert_message_detailsTODO[data-id="+(ie+1)+"]").val()){
null!=vCalendar.tplM.VTcontentline_TRIGGER[d]&&void 0!=(process_elem=vCalendar.tplM.VTcontentline_TRIGGER[d][0])?(Ne=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2))):(process_elem=vCalendar.tplC.VTcontentline_TRIGGER,process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##",""));var _e=$.datepicker.parseDate(globalSettings.datepickerformat.value,$(".message_date_inputTODO[data-id="+(ie+1)+"]").val()),me=$.fullCalendar.formatDate(_e,"yyyy-MM-dd"),Te=new Date(Date.parse("01/02/1990, "+$(".message_time_inputTODO[data-id="+(ie+1)+"]").val())),ue=$.fullCalendar.formatDate(Te,"HH:mm:ss"),ge=$.fullCalendar.parseDate(me+"T"+ue);if(globalSettings.timezonesupport.value&&(C=$("#timezoneTODO").val()),"none"==$(".timezone_rowTODO").css("display")&&(C="local"),"local"!=C){var Q=getOffsetByTZ(C,ge),j=Q.getSecondsFromOffset()*-1;ge=new Date(ge.setSeconds(j))}else{var j=getLocalOffset(ge);ge=new Date(ge.setSeconds(j))}var Ce=$.fullCalendar.formatDate(ge,"yyyyMMdd'T'HHmmss")+"Z";process_elem=process_elem.replace("##:::##VALUE=DATE-TIME##:::##",";VALUE=DATE-TIME"),process_elem=process_elem.replace("##:::##VALUE=DURATION##:::##",""),process_elem=process_elem.replace("##:::##value##:::##",vcalendarEscapeValue(Ce)),ve+=process_elem}else{var Oe="",fe=$(".before_after_inputTODO[data-id="+(ie+1)+"]").val();"minutes_before"==$(".alert_message_detailsTODO[data-id="+(ie+1)+"]").val()&&(Oe="-PT"+fe+"M"),"hours_before"==$(".alert_message_detailsTODO[data-id="+(ie+1)+"]").val()&&(Oe="-PT"+fe+"H"),"days_before"==$(".alert_message_detailsTODO[data-id="+(ie+1)+"]").val()&&(Oe="-P"+fe+"D"),"weeks_before"==$(".alert_message_detailsTODO[data-id="+(ie+1)+"]").val()&&(Oe="-P"+fe+"W"),"seconds_before"==$(".alert_message_detailsTODO[data-id="+(ie+1)+"]").val()&&(Oe="-PT"+fe+"S"),"minutes_after"==$(".alert_message_detailsTODO[data-id="+(ie+1)+"]").val()&&(Oe="PT"+fe+"M"),"hours_after"==$(".alert_message_detailsTODO[data-id="+(ie+1)+"]").val()&&(Oe="PT"+fe+"H"),"days_after"==$(".alert_message_detailsTODO[data-id="+(ie+1)+"]").val()&&(Oe="P"+fe+"D"),"weeks_after"==$(".alert_message_detailsTODO[data-id="+(ie+1)+"]").val()&&(Oe="P"+fe+"W"),"seconds_after"==$(".alert_message_detailsTODO[data-id="+(ie+1)+"]").val()&&(Oe="PT"+fe+"S"),null!=vCalendar.tplM.VTcontentline_TRIGGER[d]&&void 0!=(process_elem=vCalendar.tplM.VTcontentline_TRIGGER[d][0])?(Ne=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2))):(process_elem=vCalendar.tplC.VTcontentline_TRIGGER,process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##","")),process_elem=process_elem.replace("##:::##VALUE=DATE-TIME##:::##",""),process_elem=process_elem.replace("##:::##VALUE=DURATION##:::##",";VALUE=DURATION"),process_elem=process_elem.replace("##:::##value##:::##",Oe),ve+=process_elem}null!=vCalendar.tplM.VTcontentline_ACTION[d]&&void 0!=(process_elem=vCalendar.tplM.VTcontentline_ACTION[d][0])?(Ne=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2))):(process_elem=vCalendar.tplC.VTcontentline_ACTION,process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##","")),process_elem=process_elem.replace("##:::##value##:::##",vcalendarEscapeValue("DISPLAY")),ve+=process_elem,null!=vCalendar.tplM.VTcontentline_DESCRIPTION&&void 0!=(process_elem=vCalendar.tplM.VTcontentline_DESCRIPTION[0])?(Ne=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2))):(process_elem=vCalendar.tplC.VTcontentline_DESCRIPTION,process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##","")),process_elem=process_elem.replace("##:::##value##:::##",vcalendarEscapeValue("Reminder")),ve+=process_elem}"undefined"!=typeof vCalendar.tplM.VTunprocessedVALARM[d]&&""!=vCalendar.tplM.VTunprocessedVALARM[d]&&null!=vCalendar.tplM.VTunprocessedVALARM[d]&&void 0!=vCalendar.tplM.VTunprocessedVALARM[d][ie]&&(tmp=vCalendar.tplM.VTunprocessedVALARM[d][ie].replace(RegExp("^\r\n"),"").replace(RegExp("\r\n$"),""),0==tmp.indexOf("\r\n")&&(tmp=tmp.substring(2,tmp.length)),tmp.lastIndexOf("\r\n")!=tmp.length-2&&(tmp+="\r\n"),ve+=tmp),null!=vCalendar.tplM.VTendVALARM[d]&&void 0!=(process_elem=vCalendar.tplM.VTendVALARM[d][0])?ve+=vCalendar.tplM.VTendVALARM[d][0]:(process_elem=vCalendar.tplC.VTendVALARM,process_elem=process_elem.replace("##:::##group_wd##:::##",""),ve+=process_elem),oe.indexOf(ve)==-1&&(oe.push(ve),p+=ve)}}if("start"==$("#todo_type").val()||"due"==$("#todo_type").val()||"both"==$("#todo_type").val()){if(""==$("#date_fromTODO").val()&&""==$("#date_toTODO").val())return alert("Not enough data!"),!1;if(("start"==$("#todo_type").val()||"both"==$("#todo_type").val()&&!T)&&""!=$("#date_fromTODO").val()){null!=vCalendar.tplM.VTcontentline_E_DTSTART[d]&&void 0!=(process_elem=vCalendar.tplM.VTcontentline_E_DTSTART[d][0])?(Ne=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2))):(process_elem=vCalendar.tplC.VTcontentline_E_DTSTART,process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##",""));var De=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_fromTODO").val()),Ee=$.fullCalendar.formatDate(De,"yyyyMMdd"),Ve=new Date(Date.parse("01/02/1990, "+$("#time_fromTODO").val())),te=(Ve.getHours()<10?"0"+Ve.getHours():Ve.getHours())+""+(Ve.getMinutes()<10?"0"+Ve.getMinutes():Ve.getMinutes())+"00";if(process_elem=process_elem.replace("##:::##AllDay##:::##",vcalendarEscapeValue("")),process_elem=process_elem.replace("##:::##TZID##:::##",E),process_elem=process_elem.replace("##:::##value##:::##",vcalendarEscapeValue(Ee+"T"+te+(V?"Z":""))),T){var Me="";null!=vCalendar.tplM.VTcontentline_DUE[d]&&void 0!=(Me=vCalendar.tplM.VTcontentline_DUE[d][0])?(Ne=("\r\n"+Me).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(Me=("\r\n"+Me).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2))):(Me=vCalendar.tplC.VTcontentline_DUE,Me=Me.replace("##:::##group_wd##:::##",""),Me=Me.replace("##:::##params_wsc##:::##","")),Me=Me.replace("##:::##AllDay##:::##",vcalendarEscapeValue("")),Me=Me.replace("##:::##TZID##:::##",E),Me=Me.replace("##:::##value##:::##",vcalendarEscapeValue(Ee+"T"+te+(V?"Z":""))),p+=Me}p+=process_elem}if(("due"==$("#todo_type").val()||"both"==$("#todo_type").val())&&""!=$("#date_toTODO").val()){null!=vCalendar.tplM.VTcontentline_DUE[d]&&void 0!=(process_elem=vCalendar.tplM.VTcontentline_DUE[d][0])?(Ne=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2))):(process_elem=vCalendar.tplC.VTcontentline_DUE,process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##",""));var _e=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_toTODO").val()),me=$.fullCalendar.formatDate(_e,"yyyyMMdd"),he=new Date(Date.parse("01/02/1990, "+$("#time_toTODO").val())),ue=(he.getHours()<10?"0"+he.getHours():he.getHours())+""+(he.getMinutes()<10?"0"+he.getMinutes():he.getMinutes())+"00";if(process_elem=process_elem.replace("##:::##AllDay##:::##",vcalendarEscapeValue("")),process_elem=process_elem.replace("##:::##TZID##:::##",E),process_elem=process_elem.replace("##:::##value##:::##",vcalendarEscapeValue(me+"T"+ue+(V?"Z":""))),globalSettings.appleremindersmode.value){var Me="";null!=vCalendar.tplM.VTcontentline_E_DTSTART[d]&&void 0!=(Me=vCalendar.tplM.VTcontentline_E_DTSTART[d][0])?(Ne=("\r\n"+Me).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(Me=("\r\n"+Me).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2))):(Me=vCalendar.tplC.VTcontentline_E_DTSTART,Me=Me.replace("##:::##group_wd##:::##",""),Me=Me.replace("##:::##params_wsc##:::##","")),Me=Me.replace("##:::##AllDay##:::##",vcalendarEscapeValue("")),Me=Me.replace("##:::##TZID##:::##",E),Me=Me.replace("##:::##value##:::##",vcalendarEscapeValue(me+"T"+ue+(V?"Z":""))),p+=Me}p+=process_elem}}if(""!=u&&""!=u.type){if(u.repeatStart)var J=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_fromTODO").val()),ee=new Date(Date.parse("01/02/1990, "+$("#time_fromTODO").val()));else if(u.repeatEnd)var J=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_toTODO").val()),ee=new Date(Date.parse("01/02/1990, "+$("#time_toTODO").val()));if(u.repeatStart)var q=u.repeatStart;else if(u.repeatEnd)var Ae=u.repeatEnd;J.setHours(ee.getHours()),J.setMinutes(ee.getMinutes()),J.setSeconds(ee.getSeconds());var Re=new Date(J.getTime()),ae=0;u.repeatStart?ae=Re-q:u.repeatEnd&&(ae=Re-Ae);var Se=u.vcalendar.match(vCalendar.pre.contentline_UID);if(null!=Se&&(Se=Se[0].match(vCalendar.pre.contentline_parse)[4]),0!=ae){for(var be=p,Ie=new Array,xe=new Array;null!=be.match(vCalendar.pre.vtodo);){if("\r\n"==be.substring(be.indexOf("BEGIN:VTODO")-2,be.indexOf("BEGIN:VTODO"))){var we=be.substring(be.indexOf("BEGIN:VTODO")-2,be.indexOf("END:VTODO")+"END:VTODO".length);be=be.replace(we,"")}else{var we=be.substring(be.indexOf("BEGIN:VTODO"),be.indexOf("END:VTODO")+"END:VTODO".length);be=be.replace(we,""),we+="\r\n"}Ie[Ie.length]=we,xe[xe.length]=we}0==Ie.length&&console.log("Error: '"+l+"': unable to parse vTodo");for(var ye=0;ye<Ie.length;ye++){var $e=Ie[ye].match(vCalendar.pre.contentline_UID);if(null==$e||$e[0].match(vCalendar.pre.contentline_parse)[4]==Se){var Le=Ie[ye].match(vCalendar.pre.contentline_RECURRENCE_ID);if(null!=Le){var Ne=Le[0].match(vCalendar.pre.contentline_parse);process_elem=vCalendar.tplC.VTcontentline_REC_ID,process_elem=process_elem.replace("##:::##group_wd##:::##",Ne[1]),process_elem=process_elem.replace("##:::##params_wsc##:::##","");var pe=Ne[4].parseComnpactISO8601();if(pe){pe=new Date(pe.getTime()+ae);var Ce=$.fullCalendar.formatDate(pe,"yyyyMMdd'T'HHmmss");V&&(Ce+="Z"),process_elem=process_elem.replace("##:::##AllDay##:::##",vcalendarEscapeValue("")),process_elem=process_elem.replace("##:::##TZID##:::##",E),process_elem=process_elem.replace("##:::##value##:::##",vcalendarEscapeValue(Ce)),Ie[ye]=Ie[ye].replace(Le[0],"\r\n"+process_elem)}}p=p.replace(xe[ye],Ie[ye])}}}}if("none"!=$(".completedOnTr").css("display")&&(null!=vCalendar.tplM.VTcontentline_COMPLETED[d]&&void 0!=(process_elem=vCalendar.tplM.VTcontentline_COMPLETED[d][0])?(Ne=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2))):(process_elem=vCalendar.tplC.VTcontentline_COMPLETED,process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##","")),""!=$(".completedOnTr .date").val()&&""!=$(".completedOnTr .time").val())){var Ue=$.datepicker.parseDate(globalSettings.datepickerformat.value,$(".completedOnTr .date").val()),Pe=new Date(Date.parse("01/02/1990, "+$("#completedOnTime").val())),He=$.fullCalendar.parseDate($.fullCalendar.formatDate(Ue,"yyyy'-'MM'-'dd")+"T"+$.fullCalendar.formatDate(Pe,"HH':'mm'-'ss"));if(globalSettings.timezonesupport.value&&(C=$("#timezoneTODO").val()),"none"==$(".timezone_rowTODO").css("display")&&(C="local"),"local"!=C){var Q=getOffsetByTZ(C,He),j=Q.getSecondsFromOffset()*-1;He=new Date(He.setSeconds(j))}var Ce=$.fullCalendar.formatDate(He,"yyyyMMdd'T'HHmmss")+"Z";process_elem=process_elem.replace("##:::##value##:::##",vcalendarEscapeValue(Ce)),p+=process_elem}if(T&&(g+=0==p.indexOf("\r\n")&&g.lastIndexOf("\r\n")==g.length-2?p.substring(2,p.length):0==p.indexOf("\r\n")&&g.lastIndexOf("\r\n")!=g.length-2||0!=p.indexOf("\r\n")&&g.lastIndexOf("\r\n")==g.length-2?p:"\r\n"+p),""==$("#recurrenceIDTODO").val())var R="orig";else var R=$("#recurrenceIDTODO").val();if("undefined"!=typeof vCalendar.tplM.VTunprocessedVTODO[d]&&null!=vCalendar.tplM.VTunprocessedVTODO[d])for(vev in vCalendar.tplM.VTunprocessedVTODO[d])vev==R&&(p+=vCalendar.tplM.VTunprocessedVTODO[d][vev].replace(RegExp("^\r\n"),""));T&&(p=""),null!=vCalendar.tplM.VTendVTODO[d]&&void 0!=(process_elem=vCalendar.tplM.VTendVTODO[d][0])?T?g+=vCalendar.tplM.VTendVTODO[d][0]:p+=vCalendar.tplM.VTendVTODO[d][0]:(process_elem=vCalendar.tplC.VTendVTODO,process_elem=process_elem.replace("##:::##group_wd##:::##",""),T?g+=process_elem:p+=process_elem),null!=vCalendar.tplM.VTcontentline_PRODID[d]&&void 0!=(process_elem=vCalendar.tplM.VTcontentline_PRODID[d][0])?(Ne=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Ne[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+Ne[1].replace(".","\\."),"mg"),"\r\nitem"+c++ +".").substring(2))):(process_elem=vCalendar.tplC.VTcontentline_PRODID,process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##","")),process_elem=process_elem.replace("##:::##value##:::##","-//Inf-IT//"+globalAppName+" "+globalVersion+"//EN"),p+=process_elem,"undefined"!=typeof vCalendar.tplM.VTunprocessed[d]&&""!=vCalendar.tplM.VTunprocessed[d]&&null!=vCalendar.tplM.VTunprocessed[d]&&(T?M+=vCalendar.tplM.VTunprocessed[d].replace(RegExp("^\r\n"),""):p+=vCalendar.tplM.VTunprocessed[d].replace(RegExp("^\r\n"),"")),vCalendar.tplM.VTunprocessed[d]=new Array,null!=vCalendar.tplM.VTend[d]&&void 0!=(process_elem=vCalendar.tplM.VTend[d][0])?p+=vCalendar.tplM.VTend[d][0]:(process_elem=vCalendar.tplC.VTend,process_elem=process_elem.replace("##:::##group_wd##:::##",""),p+=process_elem);var Ze=new Array;if(T){g+=p,M.lastIndexOf("\r\n")!=M.length-2&&(M+="\r\n"),M+=p;var Ye=checkAndFixMultipleUID(g,!1);1==Ye.length?Ze[Ze.length]=M:Ze=Ye,p=g}else if(i.futureMode&&""!=O){var Ye=checkAndFixMultipleUID(O,!1);1==Ye.length?Ze[Ze.length]=O:Ze=Ye}var f=checkAndFixMultipleUID(p,!1);f=$.merge(Ze,f);var D=f[0];return f.splice(0,1),"MOVE_IN"==e?moveVcalendarToCollection(a,l,n,D,r,"vtodo",!1,t,f):putVcalendarToCollection(a,l,n,D,r,"vtodo",!1,t,f)}function fullVcalendarToTodoData(e,a){var l="";if(a)var n="form";else var n=e.repeatHash;CalDAVeditor_cleanup(n);var r=e.id.substring(0,e.id.lastIndexOf("/")+1);if(r&&void 0!=globalEventList.todos[r][e.id].uid&&(l=globalEventList.todos[r][e.id].vcalendar),!l)return!1;var t=l.split("\r\n");if(null==(parsed=("\r\n"+t[0]+"\r\n").match(vCalendar.pre.contentline_parse)))return!1;if(vCalendar.tplM.VTbegin[n]=new Array,vCalendar.tplM.VTbegin[n][0]=vCalendar.tplC.VTbegin.replace(/##:::##group_wd##:::##/g,vcalendar_begin_group=parsed[1]),null==(parsed=("\r\n"+t[t.length-2]+"\r\n").match(vCalendar.pre.contentline_parse)))return!1;if(vCalendar.tplM.VTend[n]=new Array,vCalendar.tplM.VTend[n][0]=vCalendar.tplC.VTend.replace(/##:::##group_wd##:::##/g,vcalendar_end_group=parsed[1]),vcalendar_begin_group!=vcalendar_end_group)return!1;l="\r\n"+t.slice(1,t.length-2).join("\r\n")+"\r\n";for(var s=l.indexOf("BEGIN:VTIMEZONE"),p=l.indexOf("END:VTIMEZONE"),c=0,d="";s!=-1&&p!=-1;){for(V=p+2;V<l.length;V++)if("\n"==l.charAt(V)){c=V+1;break}d=l.substring(s,c),l=l.substring(0,s)+l.substring(c,l.length),s=l.indexOf("BEGIN:VTIMEZONE"),p=l.indexOf("END:VTIMEZONE")}if(vcalendar_element=l.match(vCalendar.pre.contentline_VERSION),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),version=vcalendarUnescapeValue(parsed[4]),vCalendar.tplM.VTcontentline_VERSION[n]=new Array,vCalendar.tplM.VTcontentline_VERSION[n][0]=vCalendar.tplC.VTcontentline_VERSION,vCalendar.tplM.VTcontentline_VERSION[n][0]=vCalendar.tplM.VTcontentline_VERSION[n][0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.VTcontentline_VERSION[n][0]=vCalendar.tplM.VTcontentline_VERSION[n][0].replace(/##:::##params_wsc##:::##/g,parsed[3]),l=l.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(var o=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=l.match(o));)vCalendar.tplM.VTcontentline_VERSION[n][0]+=vcalendar_element_related[0].substr(2),l=l.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=l.match(vCalendar.pre.contentline_CALSCALE),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),version=vcalendarUnescapeValue(parsed[4]),vCalendar.tplM.VTcontentline_CALSCALE[n]=new Array,vCalendar.tplM.VTcontentline_CALSCALE[n][0]=vCalendar.tplC.VTcontentline_CALSCALE,vCalendar.tplM.VTcontentline_CALSCALE[n][0]=vCalendar.tplM.VTcontentline_CALSCALE[n][0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.VTcontentline_CALSCALE[n][0]=vCalendar.tplM.VTcontentline_CALSCALE[n][0].replace(/##:::##params_wsc##:::##/g,parsed[3]),l=l.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(var o=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=l.match(o));)vCalendar.tplM.VTcontentline_CALSCALE[n][0]+=vcalendar_element_related[0].substr(2),l=l.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=l.match(RegExp("\r\n"+vCalendar.re.contentline_PRODID,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.VTcontentline_PRODID[n]=new Array,vCalendar.tplM.VTcontentline_PRODID[n][0]=vCalendar.tplC.VTcontentline_PRODID,vCalendar.tplM.VTcontentline_PRODID[n][0]=vCalendar.tplM.VTcontentline_PRODID[n][0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.VTcontentline_PRODID[n][0]=vCalendar.tplM.VTcontentline_PRODID[n][0].replace(/##:::##params_wsc##:::##/g,parsed[3]),l=l.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(var o=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=l.match(o));)vCalendar.tplM.VTcontentline_PRODID[n][0]+=vcalendar_element_related[0].substr(2),l=l.replace(vcalendar_element_related[0],"\r\n");for(var i=new Array;null!=l.match(vCalendar.pre.vtodo);){if("\r\n"==l.substring(l.indexOf("BEGIN:VTODO")-2,l.indexOf("BEGIN:VTODO"))){var v=l.substring(l.indexOf("BEGIN:VTODO")-2,l.indexOf("END:VTODO")+"END:VTODO".length);l=l.replace(v,"")}else{var v=l.substring(l.indexOf("BEGIN:VTODO"),l.indexOf("END:VTODO")+"END:VTODO".length);l=l.replace(v,""),v+="\r\n"}i[i.length]=v}0==i.length&&console.log("Error: '"+e.id+"': unable to parse vTodo");for(var _=0;_<i.length;_++){var m=i[_],T=m.split("\r\n"),u=!1;if(null==m)return!1;if(null==(parsed="\r\nBEGIN:VTODO\r\n".match(vCalendar.pre.contentline_parse)))return!1;if(vCalendar.tplM.VTbeginVTODO[n]=new Array,vCalendar.tplM.VTbeginVTODO[n][0]=vCalendar.tplC.VTbeginVTODO.replace(/##:::##group_wd##:::##/g,vcalendar_begin_group=parsed[1]),null==(parsed=("\r\n"+t[T.length-2]+"\r\n").match(vCalendar.pre.contentline_parse)))return!1;if(vCalendar.tplM.VTendVTODO[n]=new Array,vCalendar.tplM.VTendVTODO[n][0]=vCalendar.tplC.VTendVTODO.replace(/##:::##group_wd##:::##/g,vcalendar_end_group=parsed[1]),vcalendar_begin_group!=vcalendar_end_group)return!1;m="\r\n"+T.slice(2,T.length-1).join("\r\n")+"\r\n";var g="",C="",O="",f="";if(vcalendar_element=m.match(vCalendar.pre.contentline_RECURRENCE_ID),null!=vcalendar_element){parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse);var f=parsed[4];vCalendar.tplM.VTcontentline_REC_ID[n]=new Array,vCalendar.tplM.VTcontentline_REC_ID[n][0]=vCalendar.tplC.VTcontentline_REC_ID,vCalendar.tplM.VTcontentline_REC_ID[n][0]=vCalendar.tplM.VTcontentline_REC_ID[n][0].replace(/##:::##group_wd##:::##/g,parsed[1]);for(var D=vcalendarSplitParam(parsed[3]),E="",V=0;V<D.length;V++)"VALUE=DATE"!=D[V]&&D[V].indexOf("TZID=")==-1&&""!=D[V]&&(E+=";"+D[V]);if(vCalendar.tplM.VTcontentline_REC_ID[n][0]=vCalendar.tplM.VTcontentline_REC_ID[n][0].replace(/##:::##params_wsc##:::##/g,E),m=m.replace(vcalendar_element[0],"\r\n"),""!=parsed[1])for(var o=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=m.match(o));)vCalendar.tplM.VTcontentline_REC_ID[n][0]+=vcalendar_element_related[0].substr(2),m=m.replace(vcalendar_element_related[0],"\r\n")}if(""==f?f="orig":C=f,vcalendar_element=m.match(RegExp("\r\n"+vCalendar.re.contentline_CREATED,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.VTcontentline_CREATED[n]={},vCalendar.tplM.VTcontentline_CREATED[n][f]=vCalendar.tplC.VTcontentline_CREATED,vCalendar.tplM.VTcontentline_CREATED[n][f]=vCalendar.tplM.VTcontentline_CREATED[n][f].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.VTcontentline_CREATED[n][f]=vCalendar.tplM.VTcontentline_CREATED[n][f].replace(/##:::##params_wsc##:::##/g,parsed[3]),g=parsed[4],vCalendar.tplM.VTcontentline_CREATED[n][f]=vCalendar.tplM.VTcontentline_CREATED[n][f].replace(/##:::##value##:::##/g,parsed[4]),m=m.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(var o=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=m.match(o));)vCalendar.tplM.VTcontentline_CREATED[n][f]+=vcalendar_element_related[0].substr(2),m=m.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=m.match(vCalendar.pre.contentline_RRULE2),null!=vcalendar_element){parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.VTcontentline_RRULE[n]=new Array,vCalendar.tplM.VTcontentline_RRULE[n][0]=vCalendar.tplC.VTcontentline_RRULE,vCalendar.tplM.VTcontentline_RRULE[n][0]=vCalendar.tplM.VTcontentline_RRULE[n][0].replace(/##:::##group_wd##:::##/g,parsed[1]);for(var D=parsed[4].split(";"),E="",V=0;V<D.length;V++)D[V].indexOf("FREQ=")==-1&&D[V].indexOf("COUNT=")==-1&&D[V].indexOf("UNTIL=")==-1&&""!=D[V]&&D[V].indexOf("INTERVAL=")==-1&&D[V].indexOf("BYDAY=")==-1&&D[V].indexOf("BYMONTHDAY=")==-1&&D[V].indexOf("BYMONTH=")==-1&&D[V].indexOf("WKST=")==-1&&(E+=";"+D[V]),D[V].indexOf("FREQ=")!=-1&&(O=D[V].split("FREQ=")[1]);if(vCalendar.tplM.VTcontentline_RRULE[n][0]=vCalendar.tplM.VTcontentline_RRULE[n][0].replace(/##:::##params_wsc##:::##/g,parsed[3]),vCalendar.tplM.VTcontentline_RRULE[n][0]=vCalendar.tplM.VTcontentline_RRULE[n][0].replace(/##:::##value##:::##/g,"##:::##value##:::##"+E),m=m.replace(vcalendar_element[0],"\r\n"),""!=parsed[1])for(var o=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=m.match(o));)vCalendar.tplM.VTcontentline_RRULE[n][0]+=vcalendar_element_related[0].substr(2),m=m.replace(vcalendar_element_related[0],"\r\n")}var M="";if(M=""!=O?e.id+"#"+g+"#"+O:e.id+"#"+g+"#"+C,M==n&&(u=!0),vcalendar_element=m.match(vCalendar.pre.contentline_SUMMARY),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),title=vcalendarUnescapeValue(parsed[4]),vCalendar.tplM.VTcontentline_SUMMARY[n]=new Array,vCalendar.tplM.VTcontentline_SUMMARY[n][0]=vCalendar.tplC.VTcontentline_SUMMARY,vCalendar.tplM.VTcontentline_SUMMARY[n][0]=vCalendar.tplM.VTcontentline_SUMMARY[n][0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.VTcontentline_SUMMARY[n][0]=vCalendar.tplM.VTcontentline_SUMMARY[n][0].replace(/##:::##params_wsc##:::##/g,parsed[3]),m=m.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(var o=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=m.match(o));)vCalendar.tplM.VTcontentline_SUMMARY[n][0]+=vcalendar_element_related[0].substr(2),m=m.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=m.match(RegExp("\r\n"+vCalendar.re.contentline_TRANSP,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.VTcontentline_TRANSP[n]=new Array,vCalendar.tplM.VTcontentline_TRANSP[n][0]=vCalendar.tplC.VTcontentline_TRANSP,vCalendar.tplM.VTcontentline_TRANSP[n][0]=vCalendar.tplM.VTcontentline_TRANSP[n][0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.VTcontentline_TRANSP[n][0]=vCalendar.tplM.VTcontentline_TRANSP[n][0].replace(/##:::##params_wsc##:::##/g,parsed[3]),m=m.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(var o=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=m.match(o));)vCalendar.tplM.VTcontentline_TRANSP[n][0]+=vcalendar_element_related[0].substr(2),m=m.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=m.match(vCalendar.pre.contentline_STATUS),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),title=vcalendarUnescapeValue(parsed[4]),vCalendar.tplM.VTcontentline_STATUS[n]=new Array,vCalendar.tplM.VTcontentline_STATUS[n][0]=vCalendar.tplC.VTcontentline_STATUS,vCalendar.tplM.VTcontentline_STATUS[n][0]=vCalendar.tplM.VTcontentline_STATUS[n][0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.VTcontentline_STATUS[n][0]=vCalendar.tplM.VTcontentline_STATUS[n][0].replace(/##:::##params_wsc##:::##/g,parsed[3]),m=m.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(var o=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=m.match(o));)vCalendar.tplM.VTcontentline_STATUS[n][0]+=vcalendar_element_related[0].substr(2),m=m.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=m.match(RegExp("\r\n"+vCalendar.re.contentline_LOCATION,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),title=vcalendarUnescapeValue(parsed[4]),vCalendar.tplM.VTcontentline_LOCATION[n]=new Array,vCalendar.tplM.VTcontentline_LOCATION[n][0]=vCalendar.tplC.VTcontentline_LOCATION,vCalendar.tplM.VTcontentline_LOCATION[n][0]=vCalendar.tplM.VTcontentline_LOCATION[n][0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.VTcontentline_LOCATION[n][0]=vCalendar.tplM.VTcontentline_LOCATION[n][0].replace(/##:::##params_wsc##:::##/g,parsed[3]),m=m.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(var o=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=m.match(o));)vCalendar.tplM.VTcontentline_LOCATION[n][0]+=vcalendar_element_related[0].substr(2),m=m.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=m.match(RegExp("\r\n"+vCalendar.re.contentline_URL,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),title=vcalendarUnescapeValue(parsed[4]),vCalendar.tplM.VTcontentline_URL[n]=new Array,vCalendar.tplM.VTcontentline_URL[n][0]=vCalendar.tplC.VTcontentline_URL,vCalendar.tplM.VTcontentline_URL[n][0]=vCalendar.tplM.VTcontentline_URL[n][0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.VTcontentline_URL[n][0]=vCalendar.tplM.VTcontentline_URL[n][0].replace(/##:::##params_wsc##:::##/g,parsed[3]),m=m.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(var o=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=m.match(o));)vCalendar.tplM.VTcontentline_URL[n][0]+=vcalendar_element_related[0].substr(2),m=m.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=m.match(vCalendar.pre["contentline_PERCENT-COMPLETE"]),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),title=vcalendarUnescapeValue(parsed[4]),vCalendar.tplM["VTcontentline_PERCENT-COMPLETE"][n]=new Array,vCalendar.tplM["VTcontentline_PERCENT-COMPLETE"][n][0]=vCalendar.tplC["VTcontentline_PERCENT-COMPLETE"],vCalendar.tplM["VTcontentline_PERCENT-COMPLETE"][n][0]=vCalendar.tplM["VTcontentline_PERCENT-COMPLETE"][n][0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM["VTcontentline_PERCENT-COMPLETE"][n][0]=vCalendar.tplM["VTcontentline_PERCENT-COMPLETE"][n][0].replace(/##:::##params_wsc##:::##/g,parsed[3]),m=m.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(var o=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=m.match(o));)vCalendar.tplM["VTcontentline_PERCENT-COMPLETE"][n][0]+=vcalendar_element_related[0].substr(2),m=m.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=m.match(vCalendar.pre.contentline_PRIORITY),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),title=vcalendarUnescapeValue(parsed[4]),vCalendar.tplM.VTcontentline_PRIORITY[n]=new Array,vCalendar.tplM.VTcontentline_PRIORITY[n][0]=vCalendar.tplC.VTcontentline_PRIORITY,vCalendar.tplM.VTcontentline_PRIORITY[n][0]=vCalendar.tplM.VTcontentline_PRIORITY[n][0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.VTcontentline_PRIORITY[n][0]=vCalendar.tplM.VTcontentline_PRIORITY[n][0].replace(/##:::##params_wsc##:::##/g,parsed[3]),m=m.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(var o=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=m.match(o));)vCalendar.tplM.VTcontentline_PRIORITY[n][0]+=vcalendar_element_related[0].substr(2),m=m.replace(vcalendar_element_related[0],"\r\n");var h=m.match(vCalendar.pre.valarm);if(null!=h){m=m.replace(h[0],""),vCalendar.tplM.VTalarm_STRING[n]="";for(var A="",R=new Array,V=0;V<h[0].length;V++)"END:VALARM"==h[0].substring(V-"END:VALARM".length,V)&&(R[R.length]=A+"\r\n",u&&(vCalendar.tplM.VTalarm_STRING[n]+=A+"\r\n"),A=""),A+=h[0][V];for(var S=0;S<R.length;S++)if(checkA=R[S].match(vCalendar.re.valarm),null!=checkA){var b=checkA[0].split("\r\n");if(null==(parsed=("\r\n"+b[0]+"\r\n").match(vCalendar.pre.contentline_parse)))return!1;if(vCalendar.tplM.VTbeginVALARM[n]=new Array,vCalendar.tplM.VTbeginVALARM[n][S]=vCalendar.tplC.VTbeginVALARM.replace(/##:::##group_wd##:::##/g,vcalendar_begin_group=parsed[1]),null==(parsed=("\r\n"+b[b.length-2]+"\r\n").match(vCalendar.pre.contentline_parse)))return!1;if(vCalendar.tplM.VTendVALARM[n]=new Array,vCalendar.tplM.VTendVALARM[n][S]=vCalendar.tplC.VTendVALARM.replace(/##:::##group_wd##:::##/g,vcalendar_end_group=parsed[1]),vcalendar_begin_group!=vcalendar_end_group)return!1;if(R[S]="\r\n"+b.slice(1,b.length-2).join("\r\n")+"\r\n",trigger=R[S].match(vCalendar.pre.contentline_TRIGGER),null!=trigger){parsed=(trigger[0]+"\r\n").match(vCalendar.pre.contentline_parse),vCalendar.tplM.VTcontentline_TRIGGER[n]=new Array,vCalendar.tplM.VTcontentline_TRIGGER[n][S]=vCalendar.tplC.VTcontentline_TRIGGER,vCalendar.tplM.VTcontentline_TRIGGER[n][S]=vCalendar.tplM.VTcontentline_TRIGGER[n][S].replace(/##:::##group_wd##:::##/g,parsed[1]);for(var D=vcalendarSplitParam(parsed[3]),E="",V=0;V<D.length;V++)"VALUE=DATE-TIME"!=D[V]&&"VALUE=DURATION"!=D[V]&&""!=D[V]&&(E+=";"+D[V]);if(vCalendar.tplM.VTcontentline_TRIGGER[n][S]=vCalendar.tplM.VTcontentline_TRIGGER[n][S].replace(/##:::##params_wsc##:::##/g,E),R[S]=R[S].replace(trigger[0],"\r\n"),""!=parsed[1])for(var o=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=m.match(o));)vCalendar.tplM.VTcontentline_TRIGGER[n][S]+=vcalendar_element_related[0].substr(2),m=m.replace(vcalendar_element_related[0],"\r\n")}if(note=R[S].match(vCalendar.pre.contentline_NOTE),null!=note&&(parsed=note[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.VTcontentline_VANOTE[n]=new Array,vCalendar.tplM.VTcontentline_VANOTE[n][S]=vCalendar.tplC.VTcontentline_VANOTE,vCalendar.tplM.VTcontentline_VANOTE[n][S]=vCalendar.tplM.VTcontentline_VANOTE[n][S].replace(/##:::##group_wd##:::##/g,parsed[1]),
vCalendar.tplM.VTcontentline_VANOTE[n][S]=vCalendar.tplM.VTcontentline_VANOTE[n][S].replace(/##:::##params_wsc##:::##/g,parsed[3]),R[S]=R[S].replace(note[0],"\r\n"),""!=parsed[1]))for(var o=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=m.match(o));)vCalendar.tplM.VTcontentline_VANOTE[n][S]+=vcalendar_element_related[0].substr(2),m=m.replace(vcalendar_element_related[0],"\r\n");if(action=R[S].match(vCalendar.pre.contentline_ACTION),null!=action&&(parsed=action[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.VTcontentline_ACTION[n]=new Array,vCalendar.tplM.VTcontentline_ACTION[n][S]=vCalendar.tplC.VTcontentline_ACTION,vCalendar.tplM.VTcontentline_ACTION[n][S]=vCalendar.tplM.VTcontentline_ACTION[n][S].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.VTcontentline_ACTION[n][S]=vCalendar.tplM.VTcontentline_ACTION[n][S].replace(/##:::##params_wsc##:::##/g,parsed[3]),R[S]=R[S].replace(action[0],"\r\n"),""!=parsed[1]))for(var o=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=m.match(o));)vCalendar.tplM.VTcontentline_ACTION[n][S]+=vcalendar_element_related[0].substr(2),m=m.replace(vcalendar_element_related[0],"\r\n");var I=$.trim(R[S]);vCalendar.tplM.VTunprocessedVALARM[n]=new Array,""!=I&&(vCalendar.tplM.VTunprocessedVALARM[n][S]=R[S])}}if(vcalendar_element=m.match(vCalendar.pre.contentline_NOTE),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.VTcontentline_NOTE[n]=new Array,vCalendar.tplM.VTcontentline_NOTE[n][0]=vCalendar.tplC.VTcontentline_NOTE,vCalendar.tplM.VTcontentline_NOTE[n][0]=vCalendar.tplM.VTcontentline_NOTE[n][0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.VTcontentline_NOTE[n][0]=vCalendar.tplM.VTcontentline_NOTE[n][0].replace(/##:::##params_wsc##:::##/g,parsed[3]),m=m.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(var o=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=m.match(o));)vCalendar.tplM.VTcontentline_NOTE[n][0]+=vcalendar_element_related[0].substr(2),m=m.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=m.match(vCalendar.pre.contentline_CLASS),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.VTcontentline_CLASS[n]=new Array,vCalendar.tplM.VTcontentline_CLASS[n][0]=vCalendar.tplC.VTcontentline_CLASS,vCalendar.tplM.VTcontentline_CLASS[n][0]=vCalendar.tplM.VTcontentline_CLASS[n][0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.VTcontentline_CLASS[n][0]=vCalendar.tplM.VTcontentline_CLASS[n][0].replace(/##:::##params_wsc##:::##/g,parsed[3]),vCalendar.tplM.VTcontentline_CLASS[n][0]=vCalendar.tplM.VTcontentline_CLASS[n][0].replace(/##:::##value##:::##/g,parsed[4]),m=m.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(var o=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=m.match(o));)vCalendar.tplM.VTcontentline_CLASS[n][0]+=vcalendar_element_related[0].substr(2),m=m.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=m.match(vCalendar.pre.contentline_DUE),null!=vcalendar_element){parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.VTcontentline_DUE[n]=new Array,vCalendar.tplM.VTcontentline_DUE[n][0]=vCalendar.tplC.VTcontentline_DUE,vCalendar.tplM.VTcontentline_DUE[n][0]=vCalendar.tplM.VTcontentline_DUE[n][0].replace(/##:::##group_wd##:::##/g,parsed[1]);for(var D=vcalendarSplitParam(parsed[3]),E="",V=0;V<D.length;V++)"VALUE=DATE"!=D[V]&&D[V].indexOf("TZID=")==-1&&""!=D[V]&&(E+=";"+D[V]);if(vCalendar.tplM.VTcontentline_DUE[n][0]=vCalendar.tplM.VTcontentline_DUE[n][0].replace(/##:::##params_wsc##:::##/g,E),m=m.replace(vcalendar_element[0],"\r\n"),""!=parsed[1])for(var o=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=m.match(o));)vCalendar.tplM.VTcontentline_DUE[n][0]+=vcalendar_element_related[0].substr(2),m=m.replace(vcalendar_element_related[0],"\r\n")}if(vcalendar_element=m.match(vCalendar.pre.contentline_DTSTART),null!=vcalendar_element){parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.VTcontentline_E_DTSTART[n]=new Array,vCalendar.tplM.VTcontentline_E_DTSTART[n][0]=vCalendar.tplC.VTcontentline_E_DTSTART,vCalendar.tplM.VTcontentline_E_DTSTART[n][0]=vCalendar.tplM.VTcontentline_E_DTSTART[n][0].replace(/##:::##group_wd##:::##/g,parsed[1]);for(var D=vcalendarSplitParam(parsed[3]),E="",V=0;V<D.length;V++)"VALUE=DATE"!=D[V]&&D[V].indexOf("TZID=")==-1&&""!=D[V]&&(E+=";"+D[V]);if(vCalendar.tplM.VTcontentline_E_DTSTART[n][0]=vCalendar.tplM.VTcontentline_E_DTSTART[n][0].replace(/##:::##params_wsc##:::##/g,E),m=m.replace(vcalendar_element[0],"\r\n"),""!=parsed[1])for(var o=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=m.match(o));)vCalendar.tplM.VTcontentline_E_DTSTART[n][0]+=vcalendar_element_related[0].substr(2),m=m.replace(vcalendar_element_related[0],"\r\n")}if(vcalendar_element=m.match(RegExp("\r\n"+vCalendar.re.contentline_UID,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.VTcontentline_UID[n]=new Array,vCalendar.tplM.VTcontentline_UID[n][0]=vCalendar.tplC.VTcontentline_UID,vCalendar.tplM.VTcontentline_UID[n][0]=vCalendar.tplM.VTcontentline_UID[n][0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.VTcontentline_UID[n][0]=vCalendar.tplM.VTcontentline_UID[n][0].replace(/##:::##params_wsc##:::##/g,parsed[3]),vCalendar.tplM.VTcontentline_UID[n][0]=vCalendar.tplM.VTcontentline_UID[n][0].replace(/##:::##uid##:::##/g,parsed[4]),m=m.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(var o=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=m.match(o));)vCalendar.tplM.VTcontentline_UID[n][0]+=vcalendar_element_related[0].substr(2),m=m.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=m.match(RegExp("\r\n"+vCalendar.re.contentline_LM,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.VTcontentline_LM[n]=new Array,vCalendar.tplM.VTcontentline_LM[n][0]=vCalendar.tplC.VTcontentline_LM,vCalendar.tplM.VTcontentline_LM[n][0]=vCalendar.tplM.VTcontentline_LM[n][0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.VTcontentline_LM[n][0]=vCalendar.tplM.VTcontentline_LM[n][0].replace(/##:::##params_wsc##:::##/g,parsed[3]),m=m.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(var o=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=m.match(o));)vCalendar.tplM.VTcontentline_LM[n][0]+=vcalendar_element_related[0].substr(2),m=m.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=m.match(RegExp("\r\n"+vCalendar.re.contentline_DTSTAMP,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.VTcontentline_DTSTAMP[n]=new Array,vCalendar.tplM.VTcontentline_DTSTAMP[n][0]=vCalendar.tplC.VTcontentline_DTSTAMP,vCalendar.tplM.VTcontentline_DTSTAMP[n][0]=vCalendar.tplM.VTcontentline_DTSTAMP[n][0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.VTcontentline_DTSTAMP[n][0]=vCalendar.tplM.VTcontentline_DTSTAMP[n][0].replace(/##:::##params_wsc##:::##/g,parsed[3]),m=m.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(var o=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=m.match(o));)vCalendar.tplM.VTcontentline_DTSTAMP[n][0]+=vcalendar_element_related[0].substr(2),m=m.replace(vcalendar_element_related[0],"\r\n");for(var V=-1;null!=m.match(vCalendar.pre.contentline_EXDATE);)if(V++,vcalendar_element=m.match(vCalendar.pre.contentline_EXDATE),null!=vcalendar_element){parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.VTcontentline_EXDATE[n]=new Array,vCalendar.tplM.VTcontentline_EXDATE[n][V]=vCalendar.tplC.VTcontentline_EXDATE,vCalendar.tplM.VTcontentline_EXDATE[n][V]=vCalendar.tplM.VTcontentline_EXDATE[n][V].replace(/##:::##group_wd##:::##/g,parsed[1]);for(var D=vcalendarSplitParam(parsed[3]),E="",x="",S=0;S<D.length;S++)"VALUE=DATE"!=D[S]&&""!=D[S]&&(E+=";"+D[S]),"VALUE=DATE"==D[S]&&(x=D[S]);if(x.indexOf("VALUE=DATE")!=-1?vCalendar.tplM.VTcontentline_EXDATE[n][V]=vCalendar.tplM.VTcontentline_EXDATE[n][V].replace(/##:::##AllDay##:::##/g,";VALUE=DATE"):vCalendar.tplM.VTcontentline_EXDATE[n][V]=vCalendar.tplM.VTcontentline_EXDATE[n][V].replace(/##:::##AllDay##:::##/g,""),vCalendar.tplM.VTcontentline_EXDATE[n][V]=vCalendar.tplM.VTcontentline_EXDATE[n][V].replace(/##:::##TZID##:::##/g,""),vCalendar.tplM.VTcontentline_EXDATE[n][V]=vCalendar.tplM.VTcontentline_EXDATE[n][V].replace(/##:::##params_wsc##:::##/g,E),vCalendar.tplM.VTcontentline_EXDATE[n][V]=vCalendar.tplM.VTcontentline_EXDATE[n][V].replace(/##:::##value##:::##/g,parsed[4]),m=m.replace(vcalendar_element[0],"\r\n"),""!=parsed[1])for(var o=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=m.match(o));)vCalendar.tplM.VTcontentline_EXDATE[n][V]+=vcalendar_element_related[0].substr(2),m=m.replace(vcalendar_element_related[0],"\r\n")}if(vcalendar_element=m.match(RegExp("\r\n"+vCalendar.re.contentline_COMPLETED,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.VTcontentline_COMPLETED[n]={},vCalendar.tplM.VTcontentline_COMPLETED[n][f]=vCalendar.tplC.VTcontentline_COMPLETED,vCalendar.tplM.VTcontentline_COMPLETED[n][f]=vCalendar.tplM.VTcontentline_COMPLETED[n][f].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.VTcontentline_COMPLETED[n][f]=vCalendar.tplM.VTcontentline_COMPLETED[n][f].replace(/##:::##params_wsc##:::##/g,parsed[3]),m=m.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(var o=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=m.match(o));)vCalendar.tplM.VTcontentline_COMPLETED[n][f]+=vcalendar_element_related[0].substr(2),m=m.replace(vcalendar_element_related[0],"\r\n");0==l.indexOf("\r\n")&&(l=l.substring(2,l.length-2)),l.lastIndexOf("\r\n")!=l.length-2&&(l+="\r\n"),vCalendar.tplM.VTunprocessedVTODO[n]={},vCalendar.tplM.VTunprocessedVTODO[n][f]=m,u=!1}0==l.indexOf("\r\n")&&(l=l.substring(2,l.length-2)),l.lastIndexOf("\r\n")!=l.length-2&&(l+="\r\n"),vCalendar.tplM.VTunprocessedVTIMEZONE[n]=d,vCalendar.tplM.VTunprocessed[n]=l}function vcalendarTodoData(e,a,l){var n=a.vcalendar,r=new Array,t=new Array;if(null==(check=a.vcalendar.match(vCalendar.pre.vtodo)))return console.log("Error: '"+a.uid+"': unable to parse vTodo"),!1;var s=n.match(vCalendar.pre.contentline_CALSCALE);if(null!=s){var p=s[0].match(vCalendar.pre.contentline_parse)[4];if("GREGORIAN"!=p)return console.log("Error:'"+a.uid+"': Unsupported calscale in:"+n),!1}var c=n.match(vCalendar.pre.contentline_VERSION);if(null!=c){var d=c[0].match(vCalendar.pre.contentline_parse)[4];if("2.0"!=d)return console.log("Error:'"+a.uid+"': Unsupported version ("+d+") in:"+n),!1}for(var o=n.indexOf("BEGIN:VTIMEZONE"),i=n.indexOf("END:VTIMEZONE"),v=0;n.indexOf("BEGIN:VTIMEZONE")!=-1;)if(o!=-1&&i!=-1){for(oe=i+2;oe<n.length;oe++)if("\n"==n.charAt(oe)){v=oe+1;break}vTimeZone=n.substring(o,v),n=n.substring(0,o)+n.substring(v,n.length)}for(var _=a.uid.substring(0,a.uid.lastIndexOf("/")+1),m=(a.uid.substring(a.uid.lastIndexOf("/")+1,a.uid.length),new Array);null!=n.match(vCalendar.pre.vtodo);){if("\r\n"==n.substring(n.indexOf("BEGIN:VTODO")-2,n.indexOf("BEGIN:VTODO"))){var T=n.substring(n.indexOf("BEGIN:VTODO")-2,n.indexOf("END:VTODO")+"END:VTODO".length);n=n.replace(T,"")}else{var T=n.substring(n.indexOf("BEGIN:VTODO"),n.indexOf("END:VTODO")+"END:VTODO".length);n=n.replace(T,""),T+="\r\n"}var u=T.match(vCalendar.pre.contentline_RECURRENCE_ID),g=T.match(vCalendar.pre.contentline_UID);null!=g&&null!=u&&(m[m.length]=u[0].match(vCalendar.pre.contentline_parse)[4]+";"+g[0].match(vCalendar.pre.contentline_parse)[4]),r[r.length]=T}if(0==r.length)return!1;for(var C=!1,O=0;O<r.length;O++){var f="",D="",E="",V="",M=!1,h="",A="",R="",S=!1,b=new Array,I=new Array,x=new Array,w="",y="local",L="",N="",U="",P=!1,H="",Z="",Y="",k="",A="",B="",z="",S=!1,G="",F="",X="",W="",K="",Q="",j=!0,J=new Array,_=a.uid.substring(0,a.uid.lastIndexOf("/")+1),q="",ee="",ae=0,le="0",ne="0",re=(new Array,a.vcalendar),re=(new Array,r[O]),te=re.match(vCalendar.pre.contentline_UID);null!=te&&(te=te[0].match(vCalendar.pre.contentline_parse)[4]);for(var se=new Array,pe=null,ce=new Array,de=re+"";null!=de.match(vCalendar.pre.contentline_EXDATE);)pe=de.match(vCalendar.pre.contentline_EXDATE),ce[ce.length]=pe[0],de=de.replace(pe,"\r\n");if(vcalendar_element=re.match(vCalendar.pre.contentline_RRULE2),null!=vcalendar_element){parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),J=parsed[4].split(";");J.length>0&&(P=!0);for(var oe=0;oe<J.length;oe++)if(J[oe].indexOf("FREQ=")!=-1)h=J[oe].split("=")[1];else if(J[oe].indexOf("INTERVAL=")!=-1)k=J[oe].split("=")[1];else if(J[oe].indexOf("COUNT=")!=-1){if(A=J[oe].split("=")[1],0==A){j=!1;break}if(isNaN(A)){j=!1;break}}else J[oe].indexOf("UNTIL=")!=-1?(S=!0,A=J[oe].split("=")[1]):J[oe].indexOf("WKST=")!=-1?(G=J[oe].split("=")[1].replace(/\d*MO/,1).replace(/\d*TU/,2).replace(/\d*WE/,3).replace(/\d*TH/,4).replace(/\d*FR/,5).replace(/\d*SA/,6).replace(/\d*SU/,0),null!=globalSettings.mozillasupport.value&&globalSettings.mozillasupport.value&&(G="")):J[oe].indexOf("BYMONTHDAY=")!=-1?F=J[oe].split("=")[1]:J[oe].indexOf("BYDAY=")!=-1&&(X=J[oe].split("=")[1],X=X.replace(/\d*MO/,1).replace(/\d*TU/,2).replace(/\d*WE/,3).replace(/\d*TH/,4).replace(/\d*FR/,5).replace(/\d*SA/,6).replace(/\d*SU/,0).split(","));if(!j)return!1;k||(k=1)}var ie="";if(vcalendar_element=re.match(vCalendar.pre.contentline_DTSTART),null!=vcalendar_element){parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),D=parsed[4],ie=D,ie.indexOf("T")==-1?(ie=ie.substring(0,4)+"-"+ie.substring(4,6)+"-"+ie.substring(6,8),M=!0):(ie=ie.substring(0,4)+"-"+ie.substring(4,6)+"-"+ie.substring(6,8)+"T"+ie.substring(9,11)+":"+ie.substring(11,13)+":"+ie.substring(13,15),M=!1);var ve=$.fullCalendar.parseDate(ie);if(D=ie,null==ve)return!1;if("Invalid Date"==ve.toString())return!1;if(null!=ce)for(var _e=0;_e<ce.length;_e++){var me=(ce[_e]+"\r\n").match(vCalendar.pre.contentline_parse)[4];if(me.indexOf("T")!=-1&&me.indexOf("Z")!=-1)var Te=me.parseComnpactISO8601().setSeconds(getLocalOffset(me.parseComnpactISO8601())*-1);else if(me.indexOf("T")!=-1&&me.indexOf("Z")==-1)var Te=me.parseComnpactISO8601();else{D.indexOf("T")!=-1&&(me+="T"+$.fullCalendar.formatDate(ve,"HHmmss"));var Te=me.parseComnpactISO8601()}se[se.length]=new Date(Te).toString()}var ue=parsed[3].split("=");if(!M){if("Z"==parsed[4].charAt(parsed[4].length-1)&&(y="UTC"),ue.length>1||"UTC"==y){"UTC"!=y&&(y=$.trim(ue[1]));var ge=checkTimezone(y);null!=ge&&(y=ge),globalSettings.timezonesupport.value&&y in timezones&&(w=getOffsetByTZ(y,ve),H=getLocalOffset(ve)*-1*1e3-1e3*w.getSecondsFromOffset())}else processedTimezones.indexOf(y)==-1&&(timeZonesEnabled.indexOf(y)==-1&&timeZonesEnabled.push("local"),processedTimezones.push("local"));""!=y&&"local"!=y&&processedTimezones.indexOf(y)==-1&&(timeZonesEnabled.indexOf(y)==-1&&timeZonesEnabled.push(y),processedTimezones.push(y))}Z=D,ie.indexOf("T")!=-1&&(""!=H&&ve.setTime(ve.getTime()+H),D=$.fullCalendar.formatDate(ve,"u")),a.start=$.fullCalendar.parseDate(D)}if(vcalendar_element=re.match(vCalendar.pre.contentline_DUE),null!=vcalendar_element){parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),E=parsed[4];var Ce=E,Oe="";if(Ce.indexOf("T")==-1){Ce=Ce.substring(0,4)+"-"+Ce.substring(4,6)+"-"+Ce.substring(6,8);var fe=$.fullCalendar.parseDate(Ce),De=new Date(fe.getTime());ie.indexOf("T")==-1&&De.setDate(De.getDate()-1),Ce=$.fullCalendar.formatDate(De,"yyyy-MM-dd"),M=!0,Oe=Ce,ie.indexOf("T")!=-1&&(M=!1,Ce+="T00:00:00","UTC"==y&&(Ce+="Z"))}else Ce=Ce.substring(0,4)+"-"+Ce.substring(4,6)+"-"+Ce.substring(6,8)+"T"+Ce.substring(9,11)+":"+Ce.substring(11,13)+":"+Ce.substring(13,15),Oe=Ce,M=!1;E=Ce;var Ee=$.fullCalendar.parseDate(E);if(null==Ee)return!1;if("Invalid Date"==Ee.toString())return!1;if(null!=ce&&0==se.length)for(var _e=0;_e<ce.length;_e++){var me=(ce[_e]+"\r\n").match(vCalendar.pre.contentline_parse)[4];if(me.indexOf("T")!=-1&&me.indexOf("Z")!=-1)var Te=me.parseComnpactISO8601().setSeconds(getLocalOffset(me.parseComnpactISO8601())*-1);else if(me.indexOf("T")!=-1&&me.indexOf("Z")==-1)var Te=me.parseComnpactISO8601();else{E.indexOf("T")!=-1&&(me+="T"+$.fullCalendar.formatDate(Ee,"HHmmss"));var Te=me.parseComnpactISO8601()}se[se.length]=new Date(Te).toString()}if(""==H&&(ie.indexOf("T")!=-1||Oe.indexOf("T")!=-1)){var ue=parsed[3].split("=");if("Z"==parsed[4].charAt(parsed[4].length-1)&&(y="UTC"),ue.length>1||"UTC"==y){"UTC"!=y&&Oe.indexOf("T")!=-1&&(y=$.trim(ue[1]));var ge=checkTimezone(y);null!=ge&&(y=ge),globalSettings.timezonesupport.value&&y in timezones&&(w=getOffsetByTZ(y,Ee),H=getLocalOffset(Ee)*-1*1e3-1e3*w.getSecondsFromOffset())}}Y=Ce,globalSettings.appleremindersmode.value&&(Z=Ce),Ce.indexOf("T")!=-1&&(""!=H&&Ee.setTime(Ee.getTime()+H),E=$.fullCalendar.formatDate(Ee,"u")),a.end=E,globalSettings.appleremindersmode.value&&(D=E)}globalSettings.appleremindersmode.value&&""==Y&&""!=Z&&(Z="",D="");var Ve="",Me=re.match(vCalendar.pre.valarm);if(null!=Me){re=re.replace(Me[0],"");for(var he="",Ae=new Array,oe=0;oe<Me[0].length;oe++)"END:VALARM"==Me[0].substring(oe-"END:VALARM".length,oe)&&(Ae[Ae.length]=he+"\r\n",he=""),he+=Me[0][oe];for(var _e=0;_e<Ae.length;_e++)if(Ve+=0==Ae[_e].indexOf("\r\n")&&Ve.lastIndexOf("\r\n")==Ve.length-2?Ae[_e].substring(2,Ae[_e].length):0==Ae[_e].indexOf("\r\n")&&Ve.lastIndexOf("\r\n")!=Ve.length-2||0!=Ae[_e].indexOf("\r\n")&&Ve.lastIndexOf("\r\n")==Ve.length-2?Ae[_e]:"\r\n"+Ae[_e],checkA=Ae[_e].match(vCalendar.re.valarm),null!=checkA){if(action=Ae[_e].match(vCalendar.pre.contentline_ACTION),null==action)break;if(parsed=action[0].match(vCalendar.pre.contentline_parse),trigger=Ae[_e].match(vCalendar.pre.contentline_TRIGGER),null==trigger)break;if(parsed=(trigger[0]+"\r\n").match(vCalendar.pre.contentline_parse),null!=parsed){value=parsed[4];var Re=value.match(vCalendar.pre["date-time-value"]),Se="",be="";if(null!=Re){if(parsed[3])var Ie=parsed[3].split("=");var xe=$.fullCalendar.parseDate(value.substring(0,4)+"-"+value.substring(4,6)+"-"+value.substring(6,8)+"T"+value.substring(9,11)+":"+value.substring(11,13)+":"+value.substring(13,15));if("Z"==value.charAt(value.length-1)&&(be="UTC"),Ie.length>1||"UTC"==be){"UTC"!=be&&";TZID"==Ie[0]&&(be=$.trim(Ie[1]));var ge=checkTimezone(be);if(null!=ge&&(be=ge),globalSettings.timezonesupport.value&&be in timezones){var we=getOffsetByTZ(be,xe);Se="local"!=y?1e3*getOffsetByTZ(y,xe).getSecondsFromOffset()-1e3*we.getSecondsFromOffset():-1*getLocalOffset(xe)*1e3-1e3*we.getSecondsFromOffset()}}else processedTimezones.indexOf(y)==-1&&(timeZonesEnabled.indexOf(y)==-1&&timeZonesEnabled.push("local"),processedTimezones.push("local"));""!=be&&"local"!=y&&processedTimezones.indexOf(be)==-1&&(timeZonesEnabled.indexOf(be)==-1&&timeZonesEnabled.push(be),processedTimezones.push(be)),""!=Se&&xe.setTime(xe.getTime()+Se),b[_e]=$.fullCalendar.formatDate(xe,"yyyy-MM-dd'T'HH:mm:ss")}else b[_e]=0,value.indexOf("W")!=-1?b[_e]=parseAlarmWeek(value):value.indexOf("D")!=-1?b[_e]=parseAlarmDay(value):value.indexOf("T")!=-1&&(b[_e]=parseAlarmTime(value)),"-"==parsed[4].charAt(0)?b[_e]="-"+b[_e]:b[_e]="+"+b[_e]}alnote=Ae[_e].match(vCalendar.pre.contentline_NOTE),null!=alnote?(parsed=alnote[0].match(vCalendar.pre.contentline_parse),I[_e]=parsed[4]):I[_e]="Default note"}}if(vcalendar_element=re.match(vCalendar.pre.contentline_LOCATION),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),z=vcalendarUnescapeValue(parsed[4])),vcalendar_element=re.match(vCalendar.pre.contentline_NOTE),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),f=vcalendarUnescapeValue(parsed[4])),vcalendar_element=re.match(vCalendar.pre.contentline_CLASS),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),L=vcalendarUnescapeValue(parsed[4])),vcalendar_element=re.match(vCalendar.pre.contentline_URL),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),N=vcalendarUnescapeValue(parsed[4])),vcalendar_element=re.match(vCalendar.pre.contentline_RECURRENCE_ID),null!=vcalendar_element){parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse);var ye=parsed[4];W=ye}switch(vcalendar_element=re.match(vCalendar.pre.contentline_SUMMARY),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),V=vcalendarUnescapeValue(parsed[4])),vcalendar_element=re.match(vCalendar.pre.contentline_CREATED),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),K=vcalendarUnescapeValue(parsed[4])),vcalendar_element=re.match(vCalendar.pre.contentline_STATUS),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),q=vcalendarUnescapeValue(parsed[4])),!globalSettings.appleremindersmode.value||"IN-PROCESS"!=q&&"CANCELLED"!=q||(q="NEEDS-ACTION"),q){case"NEEDS-ACTION":ee="filterAction";break;case"COMPLETED":ee="filterCompleted";break;case"IN-PROCESS":ee="filterProgress";break;case"CANCELLED":ee="filterCanceled";break;default:ee="filterAction"}if(vcalendar_element=re.match(vCalendar.pre.contentline_COMPLETED),null!=vcalendar_element){parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse);var $e=parsed[4];$e.indexOf("T")!=-1&&($e=$e.substring(0,4)+"-"+$e.substring(4,6)+"-"+$e.substring(6,8)+"T"+$e.substring(9,11)+":"+$e.substring(11,13)+":"+$e.substring(13,15));var Ee=$.fullCalendar.parseDate($e);if(B=null==Ee||"Invalid Date"==Ee.toString()?"":new Date(Ee.getTime()),""!=B){var Se="",Ie=new Array;if(parsed[3]&&(Ie=parsed[3].split("=")),"Z"==parsed[4].charAt(parsed[4].length-1)&&(be="UTC"),Ie.length>1||"UTC"==be){"UTC"!=be&&(be=$.trim(Ie[1]));var ge=checkTimezone(be);if(null!=ge&&(be=ge),globalSettings.timezonesupport.value&&be in timezones){var we=getOffsetByTZ(be,B);Se=1e3*getOffsetByTZ(y,B).getSecondsFromOffset()-1e3*we.getSecondsFromOffset()}}else processedTimezones.indexOf(y)==-1&&(timeZonesEnabled.indexOf(y)==-1&&timeZonesEnabled.push("local"),processedTimezones.push("local"));""!=y&&"local"!=y&&processedTimezones.indexOf(be)==-1&&(timeZonesEnabled.indexOf(be)==-1&&timeZonesEnabled.push(be),processedTimezones.push(be)),""!=Se&&B.setTime(B.getTime()+Se)}}if("COMPLETED"==q&&""==B&&""!=E&&"object"==typeof E&&(B=new Date(E.getTime())),vcalendar_element=re.match(vCalendar.pre["contentline_PERCENT-COMPLETE"]),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),R=vcalendarUnescapeValue(parsed[4]),le=R),vcalendar_element=re.match(vCalendar.pre.contentline_PRIORITY),null!=vcalendar_element){parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),ne=vcalendarUnescapeValue(parsed[4]);var Le=parseInt(ne,10);isNaN(Le)||(ae=ne>5&&ne<10?3:ne<5&&ne>0?1:5==ne?2:0)}var Ne=(a.uid.substring(a.uid.lastIndexOf("/")+1,a.uid.length),0),Ue=!1;if(P&&(Z||Y)?Q=a.uid+"#"+K+"#"+h:P||(Q=a.uid+"#"+K+"#"+W),""!=le&&"0"!=le&&"100"!=le&&"50"!=le&&("undefined"==typeof globalTodolistStatusArray[Q]&&(globalTodolistStatusArray[Q]={}),globalTodolistStatusArray[Q].percent=le),!l&&!C){var Pe=findEventInArray(a.uid,!1,null!=globalCalTodo?globalCalTodo.repeatHash:null);if(""!=Pe&&(Pe.etag!=a.etag||$("#showTODO").val()==a.uid&&("true"==$("#repeatTodo").val()||""!=$("#recurrenceIDTODO").val())&&!C)){for(var He=0;He<Pe.alertTimeOut.length;He++)clearTimeout(Pe.alertTimeOut[He]);if($("#showTODO").val()==a.uid)if("true"==$("#repeatTodo").val()||""!=$("#recurrenceIDTODO").val())if("undefined"==typeof globalCalTodo||null==globalCalTodo||globalCalTodo.repeatHash!=Q){var Ze=globalCalTodo.title;$("#editAllTODO").css("visibility","hidden"),$("#editFutureTODO").css("visibility","hidden"),$("#editOnlyOneTODO").css("visibility","hidden"),$("#repeatConfirmBoxContentTODO").html("<b>"+Ze+"</b> "+localization[globalInterfaceLanguage].repeatChangeTxt),$("#repeatConfirmBoxQuestionTODO").html(localization[globalInterfaceLanguage].repeatTodoChangeTxtClose)}else Ue=!0,C=!0,$("#todoList").fullCalendar("selectEvent");else Ue=!0}}for(var Ye=0,Ne=0;Ne<globalResourceCalDAVList.TodoCollections.length;Ne++)if("undefined"!=typeof globalResourceCalDAVList.TodoCollections[Ne].uid&&globalResourceCalDAVList.TodoCollections[Ne].uid==e.uid){Ye=Ne;break}var ke=new RegExp("^(https?://)([^@/]+(?:@[^@/]+)?)@([^/]+)(.*/)([^/]+/)([^/]+/)([^/]*)","i"),Be=(_.match(ke),Ye.pad(String(globalResourceCalDAVList.TodoCollections.length).length)),ze=(Be+V).toLowerCase();if(P&&(Z||Y)){void 0!=globalAppleSupport.nextDates[a.uid]&&delete globalAppleSupport.nextDates[a.uid];var Ge=re.match(vCalendar.pre.contentline_RRULE2)[0].match(vCalendar.pre.contentline_parse)[4];if(a.isRepeat=!0,Z)var Fe=new Date($.fullCalendar.parseDate(Z).getTime());else if(Y)var Fe=new Date($.fullCalendar.parseDate(Y).getTime());if(Y)var Xe=new Date($.fullCalendar.parseDate(Y).getTime());var We="",Ke="";Z&&(We=new Date(Fe.getTime())),Y&&(Ke=new Date(Xe.getTime()));var Qe="",je="",Je="";if(""!==A){if(S){if(A.indexOf("T")!=-1){var qe=A.substring(0,4)+"-"+A.substring(4,6)+"-"+A.substring(6,8)+"T"+A.substring(9,11)+":"+A.substring(11,13)+":"+A.substring(13,15),ea=$.fullCalendar.parseDate(qe);if(null==ea)return!1;if("Invalid Date"==ea.toString())return!1;if(globalSettings.timezonesupport.value&&y in timezones&&(w=getOffsetByTZ(y,ea)),w){var H=1e3*w.getSecondsFromOffset();ea.setTime(ea.getTime()+H)}Qe=new Date(ea.getTime())}else Qe=$.fullCalendar.parseDate(A.substring(0,4)+"-"+A.substring(4,6)+"-"+A.substring(6,8)),""!=Z?(Qe.setHours($.fullCalendar.parseDate(Z).getHours()),Qe.setMinutes($.fullCalendar.parseDate(Z).getMinutes()),Qe.setSeconds($.fullCalendar.parseDate(Z).getSeconds())):""!=Y&&(Qe.setHours($.fullCalendar.parseDate(Y).getHours()),Qe.setMinutes($.fullCalendar.parseDate(Y).getMinutes()),Qe.setSeconds($.fullCalendar.parseDate(Y).getSeconds()));Je=""}else Qe="",Je=A;je=Qe,a.untilDate=Qe}else Qe=globalToLoadedLimitTodo,je="",a.untilDate="never";var aa=0,la=0,na=new Date(globalToLoadedLimitTodo.getTime());na.setMonth(na.getMonth()+2);var ra=0;Y&&(ra=Xe.getTime()-Fe.getTime());generateTodoRepeatInstances({dayDifference:ra,untilDate:je,repeatStart:We,repeatEnd:Ke,futureRLimit:na,stringUID:te,recurrence_id_array:m,exDates:se,alertTime:b,ignoreAlarms:e.ignoreAlarms,isChange:Ue,todoArray:r,preTodoArray:t,realRepeatCount:la,repeatCount:aa,items:new todoItems(D,E,je,h,k,Je,G,We,Ke,aa,la,X,z,f,V,a.uid,re,a.etag,b,I,q,ee,W,Q,le,a.displayValue,_,ze,y,Z,Y,x,L,N,B,O,ne,ae,Ve,Ge)})}else{if(""!=E&&"string"==typeof E){var ta=$.fullCalendar.parseDate(E);E=new Date(ta.getTime())}e.ignoreAlarms||(x=setAlertTimeouts(!0,b,D,E,{title:V,status:q},!0,a.uid));var U=new todoItems(D,E,"","","","","","","","","","",z,f,V,a.uid,re,a.etag,b,I,q,ee,W,Q,le,a.displayValue,_,ze,y,Z,Y,x,L,N,B,O,ne,ae,Ve,"");t.splice(t.length,0,U),Ue&&(globalCalTodo=U)}deleteEventFromArray(a.uid),$.merge(globalEventList.displayTodosArray[_],t)}}