function updateTodoFormDimensions(e){$("#CATodo").css("width",""),$("#CATodo").css("width",$("#todo_details_template").css("width")),e&&($("#CATodo").css("height",""),$("#CATodo").css("height",$("#todo_details_template").css("height")))}function updateEventFormDimensions(e){$("#CAEvent").css("width",""),$("#CAEvent").css("width",$("#event_details_template").css("width")),e&&($("#CAEvent").css("height",""),$("#CAEvent").css("height",$("#event_details_template").css("height")))}function setFormPosition(e,t){var a,l;$("#event_details_template").css("max-height",""),e?(e.pageX<=$("#main").width()/2?(position_v="left",a=e.pageX):(position_v="right",a=$("body").width()-e.pageX),position_h="top",l=Math.max(29,e.pageY-(t?$("#CAEvent").height():$("#event_details_template").height()))):(position_v="right",position_h="top",a=25,l=29),$("#CAEvent").css("left",""),$("#CAEvent").css("right",""),$("#CAEvent").css("top",""),$("#CAEvent").css("bottom",""),$("#CAEvent").css(position_v,a),$("#CAEvent").css(position_h,l),$("#event_details_template").css("max-height",$("#main").height()-l+20+"px"),$("#CAEvent").css("max-height",$("#main").height()-l+20+"px")}function setTodoPosition(e){var t,a=0;$("#todo_details_template").css("max-height",""),$("#CATodo").css("max-height",""),void 0!=e&&(a=void 0!=e.pageY?e.pageY:e.clientY),t=e?Math.max(25,e.pageY-$("#todo_details_template").height()):25,$("#CATodo").css("left",""),$("#CATodo").css("right",""),$("#CATodo").css("top",""),$("#CATodo").css("bottom",""),$("#CATodo").css("top",t),$("#todo_details_template").css("right",0),$("#CATodo").css("right",25),$("#todo_details_template").css("max-height",$("#main").height()-t+20+"px"),$("#CATodo").css("max-height",$("#main").height()-t+20+"px")}function showTimezones(e,t){if(!globalSettings.timezonesupport.value)return!1;var a=$("#timezone"+t);a.empty();var l=!1;for(var r in timezoneKeys)if(timeZonesEnabled.indexOf(timezoneKeys[r])!=-1&&!isNaN(r)){var o=null;l||(o=$("<option>"),o.attr("data-type","local"),l=!0,e in timezones||""==e||"local"==e||null!=globalSettings.removeunknowntimezone.value&&globalSettings.removeunknowntimezone.value||(o.text(localization[globalInterfaceLanguage].customTimezone),o.attr("value","custom"),"PickerTODO"!=t&&"Picker"!=t||null==globalSettings.timezone.value||o.attr("value",globalSettings.timezone.value),a.append(o))),o=$("<option>"),o.attr("data-type",timezoneKeys[r]),0==r?(o.text(localization[globalInterfaceLanguage].localTime),o.attr("value","local"),a.append(o)):(o.text(timezoneKeys[r]),o.attr("value",timezoneKeys[r]),a.append(o))}!e&&"undefined"!=typeof globalSessionTimeZone&&globalSessionTimeZone&&(e=globalSessionTimeZone),e in timezones?a.val(e):null!=globalSettings.removeunknowntimezone.value&&globalSettings.removeunknowntimezone.value||"local"==e?a.val("local"):a.val("custom")}function showTodoForm(e,t,a,l){$("#CATodo").css("display","none"),$("#todo_details_template").remove(),$("#CATodo").html(cleanVtodoTemplate),setFirstDayTodo(),bindTodoForm(),$("#noteTODO").autosize({defaultStyles:{height:"64",overflow:"","overflow-y":"","word-wrap":"",resize:"none"},callback:function(){checkTodoFormScrollBar()}}),$("#showTODO").val(""),$("#uidTODO").val(""),$("#etagTODO").val(""),$("#vcalendarUIDTODO").val(""),globalPrevDate="",globalObjectLoading=!0;var r="";if(null==e){var o=$("#ResourceCalDAVTODOList").find(".resourceCalDAVTODO_item.resourceCalDAV_item_selected");o.length>0&&!globalResourceCalDAVList.getTodoCollectionByUID(o.attr("data-id")).permissions.read_only&&(r=rgbToHex(o.children(".resourceCalDAVColor").css("background-color")))}else r=globalResourceCalDAVList.getTodoCollectionByUID(e.res_id).ecolor;if(l)return $("#showTODO").val(e.id),$("#repeatTodo").val(!0),$("#CATodo").show(),$("#repeatConfirmBoxTODO").css("visibility","visible"),""!=e.repeatCount&&1==e.repeatCount||globalSettings.appleremindersmode.value?($("#editFutureTODO").css("display","none"),$("#editFutureTODO").next("br").length>0&&$("#editFutureTODO").next().remove()):"none"==$("#editFutureTODO").css("display")&&($("#editFutureTODO").css("display","block"),0==$("#editFutureTODO").next("br").length&&$("#editFutureTODO").after("<br/>")),$("#editAllTODO, #editOnlyOneTODO, #editFutureTODO").click(function(){globalCalTodo&&("editOnlyOneTODO"==$(this).attr("id")?showTodoForm(globalCalTodo,"show","editOnly"):"editAllTODO"==$(this).attr("id")?showTodoForm(globalCalTodo,"show",""):"editFutureTODO"==$(this).attr("id")&&showTodoForm(globalCalTodo,"show","futureOnly"),$("#repeatConfirmBoxContentTODO").html(""),$("#repeatConfirmBoxTODO").css("visibility","hidden"),$("#todo_details_template").css("visibility","visible"),$("#AlertDisabler").fadeOut(globalEditorFadeAnimation))}),$("#repeatConfirmBoxContentTODO").html("<b>"+e.title+"</b> "+localization[globalInterfaceLanguage].repeatBoxContentTODO),$("#repeatConfirmBoxQuestionTODO").html(localization[globalInterfaceLanguage].repeatBoxQuestionTODO),$("#todo_details_template").css("visibility","hidden"),globalObjectLoading=!1,$("#CATodo").show(200,function(){$("#todoColor").css("background-color",r),checkTodoFormScrollBar(),$("#todoForm").scrollTop(0)}),!0;if("show"==t&&"futureOnly"==a&&(null!=e.start?$("#futureStartTODO").val(e.realRepeatCount+";"+e.start):null!=e.end&&$("#futureStartTODO").val(e.realRepeatCount+";"+e.end)),"show"==t){var i="";e.start&&(i=$.fullCalendar.formatDate(e.start,"yyyyMMdd'T'HHmmss'Z'")),$(".fc-event-selected").length>0&&$(".fc-event-selected").attr("data-start")!=i?$(".fc-view-todo").addClass("fc-view-trans"):$(".fc-view-todo").removeClass("fc-view-trans")}if("editOnly"==a&&null!=e&&(e.type||e.rec_id)){var n=jQuery.grep(globalEventList.displayTodosArray[e.res_id],function(t){if(t.id==e.id)return!0}).sort(repeatStartCompare);if(n.indexOf(e)!=-1){n.indexOf(e)<n.length-1&&showTodoNextNav(),0!=n.indexOf(e)&&showTodoPrevNav();for(var s=0,d=n.indexOf(e)+1;d<n.length;d++)"COMPLETED"!=n[d].status&&s++;s>0&&n.indexOf(e)<n.length-1&&showTodoNextNav(!0);for(var s=0,d=n.indexOf(e)-1;d>=0;d--)"COMPLETED"!=n[d].status&&s++;s>0&&0!=n.indexOf(e)&&showTodoPrevNav(!0)}}if(null!=e){var p=parseInt(e.priority,10);5==p?$("#priority_TODO").val(5):p>5&&p<10?($('#priority_TODO [data-type="priority_TODO_low"]').attr("value",p),$("#priority_TODO").val(p)):p<5&&p>0?($('#priority_TODO [data-type="priority_TODO_high"]').attr("value",p),$("#priority_TODO").val(p)):$("#priority_TODO").val(0)}if(null!=e)var _=e.percent;else _=0;for(var c=globalResourceCalDAVList.sortedTodoCollections,m=$("#todo_calendar"),u=($(".resourceCalDAVTODO_item.resourceCalDAV_item_selected").attr("data-id"),0);u<c.length;u++)void 0!=c[u].uid&&(null!=e&&e.res_id==c[u].uid||c[u].makeLoaded&&!c[u].permissions_read_only)&&m.append(new Option(c[u].displayValue,c[u].uid));if("new"!=t?fullVcalendarToTodoData(e,!0):CalDAVeditor_cleanup("form"),"new"==t&&($("#todoInEdit").val("true"),$("#deleteTODO").hide(),$("#resetTODO").hide(),$("#editTODO").hide(),$("#duplicateTODO").hide(),$("#editOptionsButtonTODO").hide(),$("#showTODO").val(""),$("#ResourceCalDAVTODOList").find(".resourceCalDAVTODO_item.resourceCalDAV_item_selected").length>0&&$("#todo_calendar").find('option[value="'+$("#ResourceCalDAVTODOList").find(".resourceCalDAVTODO_item.resourceCalDAV_item_selected").attr("data-id")+'"]').length>0?$("#todo_calendar").val($("#ResourceCalDAVTODOList").find(".resourceCalDAVTODO_item.resourceCalDAV_item_selected").attr("data-id")):$("#todo_calendar").val("choose"),showTimezones("","TODO"),$(".timezone_rowTODO").css("display","none")),$("#CATodo").show(),$("#todo_details_template").show(),globalSettings.appleremindersmode.value&&($('[data-type="todo_type_start"], [data-type="todo_type_both"]').remove(),"string"==typeof globalSettings.appleremindersmode.value&&"ios6"==globalSettings.appleremindersmode.value.toLowerCase()&&($("#url_trTODO").hide(),$("#location_row_TODO").hide()),$('[data-type="STATUS_CANCELLED_TODO"],[data-type="STATUS_IN-PROCESS_TODO"]').remove()),"show"==t){if($("#showTODO").val(e.id),$('#todoDetailsTable :input[type!="button"]').prop("disabled",!0),e.timeZone?showTimezones(e.timeZone,"TODO"):showTimezones("local","TODO"),""!=e.etag&&$("#todo_calendar").val(e.res_id),$("#nameTODO").val(e.title),"CANCELLED"==e.status&&$("#nameTODO").addClass("title_cancelled"),null!=e.start||null!=e.end?(!globalSettings.appleremindersmode.value&&(null!=e.start&&null!=e.end&&""!=a||!e.type&&""!=e.realStart&&""!=e.realEnd&&""==a||e.type&&""!=e.repeatStart&&""!=e.repeatEnd&&""==a)?$("#todo_type").val("both"):!globalSettings.appleremindersmode.value&&(null!=e.start&&null==e.end&&""!=a||!e.type&&""!=e.realStart&&""==e.realEnd&&""==a||e.type&&""!=e.repeatStart&&""==e.repeatEnd&&""==a)?$("#todo_type").val("start"):$("#todo_type").val("due"),globalSettings.timezonesupport.value&&$(".timezone_rowTODO").show()):($("#todo_type").val("none"),$(".timezone_rowTODO").css("display","none")),""!=e.start&&null!=e.start){var v,f,O;if(v=e.realStart?$.fullCalendar.parseDate(e.realStart):$.fullCalendar.parseDate(e.start),""!=$("#showTODO").val()&&""!=e.repeatStart&&""==a?v=e.repeatStart:""!=$("#showTODO").val()&&""==e.repeatStart&&""==a&&e.type&&(v=""),v){f=v.getHours()<10?"0"+v.getHours():v.getHours(),O=v.getMinutes()<10?"0"+v.getMinutes():v.getMinutes();var g=$.datepicker.formatDate(globalSettings.datepickerformat.value,v);$("#date_fromTODO").val(g),"both"==$("#todo_type").val&&(globalPrevDate=new Date(v.getTime())),$("#time_fromTODO").val($.fullCalendar.formatDate(v,globalSettings.ampmformat.value?"hh:mm TT":"HH:mm"))}}if(""!=e.end&&null!=e.end&&(v=e.realEnd?$.fullCalendar.parseDate(e.realEnd):$.fullCalendar.parseDate(e.end),""!=$("#showTODO").val()&&""!=e.repeatEnd&&""==a?v=e.repeatEnd:""!=$("#showTODO").val()&&""==e.repeatEnd&&""==a&&e.type&&(v=""),v)){f=v.getHours()<10?"0"+v.getHours():v.getHours(),O=v.getMinutes()<10?"0"+v.getMinutes():v.getMinutes();var h=$.datepicker.formatDate(globalSettings.datepickerformat.value,v);$("#date_toTODO").val(h),$("#time_toTODO").val($.fullCalendar.formatDate(v,globalSettings.ampmformat.value?"hh:mm TT":"HH:mm"))}if("editOnly"==a&&""==e.rec_id?""!=e.repeatStart&&e.start?"object"==typeof e.realStart?$("#recurrenceIDTODO").val($.fullCalendar.formatDate(e.realStart,"yyyyMMdd'T'HHmmss")):"string"==typeof e.realStart&&$("#recurrenceIDTODO").val($.fullCalendar.formatDate($.fullCalendar.parseDate(e.realStart),"yyyyMMdd'T'HHmmss")):""!=e.repeatEnd&&e.end&&("object"==typeof e.realEnd?$("#recurrenceIDTODO").val($.fullCalendar.formatDate(e.realEnd,"yyyyMMdd'T'HHmmss")):"string"==typeof e.realEnd&&$("#recurrenceIDTODO").val($.fullCalendar.formatDate($.fullCalendar.parseDate(e.realEnd),"yyyyMMdd'T'HHmmss"))):$("#recurrenceIDTODO").val(e.rec_id),e.rec_id||"editOnly"==a||"futureOnly"==a){var D=jQuery.grep(globalEventList.displayTodosArray[e.res_id],function(t){if(t.id==e.id&&(t.repeatCount<2||!t.repeatCount))return!0});(D.length>1||"futureOnly"==a&&e.repeatCount>1||"editOnly"==a&&""!=e.type)&&$("#deleteTODO").attr("onclick","$('#todoInEdit').val('false');updateEventFormDimensions(true);$('#todoLoader').show();saveTodo(true);")}if(""!=e.completedOn&&null!=e.completedOn){var v,f,O;"string"==typeof e.completedOn?v=$.fullCalendar.parseDate(e.completedOn):"object"==typeof e.completedOn&&(v=new Date(e.completedOn.getTime()));var g=$.datepicker.formatDate(globalSettings.datepickerformat.value,v);$("#completedOnDate").val(g),$("#completedOnTime").val($.fullCalendar.formatDate(v,globalSettings.ampmformat.value?"hh:mm TT":"HH:mm")),$(".completedOnTr").show()}var T="",y=0;for(y=0;y<e.alertTime.length;y++)if(y>0&&todo_alert_add(y),$(".alertTODO[data-id="+(y+1)+"]").val("message"),"-"==e.alertTime[y].charAt(0)||"+"==e.alertTime[y].charAt(0)){var b=parseInt(e.alertTime[y].substring(1,e.alertTime[y].length-1)),w="";"W"==e.alertTime[y].charAt(e.alertTime[y].length-1)?(b=b/1e3/60/60/24/7,w="weeks"):"D"==e.alertTime[y].charAt(e.alertTime[y].length-1)?(b=b/1e3/60/60/24,w="days"):"H"==e.alertTime[y].charAt(e.alertTime[y].length-1)?(b=b/1e3/60/60,w="hours"):"M"==e.alertTime[y].charAt(e.alertTime[y].length-1)?(b=b/1e3/60,w="minutes"):"S"==e.alertTime[y].charAt(e.alertTime[y].length-1)&&(b/=1e3,w="seconds"),w+="-"==e.alertTime[y].charAt(0)?"_before":"_after",$(".alert_message_detailsTODO[data-id="+(y+1)+"]").val(w),$(".before_after_inputTODO[data-id="+(y+1)+"]").val(b),$('.alert_detailsTODO[data-id="'+(y+1)+'"]').show(),$('.alert_message_dateTODO[data-id="'+(y+1)+'"]').show(),$('.before_after_inputTODO[data-id="'+(y+1)+'"]').show(),$(".message_date_inputTODO[data-id="+(y+1)+"]").hide(),$(".message_time_inputTODO[data-id="+(y+1)+"]").hide()}else{T=$.fullCalendar.parseDate(e.alertTime[y]),f=T.getHours()<10?"0"+T.getHours():T.getHours(),O=T.getMinutes()<10?"0"+T.getMinutes():T.getMinutes(),$(".alert_message_detailsTODO[data-id="+(y+1)+"]").val("on_date");var C=$.datepicker.formatDate(globalSettings.datepickerformat.value,T);$(".message_date_inputTODO[data-id="+(y+1)+"]").val(C),$(".message_time_inputTODO[data-id="+(y+1)+"]").val($.fullCalendar.formatDate(T,globalSettings.ampmformat.value?"hh:mm TT":"HH:mm")),$('.alert_detailsTODO[data-id="'+(y+1)+'"]').show(),$('.alert_message_dateTODO[data-id="'+(y+1)+'"]').show()}if(y>0&&todo_alert_add(y),""!=e.type&&"editOnly"!=a&&null!=e.ruleString.match(vCalendar.re.recurCaldav)){var k=e.vcalendar.match(vCalendar.pre.contentline_RRULE2)[0].match(vCalendar.pre.contentline_parse)[4];if(k.indexOf("BYMONTH=")!=-1||k.indexOf("BYMONTHDAY=")!=-1||k.indexOf("BYDAY=")!=-1){var x=k.split(";");if(x.indexElementOf("BYMONTH=")!=-1&&x.indexElementOf("BYMONTHDAY=")==-1&&x.indexElementOf("BYDAY=")==-1&&(x[x.length]="BYMONTHDAY="+e.start.getDate()),"DAILY"==e.type)$("#repeat_TODO option[value='DAILY']").prop("selected",!0),$('#repeat_interval_TODO [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatDays);else if("WEEKLY"==e.type){$("#repeat_TODO option[value='CUSTOM_WEEKLY']").prop("selected",!0),$('#repeat_interval_TODO [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatWeeks);for(var S=0;S<x.length;S++)if(x[S].indexOf("BYDAY=")!=-1){var E=x[S].split("=")[1];E=E.replace(/\d*MO/,1).replace(/\d*TU/,2).replace(/\d*WE/,3).replace(/\d*TH/,4).replace(/\d*FR/,5).replace(/\d*SA/,6).replace(/\d*SU/,0).split(",");for(var A=0;A<E.length;A++)isNaN(parseInt(E[A],10))||$('#week_custom_TODO .customTable td[data-type="'+E[A]+'"]').addClass("selected")}$("#week_custom_TODO").show()}else if("MONTHLY"==e.type){$("#repeat_TODO option[value='CUSTOM_MONTHLY']").prop("selected",!0).change(),$('#repeat_interval_TODO [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatMonths);for(var S=0;S<x.length;S++)if(x[S].indexOf("BYDAY=")!=-1){var E=x[S].split("=")[1];E=E.split(",");for(var A=0;A<E.length;A++){var H=E[A].match(vCalendar.pre["+/-number"]);if(E[A]=E[A].replace(H[0],""),!isNaN(parseInt(H[0],10))){switch(parseInt(H[0],10)){case 1:$("#repeat_month_custom_select_TODO").val("first");break;case 2:$("#repeat_month_custom_select_TODO").val("second");break;case 3:$("#repeat_month_custom_select_TODO").val("third");break;case 4:$("#repeat_month_custom_select_TODO").val("fourth");break;case 5:$("#repeat_month_custom_select_TODO").val("fifth");break;case-1:$("#repeat_month_custom_select_TODO").val("last");break;default:$("#repeat_month_custom_select_TODO").val("every")}$("#repeat_month_custom_select2_TODO").val(E[A])}}}else if(x[S].indexOf("BYMONTHDAY=")!=-1){$("#repeat_month_custom_select_TODO").val("custom").change();var L=x[S].split("=")[1];L=L.split(",");for(var A=0;A<L.length;A++)parseInt(L[A],10)==-1?($("#repeat_month_custom_select_TODO").val("last").change(),$("#repeat_month_custom_select2_TODO").val("DAY")):$('#month_custom2_TODO .customTable td[data-type="'+parseInt(L[A],10)+'"]').addClass("selected")}}else if("YEARLY"==e.type){$("#repeat_TODO option[value='CUSTOM_YEARLY']").prop("selected",!0).change(),$('#repeat_interval_TODO [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatYears);for(var M=!1,S=0;S<x.length;S++)if(x[S].indexOf("BYDAY=")!=-1){var E=x[S].split("=")[1];E=E.split(",");for(var A=0;A<E.length;A++){var H=E[A].match(vCalendar.pre["+/-number"]);if(E[A]=E[A].replace(H[0],""),!isNaN(parseInt(H[0],10))){switch(parseInt(H[0],10)){case 1:$("#repeat_year_custom_select1_TODO").val("first");break;case 2:$("#repeat_year_custom_select1_TODO").val("second");break;case 3:$("#repeat_year_custom_select1_TODO").val("third");break;case 4:$("#repeat_year_custom_select1_TODO").val("fourth");break;case 5:$("#repeat_year_custom_select1_TODO").val("fifth");break;case-1:$("#repeat_year_custom_select1_TODO").val("last");break;default:$("#repeat_year_custom_select1_TODO").val("every")}$("#repeat_year_custom_select2_TODO").val(E[A])}}}else if(x[S].indexOf("BYMONTHDAY=")!=-1){$("#repeat_year_custom_select1_TODO").val("custom").change();var L=x[S].split("=")[1];L=L.split(",");for(var A=0;A<L.length;A++)parseInt(L[A],10)==-1?($("#repeat_year_custom_select1_TODO").val("last").change(),$("#repeat_year_custom_select2_TODO").val("DAY")):$('#year_custom1_TODO .customTable td[data-type="'+parseInt(L[A],10)+'"]').addClass("selected");M=!0}else if(x[S].indexOf("BYMONTH=")!=-1){var I=x[S].split("=")[1];I=I.split(",");for(var A=0;A<I.length;A++)$('#year_custom3_TODO .customTable td[data-type="'+(parseInt(I[A],10)-1)+'"]').addClass("selected")}}if(""==e.after&&""==e.untilDate)$("#repeat_end_details_TODO option[value='never']").prop("selected",!0);else if(""!=e.after)$("#repeat_end_details_TODO option[value='after']").prop("selected",!0),$("#repeat_end_after_TODO").val(e.after);else if(""!=e.untilDate){v=$.fullCalendar.parseDate(e.untilDate),$("#repeat_end_details_TODO option[value='on_date']").prop("selected",!0);var Y=$.datepicker.formatDate(globalSettings.datepickerformat.value,v);$("#repeat_end_date_TODO").val(Y)}if($("#repeat_interval_detail_TODO").val(e.interval),$("#repeat_interval_TODO").show(),e.byDay.length>0){var z=new Array;if(globalSettings.weekenddays.value.length>0)for(var u=0;u<7;u++)globalSettings.weekenddays.value.indexOf(u)==-1&&(z[z.length]=u+"");for(var F=0,B=0,u=0;u<E.length;u++)z.indexOf(E[u])!=-1&&F++,globalSettings.weekenddays.value.indexOf(parseInt(E[u],10))!=-1&&B++;z.length>0&&z.length==F?($("#repeat_TODO option[value='BUSINESS']").prop("selected",!0),$("#repeat_interval_TODO").hide(),$("#week_custom_TODO").hide()):globalSettings.weekenddays.value.length>0&&globalSettings.weekenddays.value.length==B&&($("#repeat_TODO option[value='WEEKEND']").prop("selected",!0),$("#repeat_interval_TODO").hide(),$("#week_custom_TODO").hide())}}else{if("DAILY"==e.type?($("#repeat_TODO option[value='DAILY']").prop("selected",!0),$('#repeat_interval_TODO [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatDays)):"WEEKLY"==e.type?($("#repeat_TODO option[value='WEEKLY']").prop("selected",!0),$('#repeat_interval_TODO [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatWeeks)):"MONTHLY"==e.type?($("#repeat_TODO option[value='MONTHLY']").prop("selected",!0),$('#repeat_interval_TODO [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatMonths)):"YEARLY"==e.type&&($("#repeat_TODO option[value='YEARLY']").prop("selected",!0),$('#repeat_interval_TODO [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatYears)),""==e.after&&""==e.untilDate)$("#repeat_end_details_TODO option[value='never']").prop("selected",!0);else if(""!=e.after)$("#repeat_end_details_TODO option[value='after']").prop("selected",!0),$("#repeat_end_after_TODO").val(e.after);else if(""!=e.untilDate){v=$.fullCalendar.parseDate(e.untilDate),$("#repeat_end_details_TODO option[value='on_date']").prop("selected",!0);var Y=$.datepicker.formatDate(globalSettings.datepickerformat.value,v);$("#repeat_end_date_TODO").val(Y)}$("#repeat_interval_detail_TODO").val(e.interval),$("#repeat_interval_TODO").show(),$("#repeatTodo").val(!0)}}else if(""!=e.type&&"editOnly"!=a){var N=new Option(localization[globalInterfaceLanguage].customRepeat,e.ruleString,!1,!0);N.attr("data-type","custom_repeat"),$("#repeat_TODO").append(N)}else $("#repeatTodo").val(!1);if(null!=e.start||null!=e.end?globalSettings.timezonesupport.value&&$(".timezone_rowTODO").show():$(".timezone_rowTODO").css("display","none"),""!=e.status&&$("#statusTODO").find("option[value="+e.status+"]").prop("selected",!0),$("#noteTODO").val(e.note).trigger("autosize.resize"),""!=e.classType?$("#typeTODO").val(e.classType.toLowerCase()):$("#typeTODO").val("public"),null!=e&&"new"!=t){var V=e.id.match(vCalendar.pre.uidParts);decodeURIComponent(V[4]).indexOf(V[2])==-1&&$(".row_typeTODO").css("display","none")}$("#uidTODO").val(e.id),$("#url_TODO").val(e.url),$("#location_TODO").val(e.location),$("#etagTODO").val(e.etag),$("#vcalendarHashTODO").val(String(CryptoJS.SHA256(e.vcalendar)));var R=e.vcalendar.match(vCalendar.pre.contentline_UID);null!=R&&(R=R[0].match(vCalendar.pre.contentline_parse)[4]),R&&$("#vcalendarUIDTODO").val(R)}if("start"==$("#todo_type").val()?($(".dateTrFromTODO").show(),$(".dateTrToTODO").hide()):"due"==$("#todo_type").val()?($(".dateTrToTODO").show(),$(".dateTrFromTODO").hide()):"both"==$("#todo_type").val()?($(".dateTrToTODO").show(),$(".dateTrFromTODO").show()):($(".dateTrToTODO").hide(),$(".dateTrFromTODO").hide(),$("#repeat_row_TODO").hide()),"repeat_no-repeat"!=$("#repeat_TODO option:selected").attr("data-type")&&"custom_repeat"!=$("#repeat_TODO option:selected").attr("data-type")&&$("#repeat_details_TODO").show(),"repeat_details_on_date"==$("#repeat_end_details_TODO option:selected").attr("data-type")&&($("#repeat_end_after_TODO").hide(),$("#repeat_end_date_TODO").show()),"repeat_details_after"==$("#repeat_end_details_TODO option:selected").attr("data-type")&&($("#repeat_end_after_TODO").show(),$("#repeat_end_date_TODO").hide()),"repeat_details_never"==$("#repeat_end_details_TODO option:selected").attr("data-type")&&($("#repeat_end_after_TODO").hide(),$("#repeat_end_date_TODO").hide()),"show"==t&&($("#ResourceCalDAVTODOList").find('[data-id="'+e.res_id+'"]').hasClass("resourceCalDAV_item_ro")&&($("#editTODO").hide(),$("#duplicateTODO").hide(),$("#editOptionsButtonTODO").hide()),$("#saveTODO").hide(),$("#resetTODO").hide(),$("#deleteTODO").hide(),$('#todoDetailsTable :input[type!="button"]').prop("disabled",!0),$('#todoDetailsTable :input[type="text"]').prop("readonly",!0),$("#todoDetailsTable textarea").prop("readonly",!0),$("#percentageSlider").slider({disabled:!0}),$.browser.webkit&&window.chrome?0==navigator.platform.toLowerCase().indexOf("win")?($("#todo_details_template").find("input").css("text-indent","2px"),$("#todo_details_template").find("select").css({"padding-left":"0px","padding-right":"13px"})):$("#todo_details_template").find("input").css("text-indent","1px"):$.browser.safari?($("#todo_details_template").find("textarea").addClass("safari_hack"),$("#todo_details_template").find("input").addClass("safari_hack")):$.browser.msie&&10==parseInt($.browser.version,10)&&($("#todo_details_template").find("select").css({"padding-top":"1px","padding-left":"0px","padding-right":"0px"}),$("#todo_details_template").find("textarea").css("padding-top","3px"),$("#todo_details_template").find("input[type=button]").css("padding-top","2px")),$.browser.msie||$.browser.mozilla)){var U=$(SVG_select_dis).attr("data-type","select_icon").css({"pointer-events":"none","z-index":"1",display:"inline","margin-left":"-22px","vertical-align":"top","background-color":"#ffffff"});$("#todo_details_template").find('svg[data-type="select_icon"]').replaceWith($("<div>").append($(U).clone()).html())}"editOnly"!=a&&""==$("#recurrenceIDTODO").val()||($("#repeat_TODO").parent().parent().css("display","none"),$("#week_custom_TODO").css("display","none"),$("#month_custom1_TODO").css("display","none"),$("#month_custom2_TODO").css("display","none"),$("#year_custom1_TODO").css("display","none"),$("#year_custom2_TODO").css("display","none"),$("#year_custom3_TODO").css("display","none"),$("#repeat_details_TODO").css("display","none")),null==e||""==e.type||globalSettings.appleremindersmode.value&&("COMPLETED"==e.status||"CANCELLED"==e.status)||globalSettings.appleremindersmode.value&&"undefined"==typeof globalAppleSupport.nextDates[e.id]?$("#editOptionsButtonTODO").hide():$("#editOptionsButtonTODO").click(function(){showTodoForm(globalCalTodo,"show","",!0)}),("editOnly"==a||"futureOnly"==a||$("#recurrenceIDTODO").val())&&$("#calendarLineTODO").hide(),e&&e.after&&"futureOnly"==a&&$("#repeat_end_after_TODO").val(e.after-e.realRepeatCount+1),$("#percenteCompleteValue").val(_),$("#percentageSlider").slider({animate:!0,range:"min",value:_,min:0,max:100,step:1,slide:function(e,t){$("#percenteCompleteValue").val(t.value),$(this).parent().parent().find("img").css("display","none")},change:function(e,t){var a;a=t.value>99&&"CANCELLED"===$("#statusTODO").val()?"CANCELLED":t.value>99?"COMPLETED":t.value>0&&!globalSettings.appleremindersmode.value?"IN-PROCESS":"NEEDS-ACTION",$("#statusTODO").val(a),todoStatusChanged(a)}}),globalSettings.timezonesupport.value||$(".timezone_rowTODO").css("display","none"),"none"==$("#todo_type").val()&&stripTodoAlerts(),"new"!=t&&$("#closeTODO").hide(),globalObjectLoading=!1,$("#CATodo").show(200,function(){$("#todoColor").css("background-color",r),checkTodoFormScrollBar(),$("#todoForm").scrollTop(0)})}function bindTodoForm(){initCalDavDatepicker($("#todo_details_template")),initCalDavTimepicker($("#todo_details_template")),$("#todo_details_template .alert_message_detailsTODO").change(function(){var e=$(this).attr("data-id");if($('.before_after_inputTODO[data-id="'+e+'"]').parent().parent().find("img").css("display","none"),"on_dateTODO"==$('.alert_message_detailsTODO[data-id="'+e+'"] option:selected').attr("data-type")){var t=new Date;if(t.setDate(t.getDate()+7),$(".dateTrToTODO").is(":visible")&&0==$(".dateTrToTODO img:visible").length){var a=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_toTODO").val()),l=$.fullCalendar.formatDate(a,"MM/dd/yyyy, ");t=new Date(Date.parse(l+$("#time_toTODO").val())),t.setHours(t.getHours()-1)}else if($(".dateTrFromTODO").is(":visible")&&0==$(".dateTrFromTODO img:visible").length){var a=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_fromTODO").val()),l=$.fullCalendar.formatDate(a,"MM/dd/yyyy, ");t=new Date(Date.parse(l+$("#time_fromTODO").val())),t.setHours(t.getHours()-1)}$('.message_date_inputTODO[data-id="'+e+'"]').val($.datepicker.formatDate(globalSettings.datepickerformat.value,t)),$('.message_date_inputTODO[data-id="'+e+'"]').show(),$('.message_time_inputTODO[data-id="'+e+'"]').val($.fullCalendar.formatDate(t,globalSettings.ampmformat.value?"hh:mm TT":"HH:mm")),$('.message_time_inputTODO[data-id="'+e+'"]').show(),$('.before_after_inputTODO[data-id="'+e+'"]').hide()}else $('.message_date_inputTODO[data-id="'+e+'"]').hide(),$('.message_time_inputTODO[data-id="'+e+'"]').hide(),$('.before_after_inputTODO[data-id="'+e+'"]').show(),$('.before_after_inputTODO[data-id="'+e+'"]').val("15")}),$("#todo_details_template .before_after_inputTODO").bind("keyup change",function(){""==$(this).val()?$(this).parent().find("img").css("display","inline"):null==$(this).val().match("^[0-9]+$")?$(this).parent().find("img").css("display","inline"):$(this).parent().find("img").css("display","none")}),$("#todo_details_template .alertTODO").change(function(){var e=$(this).attr("data-id");if("none"!=$(this).val()){$('.alert_detailsTODO[data-id="'+e+'"]').show(),$('.alert_message_dateTODO[data-id="'+e+'"]').show(),"none"!=$("#todo_type").val()&&expandTodoAlerts();var t=new Date;if(t.setDate(t.getDate()+7),$(".dateTrToTODO").is(":visible")&&0==$(".dateTrToTODO img:visible").length){var a=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_toTODO").val()),l=$.fullCalendar.formatDate(a,"MM/dd/yyyy, ");t=new Date(Date.parse(l+$("#time_toTODO").val())),t.setHours(t.getHours()-1)}else if($(".dateTrFromTODO").is(":visible")&&0==$(".dateTrFromTODO img:visible").length){var a=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_fromTODO").val()),l=$.fullCalendar.formatDate(a,"MM/dd/yyyy, ");t=new Date(Date.parse(l+$("#time_fromTODO").val())),t.setHours(t.getHours()-1)}$('.message_date_inputTODO[data-id="'+e+'"]').val($.datepicker.formatDate(globalSettings.datepickerformat.value,t)),$('.message_time_inputTODO[data-id="'+e+'"]').val($.fullCalendar.formatDate(t,globalSettings.ampmformat.value?"hh:mm TT":"HH:mm")),todo_alert_add(e)}else{$('.alert_detailsTODO[data-id="'+e+'"]').hide(),$('.alert_message_dateTODO[data-id="'+e+'"]').hide(),checkForTodo(e);var e=$(this).attr("data-id");$('#todo_details_template tr[data-id="'+e+'"]').remove()}checkTodoFormScrollBar()}),$("#repeat_end_after_TODO, #repeat_interval_detail_TODO").bind("keyup change",function(){""==$(this).val()?$(this).parent().find("img").css("display","inline"):null==$(this).val().match("^[0-9]+$")||parseInt($(this).val(),10)<1?$(this).parent().find("img").css("display","inline"):$(this).parent().find("img").css("display","none")}),$("#repeat_month_custom_select_TODO").change(function(){"custom"==$(this).val()?($("#month_custom2_TODO").show(),$("#repeat_month_custom_select2_TODO").parent().hide()):($("#month_custom2_TODO").hide(),$("#repeat_month_custom_select2_TODO").parent().show()),checkTodoFormScrollBar()}),$("#repeat_year_custom_select1_TODO").change(function(){"custom"==$(this).val()?($("#year_custom1_TODO").show(),$("#repeat_year_custom_select2_TODO").parent().hide()):($("#year_custom1_TODO").hide(),$("#repeat_year_custom_select2_TODO").parent().show()),checkTodoFormScrollBar()}),$("#repeat_end_details_TODO").change(function(){if($("#repeat_end_date_TODO").parent().find("img").css("display","none"),"repeat_details_on_date"==$("#repeat_end_details_TODO option:selected").attr("data-type")){$("#repeat_end_after_TODO").hide(),$("#repeat_end_date_TODO").show();var e;""!=$("#date_fromTODO").val()?(e=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_fromTODO").val()),null==e&&(e=new Date)):e=new Date;var t=new Date(e.getFullYear(),e.getMonth(),e.getDate()+2);$("#repeat_end_date_TODO").val($.datepicker.formatDate(globalSettings.datepickerformat.value,t))}"repeat_details_after"==$("#repeat_end_details_TODO option:selected").attr("data-type")&&($("#repeat_end_after_TODO").show(),$("#repeat_end_after_TODO").val("2"),$("#repeat_end_date_TODO").hide()),"repeat_details_never"==$("#repeat_end_details_TODO option:selected").attr("data-type")&&($("#repeat_end_after_TODO").hide(),$("#repeat_end_date_TODO").hide()),checkTodoFormScrollBar()}),$("#todo_details_template .customTable td").click(function(){return!!$(this).hasClass("disabled")||void($(this).hasClass("selected")?$(this).removeClass("selected"):$(this).addClass("selected"))}),$("#closeTODO").click(function(){if($("#todoInEdit").val("false"),""!=$("#uidTODO").val()){var e=$("#uidTODO").val(),t=e.substring(0,e.lastIndexOf("/")+1),a=$("#ResourceCalDAVTODOList").find("[data-id='"+t+"']").find(".resourceCalDAVColor").css("background-color");$('.event_item[data-id="'+e+'"]').children(".fc-event-handle").css({"background-color":rgbToRgba(a,.9),"border-color":a})}$("#TodoDisabler").fadeOut(globalEditorFadeAnimation,function(){$("#timezonePickerTODO").prop("disabled",!1)}),"undefined"!=typeof globalCalTodo&&null!=globalCalTodo&&globalVisibleCalDAVTODOCollections.indexOf(globalCalTodo.res_id)!=-1?$("#todoList").fullCalendar("selectEvent"):$("#CATodo").attr("style","display:none")}),$("#resetTODO").click(function(){if($("#todo_details_template").find("img[data-type=invalidSlider],img[data-type=invalidSmall]").css("display","none"),""!=$("#uidTODO").val()){var e=$("#uidTODO").val(),t=e.substring(0,e.lastIndexOf("/")+1),a=$("#ResourceCalDAVTODOList").find("[data-id='"+t+"']").find(".resourceCalDAVColor").css("background-color");$('.event_item[data-id="'+e+'"]').children(".fc-event-handle").css({
"background-color":rgbToRgba(a,.9),"border-color":a}),""!=$("#recurrenceIDTODO").val()?showTodoForm(globalCalTodo,"show","editOnly"):showTodoForm(globalCalTodo,"show"),startEditModeTodo()}}),$("#todo_calendar").change(function(){var e="";e="choose"==$(this).val()?"rgb(240,240,240)":$("#ResourceCalDAVTODOList").find("[data-id='"+$(this).val()+"']").find(".resourceCalDAVColor").css("background-color");var t="fooUID";""!=$("#uidTODO").val()&&(t=$("#uidTODO").val()),$("#todoColor").css("background-color",e),$('.event_item[data-id="'+t+'"]').find(".fc-event-handle").css({"background-color":rgbToRgba(e,.9),"border-color":e})}),$("#repeat_TODO").change(function(){if("repeat_no-repeat"==$("#repeat_TODO option:selected").attr("data-type")||"custom_repeat"==$("#repeat_TODO option:selected").attr("data-type"))$("#repeat_details_TODO").hide(),$("#repeat_interval_TODO").hide(),$("#week_custom_TODO").hide(),$("#month_custom1_TODO").hide(),$("#month_custom2_TODO").hide(),$("#year_custom1_TODO").hide(),$("#year_custom2_TODO").hide(),$("#year_custom3_TODO").hide();else{$("#repeat_details_TODO").show(),"BUSINESS"!=$(this).val()&&"TWO_WEEKLY"!=$(this).val()&&"WEEKEND"!=$(this).val()?($("#repeat_interval_TODO").show(),$("#repeat_interval_detail_TODO").val("1"),$("#repeat_interval_TODO").find("img").css("display","none")):$("#repeat_interval_TODO").hide(),"DAILY"==$(this).val()&&$('#repeat_interval_TODO [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatDays),"WEEKLY"==$(this).val()&&$('#repeat_interval_TODO [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatWeeks),"MONTHLY"==$(this).val()&&$('#repeat_interval_TODO [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatMonths),"YEARLY"==$(this).val()&&$('#repeat_interval_TODO [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatYears),"CUSTOM_WEEKLY"==$(this).val()?($('#repeat_interval_TODO [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatWeeks),$("#week_custom_TODO").show()):$("#week_custom_TODO").hide(),"CUSTOM_MONTHLY"==$(this).val()?($('#repeat_interval_TODO [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatMonths),$("#month_custom1_TODO").show(),"custom"==$("#repeat_month_custom_select_TODO").val()&&$("#repeat_month_custom_select_TODO").trigger("change")):($("#month_custom1_TODO").hide(),$("#month_custom2_TODO").hide()),"CUSTOM_YEARLY"==$(this).val()?($('#repeat_interval_TODO [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatYears),$("#year_custom2_TODO").show(),$("#year_custom3_TODO").show(),"custom"==$("#repeat_year_custom_select1_TODO").val()&&$("#repeat_year_custom_select1_TODO").trigger("change")):($("#year_custom1_TODO").hide(),$("#year_custom2_TODO").hide(),$("#year_custom3_TODO").hide());var e;""!=$("#date_fromTODO").val()?(e=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_fromTODO").val()),null==e&&(e=new Date)):e=new Date;var t=new Date(e.getFullYear(),e.getMonth(),e.getDate()+2);$("#repeat_end_date_TODO").val($.datepicker.formatDate(globalSettings.datepickerformat.value,t))}checkTodoFormScrollBar()}),$("#statusTODO").change(function(){var e=$(this).val();switch(e){case"NEEDS-ACTION":$("#percenteCompleteValue").val(0),$("#percentageSlider").slider({value:0}),$("#nameTODO").removeClass("title_cancelled");break;case"IN-PROCESS":var t=50,a=$(".fc-event-selected").attr("data-repeat-hash");"undefined"!=typeof globalTodolistStatusArray[a]&&"undefined"!=typeof globalTodolistStatusArray[a].percent&&(t=globalTodolistStatusArray[a].percent),$("#percenteCompleteValue").val(t),$("#percentageSlider").slider({value:t}),$("#nameTODO").removeClass("title_cancelled");break;case"CANCELLED":$("#percenteCompleteValue").val(100),$("#percentageSlider").slider({value:100}),$("#nameTODO").addClass("title_cancelled");break;case"COMPLETED":$("#percenteCompleteValue").val(100),$("#percentageSlider").slider({value:100}),$("#nameTODO").removeClass("title_cancelled")}todoStatusChanged(e)}),$("#todo_type").change(function(){if("none"==$(this).val())$("#timezoneTODO").val("local"),$("#repeat_row_TODO").hide(),$("#date_fromTODO, #time_fromTODO, #date_toTODO, #time_toTODO").parent().find("img").css("display","none"),$(".dateTrFromTODO, .dateTrToTODO, .timezone_rowTODO").hide(),stripTodoAlerts();else if("start"==$(this).val()){var e=new Date;$("#date_fromTODO").val($.datepicker.formatDate(globalSettings.datepickerformat.value,e)),$("#time_fromTODO").val($.fullCalendar.formatDate(e,globalSettings.ampmformat.value?"hh:mm TT":"HH:mm")),$("#repeat_row_TODO").show(),$("#date_toTODO, #time_toTODO").parent().find("img").css("display","none"),$(".dateTrToTODO").hide(),$(".dateTrFromTODO").show(),globalSettings.timezonesupport.value&&($(".timezone_rowTODO").show(),$("#timezoneTODO").val(globalSessionTimeZone)),$("#date_fromTODO, #time_fromTODO").trigger("change")}else if("due"==$(this).val()){var e=new Date($("#todoList").fullCalendar("getView").start.getTime());e.setHours(globalSettings.calendarendofbusiness.value),e.setMinutes(globalSettings.calendarendofbusiness.value%1*60),$("#date_toTODO").val($.datepicker.formatDate(globalSettings.datepickerformat.value,e)),$("#time_toTODO").val($.fullCalendar.formatDate(e,globalSettings.ampmformat.value?"hh:mm TT":"HH:mm")),$("#repeat_row_TODO").show(),$("#date_fromTODO, #time_fromTODO").parent().find("img").css("display","none"),$(".dateTrFromTODO").hide(),$(".dateTrToTODO").show(),globalSettings.timezonesupport.value&&($(".timezone_rowTODO").show(),$("#timezoneTODO").val(globalSessionTimeZone)),$("#date_toTODO, #time_toTODO").trigger("change")}else if("both"==$(this).val()){var e="",t=new Date;if(""!=$("#date_toTODO").val())var a=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_toTODO").val()),l=$.fullCalendar.formatDate(a,"yyyy-MM-dd"),r=new Date(Date.parse("01/02/1990, "+$("#time_toTODO").val())),o=$.fullCalendar.formatDate(r,"HH:mm:ss"),e=$.fullCalendar.parseDate(l+"T"+o);else e=new Date($("#todoList").fullCalendar("getView").start.getTime()),$("#repeat_row_TODO").show(),e.setHours(globalSettings.calendarendofbusiness.value),e.setMinutes(globalSettings.calendarendofbusiness.value%1*60),""==$("#date_toTODO").val()&&$("#date_toTODO").val($.datepicker.formatDate(globalSettings.datepickerformat.value,e)),""==$("#time_toTODO").val()&&$("#time_toTODO").val($.fullCalendar.formatDate(e,globalSettings.ampmformat.value?"hh:mm TT":"HH:mm"));t>e&&(t=new Date(e.getTime())),globalPrevDate=new Date(t.getTime()),""==$("#date_fromTODO").val()&&$("#date_fromTODO").val($.datepicker.formatDate(globalSettings.datepickerformat.value,t)),""==$("#time_fromTODO").val()&&$("#time_fromTODO").val($.fullCalendar.formatDate(t,globalSettings.ampmformat.value?"hh:mm TT":"HH:mm")),$(".dateTrFromTODO, .dateTrToTODO").show(),globalSettings.timezonesupport.value&&($(".timezone_rowTODO").show(),$("#timezoneTODO").val(globalSessionTimeZone)),$("#date_fromTODO, #time_fromTODO, #date_toTODO, #time_toTODO").trigger("change")}"none"!=$("#todo_type").val()&&expandTodoAlerts(),checkTodoFormScrollBar()}),$("#percenteCompleteValue").bind("keyup change",function(){""==$(this).val()?$(this).parent().find("img").css("display","inline"):null==$(this).val().match("^(([0-9])|([1-9][0-9])|(100))$")?$(this).parent().find("img").css("display","inline"):($(this).parent().find("img").css("display","none"),$("#percentageSlider").slider({value:$(this).val()}))})}function showEventForm(e,t,a,l,r,o,i){$("#event_details_template").remove(),$("#CAEvent").html(cleanVcalendarTemplate),setFirstDayEvent(),bindEventForm(),$("#note").autosize({defaultStyles:{height:"64",overflow:"","overflow-y":"","word-wrap":"",resize:"none"},callback:function(){checkEventFormScrollBar()}}),$("#show").val(""),$("#uid").val(""),$("#etag").val(""),$("#repeatCount").val(""),$("#repeatEvent").val(""),$("#recurrenceID").val(""),$("#futureStart").val(""),$("#vcalendarHash").val(""),$("#vcalendarUID").val(""),globalPrevDate="";var n="";if("new"==r){var s=$("#ResourceCalDAVList").find(".resourceCalDAV_item.resourceCalDAV_item_selected");s.length>0&&!globalResourceCalDAVList.getEventCollectionByUID(s.attr("data-id")).permissions.read_only&&(n=rgbToHex(s.children(".resourceCalDAVColor").css("background-color")))}else n=globalResourceCalDAVList.getEventCollectionByUID(a.res_id).ecolor;if(i)return $("#show").val(a.id),$("#repeatEvent").val(!0),$("#CAEvent").show(),$("#repeatConfirmBox").css("visibility","visible"),""!=a.repeatCount&&1==a.repeatCount?($("#editFuture").css("display","none"),$("#editFuture").next("br").length>0&&$("#editFuture").next().remove()):"none"==$("#editFuture").css("display")&&($("#editFuture").css("display","block"),0==$("#editFuture").next("br").length&&$("#editFuture").after("<br/>")),$("#repeatConfirmBoxContent").html("<b>"+a.title+"</b> "+localization[globalInterfaceLanguage].repeatBoxContent),$("#repeatConfirmBoxQuestion").html(localization[globalInterfaceLanguage].repeatBoxQuestion),$("#editAll, #editOnlyOne, #editFuture").click(function(){globalCalEvent&&("editOnlyOne"==$(this).attr("id")?showEventForm(null,globalCalEvent.allDay,globalCalEvent,globalJsEvent,"show","editOnly"):"editAll"==$(this).attr("id")?showEventForm(null,globalCalEvent.allDay,globalCalEvent,globalJsEvent,"show",""):"editFuture"==$(this).attr("id")&&showEventForm(null,globalCalEvent.allDay,globalCalEvent,globalJsEvent,"show","futureOnly"),$("#repeatConfirmBoxContent").html(""),$("#repeatConfirmBox").css("visibility","hidden"),$("#AlertDisabler").fadeOut(globalEditorFadeAnimation))}),$("#CAEvent").height($("#repeatConfirmBox").height()),$("#eventColor").css("background-color",n),updateEventFormDimensions(),setFormPosition(l,!0),$("#event_details_template").scrollTop(0),!0;if("show"==r&&"futureOnly"==o&&$("#futureStart").val(a.realRepeatCount+";"+a.start),"new"!=r?fullVcalendarToData(a):CalDAVeditor_cleanup(),null!=a&&("editOnly"==o&&a.type||a.rec_id)){var d=jQuery.grep(globalEventList.displayEventsArray[a.res_id],function(e){if(e.id==a.id)return!0}).sort(repeatStartCompare);d.indexOf(a)!=-1&&(d.indexOf(a)<d.length-1&&showEventNextNav(),0!=d.indexOf(a)&&showEventPrevNav())}for(var p=globalResourceCalDAVList.sortedCollections,_=$("#event_calendar"),c=($(".resourceCalDAV_item.resourceCalDAV_item_selected").attr("data-id"),0);c<p.length;c++)void 0!=p[c].uid&&(null!=a&&a.res_id==p[c].uid||p[c].makeLoaded&&!p[c].permissions_read_only)&&_.append(new Option(p[c].displayValue,p[c].uid));if("new"==r&&($("#show").val(""),$("#editButton").hide(),$("#duplicateButton").hide(),$("#editOptionsButton").hide(),$("#resetButton").hide(),$("#deleteButton").hide(),$("#ResourceCalDAVList").find(".resourceCalDAV_item.resourceCalDAV_item_selected").length>0&&$("#event_calendar").find('option[value="'+$("#ResourceCalDAVList").find(".resourceCalDAV_item.resourceCalDAV_item_selected").attr("data-id")+'"]').length>0?$(".R_calendar").val($("#ResourceCalDAVList").find(".resourceCalDAV_item.resourceCalDAV_item_selected").attr("data-id")):$("#event_calendar").val("choose")),"drop"==r&&""!=a.etag&&$("#event_calendar").val(a.res_id),"new"==r){var m=null;null!==a&&(e=a.realStart?a.realStart:a.start,m=a.realEnd?new Date(a.realEnd.getTime()):new Date(a.end.getTime())),t||null!=m&&m-e!=0||(m=new Date(e.getTime()),null!==globalSettings.defaulteventduration.value?m.setMinutes(m.getMinutes()+globalSettings.defaulteventduration.value):(m.setHours(globalSettings.calendarendofbusiness.value),m.setMinutes(globalSettings.calendarendofbusiness.value%1*60)),m.getTime()<e.getTime()&&m.setDate(m.getDate()+1));var u=$("#main").width()-$("#calendar").width();$("#calendar").fullCalendar("renderEvent",$.extend(new items("",e,m,localization[globalInterfaceLanguage].pholderNewEvent,t,"fooUID","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""),{backgroundColor:hexToRgba(n,.9),borderColor:n,textColor:checkFontColor(n)}));var v=$("#main").width()-$("#calendar").width();rerenderCalendar(u!=v),t&&($("#allday").prop("checked",!0),$("#time_from_cell").css("visibility","hidden"),$("#time_to_cell").css("visibility","hidden"),$(".timezone_row").css("display","none")),showTimezones("","")}if("show"==r||"drop"==r){if("CANCELLED"==a.status&&$("#name").addClass("title_cancelled"),$("#name").val(a.title),$("#location").val(a.location),1==a.allDay&&($("#allday").prop("checked",!0),$("#time_from_cell").css("visibility","hidden"),$("#time_to_cell").css("visibility","hidden"),$(".timezone_row").css("display","none")),a.end&&(m=!a.realEnd||"drop"==r&&"editOnly"==o?new Date(a.end.getTime()):new Date(a.realEnd.getTime())),$("#note").val(a.note).trigger("autosize.resize"),"undefined"!=typeof a.classType&&null!=a.classType&&""!=a.classType?$("#type").val(a.classType.toLowerCase()):$("#type").val("public"),""!=a.status?$("#status").val(a.status):$("#status").val("NONE"),null!=a&&"new"!=r){var f=a.id.match(vCalendar.pre.uidParts);decodeURIComponent(f[4]).indexOf(f[2])==-1&&$(".row_type").css("display","none")}if("OPAQUE"==a.avail?$("#avail").val("busy"):$("#avail").val("free"),null!=a){var O=parseInt(a.priority,10);5==O?$("#priority").val(5):O>5&&O<10?($('#priority [data-type="priority_low"]').attr("value",O),$("#priority").val(O)):O<5&&O>0?($('#priority [data-type="priority_high"]').attr("value",O),$("#priority").val(O)):$("#priority").val(0)}$("#uid").val(a.id),$("#url_EVENT").val(a.hrefUrl+""),$("#vcalendarHash").val(String(CryptoJS.SHA256(a.vcalendar))),$("#etag").val(a.etag);var g=a.vcalendar.match(vCalendar.pre.contentline_UID);null!=g&&(g=g[0].match(vCalendar.pre.contentline_parse)[4]),g&&$("#vcalendarUID").val(g);for(var h="",D=0;D<a.alertTime.length;D++)if(D>0&&event_alert_add(D),$(".alert[data-id="+(D+1)+"]").val("message"),"-"==a.alertTime[D].charAt(0)||"+"==a.alertTime[D].charAt(0)){var T=parseInt(a.alertTime[D].substring(1,a.alertTime[D].length-1)),y="";"W"==a.alertTime[D].charAt(a.alertTime[D].length-1)?(T=T/1e3/60/60/24/7,y="weeks"):"D"==a.alertTime[D].charAt(a.alertTime[D].length-1)?(T=T/1e3/60/60/24,y="days"):"H"==a.alertTime[D].charAt(a.alertTime[D].length-1)?(T=T/1e3/60/60,y="hours"):"M"==a.alertTime[D].charAt(a.alertTime[D].length-1)?(T=T/1e3/60,y="minutes"):"S"==a.alertTime[D].charAt(a.alertTime[D].length-1)&&(T/=1e3,y="seconds"),y+="-"==a.alertTime[D].charAt(0)?"_before":"_after",$(".alert_message_details[data-id="+(D+1)+"]").val(y),$(".before_after_input[data-id="+(D+1)+"]").val(T),$('.alert_details[data-id="'+(D+1)+'"]').show(),$('.alert_message_date[data-id="'+(D+1)+'"]').show(),$('.before_after_input[data-id="'+(D+1)+'"]').show(),$(".message_date_input[data-id="+(D+1)+"]").hide(),$(".message_time_input[data-id="+(D+1)+"]").hide()}else{h=$.fullCalendar.parseDate(a.alertTime[D]),B=h.getHours()<10?"0"+h.getHours():h.getHours(),N=h.getMinutes()<10?"0"+h.getMinutes():h.getMinutes(),$(".alert_message_details[data-id="+(D+1)+"]").val("on_date");var b=$.datepicker.formatDate(globalSettings.datepickerformat.value,h);$(".message_date_input[data-id="+(D+1)+"]").val(b),$(".message_time_input[data-id="+(D+1)+"]").val($.fullCalendar.formatDate(h,globalSettings.ampmformat.value?"hh:mm TT":"HH:mm")),$('.alert_details[data-id="'+(D+1)+'"]').show(),$('.alert_message_date[data-id="'+(D+1)+'"]').show()}if(D>0&&event_alert_add(D+2),""!=a.type&&"editOnly"!=o&&null!=a.ruleString.match(vCalendar.re.recurCaldav)){var w=a.vcalendar.match(vCalendar.pre.contentline_RRULE2)[0].match(vCalendar.pre.contentline_parse)[4];if(w.indexOf("BYMONTH=")!=-1||w.indexOf("BYMONTHDAY=")!=-1||w.indexOf("BYDAY=")!=-1){var C=w.split(";");if(C.indexElementOf("BYMONTH=")!=-1&&C.indexElementOf("BYMONTHDAY=")==-1&&C.indexElementOf("BYDAY=")==-1&&(C[C.length]="BYMONTHDAY="+a.start.getDate()),"DAILY"==a.type)$("#repeat option[value='DAILY']").prop("selected",!0),$('#repeat_interval [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatDays);else if("WEEKLY"==a.type){$("#repeat option[value='CUSTOM_WEEKLY']").prop("selected",!0),$('#repeat_interval [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatWeeks);for(var k=0;k<C.length;k++)if(C[k].indexOf("BYDAY=")!=-1){var x=C[k].split("=")[1];x=x.replace(/\d*MO/,1).replace(/\d*TU/,2).replace(/\d*WE/,3).replace(/\d*TH/,4).replace(/\d*FR/,5).replace(/\d*SA/,6).replace(/\d*SU/,0).split(",");for(var S=0;S<x.length;S++)isNaN(parseInt(x[S],10))||$('#week_custom .customTable td[data-type="'+x[S]+'"]').addClass("selected")}$("#week_custom").show()}else if("MONTHLY"==a.type){$("#repeat option[value='CUSTOM_MONTHLY']").prop("selected",!0).change(),$('#repeat_interval [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatMonths);for(var k=0;k<C.length;k++)if(C[k].indexOf("BYDAY=")!=-1){var x=C[k].split("=")[1];x=x.split(",");for(var S=0;S<x.length;S++){var E=x[S].match(vCalendar.pre["+/-number"]);if(x[S]=x[S].replace(E[0],""),!isNaN(parseInt(E[0],10))){switch(parseInt(E[0],10)){case 1:$("#repeat_month_custom_select").val("first");break;case 2:$("#repeat_month_custom_select").val("second");break;case 3:$("#repeat_month_custom_select").val("third");break;case 4:$("#repeat_month_custom_select").val("fourth");break;case 5:$("#repeat_month_custom_select").val("fifth");break;case-1:$("#repeat_month_custom_select").val("last");break;default:$("#repeat_month_custom_select").val("every")}$("#repeat_month_custom_select2").val(x[S])}}}else if(C[k].indexOf("BYMONTHDAY=")!=-1){$("#repeat_month_custom_select").val("custom").change();var A=C[k].split("=")[1];A=A.split(",");for(var S=0;S<A.length;S++)parseInt(A[S],10)==-1?($("#repeat_month_custom_select").val("last").change(),$("#repeat_month_custom_select2").val("DAY")):$('#month_custom2 .customTable td[data-type="'+parseInt(A[S],10)+'"]').addClass("selected")}}else if("YEARLY"==a.type){$("#repeat option[value='CUSTOM_YEARLY']").prop("selected",!0).change(),$('#repeat_interval [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatYears);for(var H=!1,k=0;k<C.length;k++)if(C[k].indexOf("BYDAY=")!=-1){var x=C[k].split("=")[1];x=x.split(",");for(var S=0;S<x.length;S++){var E=x[S].match(vCalendar.pre["+/-number"]);if(x[S]=x[S].replace(E[0],""),!isNaN(parseInt(E[0],10))){switch(parseInt(E[0],10)){case 1:$("#repeat_year_custom_select1").val("first");break;case 2:$("#repeat_year_custom_select1").val("second");break;case 3:$("#repeat_year_custom_select1").val("third");break;case 4:$("#repeat_year_custom_select1").val("fourth");break;case 5:$("#repeat_year_custom_select1").val("fifth");break;case-1:$("#repeat_year_custom_select1").val("last");break;default:$("#repeat_year_custom_select1").val("every")}$("#repeat_year_custom_select2").val(x[S])}}}else if(C[k].indexOf("BYMONTHDAY=")!=-1){$("#repeat_year_custom_select1").val("custom").change();var A=C[k].split("=")[1];A=A.split(",");for(var S=0;S<A.length;S++)parseInt(A[S],10)==-1?($("#repeat_year_custom_select1").val("last").change(),$("#repeat_year_custom_select2").val("DAY")):$('#year_custom1 .customTable td[data-type="'+parseInt(A[S],10)+'"]').addClass("selected");H=!0}else if(C[k].indexOf("BYMONTH=")!=-1){var L=C[k].split("=")[1];L=L.split(",");for(var S=0;S<L.length;S++)$('#year_custom3 .customTable td[data-type="'+(parseInt(L[S],10)-1)+'"]').addClass("selected")}}if(""==a.after&&""==a.untilDate)$("#repeat_end_details option[value='never']").prop("selected",!0);else if(""!=a.after)$("#repeat_end_details option[value='after']").prop("selected",!0),$("#repeat_end_after").val(a.after);else if(""!=a.untilDate){e=$.fullCalendar.parseDate(a.untilDate),$("#repeat_end_details option[value='on_date']").prop("selected",!0);var M=$.datepicker.formatDate(globalSettings.datepickerformat.value,e);$("#repeat_end_date").val(M)}if($("#repeat_interval_detail").val(a.interval),$("#repeat_interval").show(),a.byDay.length>0){var I=new Array;if(globalSettings.weekenddays.value.length>0)for(var c=0;c<7;c++)globalSettings.weekenddays.value.indexOf(c)==-1&&(I[I.length]=c+"");for(var Y=0,z=0,c=0;c<x.length;c++)I.indexOf(x[c])!=-1&&Y++,globalSettings.weekenddays.value.indexOf(parseInt(x[c],10))!=-1&&z++;I.length>0&&I.length==Y?($("#repeat option[value='BUSINESS']").prop("selected",!0),$("#repeat_interval").hide(),$("#week_custom").hide()):globalSettings.weekenddays.value.length>0&&globalSettings.weekenddays.value.length==z&&($("#repeat option[value='WEEKEND']").prop("selected",!0),$("#repeat_interval").hide(),$("#week_custom").hide())}}else{if("DAILY"==a.type?($("#repeat option[value='DAILY']").prop("selected",!0),$('#repeat_interval [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatDays)):"WEEKLY"==a.type?($("#repeat option[value='WEEKLY']").prop("selected",!0),$('#repeat_interval [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatWeeks)):"MONTHLY"==a.type?($("#repeat option[value='MONTHLY']").prop("selected",!0),$('#repeat_interval [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatMonths)):"YEARLY"==a.type&&($("#repeat option[value='YEARLY']").prop("selected",!0),$('#repeat_interval [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatYears)),""==a.after&&""==a.untilDate)$("#repeat_end_details option[value='never']").prop("selected",!0);else if(""!=a.after)$("#repeat_end_details option[value='after']").prop("selected",!0),$("#repeat_end_after").val(a.after);else if(""!=a.untilDate){e=$.fullCalendar.parseDate(a.untilDate),$("#repeat_end_details option[value='on_date']").prop("selected",!0);var M=$.datepicker.formatDate(globalSettings.datepickerformat.value,e);$("#repeat_end_date").val(M)}$("#repeat_interval_detail").val(a.interval),$("#repeat_interval").show(),a.byDay.length>0&&(a.byDay.indexOf("1")!=-1&&a.byDay.indexOf("2")!=-1&&a.byDay.indexOf("3")!=-1&&a.byDay.indexOf("4")!=-1&&a.byDay.indexOf("5")!=-1&&a.byDay.indexOf("6")==-1&&a.byDay.indexOf("0")==-1?($("#repeat option[value='BUSINESS']").prop("selected",!0),$("#repeat_interval").hide()):a.byDay.indexOf("1")==-1&&a.byDay.indexOf("2")==-1&&a.byDay.indexOf("3")==-1&&a.byDay.indexOf("4")==-1&&a.byDay.indexOf("5")==-1&&a.byDay.indexOf("6")!=-1&&a.byDay.indexOf("0")!=-1&&($("#repeat option[value='WEEKEND']").prop("selected",!0),$("#repeat_interval").hide())),$("#repeatEvent").val(!0)}}else if(""!=a.type&&"editOnly"!=o){var F=new Option(localization[globalInterfaceLanguage].customRepeat,a.ruleString,!1,!0);$(F).attr("data-type","custom_repeat"),$("#repeat").append(F)}else $("#repeatEvent").val(!1);a.timeZone?showTimezones(a.timeZone,""):showTimezones("local","")}var B,N;if("show"==r&&$("#show").val(a.id),("show"==r||"drop"==r)&&($("#repeatCount").val(a.repeatCount),e=!a.realStart||"drop"==r&&"editOnly"==o?a.start:a.realStart,$("#show").val()&&(a.repeatStart&&""==o&&(e=new Date(a.repeatStart.getTime())),a.repeatEnd&&""==o&&(m=new Date(a.repeatEnd.getTime()))),"editOnly"==o?"drop"==r&&globalPrevDragEventAllDay||"drop"!=r&&a.allDay?a.realStart?$("#recurrenceID").val($.fullCalendar.formatDate($.fullCalendar.parseDate(a.realStart),"yyyyMMdd")):$("#recurrenceID").val($.fullCalendar.formatDate(e,"yyyyMMdd")):a.realStart?$("#recurrenceID").val($.fullCalendar.formatDate(a.realStart,"yyyyMMdd'T'HHmmss")):$("#recurrenceID").val($.fullCalendar.formatDate(e,"yyyyMMdd'T'HHmmss")):$("#recurrenceID").val(a.rec_id),a.rec_id||"editOnly"==o||"futureOnly"==o)){var V=jQuery.grep(globalEventList.displayEventsArray[a.res_id],function(e){if(e.id==a.id&&(e.repeatCount<2||!e.repeatCount))return!0});(V.length>1||"futureOnly"==o&&a.repeatCount>1||"editOnly"==o&&""!=a.type)&&$("#deleteButton").attr("onclick","updateEventFormDimensions(true);$('#CAEvent .saveLoader').show();save(false, true);")}var R=new Date,U=new Date(R.getTime());U.setHours(0),U.setMinutes(0),U.setSeconds(0),U.setMilliseconds(0);var W=new Date(e.getTime());if(W.setHours(0),W.setMinutes(0),W.setSeconds(0),W.setMilliseconds(0),t&&(null!==globalSettings.defaulteventduration.value&&U.getTime()===W.getTime()?R.getMinutes()>0?(e.setHours(R.getHours()+1),e.setMinutes(0)):(e.setHours(R.getHours()),e.setMinutes(R.setMinutes())):(e.setHours(globalSettings.calendarstartofbusiness.value),e.setMinutes(globalSettings.calendarstartofbusiness.value%1*60))),$("#date_from").val($.datepicker.formatDate(globalSettings.datepickerformat.value,e)),$("#time_from").val($.fullCalendar.formatDate(e,globalSettings.ampmformat.value?"hh:mm TT":"HH:mm")),globalPrevDate=new Date(e.getTime()),"undefined"!=typeof m&&null!==m||(m=new Date(e.getTime())),t&&(null!==globalSettings.defaulteventduration.value?(m.setHours(e.getHours()),m.setMinutes(e.getMinutes()+globalSettings.defaulteventduration.value)):(m.setHours(globalSettings.calendarendofbusiness.value),m.setMinutes(globalSettings.calendarendofbusiness.value%1*60))),m.getTime()<e.getTime()&&m.setDate(m.getDate()+1),$("#date_to").val($.datepicker.formatDate(globalSettings.datepickerformat.value,m)),$("#time_to").val($.fullCalendar.formatDate(m,globalSettings.ampmformat.value?"hh:mm TT":"HH:mm")),"repeat_no-repeat"!=$("#repeat option:selected").attr("data-type")&&"custom_repeat"!=$("#repeat option:selected").attr("data-type")&&$("#repeat_details").show(),"repeat_details_on_date"==$("#repeat_end_details option:selected").attr("data-type")&&($("#repeat_end_after").hide(),$("#repeat_end_date").show()),"repeat_details_after"==$("#repeat_end_details option:selected").attr("data-type")&&($("#repeat_end_after").show(),$("#repeat_end_date").hide()),"repeat_details_never"==$("#repeat_end_details option:selected").attr("data-type")&&($("#repeat_end_after").hide(),$("#repeat_end_date").hide()),"show"==r){if($("#saveButton").hide(),$("#resetButton").hide(),$("#deleteButton").hide(),$("#ResourceCalDAVList").find('[data-id="'+a.res_id+'"]').hasClass("resourceCalDAV_item_ro")&&($("#editButton").hide(),$("#duplicateButton").hide(),$("#editOptionsButton").hide()),$('#eventDetailsTable :input[type!="button"]').prop("disabled",!0),$('#eventDetailsTable :input[type="text"]').prop("readonly",!0),$("#eventDetailsTable .customTable td").addClass("disabled"),$("#eventDetailsTable textarea").prop("readonly",!0),$.browser.webkit&&window.chrome?0==navigator.platform.toLowerCase().indexOf("win")?($("#event_details_template").find("input").css("text-indent","2px"),$("#event_details_template").find("select").css({"padding-left":"0px","padding-right":"13px"})):$("#event_details_template").find("input").css("text-indent","1px"):$.browser.safari?($("#event_details_template").find("textarea").addClass("safari_hack"),$("#event_details_template").find("input").addClass("safari_hack")):$.browser.msie&&10==parseInt($.browser.version,10)&&($("#event_details_template").find("select").css({"padding-top":"1px","padding-left":"0px","padding-right":"0px"}),$("#event_details_template").find("textarea").css("padding-top","3px"),$("#event_details_template").find("input[type=button]").css("padding-top","2px")),$.browser.msie||$.browser.mozilla){var P=$(SVG_select_dis).attr("data-type","select_icon").css({"pointer-events":"none","z-index":"1",display:"inline","margin-left":"-22px","vertical-align":"top","background-color":"#ffffff"});$("#event_details_template").find('svg[data-type="select_icon"]').replaceWith($("<div>").append($(P).clone()).html())}""!=a.etag&&$("#event_calendar").val(a.res_id)}"editOnly"!=o&&""==$("#recurrenceID").val()||($("#repeat").parent().parent().css("display","none"),$("#week_custom").css("display","none"),$("#month_custom1").css("display","none"),$("#month_custom2").css("display","none"),$("#year_custom1").css("display","none"),$("#year_custom2").css("display","none"),$("#year_custom3").css("display","none"),$("#repeat_details").css("display","none")),("editOnly"==o||"futureOnly"==o||$("#recurrenceID").val())&&$("#calendarLine").hide(),null==a||""==a.type?$("#editOptionsButton").hide():$("#editOptionsButton").click(function(){showEventForm(null,globalCalEvent.allDay,globalCalEvent,globalJsEvent,"show","",!0)}),a&&a.after&&"futureOnly"==o&&$("#repeat_end_after").val(a.after-a.realRepeatCount+1),globalSettings.timezonesupport.value||$(".timezone_row").css("display","none"),$("#allday").prop("checked")&&stripEventAlerts(),"drop"!=r&&($("#CAEvent").show(),$("#event_details_template").show(),$("#eventColor").css("background-color",n),updateEventFormDimensions(),setFormPosition(l)),checkEventFormScrollBar(),$("#event_details_template").scrollTop(0)}function bindEventForm(){initCalDavDatepicker($("#event_details_template")),initCalDavTimepicker($("#event_details_template")),$("#event_details_template .alert_message_details").change(function(){var e=$(this).attr("data-id");if($('.before_after_input[data-id="'+e+'"]').parent().parent().find("img").css("display","none"),"on_date"==$('.alert_message_details[data-id="'+e+'"] option:selected').attr("data-type")){var t=new Date;if(t.setDate(t.getDate()+7),0==$("#date_from").parent().parent().find("img:visible").length){var a=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_from").val()),l=$.fullCalendar.formatDate(a,"MM/dd/yyyy, ");t=new Date(Date.parse(l+($("#allday").prop("checked")?"":$("#time_from").val()))),t.setHours(t.getHours()-1)}else if(0==$("#date_to").parent().parent().find("img:visible").length){var a=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_to").val()),l=$.fullCalendar.formatDate(a,"MM/dd/yyyy, ");t=new Date(Date.parse(l+($("#allday").prop("checked")?"":$("#time_to").val()))),t.setHours(t.getHours()-1)}$('.message_date_input[data-id="'+e+'"]').val($.datepicker.formatDate(globalSettings.datepickerformat.value,t)),$('.message_date_input[data-id="'+e+'"]').show(),$('.message_time_input[data-id="'+e+'"]').val($.fullCalendar.formatDate(t,globalSettings.ampmformat.value?"hh:mm TT":"HH:mm")),$('.message_time_input[data-id="'+e+'"]').show(),$('.before_after_input[data-id="'+e+'"]').hide()}else $('.message_date_input[data-id="'+e+'"]').hide(),$('.message_time_input[data-id="'+e+'"]').hide(),$('.before_after_input[data-id="'+e+'"]').show(),$('.before_after_input[data-id="'+e+'"]').val("15")}),$("#event_details_template .before_after_input").bind("keyup change",function(){""==$(this).val()?$(this).parent().find("img").css("display","inline"):null==$(this).val().match("^(d*[0-9])*$")?$(this).parent().find("img").css("display","inline"):$(this).parent().find("img").css("display","none")}),$("#event_details_template .alert").change(function(){var e=$(this).attr("data-id");if("none"!=$(this).val()){$('.alert_details[data-id="'+e+'"]').show(),$('.alert_message_date[data-id="'+e+'"]').show();var t=new Date;if(t.setDate(t.getDate()+7),0==$("#date_from").parent().parent().find("img:visible").length){var a=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_from").val()),l=$.fullCalendar.formatDate(a,"MM/dd/yyyy, ");t=new Date(Date.parse(l+($("#allday").prop("checked")?"":$("#time_from").val()))),t.setHours(t.getHours()-1)}else if(0==$("#date_to").parent().parent().find("img:visible").length){var a=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_to").val()),l=$.fullCalendar.formatDate(a,"MM/dd/yyyy, ");t=new Date(Date.parse(l+($("#allday").prop("checked")?"":$("#time_to").val()))),t.setHours(t.getHours()-1)}$('.message_date_input[data-id="'+e+'"]').val($.datepicker.formatDate(globalSettings.datepickerformat.value,t)),$('.message_time_input[data-id="'+e+'"]').val($.fullCalendar.formatDate(t,globalSettings.ampmformat.value?"hh:mm TT":"HH:mm")),event_alert_add(e)}else{$('.alert_details[data-id="'+e+'"]').hide(),$('.alert_message_date[data-id="'+e+'"]').hide(),checkFor(e);var e=$(this).attr("data-id");$('#event_details_template tr[data-id="'+e+'"]').remove()}checkEventFormScrollBar()}),$("#repeat_end_after, #repeat_interval_detail").bind("keyup change",function(){""==$(this).val()?$(this).parent().find("img").css("display","inline"):null==$(this).val().match("^[0-9]+$")||parseInt($(this).val(),10)<1?$(this).parent().find("img").css("display","inline"):$(this).parent().find("img").css("display","none");
}),$("#repeat_month_custom_select").change(function(){"custom"==$(this).val()?($("#month_custom2").show(),$("#repeat_month_custom_select2").parent().hide()):($("#month_custom2").hide(),$("#repeat_month_custom_select2").parent().show()),checkEventFormScrollBar()}),$("#repeat_year_custom_select1").change(function(){"custom"==$(this).val()?($("#year_custom1").show(),$("#repeat_year_custom_select2").parent().hide()):($("#year_custom1").hide(),$("#repeat_year_custom_select2").parent().show()),checkEventFormScrollBar()}),$("#repeat_end_details").change(function(){if($("#repeat_end_date").parent().find("img").css("display","none"),"repeat_details_on_date"==$("#repeat_end_details option:selected").attr("data-type")){$("#repeat_end_after").hide(),$("#repeat_end_date").show();var e;""!=$("#date_from").val()?(e=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_from").val()),null==e&&(e=new Date)):e=new Date;var t=new Date(e.getFullYear(),e.getMonth(),e.getDate()+2);$("#repeat_end_date").val($.datepicker.formatDate(globalSettings.datepickerformat.value,t))}"repeat_details_after"==$("#repeat_end_details option:selected").attr("data-type")&&($("#repeat_end_after").show(),$("#repeat_end_after").val("2"),$("#repeat_end_date").hide()),"repeat_details_never"==$("#repeat_end_details option:selected").attr("data-type")&&($("#repeat_end_after").hide(),$("#repeat_end_date").hide()),checkEventFormScrollBar()}),$("#closeButton").click(function(){if(""!=$("#uid").val()){var e=$("#uid").val(),t=e.substring(0,e.lastIndexOf("/")+1),a=$('.event_item[data-id="'+e+'"]'),l=$("#ResourceCalDAVList").find("[data-id='"+t+"']").find(".resourceCalDAVColor").css("background-color");$.each(a,function(e,t){"tr"!=t.nodeName.toLowerCase()?($(t).find(".fc-event-inner, .fc-event-head").addBack().css({"background-color":rgbToRgba(l,.9),"border-color":l}),$(t).find(".fc-event-title, .fc-event-title-strict, .fc-event-time").css("color",checkFontColor(rgbToHex(l)))):$(t).children(".fc-event-handle").css({"background-color":rgbToRgba(l,.9),"border-color":l})})}else{var r=$("#main").width()-$("#calendar").width();$("#calendar").fullCalendar("unselect"),$("#calendar").fullCalendar("removeEvents","fooUID");var o=$("#main").width()-$("#calendar").width();rerenderCalendar(r!=o)}$("#show").val(""),$("#CAEvent").hide(),$("#EventDisabler").fadeOut(globalEditorFadeAnimation,function(){$("#timezonePicker").prop("disabled",!1)})}),$("#resetButton").click(function(){$("#event_details_template").find("img[data-type=invalidSmall]").css("display","none");var e=$("#uid").val();if(""!=e){var t=e.substring(0,e.lastIndexOf("/")+1),a=$('.event_item[data-id="'+e+'"]'),l=$("#ResourceCalDAVList").find("[data-id='"+t+"']").find(".resourceCalDAVColor").css("background-color");$.each(a,function(e,t){"tr"!=t.nodeName.toLowerCase()?($(t).find(".fc-event-inner, .fc-event-head").addBack().css({"background-color":rgbToRgba(l,.9),"border-color":l}),$(t).find(".fc-event-title, .fc-event-title-strict, .fc-event-time").css("color",checkFontColor(rgbToHex(l)))):$(t).children(".fc-event-handle").css({"background-color":rgbToRgba(l,.9),"border-color":l})}),""!=$("#recurrenceID").val()&&""!=$("#repeatCount").val()?showEventForm(null,globalCalEvent.allDay,globalCalEvent,globalJsEvent,"show","editOnly"):""!=$("#futureStart").val()?showEventForm(null,globalCalEvent.allDay,globalCalEvent,globalJsEvent,"show","futureOnly"):showEventForm(null,globalCalEvent.allDay,globalCalEvent,globalJsEvent,"show",""),startEditModeEvent()}}),$("#allday").click(function(){$("#allday").prop("checked")?($("#timezone").val("local"),$("#time_from_cell").css("visibility","hidden"),$("#time_to_cell").css("visibility","hidden"),$("#time_to_cell").find("img").css("display","none"),$("#time_from_cell").find("img").css("display","none"),$(".timezone_row").css("display","none"),stripEventAlerts()):($("#time_from_cell").css("visibility","visible"),$("#time_to_cell").css("visibility","visible"),$("#time_from").trigger("change"),$("#time_to").trigger("change"),globalSettings.timezonesupport.value&&($(".timezone_row").show(),$("#timezone").val(globalSessionTimeZone)),expandEventAlerts()),checkEventFormScrollBar()}),$("#event_details_template .customTable td").click(function(){return!!$(this).hasClass("disabled")||void($(this).hasClass("selected")?$(this).removeClass("selected"):$(this).addClass("selected"))}),$("#event_calendar").change(function(){var e="";e="choose"==$(this).val()?"rgb(240,240,240)":$("#ResourceCalDAVList").find("[data-id='"+$(this).val()+"']").find(".resourceCalDAVColor").css("background-color");var t="fooUID";""!=$("#uid").val()&&(t=$("#uid").val());var a=$('.event_item[data-id="'+t+'"]');$("#eventColor").css("background-color",e),$.each(a,function(t,a){"tr"!=a.nodeName.toLowerCase()?($(a).find(".fc-event-inner, .fc-event-head").addBack().css({"background-color":rgbToRgba(e,.9),"border-color":e}),$(a).find(".fc-event-title, .fc-event-title-strict, .fc-event-time").css("color",checkFontColor(rgbToHex(e)))):$(a).find(".fc-event-handle").css({"background-color":rgbToRgba(e,.9),"border-color":e})})}),$("#repeat").change(function(){if("repeat_no-repeat"==$("#repeat option:selected").attr("data-type")||"custom_repeat"==$("#repeat option:selected").attr("data-type"))$("#repeat_details").hide(),$("#repeat_interval").hide(),$("#week_custom").hide(),$("#month_custom1").hide(),$("#month_custom2").hide(),$("#year_custom1").hide(),$("#year_custom2").hide(),$("#year_custom3").hide();else{$("#repeat_details").show(),"BUSINESS"!=$(this).val()&&"TWO_WEEKLY"!=$(this).val()&&"WEEKEND"!=$(this).val()?($("#repeat_interval").show(),$("#repeat_interval_detail").val("1"),$("#repeat_interval").find("img").css("display","none")):$("#repeat_interval").hide(),"DAILY"==$(this).val()&&$('#repeat_interval [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatDays),"WEEKLY"==$(this).val()&&$('#repeat_interval [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatWeeks),"MONTHLY"==$(this).val()&&$('#repeat_interval [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatMonths),"YEARLY"==$(this).val()&&$('#repeat_interval [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatYears),"CUSTOM_WEEKLY"==$(this).val()?($('#repeat_interval [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatWeeks),$("#week_custom").show()):$("#week_custom").hide(),"CUSTOM_MONTHLY"==$(this).val()?($('#repeat_interval [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatMonths),$("#month_custom1").show(),"custom"==$("#repeat_month_custom_select").val()&&$("#repeat_month_custom_select").trigger("change")):($("#month_custom1").hide(),$("#month_custom2").hide()),"CUSTOM_YEARLY"==$(this).val()?($('#repeat_interval [data-type="txt_interval"]').text(localization[globalInterfaceLanguage].repeatYears),$("#year_custom2").show(),$("#year_custom3").show(),"custom"==$("#repeat_year_custom_select1").val()&&$("#repeat_year_custom_select1").trigger("change")):($("#year_custom1").hide(),$("#year_custom2").hide(),$("#year_custom3").hide());var e;""!=$("#date_from").val()?(e=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_from").val()),null==e&&(e=new Date)):e=new Date;var t=new Date(e.getFullYear(),e.getMonth(),e.getDate()+2);$("#repeat_end_date").val($.datepicker.formatDate(globalSettings.datepickerformat.value,t))}checkEventFormScrollBar()}),$("#status").change(function(){var e=$(this).val();"CANCELLED"==e?$("#name").addClass("title_cancelled"):$("#name").removeClass("title_cancelled"),todoStatusChanged(e)})}function startEditModeEvent(){if($("#timezonePicker").prop("disabled",!0),$("#EventDisabler").fadeIn(globalEditorFadeAnimation),$("#CAEvent .formNav").css("display","none"),$("#CAEvent textarea.header").removeClass("leftspace rightspace"),$("#editButton").hide(),$("#duplicateButton").hide(),$("#editOptionsButton").hide(),$("#saveButton").show(),$("#resetButton").show(),$("#deleteButton").show(),$("#show").val(""),$("#eventDetailsTable :input[disabled]").prop("disabled",!1),$('#eventDetailsTable :input[type="text"]').prop("readonly",!1),$("#eventDetailsTable .customTable td").removeClass("disabled"),$("#eventDetailsTable textarea").prop("readonly",!1),$.browser.msie||$.browser.mozilla){var e=$(SVG_select).attr("data-type","select_icon").css({"pointer-events":"none","z-index":"1",display:"inline","margin-left":"-19px","vertical-align":"top","background-color":"#ffffff"});$("#event_details_template").find('svg[data-type="select_icon"]').replaceWith($("<div>").append($(e).clone()).html())}$("#name").focus()}function startEditModeTodo(){if($("#todoInEdit").val("true"),$("#timezonePickerTODO").prop("disabled",!0),$("#TodoDisabler").fadeIn(globalEditorFadeAnimation),$("#CATodo .formNav").css("display","none"),$("#CATodo textarea.header").removeClass("leftspace rightspace"),$("#editTODO").hide(),$("#duplicateTODO").hide(),$("#editOptionsButtonTODO").hide(),$("#closeTODO").show(),$("#saveTODO").show(),$("#resetTODO").show(),$("#deleteTODO").show(),$("#showTODO").val(""),$("#todoDetailsTable :input[disabled]").prop("disabled",!1),$('#todoDetailsTable :input[type="text"]').prop("readonly",!1),$("#todoDetailsTable textarea").prop("readonly",!1),$.browser.msie||$.browser.mozilla){var e=$(SVG_select).attr("data-type","select_icon").css({"pointer-events":"none","z-index":"1",display:"inline","margin-left":"-19px","vertical-align":"top","background-color":"#ffffff"});$("#todo_details_template").find('svg[data-type="select_icon"]').replaceWith($("<div>").append($(e).clone()).html())}$("#percentageSlider").slider({disabled:!1}),$("#nameTODO").focus()}function todo_alert_add(e){e++;var t,a,l;if(t='<tr data-id="'+e+'"><td><label data-type="alert_TODO" for="alertTODO">alert: </label></td><td data-size="full" colspan="2"><select class="long alertTODO" name="alert_typeTODO" data-id="'+e+'"><option data-type="alert_none_TODO" value="none">none</option><option data-type="alert_message_TODO" value="message">message</option></select></td></tr>',a='<tr class="alert_detailsTODO" style="display:none;" data-id="'+e+'"><td></td><td data-size="full" colspan="2"><select class="long alert_message_detailsTODO" name="alert_detailsTODO" data-id="'+e+'"><option data-type="on_dateTODO" class="todoTimeOptions" value="on_date">On date</option>'+("none"==$("#todo_type").val()?"":'<option data-type="weeks_beforeTODO" value="weeks_before">weeks before</option><option data-type="days_beforeTODO" value="days_before">days before</option><option data-type="hours_beforeTODO" value="hours_before">hours before</option><option data-type="minutes_beforeTODO" value="minutes_before">minutes before</option><option data-type="seconds_beforeTODO" value="seconds_before">seconds before</option><option data-type="weeks_afterTODO" value="weeks_after">weeks after</option><option data-type="days_afterTODO" value="days_after">days after</option><option data-type="hours_afterTODO" value="hours_after">hours after</option><option data-type="minutes_afterTODO" value="minutes_after">minutes after</option><option data-type="seconds_afterTODO" value="seconds_after">seconds after</option>')+"</select></td></tr>",l='<tr data-id="'+e+'" class="alert_message_dateTODO" style="display:none;"><td></td><td><input data-id="'+e+'" data-type="PH_before_after_alert_TODO" class="small before_after_inputTODO" type="text" style="display:none;" /><input data-id="'+e+'" class="date small message_date_inputTODO" data-type="PH_alarm_date_TODO" type="text" name="message_dateTODO" /><div class="invalidWrapper"><img data-type="invalidSmall" data-id="'+e+'" style="display: none;" src="images/error_b.svg" alt="invalid" /></div></td><td><input data-id="'+e+'" data-type="PH_alarm_time_TODO" class="time small message_time_inputTODO" type="text" name="message_timeTODO" /><div class="invalidWrapper"><img data-type="invalidSmall" data-id="'+e+'" style="display: none;" src="images/error_b.svg" alt="invalid" /></div></td><tr>',$("#url_trTODO").before(t),$("#url_trTODO").before(a),$("#url_trTODO").before(l),translateTodoAlerts(),$("#todo_details_template").find("input[placeholder],textarea[placeholder]").placeholder(),$('#todo_details_template .alert_message_detailsTODO[data-id="'+e+'"]').change(function(){var e=$(this).attr("data-id");if($('.before_after_inputTODO[data-id="'+e+'"]').parent().parent().find("img").css("display","none"),"on_dateTODO"==$('.alert_message_detailsTODO[data-id="'+e+'"] option:selected').attr("data-type")){var t=new Date;if(t.setDate(t.getDate()+7),$(".dateTrToTODO").is(":visible")&&0==$(".dateTrToTODO img:visible").length){var a=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_toTODO").val()),l=$.fullCalendar.formatDate(a,"MM/dd/yyyy, ");t=new Date(Date.parse(l+$("#time_toTODO").val())),t.setHours(t.getHours()-1)}else if($(".dateTrFromTODO").is(":visible")&&0==$(".dateTrFromTODO img:visible").length){var a=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_fromTODO").val()),l=$.fullCalendar.formatDate(a,"MM/dd/yyyy, ");t=new Date(Date.parse(l+$("#time_fromTODO").val())),t.setHours(t.getHours()-1)}$('.message_date_inputTODO[data-id="'+e+'"]').val($.datepicker.formatDate(globalSettings.datepickerformat.value,t)),$('.message_date_inputTODO[data-id="'+e+'"]').show(),$('.message_time_inputTODO[data-id="'+e+'"]').val($.fullCalendar.formatDate(t,globalSettings.ampmformat.value?"hh:mm TT":"HH:mm")),$('.message_time_inputTODO[data-id="'+e+'"]').show(),$('.before_after_inputTODO[data-id="'+e+'"]').hide()}else $('.message_date_inputTODO[data-id="'+e+'"]').hide(),$('.message_time_inputTODO[data-id="'+e+'"]').hide(),$('.before_after_inputTODO[data-id="'+e+'"]').show(),$('.before_after_inputTODO[data-id="'+e+'"]').val("15")}),$('#todo_details_template .before_after_inputTODO[data-id="'+e+'"]').bind("keyup change",function(){""==$(this).val()?$(this).parent().find("img").css("display","inline"):null==$(this).val().match("^[0-9]+$")?$(this).parent().find("img").css("display","inline"):$(this).parent().find("img").css("display","none")}),$('#todo_details_template .alertTODO[data-id="'+e+'"]').change(function(){var e=$(this).attr("data-id");if("none"!=$(this).val()){$('.alert_detailsTODO[data-id="'+e+'"]').show(),$('.alert_message_dateTODO[data-id="'+e+'"]').show(),"none"!=$("#todo_type").val()&&expandTodoAlerts();var t=new Date;if(t.setDate(t.getDate()+7),$(".dateTrToTODO").is(":visible")&&0==$(".dateTrToTODO img:visible").length){var a=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_toTODO").val()),l=$.fullCalendar.formatDate(a,"MM/dd/yyyy, ");t=new Date(Date.parse(l+$("#time_toTODO").val())),t.setHours(t.getHours()-1)}else if($(".dateTrFromTODO").is(":visible")&&0==$(".dateTrFromTODO img:visible").length){var a=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_fromTODO").val()),l=$.fullCalendar.formatDate(a,"MM/dd/yyyy, ");t=new Date(Date.parse(l+$("#time_fromTODO").val())),t.setHours(t.getHours()-1)}$('.message_date_inputTODO[data-id="'+e+'"]').val($.datepicker.formatDate(globalSettings.datepickerformat.value,t)),$('.message_time_inputTODO[data-id="'+e+'"]').val($.fullCalendar.formatDate(t,globalSettings.ampmformat.value?"hh:mm TT":"HH:mm")),todo_alert_add(e)}else{$('.alert_detailsTODO[data-id="'+e+'"]').hide(),$('.alert_message_dateTODO[data-id="'+e+'"]').hide(),checkForTodo(e);var e=$(this).attr("data-id");$('#todo_details_template tr[data-id="'+e+'"]').remove()}checkTodoFormScrollBar()}),initCalDavDatepicker($('#todo_details_template .alert_message_dateTODO[data-id="'+e+'"]')),initCalDavTimepicker($('#todo_details_template .alert_message_dateTODO[data-id="'+e+'"]')),$.browser.webkit&&window.chrome?0==navigator.platform.toLowerCase().indexOf("win")?($("#todo_details_template").find("input").css("text-indent","2px"),$("#todo_details_template").find("select").css({"padding-left":"0px","padding-right":"13px"})):$("#todo_details_template").find("input").css("text-indent","1px"):$.browser.safari?($("#todo_details_template").find("textarea").addClass("safari_hack"),$("#todo_details_template").find("input").addClass("safari_hack")):$.browser.msie&&10==parseInt($.browser.version,10)&&($("#todo_details_template").find("select").css({"padding-top":"1px","padding-left":"0px","padding-right":"0px"}),$("#todo_details_template").find("textarea").css("padding-top","3px"),$("#todo_details_template").find("input[type=button]").css("padding-top","2px")),($.browser.msie||$.browser.mozilla)&&$('<svg data-type="select_icon"></svg>').css("display","none").insertAfter($('#todo_details_template tr[data-id="'+e+'"]').find("select")),$.browser.msie||$.browser.mozilla){var r=$(SVG_select).attr("data-type","select_icon").css({"pointer-events":"none","z-index":"1",display:"inline","margin-left":"-19px","vertical-align":"top","background-color":"#ffffff"});$('#todo_details_template tr[data-id="'+e+'"]').find('svg[data-type="select_icon"]').replaceWith($("<div>").append($(r).clone()).html())}}function event_alert_add(e){e++;var t,a,l;if(t='<tr data-id="'+e+'"><td><label data-type="alert" for="alert">alert: </label></td><td data-size="full" colspan="2"><select class="long alert" name="alert_type" data-id="'+e+'"><option data-type="alert_none" value="none">none</option><option data-type="alert_message" value="message">message</option></select></td></tr>',a='<tr data-id="'+e+'" class="alert_details" style="display:none;"><td></td><td data-size="full" colspan="2"><select class="long alert_message_details" name="alert_details" data-id="'+e+'"><option data-type="on_date" value="on_date">On date</option>'+($("#allday").prop("checked")?"":'<option data-type="weeks_before" value="weeks_before">weeks before</option><option data-type="days_before" value="days_before">days before</option><option data-type="hours_before" value="hours_before">hours before</option><option data-type="minutes_before" value="minutes_before">minutes before</option><option data-type="seconds_before" value="seconds_before">seconds before</option><option data-type="weeks_after" value="weeks_after">weeks after</option><option data-type="days_after" value="days_after">days after</option><option data-type="hours_after" value="hours_after">hours after</option><option data-type="minutes_after" value="minutes_after">minutes after</option><option data-type="seconds_after" value="seconds_after">seconds after</option>')+"</select></td></tr>",l='<tr data-id="'+e+'" class="alert_message_date" style="display:none;"><td></td><td><input class="small before_after_input" data-type="PH_before_after_alert" type="text" data-id="'+e+'" style="display:none;" /><input class="date small message_date_input" data-type="PH_alarm_date" type="text" data-id="'+e+'" /><div class="invalidWrapper"><img data-type="invalidSmall" data-id="'+e+'" style="display: none;" src="images/error_b.svg" alt="invalid" /></div></td><td><input class="time small message_time_input" data-type="PH_alarm_time" type="text" data-id="'+e+'" /><div class="invalidWrapper"><img data-type="invalidSmall" data-id="'+e+'" style="display: none;" src="images/error_b.svg" alt="invalid" /></div></td><tr>',$("#url_tr").before(t),$("#url_tr").before(a),$("#url_tr").before(l),translateEventAlerts(),$("#event_details_template").find("input[placeholder],textarea[placeholder]").placeholder(),$('#event_details_template .before_after_input[data-id="'+e+'"]').bind("keyup change",function(){""==$(this).val()?$(this).parent().find("img").css("display","inline"):null==$(this).val().match("^(d*[0-9])*$")?$(this).parent().find("img").css("display","inline"):$(this).parent().find("img").css("display","none")}),$('#event_details_template .alert[data-id="'+e+'"]').change(function(){var e=$(this).attr("data-id");if("none"!=$(this).val()){$('.alert_details[data-id="'+e+'"]').show(),$('.alert_message_date[data-id="'+e+'"]').show(),$("#allday").prop("checked")||expandEventAlerts();var t=new Date;if(t.setDate(t.getDate()+7),0==$("#date_from").parent().parent().find("img:visible").length){var a=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_from").val()),l=$.fullCalendar.formatDate(a,"MM/dd/yyyy, ");t=new Date(Date.parse(l+($("#allday").prop("checked")?"":$("#time_from").val()))),t.setHours(t.getHours()-1)}else if(0==$("#date_to").parent().parent().find("img:visible").length){var a=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_to").val()),l=$.fullCalendar.formatDate(a,"MM/dd/yyyy, ");t=new Date(Date.parse(l+($("#allday").prop("checked")?"":$("#time_to").val()))),t.setHours(t.getHours()-1)}$('.message_date_input[data-id="'+e+'"]').val($.datepicker.formatDate(globalSettings.datepickerformat.value,t)),$('.message_time_input[data-id="'+e+'"]').val($.fullCalendar.formatDate(t,globalSettings.ampmformat.value?"hh:mm TT":"HH:mm")),event_alert_add(e)}else{$('.alert_details[data-id="'+e+'"]').hide(),$('.alert_message_date[data-id="'+e+'"]').hide(),checkFor(e);var e=$(this).attr("data-id");$('#event_details_template tr[data-id="'+e+'"]').remove()}checkEventFormScrollBar()}),$('#event_details_template .alert_message_details[data-id="'+e+'"]').change(function(){var e=$(this).attr("data-id");if($('.before_after_input[data-id="'+e+'"]').parent().parent().find("img").css("display","none"),"on_date"==$('.alert_message_details[data-id="'+e+'"] option:selected').attr("data-type")){var t=new Date;if(t.setDate(t.getDate()+7),0==$("#date_from").parent().parent().find("img:visible").length){var a=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_from").val()),l=$.fullCalendar.formatDate(a,"MM/dd/yyyy, ");t=new Date(Date.parse(l+($("#allday").prop("checked")?"":$("#time_from").val()))),t.setHours(t.getHours()-1)}else if(0==$("#date_to").parent().parent().find("img:visible").length){var a=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_to").val()),l=$.fullCalendar.formatDate(a,"MM/dd/yyyy, ");t=new Date(Date.parse(l+($("#allday").prop("checked")?"":$("#time_to").val()))),t.setHours(t.getHours()-1)}$('.message_date_input[data-id="'+e+'"]').val($.datepicker.formatDate(globalSettings.datepickerformat.value,t)),$('.message_date_input[data-id="'+e+'"]').show(),$('.message_time_input[data-id="'+e+'"]').val($.fullCalendar.formatDate(t,globalSettings.ampmformat.value?"hh:mm TT":"HH:mm")),$('.message_time_input[data-id="'+e+'"]').show(),$('.before_after_input[data-id="'+e+'"]').hide()}else $('.message_date_input[data-id="'+e+'"]').hide(),$('.message_time_input[data-id="'+e+'"]').hide(),$('.before_after_input[data-id="'+e+'"]').show(),$('.before_after_input[data-id="'+e+'"]').val("15")}),initCalDavDatepicker($('#event_details_template .alert_message_date[data-id="'+e+'"]')),initCalDavTimepicker($('#event_details_template .alert_message_date[data-id="'+e+'"]')),$.browser.webkit&&window.chrome?0==navigator.platform.toLowerCase().indexOf("win")?($("#event_details_template").find("input").css("text-indent","2px"),$("#event_details_template").find("select").css({"padding-left":"0px","padding-right":"13px"})):$("#event_details_template").find("input").css("text-indent","1px"):$.browser.safari?($("#event_details_template").find("textarea").addClass("safari_hack"),$("#event_details_template").find("input").addClass("safari_hack")):$.browser.msie&&10==parseInt($.browser.version,10)&&($("#event_details_template").find("select").css({"padding-top":"1px","padding-left":"0px","padding-right":"0px"}),$("#event_details_template").find("textarea").css("padding-top","3px"),$("#event_details_template").find("input[type=button]").css("padding-top","2px")),($.browser.msie||$.browser.mozilla)&&$('<svg data-type="select_icon"></svg>').css("display","none").insertAfter($('#event_details_template tr[data-id="'+e+'"]').find("select")),$.browser.msie||$.browser.mozilla){var r=$(SVG_select).attr("data-type","select_icon").css({"pointer-events":"none","z-index":"1",display:"inline","margin-left":"-19px","vertical-align":"top","background-color":"#ffffff"});$('#event_details_template tr[data-id="'+e+'"]').find('svg[data-type="select_icon"]').replaceWith($("<div>").append($(r).clone()).html())}}function stripEventAlerts(){$(".alert_message_details").each(function(){if("on_date"==$(this).val())$(this).find("option").not(":selected").remove();else{var e=$(this).parent().parent().attr("data-id");$("#event_details_template").find('tr[data-id="'+e+'"]').remove()}})}function expandEventAlerts(){$(".alert_message_details").each(function(){var e=$(this).val();$(this).html('<option data-type="on_date" value="on_date">on date</option><option data-type="weeks_before" value="weeks_before">weeks before</option><option data-type="days_before" value="days_before">days before</option><option data-type="hours_before" value="hours_before">hours before</option><option data-type="minutes_before" value="minutes_before">minutes before</option><option data-type="seconds_before" value="seconds_before">seconds before</option><option data-type="weeks_after" value="weeks_after">weeks after</option><option data-type="days_after" value="days_after">days after</option><option data-type="hours_after" value="hours_after">hours after</option><option data-type="minutes_after" value="minutes_after">minutes after</option><option data-type="seconds_after" value="seconds_after">seconds after</option>'),$(this).val(e)}),translateEventAlerts()}function stripTodoAlerts(){$(".alert_message_detailsTODO").each(function(){if("on_date"==$(this).val())$(this).find("option").not(":selected").remove();else{var e=$(this).parent().parent().attr("data-id");$("#todo_details_template").find('tr[data-id="'+e+'"]').remove()}})}function expandTodoAlerts(){$(".alert_message_detailsTODO").each(function(){var e=$(this).val();$(this).html('<option data-type="on_dateTODO" value="on_date">On date</option><option data-type="weeks_beforeTODO" value="weeks_before">weeks before</option><option data-type="days_beforeTODO" value="days_before">days before</option><option data-type="hours_beforeTODO" value="hours_before">hours before</option><option data-type="minutes_beforeTODO" value="minutes_before">minutes before</option><option data-type="seconds_beforeTODO" value="seconds_before">seconds before</option><option data-type="weeks_afterTODO" value="weeks_after">weeks after</option><option data-type="days_afterTODO" value="days_after">days after</option><option data-type="hours_afterTODO" value="hours_after">hours after</option><option data-type="minutes_afterTODO" value="minutes_after">minutes after</option><option data-type="seconds_afterTODO" value="seconds_after">seconds after</option>'),$(this).val(e)}),translateTodoAlerts()}