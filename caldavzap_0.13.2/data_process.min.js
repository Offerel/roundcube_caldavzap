function repeatStartCompare(e,a){var n="",l="";return n=""!=e.rec_id?e.rec_id.parseComnpactISO8601():e.start?new Date(e.start.getTime()):e.end?new Date(e.end.getTime()):1/0,l=""!=a.rec_id?a.rec_id.parseComnpactISO8601():a.start?new Date(a.start.getTime()):a.end?new Date(a.end.getTime()):1/0,n<l?-1:n>l?1:0}function findWeek(e,a,n){var l=(n+7-a.getDay())%7,r=new Date(a.getTime());if(r.setDate(r.getDate()+l),r.getWeekNo()<=e)r.setDate(r.getDate()+7*(e-r.getWeekNo()));else{var t=new Date(r.getFullYear(),11,31,1,1,1).getWeekNo();r.setDate(r.getDate()+7*(t-r.getWeekNo()))}}function setAlertTimeouts(e,a,n,l,r,t,s){var d=new Array;if(e&&""!=l?n="string"==typeof l?l:new Date(l.getTime()):e&&""!=n&&(l="string"==typeof n?n:new Date(n.getTime())),a.length>0)for(var c=0;c<a.length;c++)if("-"==a[c].charAt(0)||"+"==a[c].charAt(0)||t){var p,i="";if(""==n&&""==l||"-"!=a[c].charAt(0))if(""==n&&""==l||"+"!=a[c].charAt(0)){if(t){if(i=$.fullCalendar.parseDate(a[c]),e)var o=""==l?n:l;else o=n;p=""!=o?new Date(o.getTime()):""}}else p="string"==typeof l?$.fullCalendar.parseDate(l):new Date(l.getTime()),i=p.getTime()+parseInt(a[c].substring(1,a[c].length-1));else p="string"==typeof n?$.fullCalendar.parseDate(n):new Date(n.getTime()),i=p.getTime()-parseInt(a[c].substring(1,a[c].length-1));var v=new Date;if(""!==i&&i>v){var u=i-v;maxAlarmValue<u&&(u=maxAlarmValue),d[d.length]=e?setTimeout(function(e){showAlertTODO(s,i-v,{start:""!=e?new Date(e.getTime()):"",status:r.status,title:r.title})},u,p):setTimeout(function(e){showAlertEvents(s,i-v,{start:new Date(e.getTime()),allDay:r.allDay,title:r.title})},u,p)}}return d}function isInRecurrenceArray(e,a,n,l){var r=!1;if("string"==typeof e?$.fullCalendar.parseDate(e):new Date(e.getTime()),n.length>0)for(var t=0;t<n.length;t++){var s=n[t].split(";")[0];if("Z"==s.charAt(s.length-1)){if(globalSettings.timezonesupport.value&&l in timezones){var d=getOffsetByTZ(l,e),c=new Date(s.parseComnpactISO8601().getTime());if(d){var p=1e3*d.getSecondsFromOffset();c.setTime(c.getTime()+p)}c.toString()+n[t].split(";")[1]==e+a&&(r=!0)}}else s.parseComnpactISO8601().toString()+n[t].split(";")[1]==e+a&&(r=!0)}return r}function applyTimezone(e,a){updateMainLoaderTextTimezone(),$("#MainLoader").show();for(var n=!1,l=!1,r=globalResourceCalDAVList.collections,t=globalResourceCalDAVList.TodoCollections,s=0,d=0,c=0,p=0,i=0;i<r.length;i++)null!=r[i].uid&&s++;for(i=0;i<t.length;i++)null!=t[i].uid&&c++;var o=globalEventList.displayEventsArray,v=globalEventList.displayTodosArray;for(i=0;i<r.length;i++)null!=r[i].uid&&setTimeout(function(t){for(var c=0;c<o[r[t].uid].length;c++)if("local"!=o[r[t].uid][c].timeZone&&!o[r[t].uid][c].allDay){var p=o[r[t].uid][c].start,i=getOffsetByTZ(e,p).getSecondsFromOffset(),v="";if(v="undefined"!=typeof globalSessionTimeZone&&null!=globalSessionTimeZone&&""!=globalSessionTimeZone?getOffsetByTZ(globalSessionTimeZone,p).getSecondsFromOffset():60*p.getTimezoneOffset()*-1,void 0!==a&&(v=getOffsetByTZ(o[r[t].uid][c].timeZone,p).getSecondsFromOffset()),void 0===a||a)u=1e3*(v-i);else var u=1e3*(i-v);o[r[t].uid][c].start.setTime(o[r[t].uid][c].start.getTime()+u),o[r[t].uid][c].end&&o[r[t].uid][c].end.setTime(o[r[t].uid][c].end.getTime()+u);var m=o[r[t].uid][c];if((0==c||c>0&&o[r[t].uid][c].id!=o[r[t].uid][c-1].id)&&m.alertTime.length>0){for(var g=0;g<m.alertTimeOut.length;g++)clearTimeout(m.alertTimeOut[g]);for(var _="",f=new Date,C=0;C<m.alertTime.length;C++){if(null!=o[r[t].uid][c].start&&"-"==m.alertTime[C].charAt(0))_=o[r[t].uid][c].start.getTime()-parseInt(m.alertTime[C].substring(1,m.alertTime[C].length-1));else if(null!=o[r[t].uid][c].end&&"+"==m.alertTime[C].charAt(0))_=o[r[t].uid][c].end.getTime()+parseInt(m.alertTime[C].substring(1,m.alertTime[C].length-1));else{i=getOffsetByTZ(e,$.fullCalendar.parseDate(m.alertTime[C])).getSecondsFromOffset(),v="";if(v="undefined"!=typeof globalSessionTimeZone&&null!=globalSessionTimeZone&&""!=globalSessionTimeZone?getOffsetByTZ(globalSessionTimeZone,$.fullCalendar.parseDate(m.alertTime[C])).getSecondsFromOffset():60*$.fullCalendar.parseDate(m.alertTime[C]).getTimezoneOffset()*-1,void 0!==a&&(v=getOffsetByTZ(o[r[t].uid][c].timeZone,$.fullCalendar.parseDate(m.alertTime[C])).getSecondsFromOffset()),void 0===a||a)u=1e3*(v-i);else var u=1e3*(i-v);_=new Date($.fullCalendar.parseDate(m.alertTime[C]).getTime()+u),o[r[t].uid][c].alertTime[C]=$.fullCalendar.formatDate(_,"yyyy-MM-dd HH:mm:ss")}if(_>f){var T=_-f;maxAlarmValue<T&&(T=maxAlarmValue),o[r[t].uid][c].alertTimeOut[C]=setTimeout(function(){showAlertEvents(m.id,_-f,{start:m.start,allDay:m.allDay,title:m.title})},T)}}}}d++,d==s&&(refetchCalendarEvents(),n=!0,l&&$("#MainLoader").hide())},10,i);for(i=0;i<t.length;i++)null!=t[i].uid&&setTimeout(function(r){for(var s=0;s<v[t[r].uid].length;s++){if(v[t[r].uid][s].start){"string"==typeof v[t[r].uid][s].start&&(v[t[r].uid][s].start=$.fullCalendar.parseDate(v[t[r].uid][s].start));var d=v[t[r].uid][s].start,i=getOffsetByTZ(e,d).getSecondsFromOffset(),o="";o="undefined"!=typeof globalSessionTimeZone&&null!=globalSessionTimeZone&&""!=globalSessionTimeZone?getOffsetByTZ(globalSessionTimeZone,d).getSecondsFromOffset():60*d.getTimezoneOffset()*-1;var u=1e3*(o-i);v[t[r].uid][s].start.setTime(v[t[r].uid][s].start.getTime()+u)}if(v[t[r].uid][s].end){"string"==typeof v[t[r].uid][s].end&&(v[t[r].uid][s].end=$.fullCalendar.parseDate(v[t[r].uid][s].end));var m=v[t[r].uid][s].end;i=getOffsetByTZ(e,m).getSecondsFromOffset(),o="";if(o="undefined"!=typeof globalSessionTimeZone&&null!=globalSessionTimeZone&&""!=globalSessionTimeZone?getOffsetByTZ(globalSessionTimeZone,m).getSecondsFromOffset():60*m.getTimezoneOffset()*-1,void 0!==a&&(o=getOffsetByTZ(v[t[r].uid][s].timeZone,d).getSecondsFromOffset()),void 0===a||a)u=1e3*(o-i);else var u=1e3*(i-o);v[t[r].uid][s].end.setTime(v[t[r].uid][s].end.getTime()+u)}var g=v[t[r].uid][s];if((0==s||s>0&&v[t[r].uid][s].id!=v[t[r].uid][s-1].id)&&g.alertTime.length>0){if(g.end)var _=new Date(g.end.getTime());else if(g.start)_=new Date(g.start.getTime());else _=new Date;for(var f=0;f<g.alertTimeOut.length;f++)clearTimeout(g.alertTimeOut[f]);for(var C="",T="",E=0;E<g.alertTime.length;E++){if("-"==g.alertTime[E].charAt(0)||"+"==g.alertTime[E].charAt(0)){C=_.getTime();var D=parseInt(g.alertTime[E].substring(1,g.alertTime[E].length-1));"-"==g.alertTime[E].charAt(0)?C-=D:C+=D,T=new Date}else{i=getOffsetByTZ(e,$.fullCalendar.parseDate(g.alertTime[E])).getSecondsFromOffset(),o="";if(o="undefined"!=typeof globalSessionTimeZone&&null!=globalSessionTimeZone&&""!=globalSessionTimeZone?getOffsetByTZ(globalSessionTimeZone,$.fullCalendar.parseDate(g.alertTime[E])).getSecondsFromOffset():60*$.fullCalendar.parseDate(g.alertTime[E]).getTimezoneOffset()*-1,void 0!==a&&(o=getOffsetByTZ(v[t[r].uid][s].timeZone,$.fullCalendar.parseDate(g.alertTime[E])).getSecondsFromOffset()),void 0===a||a)u=1e3*(o-i);else u=1e3*(i-o);C=new Date($.fullCalendar.parseDate(g.alertTime[E]).getTime()+u),v[t[r].uid][s].alertTime[E]=$.fullCalendar.formatDate(C,"yyyy-MM-dd HH:mm:ss"),T=new Date}if(C>T){var h=C-T;maxAlarmValue<h&&(h=maxAlarmValue),v[t[r].uid][s].alertTimeOut[E]=setTimeout(function(){showAlertEvents(g.id,C-T,{start:_,allDay:g.allDay,title:g.title})},h)}}}}p++,p==c&&(refetchTodoEvents(),l=!0,n&&$("#MainLoader").hide())},10,i)}function getLocalOffset(e){if("undefined"!=typeof globalSessionTimeZone&&null!=globalSessionTimeZone&&""!=globalSessionTimeZone)return-1*getOffsetByTZ(globalSessionTimeZone,e).getSecondsFromOffset();e.getTimezoneOffset()}function changeRuleForFuture(e,a){var n=e.vcalendar,l=n.match(vCalendar.pre.contentline_RRULE2);if(null!=l){parsed=l[0].match(vCalendar.pre.contentline_parse);for(var r=parsed[4].split(";"),t=!1,s=parsed[0],d=0;d<r.length;d++)-1==r[d].indexOf("UNTIL")&&-1==r[d].indexOf("COUNT")||(s=s.replace(r[d],"COUNT="+(a-1)),t=!0);if(!t){var c=parsed[4]+";COUNT="+(a-1);s=s.replace(parsed[4],c)}n=n.replace(parsed[0],s)}return n}function buildTimezoneComponent(e){var a="",n=["SU","MO","TU","WE","TH","FR","SA"];if(!e||"local"==e||"UTC"==e)return a;if(e in timezones){for(comp in a+="BEGIN:VTIMEZONE\r\nTZID:"+e+"\r\n",timezones[e]){if("daylightComponents"==comp)var l=timezones[e].daylightComponents,r="DAYLIGHT";else if("standardComponents"==comp)l=timezones[e].standardComponents,r="STANDARD";for(var t in l)if(!isNaN(t)){for(key in a+="BEGIN:"+r+"\r\n",l[t])switch(key){case"dtStart":a+="DTSTART:"+l[t][key]+"\r\n";break;case"tzName":a+="TZNAME:"+l[t][key]+"\r\n";break;case"tzOffsetFROM":a+="TZOFFSETFROM:"+l[t][key]+"\r\n";break;case"tzOffsetTO":a+="TZOFFSETTO:"+l[t][key]+"\r\n";break;case"startMonth":a+="RRULE:FREQ=YEARLY",l[t].startMonth&&(a+=";BYMONTH="+l[t].startMonth),void 0!==l[t].startDay&&void 0!==n[l[t].startDay]&&(l[t].startCount?a+=";BYDAY="+l[t].startCount+n[l[t].startDay]:a+=";BYDAY="+n[l[t].startDay]),a+="\r\n";break;case"rDates":if(l[t].rDates)for(var s=0;s<l[t].rDates.length;s++)a+="RDATE:"+l[t].rDates[s]+"\r\n"}a+="END:"+r+"\r\n"}}a+="END:VTIMEZONE\r\n"}return a}function getOffsetByTZ(e,a,n){var l="+0000";if(e in timezones&&"UTC"!=e){var r,t="",s="",d=!0,c=timezones[e].daylightComponents;if(c)for(var p=0;p<c.length;p++)if(!(c[p].dtStart.parseComnpactISO8601()>a)){if(d&&c[p].startMonth){t=c[p],r=getDateFromDay(t,a,!1,n);break}for(var i=0;i<c[p].rDates.length;i++)c[p].rDates[i].parseComnpactISO8601()<a&&(null==r||a-c[p].rDates[i].parseComnpactISO8601()<a-r.startDate)&&(t=c[p],r={offsetFrom:t.tzOffsetFROM,offsetTo:t.tzOffsetTO,startDate:c[p].rDates[i].parseComnpactISO8601()});d=!1}var o,v=timezones[e].standardComponents;if(d=!0,v)for(p=0;p<v.length;p++)if(!(v[p].dtStart.parseComnpactISO8601()>a)){if(d&&v[p].startMonth){t=v[p],o=getDateFromDay(t,a);break}for(i=0;i<v[p].rDates.length;i++)v[p].rDates[i].parseComnpactISO8601()<a&&(null==o||a-v[p].rDates[i].parseComnpactISO8601()<a-o.startDate)&&(s=v[p],o={offsetFrom:s.tzOffsetFROM,offsetTo:s.tzOffsetTO,startDate:v[p].rDates[i].parseComnpactISO8601()});d=!1}r&&o?l=r.startDate>o.startDate?r.offsetTo:o.offsetTo:r?l=r.offsetTo:o&&(l=o.offsetTo)}else"local"==e&&(l=getStringLocalOffset(a));return l}function getStringLocalOffset(e){var a="+0000",n=e.getTimezoneOffset();if(n>0){var l=Math.floor(n/60),r=n-60*l;a="-"+(l<10?"0"+l:l),a+=r<10?"0"+r:r}else if(n<0){n*=-1;l=Math.floor(n/60),r=n-60*l;a="+"+(l<10?"0"+l:l),a+=r<10?"0"+r:r}return a}function getDayLightObject(e,a){var n,l,r=a;n=getDateFromDay(e,a),l=getDateFromDay(e,a);for(var t=0;t<e.rDatesDT.length;t++){var s=e.rDatesDT[t].parseComnpactISO8601();if(s&&s.getFullYear()==a.getFullYear()){n=s;break}}for(t=0;t<e.rDatesST.length;t++){var d=e.rDatesST[t].parseComnpactISO8601();if(d&&d.getFullYear()==a.getFullYear()){l=d;break}}return n>l&&(r>n?l.setFullYear(l.getFullYear()+1):n.setFullYear(n.getFullYear()-1)),{dayLightStartDate:n,dayLightEndDate:l}}function deleteEventFromArray(e){var a=e.substring(0,e.lastIndexOf("/")+1),n=0;if(null!=globalEventList.displayEventsArray[a]&&void 0!==globalEventList.displayEventsArray[a])for(var l=globalEventList.displayEventsArray[a].length-1;l>=0;l--)if(globalEventList.displayEventsArray[a][l].id==e){n++;for(var r=0;r<globalEventList.displayEventsArray[a][l].alertTimeOut.length;r++)clearTimeout(globalEventList.displayEventsArray[a][l].alertTimeOut[r]);globalEventList.displayEventsArray[a].splice(l,1)}if(0==n&&null!=globalEventList.displayTodosArray[a]&&void 0!==globalEventList.displayTodosArray[a])for(l=globalEventList.displayTodosArray[a].length-1;l>=0;l--)if(globalEventList.displayTodosArray[a][l].id==e){for(r=0;r<globalEventList.displayTodosArray[a][l].alertTimeOut.length;r++)clearTimeout(globalEventList.displayTodosArray[a][l].alertTimeOut[r]);globalEventList.displayTodosArray[a].splice(l,1)}}function findEventInArray(e,a,n){var l=e.substring(0,e.lastIndexOf("/")+1),r=null;if(a){for(var t=0;t<globalEventList.displayEventsArray[l].length;t++)if(globalEventList.displayEventsArray[l][t].id==e)return globalEventList.displayEventsArray[l][t]}else for(t=0;t<globalEventList.displayTodosArray[l].length;t++)if(globalEventList.displayTodosArray[l][t].id==e){if(void 0===n||null==n)return globalEventList.displayTodosArray[l][t];if(globalEventList.displayTodosArray[l][t].repeatHash==n)return globalEventList.displayTodosArray[l][t];null==r&&(r=globalEventList.displayTodosArray[l][t])}return r||""}function getvCalendarstart(e){var a="",n=!1,l=e.vcalendar;if(l.match(vCalendar.pre.vcalendar)){if(a=l.match(vCalendar.pre.beginVTODO),null!=a){var r=l.match(vCalendar.pre.endVTODO);return null!=r&&"1970-01-01T01:01:01Z"}if(a=l.match(vCalendar.pre.beginVEVENT),n=null!=a,!n)return!1;if(a=l.match(vCalendar.pre.endVEVENT),n=null!=a,!n)return!1;var t,s="";if(l=l.replace(/BEGIN:VTIMEZONE((\s|.)*?)END:VTIMEZONE\r\n/g,""),a=l.match(vCalendar.pre.contentline_DTSTART),null!=a&&(parsed=a[0].match(vCalendar.pre.contentline_parse),s=parsed[4],t=s,t=-1==t.indexOf("T")?t.substring(0,4)+"-"+t.substring(4,6)+"-"+t.substring(6,8)+"T00:00:00Z":t.substring(0,4)+"-"+t.substring(4,6)+"-"+t.substring(6,8)+"T"+t.substring(9,11)+":"+t.substring(11,13)+":"+t.substring(13,15)+"Z",s=t),""!=s){var d=$.fullCalendar.parseDate(t);if("Invalid Date"==d.toString())return!1}return t}return-1}function giveMeUntilDate(e,a,n,l,r){var t=$.fullCalendar.parseDate(e),s=0,d=0;"DAILY"==n?(s=0,d=1):"WEEKLY"==n?(s=0,d=7):"MONTHLY"==n?(s=1,d=0):"YEARLY"==n&&(s=12,d=0);for(var c=1,p=1;c<a;){if(p%l==0&&c++,r)var i=new Date(t.getFullYear(),t.getMonth()+s,t.getDate()+d);else i=new Date(t.getFullYear(),t.getMonth()+s,t.getDate()+d,t.getHours(),t.getMinutes(),t.getSeconds());t=i,p++}return t}function checkAndFixMultipleUID(e,a){var n=e,l={},r=0,t=new Array,s="VEVENT";a||(s="VTODO");var d=n,c=d.match(vCalendar.pre.valarm);for(null!=c&&(d=d.replace(c[0],""));null!=d.match(vCalendar.pre.contentline_UID);)vcalendar_element=d.match(vCalendar.pre.contentline_UID),null!=vcalendar_element[0]&&void 0===l[vcalendar_element[0]]&&(l[vcalendar_element[0]]={isTimezone:!1,string:""},r++),d=d.replace(vcalendar_element[0],"\r\n");if(1==r)return[e];var p=n.indexOf("BEGIN:VTIMEZONE"),o=n.lastIndexOf("END:VTIMEZONE"),v=0,u="";if(-1!=p&&-1!=o){for(i=o+2;i<n.length;i++)if("\n"==n.charAt(i)){v=i+1;break}u=n.substring(p,v),n=n.substring(0,p)+n.substring(v,n.length)}for(;null!=n.match(vCalendar.pre[s.toLowerCase()]);){if("\r\n"==n.substring(n.indexOf("BEGIN:"+s)-2,n.indexOf("BEGIN:"+s))){var m=n.substring(n.indexOf("BEGIN:"+s)-2,n.indexOf("END:"+s)+("END:"+s).length);n=n.replace(m,"")}else{m=n.substring(n.indexOf("BEGIN:"+s),n.indexOf("END:"+s)+("END:"+s).length);n=n.replace(m,""),m+="\r\n"}var g=m;c=g.match(vCalendar.pre.valarm);if(null!=c&&(g=g.replace(c[0],"")),vcalendar_element=g.match(vCalendar.pre.contentline_UID),null!=vcalendar_element[0]){var _=g.match(vCalendar.pre.contentline_DTSTART);if(null!=_){var f=_[0].match(vCalendar.pre.contentline_parse),C=vcalendarSplitParam(f[3]);-1!=C.indexElementOf("TZID=")&&(l[vcalendar_element[0]].isTimezone=!0)}if(!a&&!l[vcalendar_element[0]].isTimezone){_=g.match(vCalendar.pre.contentline_DUE);if(null!=_){f=_[0].match(vCalendar.pre.contentline_parse),C=vcalendarSplitParam(f[3]);-1!=C.indexElementOf("TZID=")&&(l[vcalendar_element[0]].isTimezone=!0)}}l[vcalendar_element[0]].string+=m}}for(var T in l){var E="";null!=vCalendar.tplM.begin&&null!=(process_elem=vCalendar.tplM.begin[0])?E+=vCalendar.tplM.begin[0]:(process_elem=vCalendar.tplC.begin,process_elem=process_elem.replace("##:::##group_wd##:::##",""),E+=process_elem),null!=vCalendar.tplM.contentline_VERSION&&null!=(process_elem=vCalendar.tplM.contentline_VERSION[0])?(f=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=f[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+f[1].replace(".","\\."),"mg"),"\r\nitem"+groupCounter+++".").substring(2))):(process_elem=vCalendar.tplC.contentline_VERSION,process_elem=process_elem.replace("##:::##group_wd##:::##","")),process_elem=process_elem.replace("##:::##version##:::##","2.0"),E+=process_elem,null!=vCalendar.tplM.contentline_CALSCALE&&null!=(process_elem=vCalendar.tplM.contentline_CALSCALE[0])?(f=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=f[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+f[1].replace(".","\\."),"mg"),"\r\nitem"+groupCounter+++".").substring(2))):(process_elem=vCalendar.tplC.contentline_CALSCALE,process_elem=process_elem.replace("##:::##group_wd##:::##","")),process_elem=process_elem.replace("##:::##calscale##:::##","GREGORIAN"),E+=process_elem,l[T].isTimezone&&(E+=u),E=E.substring(0,E.length-2),E+=l[T].string,E.lastIndexOf("\r\n")!=E.length-2&&(E+="\r\n"),null!=vCalendar.tplM.contentline_PRODID&&null!=(process_elem=vCalendar.tplM.contentline_PRODID[0])?(f=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=f[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+f[1].replace(".","\\."),"mg"),"\r\nitem"+groupCounter+++".").substring(2))):(process_elem=vCalendar.tplC.contentline_PRODID,process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##","")),process_elem=process_elem.replace("##:::##value##:::##","-//Inf-IT//"+globalAppName+" "+globalVersion+"//EN"),E+=process_elem,void 0!==vCalendar.tplM.unprocessed&&""!=vCalendar.tplM.unprocessed&&null!=vCalendar.tplM.unprocessed&&(E+=vCalendar.tplM.unprocessed.replace(RegExp("^\r\n"),"")),vCalendar.tplM.unprocessed=new Array,null!=vCalendar.tplM.end&&null!=(process_elem=vCalendar.tplM.end[0])?E+=vCalendar.tplM.end[0]:(process_elem=vCalendar.tplC.end,process_elem=process_elem.replace("##:::##group_wd##:::##",""),E+=process_elem),t.push(E)}return t}function dataToVcalendar(e,a,n,l,r,t,s){var d=!1,c="",p=0,i="local";if(null!=vCalendar.tplM.begin&&null!=(I=vCalendar.tplM.begin[0])?c+=vCalendar.tplM.begin[0]:(I=vCalendar.tplC.begin,I=I.replace("##:::##group_wd##:::##",""),c+=I),null!=vCalendar.tplM.contentline_VERSION&&null!=(I=vCalendar.tplM.contentline_VERSION[0])?(Pe=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Pe[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+Pe[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2))):(I=vCalendar.tplC.contentline_VERSION,I=I.replace("##:::##group_wd##:::##","")),I=I.replace("##:::##version##:::##","2.0"),c+=I,null!=vCalendar.tplM.contentline_CALSCALE&&null!=(I=vCalendar.tplM.contentline_CALSCALE[0])?(Pe=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Pe[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+Pe[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2))):(I=vCalendar.tplC.contentline_CALSCALE,I=I.replace("##:::##group_wd##:::##","")),I=I.replace("##:::##calscale##:::##","GREGORIAN"),c+=I,""!=r)var o=r.substring(0,r.lastIndexOf("/")+1);else o=n.substring(0,n.lastIndexOf("/")+1);var v=jQuery.grep(globalEventList.displayEventsArray[o],function(e){if(e.id==$("#uid").val()&&(e.repeatCount<2||!e.repeatCount))return!0}),u=new Array,m="",g=!1,_="",f=new Array;if(v.length>0){o=$("#uid").val().substring(0,$("#uid").val().lastIndexOf("/")+1);for(o&&null!=globalEventList.events[o][$("#uid").val()].uid&&(_=globalEventList.events[o][$("#uid").val()].vcalendar);null!=_.match(vCalendar.pre.vevent);){if("\r\n"==_.substring(_.indexOf("BEGIN:VEVENT")-2,_.indexOf("BEGIN:VEVENT"))){var C=_.substring(_.indexOf("BEGIN:VEVENT")-2,_.indexOf("END:VEVENT")+"END:VEVENT".length);_=_.replace(C,"")}else{C=_.substring(_.indexOf("BEGIN:VEVENT"),_.indexOf("END:VEVENT")+"END:VEVENT".length);_=_.replace(C,""),C+="\r\n"}f[f.length]=C}}for(var T="",E=0;E<v.length;E++)if(-1==u.indexOf(v[E].timeZone)){if(v[E].allDay||s&&$("#vcalendarHash").val()==String(CryptoJS.SHA256(v[E].vcalendar)))continue;var D=buildTimezoneComponent(v[E].timeZone);""!=D&&$("#vcalendarHash").val()!=String(CryptoJS.SHA256(v[E].vcalendar))?(u[u.length]=v[E].timeZone,m+=D,m.lastIndexOf("\r\n")!=m.length-2&&(m+="\r\n"),g=!0):""!=D&&$("#vcalendarHash").val()==String(CryptoJS.SHA256(v[E].vcalendar))&&(T+=D)}g&&(c.lastIndexOf("\r\n")!=c.length-2&&(c+="\r\n"),c+=m);for(var h=c,M="",A=!1,O=0;O<v.length;O++)if(f.splice(f.indexOf(v[O].vcalendar),1),""==$("#futureStart").val()&&$("#vcalendarHash").val()!=String(CryptoJS.SHA256(v[O].vcalendar))||v[O].rec_id!=$("#recurrenceID").val()){var R=v[O].vcalendar.match(vCalendar.pre.contentline_UID);if(null!=R&&(R=R[0].match(vCalendar.pre.contentline_parse)[4]),s&&$("#vcalendarHash").val()==String(CryptoJS.SHA256(v[O].vcalendar))||s&&!v[O].rec_id&&$("#vcalendarUID").val()==R){var b=v[O].vcalendar.match(vCalendar.pre.contentline_RRULE2),S=v[O].start,I=vCalendar.tplC.contentline_EXDATE;if(I=I.replace("##:::##group_wd##:::##",""),I=I.replace("##:::##params_wsc##:::##",""),v[O].allDay)S=$("#recurrenceID").val(),I=I.replace("##:::##AllDay##:::##",";"+vcalendarEscapeValue("VALUE=DATE")),I=I.replace("##:::##TZID##:::##",vcalendarEscapeValue("")),I=I.replace("##:::##value##:::##",vcalendarEscapeValue(S));else{if(S=$("#recurrenceID").val().parseComnpactISO8601(),$("#allday").prop("checked")||globalSettings.timezonesupport.value&&(i=$("#timezone").val()),"local"!=i){var y=getOffsetByTZ(i,S),N=-1*y.getSecondsFromOffset();S=new Date(S.setSeconds(N))}else S=new Date(S.setSeconds(getLocalOffset(S)));S=$.fullCalendar.formatDate(S,"yyyyMMdd'T'HHmmss'Z'"),I=I.replace("##:::##AllDay##:::##",vcalendarEscapeValue("")),I=I.replace("##:::##TZID##:::##",""),I=I.replace("##:::##value##:::##",vcalendarEscapeValue(S))}v[O].vcalendar=v[O].vcalendar.replace(b,b+I)}0==v[O].vcalendar.indexOf("\r\n")&&c.lastIndexOf("\r\n")==c.length-2?c+=v[O].vcalendar.substring(2,v[O].vcalendar.length):0==v[O].vcalendar.indexOf("\r\n")&&c.lastIndexOf("\r\n")!=c.length-2||0!=v[O].vcalendar.indexOf("\r\n")&&c.lastIndexOf("\r\n")==c.length-2?c+=v[O].vcalendar:c+="\r\n"+v[O].vcalendar}else""!=$("#futureStart").val().split(";")[0]&&$("#futureStart").val().split(";")[1]!=v[O].start?($("#futureStart").val().split(";")[0]>1&&$("#vcalendarHash").val()==String(CryptoJS.SHA256(v[O].vcalendar))&&(v[O].vcalendar=changeRuleForFuture(v[O],$("#futureStart").val().split(";")[0])),0==v[O].vcalendar.indexOf("\r\n")&&c.lastIndexOf("\r\n")==c.length-2?c+=v[O].vcalendar.substring(2,v[O].vcalendar.length):0==v[O].vcalendar.indexOf("\r\n")&&c.lastIndexOf("\r\n")!=c.length-2||0!=v[O].vcalendar.indexOf("\r\n")&&c.lastIndexOf("\r\n")==c.length-2?c+=v[O].vcalendar:c+="\r\n"+v[O].vcalendar,A=!0):s&&""!=$("#futureStart").val().split(";")[0]&&$("#futureStart").val().split(";")[1]==v[O].start?($("#vcalendarHash").val()==String(CryptoJS.SHA256(v[O].vcalendar))&&(v[O].vcalendar=changeRuleForFuture(v[O],2)),0==v[O].vcalendar.indexOf("\r\n")&&c.lastIndexOf("\r\n")==c.length-2?c+=v[O].vcalendar.substring(2,v[O].vcalendar.length):0==v[O].vcalendar.indexOf("\r\n")&&c.lastIndexOf("\r\n")!=c.length-2||0!=v[O].vcalendar.indexOf("\r\n")&&c.lastIndexOf("\r\n")==c.length-2?c+=v[O].vcalendar:c+="\r\n"+v[O].vcalendar):M=v[O];c=c.replace(M.vcalendar,"");for(var V=0;V<f.length;V++)0==f[V].indexOf("\r\n")&&c.lastIndexOf("\r\n")==c.length-2?c+=f[V].substring(2,f[V].length):0==f[V].indexOf("\r\n")&&c.lastIndexOf("\r\n")!=c.length-2||0!=f[V].indexOf("\r\n")&&c.lastIndexOf("\r\n")==c.length-2?c+=f[V]:c+="\r\n"+f[V];var x="";if(s||A){if(c.lastIndexOf("\r\n")!=c.length-2&&(c+="\r\n"),!g&&A&&""!=T&&(c+=T,c.lastIndexOf("\r\n")!=c.length-2&&(c+="\r\n")),null!=vCalendar.tplM.contentline_PRODID&&null!=(I=vCalendar.tplM.contentline_PRODID[0])?(Pe=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Pe[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+Pe[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2))):(I=vCalendar.tplC.contentline_PRODID,I=I.replace("##:::##group_wd##:::##",""),I=I.replace("##:::##params_wsc##:::##","")),I=I.replace("##:::##value##:::##","-//Inf-IT//"+globalAppName+" "+globalVersion+"//EN"),c+=I,void 0!==vCalendar.tplM.unprocessed&&""!=vCalendar.tplM.unprocessed&&null!=vCalendar.tplM.unprocessed&&(c+=vCalendar.tplM.unprocessed.replace(RegExp("^\r\n"),"")),vCalendar.tplM.unprocessed=new Array,null!=vCalendar.tplM.end&&null!=(I=vCalendar.tplM.end[0])?c+=vCalendar.tplM.end[0]:(I=vCalendar.tplC.end,I=I.replace("##:::##group_wd##:::##",""),c+=I),s){var w=checkAndFixMultipleUID(c,!0),L=w[0];return w.splice(0,1),putVcalendarToCollection(a,n,l,L,r,"vevent",t,s,w)}A&&(x=c,c=h)}var U="";"undefined"!=typeof globalSessionTimeZone&&globalSessionTimeZone&&(i=globalSessionTimeZone);var Z=!1;if(!$("#allday").prop("checked")){globalSettings.timezonesupport.value&&(i=$("#timezone").val()),"UTC"==i?(Z=!0,U=""):U="local"==i?"":"custom"==i?";"+vcalendarEscapeValue("TZID="+M.timeZone):";"+vcalendarEscapeValue("TZID="+i);var Y="";globalSettings.rewritetimezonecomponent.value||!vCalendar.tplM.unprocessedVTIMEZONE?-1==u.indexOf(i)&&(Y=buildTimezoneComponent(i)):Y=vCalendar.tplM.unprocessedVTIMEZONE,c.lastIndexOf("\r\n")!=c.length-2&&(c+="\r\n"),c+=Y}null!=vCalendar.tplM.beginVEVENT&&null!=(I=vCalendar.tplM.beginVEVENT[0])?(c.lastIndexOf("\r\n")==c.length-2?c+=vCalendar.tplM.beginVEVENT[0]:c+="\r\n"+vCalendar.tplM.beginVEVENT[0],d=!0):(I=vCalendar.tplC.beginVEVENT,I=I.replace("##:::##group_wd##:::##",""),c.lastIndexOf("\r\n")==c.length-2?c+=I:c+="\r\n"+I,d=!0);var k,F=new Date;k=F.getUTCFullYear()+(F.getUTCMonth()+1<10?"0":"")+(F.getUTCMonth()+1)+(F.getUTCDate()<10?"0":"")+F.getUTCDate()+"T"+(F.getUTCHours()<10?"0":"")+F.getUTCHours()+(F.getUTCMinutes()<10?"0":"")+F.getUTCMinutes()+(F.getUTCSeconds()<10?"0":"")+F.getUTCSeconds()+"Z";if(""==$("#recurrenceID").val())var H="orig";else H=$("#recurrenceID").val();var B="";for(vev in vCalendar.tplM.contentline_CREATED)vev==H&&(B=vCalendar.tplM.contentline_CREATED[vev]);if(""!=B?(I=B,Pe=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Pe[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+Pe[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2))):(I=vCalendar.tplC.contentline_CREATED,I=I.replace("##:::##group_wd##:::##",""),I=I.replace("##:::##params_wsc##:::##",""),I=I.replace("##:::##value##:::##",vcalendarEscapeValue(k))),c+=I,null!=vCalendar.tplM.contentline_LM&&null!=(I=vCalendar.tplM.contentline_LM[0])?(Pe=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Pe[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+Pe[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2))):(I=vCalendar.tplC.contentline_LM,I=I.replace("##:::##group_wd##:::##",""),I=I.replace("##:::##params_wsc##:::##","")),I=I.replace("##:::##value##:::##",vcalendarEscapeValue(k)),c+=I,null!=vCalendar.tplM.contentline_DTSTAMP&&null!=(I=vCalendar.tplM.contentline_DTSTAMP[0])?(Pe=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Pe[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+Pe[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2))):(I=vCalendar.tplC.contentline_DTSTAMP,I=I.replace("##:::##group_wd##:::##",""),I=I.replace("##:::##params_wsc##:::##","")),I=I.replace("##:::##value##:::##",vcalendarEscapeValue(k)),c+=I,""==$("#futureStart").val()&&"MOVE_IN"!=e&&"MOVE_OTHER"!=e&&null!=vCalendar.tplM.contentline_UID&&null!=(I=vCalendar.tplM.contentline_UID[0]))Pe=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Pe[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+Pe[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2));else{I=vCalendar.tplC.contentline_UID,I=I.replace("##:::##group_wd##:::##",""),I=I.replace("##:::##params_wsc##:::##","");var P=globalEventList.getNewUID();I=I.replace("##:::##uid##:::##",P)}if(c+=I,null!=vCalendar.tplM.contentline_SUMMARY&&null!=(I=vCalendar.tplM.contentline_SUMMARY[0])?(Pe=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Pe[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+Pe[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2))):(I=vCalendar.tplC.contentline_SUMMARY,I=I.replace("##:::##group_wd##:::##",""),I=I.replace("##:::##params_wsc##:::##","")),I=I.replace("##:::##value##:::##",vcalendarEscapeValue($("#name").val())),c+=I,"0"!=$("#priority").val()&&(null!=vCalendar.tplM.contentline_PRIORITY&&null!=(I=vCalendar.tplM.contentline_PRIORITY[0])?(Pe=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Pe[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+Pe[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2))):(I=vCalendar.tplC.contentline_PRIORITY,I=I.replace("##:::##group_wd##:::##",""),I=I.replace("##:::##params_wsc##:::##","")),I=I.replace("##:::##value##:::##",vcalendarEscapeValue($("#priority").val())),c+=I),d){if("no-repeat"!=$("#repeat").val()){var z=$("#repeat_interval_detail").val(),G="",W="",X="",K="",J=!1;z=1==z||""==z?"":";INTERVAL="+$("#repeat_interval_detail").val();var Q=$("#repeat").val();if("TWO_WEEKLY"==Q)Q="WEEKLY",z=";INTERVAL=2";else if("BUSINESS"==Q){if(Q="WEEKLY",G=";BYDAY=",globalSettings.weekenddays.value.length>0){for(var j=0;j<7;j++)-1==globalSettings.weekenddays.value.indexOf(j)&&(G+=j+",");G=G.substring(0,G.length-1),G=G.replace(1,"MO").replace(2,"TU").replace(3,"WE").replace(4,"TH").replace(5,"FR").replace(6,"SA").replace(0,"SU")}else G="SA,SU";z=""}else if("WEEKEND"==Q){if(Q="WEEKLY",G=";BYDAY=",globalSettings.weekenddays.value.length>0){for(j=0;j<globalSettings.weekenddays.value.length;j++)G+=globalSettings.weekenddays.value[j]+",";G=G.substring(0,G.length-1),G=G.replace(1,"MO").replace(2,"TU").replace(3,"WE").replace(4,"TH").replace(5,"FR").replace(6,"SA").replace(0,"SU")}else G="SA,SU";z=""}else if("CUSTOM_WEEKLY"==Q){Q="WEEKLY";var q=$("#week_custom .customTable td.selected");if(q.length>0){G=";BYDAY=";for(var ee=0;ee<q.length;ee++)G+=$(q[ee]).attr("data-type")+",";G=G.substring(0,G.length-1),G=G.replace(1,"MO").replace(2,"TU").replace(3,"WE").replace(4,"TH").replace(5,"FR").replace(6,"SA").replace(0,"SU"),null!=globalSettings.mozillasupport.value&&globalSettings.mozillasupport.value||(""!=M?""!=M.wkst&&(K=";WKST="+M.wkst.replace(1,"MO").replace(2,"TU").replace(3,"WE").replace(4,"TH").replace(5,"FR").replace(6,"SA").replace(0,"SU")):K=";WKST="+globalSettings.datepickerfirstdayofweek.value.toString().replace(1,"MO").replace(2,"TU").replace(3,"WE").replace(4,"TH").replace(5,"FR").replace(6,"SA").replace(0,"SU"))}}else if("CUSTOM_MONTHLY"==Q){Q="MONTHLY";var ae="",ne=$("#repeat_month_custom_select").val();if("custom"!=ne&&"DAY"!=$("#repeat_month_custom_select2").val()){switch(""!=ne&&(G=";BYDAY="),ne){case"every":ae="";break;case"first":ae="1";break;case"second":ae="2";break;case"third":ae="3";break;case"fourth":ae="4";break;case"fifth":ae="5";break;case"last":ae="-1";break;default:ae=""}G+=ae+$("#repeat_month_custom_select2").val()}else if("custom"!=ne&&"DAY"==$("#repeat_month_custom_select2").val())switch(G="",ne){case"every":W=";BYMONTHDAY=";for(var le=1;le<32;le++)W+=le+",";W=W.substring(0,W.length-1);break;case"first":W=";BYMONTHDAY=1";break;case"second":W=";BYMONTHDAY=2";break;case"third":W=";BYMONTHDAY=3";break;case"fourth":W=";BYMONTHDAY=4";break;case"fifth":W=";BYMONTHDAY=5";break;case"last":W=";BYMONTHDAY=-1";break;default:ae="",W=""}else{var re=$("#month_custom2 .selected");if(re.length>0){W=";BYMONTHDAY=";for(ee=0;ee<re.length;ee++)W+=$(re[ee]).attr("data-type")+",";W=W.substring(0,W.length-1)}}}else if("CUSTOM_YEARLY"==Q){Q="YEARLY";ae="",ne=$("#repeat_year_custom_select1").val();var te=$("#year_custom3 .selected");if(te.length>0){X=";BYMONTH=";for(ee=0;ee<te.length;ee++){var se=parseInt($(te[ee]).attr("data-type"),10);isNaN(se)||(X+=se+1+",")}X=X.substring(0,X.length-1)}if("custom"!=ne&&"DAY"!=$("#repeat_year_custom_select2").val()){switch(""!=ne&&(G=";BYDAY="),ne){case"every":ae="";break;case"first":ae="1";break;case"second":ae="2";break;case"third":ae="3";break;case"fourth":ae="4";break;case"fifth":ae="5";break;case"last":ae="-1";break;default:ae=""}G+=ae+$("#repeat_year_custom_select2").val()}else if("custom"!=ne&&"DAY"==$("#repeat_year_custom_select2").val())switch(G="",ne){case"every":W=";BYMONTHDAY=";for(le=1;le<32;le++)W+=le+",";W=W.substring(0,W.length-1);break;case"first":W=";BYMONTHDAY=1";break;case"second":W=";BYMONTHDAY=2";break
;case"third":W=";BYMONTHDAY=3";break;case"fourth":W=";BYMONTHDAY=4";break;case"fifth":W=";BYMONTHDAY=5";break;case"last":W=";BYMONTHDAY=-1";break;default:ae="",W=""}else{re=$("#year_custom1 .selected");if(re.length>0){W=";BYMONTHDAY=";for(ee=0;ee<re.length;ee++)W+=$(re[ee]).attr("data-type")+",";W=W.substring(0,W.length-1)}}}else"custom_repeat"==$("#repeat option:selected").attr("data-type")&&(J=!0);if(null!=vCalendar.tplM.contentline_RRULE&&null!=(I=vCalendar.tplM.contentline_RRULE[0])?(Pe=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Pe[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+Pe[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2))):(I=vCalendar.tplC.contentline_RRULE,I=I.replace("##:::##group_wd##:::##",""),I=I.replace("##:::##params_wsc##:::##","")),J)I=I.replace("##:::##value##:::##",$("#repeat").val());else if("on_date"==$("#repeat_end_details").val()){var de=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#repeat_end_date").val()),ce="";if($("#allday").prop("checked"))ce=$.fullCalendar.formatDate(de,"yyyyMMdd")+"T000000Z";else{var pe=new Date(Date.parse("01/02/1990, "+$("#time_from").val()));if(de.setHours(pe.getHours()),de.setMinutes(pe.getMinutes()),de.setSeconds(pe.getSeconds()),globalSettings.timezonesupport.value&&i in timezones)y=getOffsetByTZ(i,de);if(y){N=1e3*y.getSecondsFromOffset()*-1;de.setTime(de.getTime()+N)}ce=$.fullCalendar.formatDate(de,"yyyyMMdd'T'HHmmss'Z'")}I=I.replace("##:::##value##:::##",vcalendarEscapeValue("FREQ="+Q)+z+";UNTIL="+ce+X+W+G+K)}else I="after"==$("#repeat_end_details").val()?I.replace("##:::##value##:::##",vcalendarEscapeValue("FREQ="+Q)+z+";COUNT="+parseInt($("#repeat_end_after").val())+X+W+G+K):I.replace("##:::##value##:::##",vcalendarEscapeValue("FREQ="+Q)+z+X+W+G+K);if(c+=I,M.repeatStart){var ie=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_from").val()),oe=M.repeatStart,ve=new Date(1970,1,1,0,0,0);$("#allday").prop("checked")||(ve=new Date(Date.parse("01/02/1990, "+$("#time_from").val())),ie.setHours(ve.getHours()),ie.setMinutes(ve.getMinutes()),ie.setSeconds(ve.getSeconds()));var ue=ie-oe;for(var me in vCalendar.tplM.contentline_EXDATE)if(!isNaN(me)){var ge=("\r\n"+vCalendar.tplM.contentline_EXDATE[me]).match(vCalendar.pre.contentline_parse),_e=ge[4].parseComnpactISO8601();if(_e){if(-1!=ge[4].indexOf("T")||$("#allday").prop("checked")){if(-1!=ge[4].indexOf("T")&&!$("#allday").prop("checked"))if("local"!=i){y=getOffsetByTZ(i,_e);var fe=getOffsetByTZ(M.timeZone,_e);N=-1*(y.getSecondsFromOffset()-fe.getSecondsFromOffset());_e=new Date(_e.setSeconds(N))}else{fe=getOffsetByTZ(M.timeZone,_e);_e=new Date(_e.setSeconds(fe.getSecondsFromOffset()))}}else{new Date(Date.parse("01/02/1990, "+$("#time_from").val()));var Ce=$.fullCalendar.formatDate(ve,"HHmmss");if(_e=(ge[4]+"T"+Ce).parseComnpactISO8601(),"local"!=i){var y=getOffsetByTZ(i,_e),N=-1*y.getSecondsFromOffset();_e=new Date(_e.setSeconds(N))}}var Te=new Date(_e.getTime()+ue);if(I=vCalendar.tplC.contentline_EXDATE,I=I.replace("##:::##group_wd##:::##",""),I=I.replace("##:::##params_wsc##:::##",""),$("#allday").prop("checked")){var Ee=$.fullCalendar.formatDate(Te,"yyyyMMdd");I=I.replace("##:::##AllDay##:::##",";"+vcalendarEscapeValue("VALUE=DATE")),I=I.replace("##:::##TZID##:::##",vcalendarEscapeValue("")),I=I.replace("##:::##value##:::##",vcalendarEscapeValue(Ee))}else Ee=$.fullCalendar.formatDate(Te,"yyyyMMdd'T'HHmmss")+("local"!=i?"Z":""),I=I.replace("##:::##AllDay##:::##",vcalendarEscapeValue("")),I=I.replace("##:::##TZID##:::##",vcalendarEscapeValue("")),I=I.replace("##:::##value##:::##",vcalendarEscapeValue(Ee));c+=I}}}}ie=$("#eventDetailsTable").find("tr[data-id]");var De=0;for(j=0;j<ie[ie.length-1].attributes.length;j++)if("data-id"==ie[ie.length-1].attributes[j].nodeName){De=ie[ie.length-1].attributes[j].value;break}for(var he=new Array,Me=0;Me<De;Me++)if($(".alert[data-id="+(Me+1)+"]").length>0){var Ae="";if("none"!=$(".alert[data-id="+(Me+1)+"]").val()){if(null!=vCalendar.tplM.beginVALARM&&null!=(I=vCalendar.tplM.beginVALARM[0])?Ae+=vCalendar.tplM.beginVALARM[0]:(I=vCalendar.tplC.beginVALARM,I=I.replace("##:::##group_wd##:::##",""),Ae+=I,d=!0),"message"==$(".alert[data-id="+(Me+1)+"]").val()){if("on_date"==$(".alert_message_details[data-id="+(Me+1)+"]").val()){null!=vCalendar.tplM.contentline_TRIGGER&&null!=(I=vCalendar.tplM.contentline_TRIGGER[0])?(Pe=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Pe[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+Pe[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2))):(I=vCalendar.tplC.contentline_TRIGGER,I=I.replace("##:::##group_wd##:::##",""),I=I.replace("##:::##params_wsc##:::##",""));var Oe=$.datepicker.parseDate(globalSettings.datepickerformat.value,$(".message_date_input[data-id="+(Me+1)+"]").val()),Re=$.fullCalendar.formatDate(Oe,"yyyy-MM-dd"),be=new Date(Date.parse("01/02/1990, "+$(".message_time_input[data-id="+(Me+1)+"]").val())),Se=$.fullCalendar.formatDate(be,"HH:mm:ss"),Ie=$.fullCalendar.parseDate(Re+"T"+Se);if(globalSettings.timezonesupport.value&&(i=$("#timezone").val()),"none"==$(".timezone_row").css("display")&&(i="local"),"local"!=i){fe=getOffsetByTZ(i,Ie);var ye=-1*fe.getSecondsFromOffset();Ie=new Date(Ie.setSeconds(ye))}Ee=$.fullCalendar.formatDate(Ie,"yyyyMMdd'T'HHmmss")+("local"!=i?"Z":"");I=I.replace("##:::##VALUE=DATE-TIME##:::##",";VALUE=DATE-TIME"),I=I.replace("##:::##VALUE=DURATION##:::##",""),I=I.replace("##:::##value##:::##",vcalendarEscapeValue(Ee)),Ae+=I}else{var Ne="",Ve=$(".before_after_input[data-id="+(Me+1)+"]").val();"minutes_before"==$(".alert_message_details[data-id="+(Me+1)+"]").val()&&(Ne="-PT"+Ve+"M"),"hours_before"==$(".alert_message_details[data-id="+(Me+1)+"]").val()&&(Ne="-PT"+Ve+"H"),"days_before"==$(".alert_message_details[data-id="+(Me+1)+"]").val()&&(Ne="-P"+Ve+"D"),"weeks_before"==$(".alert_message_details[data-id="+(Me+1)+"]").val()&&(Ne="-P"+Ve+"W"),"seconds_before"==$(".alert_message_details[data-id="+(Me+1)+"]").val()&&(Ne="-PT"+Ve+"S"),"minutes_after"==$(".alert_message_details[data-id="+(Me+1)+"]").val()&&(Ne="PT"+Ve+"M"),"hours_after"==$(".alert_message_details[data-id="+(Me+1)+"]").val()&&(Ne="PT"+Ve+"H"),"days_after"==$(".alert_message_details[data-id="+(Me+1)+"]").val()&&(Ne="P"+Ve+"D"),"weeks_after"==$(".alert_message_details[data-id="+(Me+1)+"]").val()&&(Ne="P"+Ve+"W"),"seconds_after"==$(".alert_message_details[data-id="+(Me+1)+"]").val()&&(Ne="PT"+Ve+"S"),null!=vCalendar.tplM.contentline_TRIGGER&&null!=(I=vCalendar.tplM.contentline_TRIGGER[0])?(Pe=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Pe[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+Pe[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2))):(I=vCalendar.tplC.contentline_TRIGGER,I=I.replace("##:::##group_wd##:::##",""),I=I.replace("##:::##params_wsc##:::##","")),I=I.replace("##:::##VALUE=DATE-TIME##:::##",""),I=I.replace("##:::##VALUE=DURATION##:::##",";VALUE=DURATION"),I=I.replace("##:::##value##:::##",Ne),Ae+=I}null!=vCalendar.tplM.contentline_ACTION&&null!=(I=vCalendar.tplM.contentline_ACTION[0])?(Pe=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Pe[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+Pe[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2))):(I=vCalendar.tplC.contentline_ACTION,I=I.replace("##:::##group_wd##:::##",""),I=I.replace("##:::##params_wsc##:::##","")),I=I.replace("##:::##value##:::##",vcalendarEscapeValue("DISPLAY")),Ae+=I;ie=new Date;null!=vCalendar.tplM.contentline_DESCRIPTION&&null!=(I=vCalendar.tplM.contentline_DESCRIPTION[0])?(Pe=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Pe[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+Pe[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2))):(I=vCalendar.tplC.contentline_DESCRIPTION,I=I.replace("##:::##group_wd##:::##",""),I=I.replace("##:::##params_wsc##:::##","")),I=I.replace("##:::##value##:::##",vcalendarEscapeValue("Reminder")),Ae+=I}void 0!==vCalendar.tplM.unprocessedVALARM&&void 0!==vCalendar.tplM.unprocessedVALARM[Me]&&""!=vCalendar.tplM.unprocessedVALARM[Me]&&null!=vCalendar.tplM.unprocessedVALARM[Me]&&(tmp=vCalendar.tplM.unprocessedVALARM[Me].replace(RegExp("^\r\n"),"").replace(RegExp("\r\n$"),""),0==tmp.indexOf("\r\n")&&(tmp=tmp.substring(2,tmp.length)),tmp.lastIndexOf("\r\n")!=tmp.length-2&&(tmp+="\r\n"),Ae+=tmp),null!=vCalendar.tplM.endVALARM&&null!=(I=vCalendar.tplM.endVALARM[0])?Ae+=vCalendar.tplM.endVALARM[0]:(I=vCalendar.tplC.endVALARM,I=I.replace("##:::##group_wd##:::##",""),Ae+=I),-1==he.indexOf(Ae)&&(he.push(Ae),c+=Ae)}}vCalendar.tplM.unprocessedVALARM=new Array,"none"!=$("#avail").val()&&(null!=vCalendar.tplM.contentline_TRANSP&&null!=(I=vCalendar.tplM.contentline_TRANSP[0])?(Pe=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Pe[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+Pe[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2))):(I=vCalendar.tplC.contentline_TRANSP,I=I.replace("##:::##group_wd##:::##",""),I=I.replace("##:::##params_wsc##:::##","")),I="busy"==$("#avail").val()?I.replace("##:::##value##:::##",vcalendarEscapeValue("OPAQUE")):I.replace("##:::##value##:::##",vcalendarEscapeValue("TRANSPARENT")),c+=I),""!=$("#url_EVENT").val()&&(null!=vCalendar.tplM.contentline_URL&&null!=(I=vCalendar.tplM.contentline_URL[0])?(Pe=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Pe[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+Pe[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2))):(I=vCalendar.tplC.contentline_URL,I=I.replace("##:::##group_wd##:::##",""),I=I.replace("##:::##params_wsc##:::##","")),I=I.replace("##:::##value##:::##",vcalendarEscapeValue($("#url_EVENT").val())),c+=I)}if(""!=$("#note").val()&&(null!=vCalendar.tplM.contentline_NOTE&&null!=(I=vCalendar.tplM.contentline_NOTE[0])?(Pe=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Pe[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+Pe[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2))):(I=vCalendar.tplC.contentline_NOTE,I=I.replace("##:::##group_wd##:::##",""),I=I.replace("##:::##params_wsc##:::##","")),I=I.replace("##:::##value##:::##",vcalendarEscapeValue($("#note").val())),c+=I),"NONE"!=$("#status").val()&&(null!=vCalendar.tplM.contentline_STATUS&&null!=(I=vCalendar.tplM.contentline_STATUS[0])?(Pe=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Pe[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+Pe[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2))):(I=vCalendar.tplC.contentline_STATUS,I=I.replace("##:::##group_wd##:::##",""),I=I.replace("##:::##params_wsc##:::##","")),I=I.replace("##:::##value##:::##",vcalendarEscapeValue($("#status").val())),c+=I),""!=$("#type").val()&&(null!=vCalendar.tplM.contentline_CLASS&&null!=(I=vCalendar.tplM.contentline_CLASS[0])?(Pe=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Pe[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+Pe[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2))):(I=vCalendar.tplC.contentline_CLASS,I=I.replace("##:::##group_wd##:::##",""),I=I.replace("##:::##params_wsc##:::##",""),void 0!==vCalendar.tplM.contentline_CLASS&&null!=vCalendar.tplM.contentline_CLASS&&0!=vCalendar.tplM.contentline_CLASS.length||(I="")),"none"!=$(".row_type").css("display")&&(I=vCalendar.tplC.contentline_CLASS,I=I.replace("##:::##group_wd##:::##",""),I=I.replace("##:::##params_wsc##:::##",""),I=I.replace("##:::##value##:::##",vcalendarEscapeValue($("#type").val().toUpperCase()))),c+=I),$("#recurrenceID").val()){null!=vCalendar.tplM.contentline_REC_ID&&null!=(I=vCalendar.tplM.contentline_REC_ID[0])?(Pe=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Pe[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+Pe[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2))):(I=vCalendar.tplC.contentline_REC_ID,I=I.replace("##:::##group_wd##:::##",""),I=I.replace("##:::##params_wsc##:::##",""));var xe=$("#recurrenceID").val();-1==xe.indexOf("T")?(I=I.replace("##:::##AllDay##:::##",";"+vcalendarEscapeValue("VALUE=DATE")),I=I.replace("##:::##TZID##:::##",vcalendarEscapeValue("")),I=I.replace("##:::##value##:::##",vcalendarEscapeValue(xe))):(I=I.replace("##:::##AllDay##:::##",vcalendarEscapeValue("")),I=I.replace("##:::##TZID##:::##",U),Z&&"Z"!=xe.charAt(xe.length-1)&&(xe+="Z"),I=I.replace("##:::##value##:::##",vcalendarEscapeValue(xe))),c+=I}null!=vCalendar.tplM.contentline_E_DTSTART&&null!=(I=vCalendar.tplM.contentline_E_DTSTART[0])?(Pe=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Pe[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+Pe[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2))):(I=vCalendar.tplC.contentline_E_DTSTART,I=I.replace("##:::##group_wd##:::##",""),I=I.replace("##:::##params_wsc##:::##",""));var we="",Le=(Re="",ie=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_from").val()),$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_to").val()));ve=new Date(1970,1,1,0,0,0);""==we&&(we=$.fullCalendar.formatDate(ie,"yyyyMMdd")),""==Re&&(Re=$.fullCalendar.formatDate(Le,"yyyyMMdd"));Oe=$.datepicker.parseDate("yymmdd",Re);if($("#allday").prop("checked"))I=I.replace("##:::##AllDay##:::##",";"+vcalendarEscapeValue("VALUE=DATE")),I=I.replace("##:::##TZID##:::##",vcalendarEscapeValue("")),I=I.replace("##:::##value##:::##",vcalendarEscapeValue(we));else{ve=new Date(Date.parse("01/02/1990, "+$("#time_from").val()));Ce=$.fullCalendar.formatDate(ve,"HHmmss");I=I.replace("##:::##AllDay##:::##",vcalendarEscapeValue("")),I=I.replace("##:::##TZID##:::##",U),I=I.replace("##:::##value##:::##",vcalendarEscapeValue(we+"T"+Ce+(Z?"Z":"")))}if(c+=I,""!=M&&""!=M.type){oe=M.repeatStart;ie.setHours(ve.getHours()),ie.setMinutes(ve.getMinutes()),ie.setSeconds(ve.getSeconds());var $e=ie,Ue=(ue=$e-oe,M.vcalendar.match(vCalendar.pre.contentline_UID));if(null!=Ue&&(Ue=Ue[0].match(vCalendar.pre.contentline_parse)[4]),0!=ue){for(var Ze=c,Ye=new Array,ke=new Array;null!=Ze.match(vCalendar.pre.vevent);){if("\r\n"==Ze.substring(Ze.indexOf("BEGIN:VEVENT")-2,Ze.indexOf("BEGIN:VEVENT"))){C=Ze.substring(Ze.indexOf("BEGIN:VEVENT")-2,Ze.indexOf("END:VEVENT")+"END:VEVENT".length);Ze=Ze.replace(C,"")}else{C=Ze.substring(Ze.indexOf("BEGIN:VEVENT"),Ze.indexOf("END:VEVENT")+"END:VEVENT".length);Ze=Ze.replace(C,""),C+="\r\n"}Ye[Ye.length]=C,ke[ke.length]=C}0==Ye.length&&console.log("Error: '"+n+"': unable to parse vEvent");for(var Fe=0;Fe<Ye.length;Fe++){var He=Ye[Fe].match(vCalendar.pre.contentline_UID);if(null==He||He[0].match(vCalendar.pre.contentline_parse)[4]==Ue){var Be=Ye[Fe].match(vCalendar.pre.contentline_RECURRENCE_ID);if(null!=Be){var Pe=Be[0].match(vCalendar.pre.contentline_parse);I=vCalendar.tplC.contentline_REC_ID,I=I.replace("##:::##group_wd##:::##",Pe[1]),I=I.replace("##:::##params_wsc##:::##","");Te=Pe[4].parseComnpactISO8601();if(Te){Te=new Date(Te.getTime()+ue);Ee=$.fullCalendar.formatDate(Te,"yyyyMMdd'T'HHmmss");Z&&(Ee+="Z"),$("#allday").prop("checked")?(Ee=$.fullCalendar.formatDate(Te,"yyyyMMdd"),I=I.replace("##:::##AllDay##:::##",";"+vcalendarEscapeValue("VALUE=DATE")),I=I.replace("##:::##TZID##:::##",vcalendarEscapeValue("")),I=I.replace("##:::##value##:::##",vcalendarEscapeValue(Ee))):(I=I.replace("##:::##AllDay##:::##",vcalendarEscapeValue("")),I=I.replace("##:::##TZID##:::##",U),I=I.replace("##:::##value##:::##",vcalendarEscapeValue(Ee))),Ye[Fe]=Ye[Fe].replace(Be[0],"\r\n"+I)}}c=c.replace(ke[Fe],Ye[Fe])}}}}if(null!=vCalendar.tplM.contentline_E_DTEND&&null!=(I=vCalendar.tplM.contentline_E_DTEND[0])?(Pe=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Pe[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+Pe[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2))):(I=vCalendar.tplC.contentline_E_DTEND,I=I.replace("##:::##group_wd##:::##",""),I=I.replace("##:::##params_wsc##:::##","")),$("#allday").prop("checked")){var ze=new Date(Oe.getFullYear(),Oe.getMonth(),Oe.getDate()+1);ze=ze.getFullYear()+""+(ze.getMonth()+1<10?"0"+(ze.getMonth()+1):ze.getMonth()+1)+(ze.getDate()<10?"0"+ze.getDate():ze.getDate()),I=I.replace("##:::##AllDay##:::##",";"+vcalendarEscapeValue("VALUE=DATE")),I=I.replace("##:::##TZID##:::##",vcalendarEscapeValue("")),I=I.replace("##:::##value##:::##",vcalendarEscapeValue(ze))}else{var Ge=new Date(Date.parse("01/02/1990, "+$("#time_to").val()));Se=$.fullCalendar.formatDate(Ge,"HHmmss");I=I.replace("##:::##AllDay##:::##",vcalendarEscapeValue("")),I=I.replace("##:::##TZID##:::##",U),I=I.replace("##:::##value##:::##",vcalendarEscapeValue(Re+"T"+Se+(Z?"Z":"")))}if(c+=I,null!=vCalendar.tplM.contentline_LOCATION&&null!=(I=vCalendar.tplM.contentline_LOCATION[0])?(Pe=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Pe[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+Pe[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2))):(I=vCalendar.tplC.contentline_LOCATION,I=I.replace("##:::##group_wd##:::##",""),I=I.replace("##:::##params_wsc##:::##","")),""!=$("#location").val()&&(I=I.replace("##:::##value##:::##",vcalendarEscapeValue($("#location").val())),c+=I),""==$("#recurrenceID").val())H="orig";else H=$("#recurrenceID").val();if(void 0!==vCalendar.tplM.unprocessedVEVENT&&null!=vCalendar.tplM.unprocessedVEVENT)for(vev in vCalendar.tplM.unprocessedVEVENT)vev==H&&(c+=vCalendar.tplM.unprocessedVEVENT[vev].replace(RegExp("^\r\n"),""));null!=vCalendar.tplM.endVEVENT&&null!=(I=vCalendar.tplM.endVEVENT[0])?c+=vCalendar.tplM.endVEVENT[0]:(I=vCalendar.tplC.endVEVENT,I=I.replace("##:::##group_wd##:::##",""),c+=I),null!=vCalendar.tplM.contentline_PRODID&&null!=(I=vCalendar.tplM.contentline_PRODID[0])?(Pe=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")),""!=Pe[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+Pe[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2))):(I=vCalendar.tplC.contentline_PRODID,I=I.replace("##:::##group_wd##:::##",""),I=I.replace("##:::##params_wsc##:::##","")),I=I.replace("##:::##value##:::##","-//Inf-IT//"+globalAppName+" "+globalVersion+"//EN"),c+=I,void 0!==vCalendar.tplM.unprocessed&&""!=vCalendar.tplM.unprocessed&&null!=vCalendar.tplM.unprocessed&&(c+=vCalendar.tplM.unprocessed.replace(RegExp("^\r\n"),"")),vCalendar.tplM.unprocessed=new Array,null!=vCalendar.tplM.end&&null!=(I=vCalendar.tplM.end[0])?c+=vCalendar.tplM.end[0]:(I=vCalendar.tplC.end,I=I.replace("##:::##group_wd##:::##",""),c+=I);var We=new Array;if(A&&""!=x){var Xe=checkAndFixMultipleUID(x,!0);1==Xe.length?We[We.length]=x:We=Xe}c=c.replace(/[^\u0009\u000A\u000D\u0020-\uD7FF\uE000-\uFFFD]/g," ");w=checkAndFixMultipleUID(c,!0);w=$.merge(We,w);L=w[0];return w.splice(0,1),"MOVE_IN"==e?moveVcalendarToCollection(a,n,l,L,r,"vevent",t,s,w):putVcalendarToCollection(a,n,l,L,r,"vevent",t,s,w)}function fullVcalendarToData(e){CalDAVeditor_cleanup();var a="",n=e.id.substring(0,e.id.lastIndexOf("/")+1);if(null!=globalEventList.events[n][e.id].uid&&(a=globalEventList.events[n][e.id].vcalendar),!a)return!1;var l=a.split("\r\n");if(null==(parsed=("\r\n"+l[0]+"\r\n").match(vCalendar.pre.contentline_parse)))return!1;if(vCalendar.tplM.begin[0]=vCalendar.tplC.begin.replace(/##:::##group_wd##:::##/g,vcalendar_begin_group=parsed[1]),null==(parsed=("\r\n"+l[l.length-2]+"\r\n").match(vCalendar.pre.contentline_parse)))return!1;if(vCalendar.tplM.end[0]=vCalendar.tplC.end.replace(/##:::##group_wd##:::##/g,vcalendar_end_group=parsed[1]),vcalendar_begin_group!=vcalendar_end_group)return!1;a="\r\n"+l.slice(1,l.length-2).join("\r\n")+"\r\n";var r=a.indexOf("BEGIN:VTIMEZONE"),t=a.lastIndexOf("END:VTIMEZONE"),s=0,d="";if(-1!=r&&-1!=t){for(f=t+2;f<a.length;f++)if("\n"==a.charAt(f)){s=f+1;break}d=a.substring(r,s),a=a.substring(0,r)+a.substring(s,a.length)}if(vcalendar_element=a.match(RegExp("\r\n"+vCalendar.re.contentline_CALSCALE,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),version=vcalendarUnescapeValue(parsed[4]),vCalendar.tplM.contentline_CALSCALE[0]=vCalendar.tplC.contentline_CALSCALE,vCalendar.tplM.contentline_CALSCALE[0]=vCalendar.tplM.contentline_CALSCALE[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_CALSCALE[0]=vCalendar.tplM.contentline_CALSCALE[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),a=a.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(var c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=a.match(c));)vCalendar.tplM.contentline_CALSCALE[0]+=vcalendar_element_related[0].substr(2),a=a.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=a.match(RegExp("\r\n"+vCalendar.re.contentline_VERSION,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),version=vcalendarUnescapeValue(parsed[4]),vCalendar.tplM.contentline_VERSION[0]=vCalendar.tplC.contentline_VERSION,vCalendar.tplM.contentline_VERSION[0]=vCalendar.tplM.contentline_VERSION[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_VERSION[0]=vCalendar.tplM.contentline_VERSION[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),a=a.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=a.match(c));)vCalendar.tplM.contentline_VERSION[0]+=vcalendar_element_related[0].substr(2),a=a.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=a.match(RegExp("\r\n"+vCalendar.re.contentline_PRODID,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_PRODID[0]=vCalendar.tplC.contentline_PRODID,vCalendar.tplM.contentline_PRODID[0]=vCalendar.tplM.contentline_PRODID[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_PRODID[0]=vCalendar.tplM.contentline_PRODID[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),a=a.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=a.match(c));)vCalendar.tplM.contentline_PRODID[0]+=vcalendar_element_related[0].substr(2),a=a.replace(vcalendar_element_related[0],"\r\n");for(var p=new Array;null!=a.match(vCalendar.pre.vevent);){var i=a.substring(a.indexOf("BEGIN:VEVENT")-2,a.indexOf("END:VEVENT")+"END:VEVENT".length);p[p.length]=i,a=a.replace(i,"")}0==p.length&&console.log("Error: '"+e.id+"': unable to parse vEvent");for(var o=0;o<p.length;o++){var v=p[o],u=v.split("\r\n");if(null==v)return!1;if(null==(parsed="\r\nBEGIN:VEVENT\r\n".match(vCalendar.pre.contentline_parse)))return!1;if(vCalendar.tplM.beginVEVENT[0]=vCalendar.tplC.beginVEVENT.replace(/##:::##group_wd##:::##/g,vcalendar_begin_group=parsed[1]),null==(parsed=("\r\n"+l[u.length-2]+"\r\n").match(vCalendar.pre.contentline_parse)))return!1;if(vCalendar.tplM.endVEVENT[0]=vCalendar.tplC.endVEVENT.replace(/##:::##group_wd##:::##/g,vcalendar_end_group=parsed[1]),vcalendar_begin_group!=vcalendar_end_group)return!1;if(v="\r\n"+u.slice(2,u.length-1).join("\r\n")+"\r\n",vcalendar_element=v.match(RegExp("\r\n"+vCalendar.re.contentline_SUMMARY,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),title=vcalendarUnescapeValue(parsed[4]),vCalendar.tplM.contentline_SUMMARY[0]=vCalendar.tplC.contentline_SUMMARY,vCalendar.tplM.contentline_SUMMARY[0]=vCalendar.tplM.contentline_SUMMARY[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_SUMMARY[0]=vCalendar.tplM.contentline_SUMMARY[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_SUMMARY[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=v.match(RegExp("\r\n"+vCalendar.re.contentline_TRANSP,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),title=vcalendarUnescapeValue(parsed[4]),vCalendar.tplM.contentline_TRANSP[0]=vCalendar.tplC.contentline_TRANSP,vCalendar.tplM.contentline_TRANSP[0]=vCalendar.tplM.contentline_TRANSP[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_TRANSP[0]=vCalendar.tplM.contentline_TRANSP[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_TRANSP[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=v.match(RegExp("\r\n"+vCalendar.re.contentline_PRIORITY,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),title=vcalendarUnescapeValue(parsed[4]),vCalendar.tplM.contentline_PRIORITY[0]=vCalendar.tplC.contentline_PRIORITY,vCalendar.tplM.contentline_PRIORITY[0]=vCalendar.tplM.contentline_PRIORITY[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_PRIORITY[0]=vCalendar.tplM.contentline_PRIORITY[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_PRIORITY[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=v.match(RegExp("\r\n"+vCalendar.re.contentline_LOCATION,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),title=vcalendarUnescapeValue(parsed[4]),vCalendar.tplM.contentline_LOCATION[0]=vCalendar.tplC.contentline_LOCATION,vCalendar.tplM.contentline_LOCATION[0]=vCalendar.tplM.contentline_LOCATION[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_LOCATION[0]=vCalendar.tplM.contentline_LOCATION[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_LOCATION[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=v.match(RegExp("\r\n"+vCalendar.re.contentline_URL,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),title=vcalendarUnescapeValue(parsed[4]),vCalendar.tplM.contentline_URL[0]=vCalendar.tplC.contentline_URL,vCalendar.tplM.contentline_URL[0]=vCalendar.tplM.contentline_URL[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_URL[0]=vCalendar.tplM.contentline_URL[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_URL[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");var m=v.match(vCalendar.pre.valarm);if(null!=m){v=v.replace(m[0],"");for(var g="",_=new Array,f=0;f<m[0].length;f++)"END:VALARM"==m[0].substring(f-"END:VALARM".length,f)&&(_[_.length]=g+"\r\n",g=""),g+=m[0][f];for(var C=0;C<_.length;C++)if(checkA=_[C].match(vCalendar.re.valarm),null!=checkA){var T=checkA[0].split("\r\n");if(null==(parsed=("\r\n"+T[0]+"\r\n").match(vCalendar.pre.contentline_parse)))return!1;if(vCalendar.tplM.beginVALARM[C]=vCalendar.tplC.beginVALARM.replace(/##:::##group_wd##:::##/g,vcalendar_begin_group=parsed[1]),null==(parsed=("\r\n"+T[T.length-2]+"\r\n").match(vCalendar.pre.contentline_parse)))return!1;if(vCalendar.tplM.endVALARM[C]=vCalendar.tplC.endVALARM.replace(/##:::##group_wd##:::##/g,vcalendar_end_group=parsed[1]),vcalendar_begin_group!=vcalendar_end_group)return!1;if(_[C]="\r\n"+T.slice(1,T.length-2).join("\r\n")+"\r\n",trigger=_[C].match(vCalendar.pre.contentline_TRIGGER),null!=trigger){parsed=(trigger[0]+"\r\n").match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_TRIGGER[C]=vCalendar.tplC.contentline_TRIGGER,vCalendar.tplM.contentline_TRIGGER[C]=vCalendar.tplM.contentline_TRIGGER[C].replace(/##:::##group_wd##:::##/g,parsed[1]);var E=vcalendarSplitParam(parsed[3]),D="";for(f=0;f<E.length;f++)"VALUE=DATE-TIME"!=E[f]&&"VALUE=DURATION"!=E[f]&&""!=E[f]&&(D+=";"+E[f]);if(vCalendar.tplM.contentline_TRIGGER[C]=vCalendar.tplM.contentline_TRIGGER[C].replace(/##:::##params_wsc##:::##/g,D),_[C]=_[C].replace(trigger[0],""),""!=parsed[1])for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_TRIGGER[C]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"")}if(note=_[C].match(vCalendar.pre.contentline_NOTE),null!=note&&(parsed=note[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_VANOTE[C]=vCalendar.tplC.contentline_VANOTE,vCalendar.tplM.contentline_VANOTE[C]=vCalendar.tplM.contentline_VANOTE[C].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_VANOTE[C]=vCalendar.tplM.contentline_VANOTE[C].replace(/##:::##params_wsc##:::##/g,parsed[3]),_[C]=_[C].replace(note[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_VANOTE[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");if(action=_[C].match(vCalendar.pre.contentline_ACTION),null!=action&&(parsed=action[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_ACTION[C]=vCalendar.tplC.contentline_ACTION,vCalendar.tplM.contentline_ACTION[C]=vCalendar.tplM.contentline_ACTION[C].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_ACTION[C]=vCalendar.tplM.contentline_ACTION[C].replace(/##:::##params_wsc##:::##/g,parsed[3]),_[C]=_[C].replace(action[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_ACTION[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");var h=$.trim(_[C]);""!=h&&(vCalendar.tplM.unprocessedVALARM[C]=_[C])}}if(vcalendar_element=v.match(vCalendar.pre.contentline_NOTE),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_NOTE[0]=vCalendar.tplC.contentline_NOTE,vCalendar.tplM.contentline_NOTE[0]=vCalendar.tplM.contentline_NOTE[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_NOTE[0]=vCalendar.tplM.contentline_NOTE[0].replace(/##:::##params_wsc##:::##/g,""),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_NOTE[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=v.match(vCalendar.pre.contentline_CLASS),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_CLASS[0]=vCalendar.tplC.contentline_CLASS,vCalendar.tplM.contentline_CLASS[0]=vCalendar.tplM.contentline_CLASS[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_CLASS[0]=vCalendar.tplM.contentline_CLASS[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),vCalendar.tplM.contentline_CLASS[0]=vCalendar.tplM.contentline_CLASS[0].replace(/##:::##value##:::##/g,parsed[4]),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_CLASS[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n")
;if(vcalendar_element=v.match(vCalendar.pre.contentline_STATUS),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),title=vcalendarUnescapeValue(parsed[4]),vCalendar.tplM.contentline_STATUS[0]=vCalendar.tplC.contentline_STATUS,vCalendar.tplM.contentline_STATUS[0]=vCalendar.tplM.contentline_STATUS[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_STATUS[0]=vCalendar.tplM.contentline_STATUS[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_STATUS[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");var M="";if(vcalendar_element=v.match(vCalendar.pre.contentline_RECURRENCE_ID),null!=vcalendar_element){parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse);M=parsed[4];vCalendar.tplM.contentline_REC_ID[0]=vCalendar.tplC.contentline_REC_ID,vCalendar.tplM.contentline_REC_ID[0]=vCalendar.tplM.contentline_REC_ID[0].replace(/##:::##group_wd##:::##/g,parsed[1]);for(E=vcalendarSplitParam(parsed[3]),D="",f=0;f<E.length;f++)"VALUE=DATE"!=E[f]&&-1==E[f].indexOf("TZID=")&&""!=E[f]&&(D+=";"+E[f]);if(vCalendar.tplM.contentline_REC_ID[0]=vCalendar.tplM.contentline_REC_ID[0].replace(/##:::##params_wsc##:::##/g,D),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1])for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_REC_ID[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n")}""==M&&(M="orig");for(f=-1;null!=v.match(vCalendar.pre.contentline_EXDATE);)if(f++,vcalendar_element=v.match(vCalendar.pre.contentline_EXDATE),null!=vcalendar_element){parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_EXDATE[f]=vCalendar.tplC.contentline_EXDATE,vCalendar.tplM.contentline_EXDATE[f]=vCalendar.tplM.contentline_EXDATE[f].replace(/##:::##group_wd##:::##/g,parsed[1]);E=vcalendarSplitParam(parsed[3]),D="";var A="";for(C=0;C<E.length;C++)"VALUE=DATE"!=E[C]&&""!=E[C]&&(D+=";"+E[C]),"VALUE=DATE"==E[C]&&(A=E[C]);if(-1!=A.indexOf("VALUE=DATE")?vCalendar.tplM.contentline_EXDATE[f]=vCalendar.tplM.contentline_EXDATE[f].replace(/##:::##AllDay##:::##/g,";VALUE=DATE"):vCalendar.tplM.contentline_EXDATE[f]=vCalendar.tplM.contentline_EXDATE[f].replace(/##:::##AllDay##:::##/g,""),vCalendar.tplM.contentline_EXDATE[f]=vCalendar.tplM.contentline_EXDATE[f].replace(/##:::##TZID##:::##/g,""),vCalendar.tplM.contentline_EXDATE[f]=vCalendar.tplM.contentline_EXDATE[f].replace(/##:::##params_wsc##:::##/g,D),vCalendar.tplM.contentline_EXDATE[f]=vCalendar.tplM.contentline_EXDATE[f].replace(/##:::##value##:::##/g,parsed[4]),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1])for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_EXDATE[f]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n")}if(vcalendar_element=v.match(vCalendar.pre.contentline_DTEND),null!=vcalendar_element){parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_E_DTEND[0]=vCalendar.tplC.contentline_E_DTEND,vCalendar.tplM.contentline_E_DTEND[0]=vCalendar.tplM.contentline_E_DTEND[0].replace(/##:::##group_wd##:::##/g,parsed[1]);for(E=vcalendarSplitParam(parsed[3]),D="",f=0;f<E.length;f++)"VALUE=DATE"!=E[f]&&-1==E[f].indexOf("TZID=")&&""!=E[f]&&(D+=";"+E[f]);if(vCalendar.tplM.contentline_E_DTEND[0]=vCalendar.tplM.contentline_E_DTEND[0].replace(/##:::##params_wsc##:::##/g,D),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1])for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_E_DTEND[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n")}if(vcalendar_element=v.match(vCalendar.pre.contentline_DTSTART),null!=vcalendar_element){parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_E_DTSTART[0]=vCalendar.tplC.contentline_E_DTSTART,vCalendar.tplM.contentline_E_DTSTART[0]=vCalendar.tplM.contentline_E_DTSTART[0].replace(/##:::##group_wd##:::##/g,parsed[1]);for(E=vcalendarSplitParam(parsed[3]),D="",f=0;f<E.length;f++)"VALUE=DATE"!=E[f]&&-1==E[f].indexOf("TZID=")&&""!=E[f]&&(D+=";"+E[f]);if(vCalendar.tplM.contentline_E_DTSTART[0]=vCalendar.tplM.contentline_E_DTSTART[0].replace(/##:::##params_wsc##:::##/g,D),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1])for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_E_DTSTART[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n")}if(vcalendar_element=v.match(vCalendar.pre.contentline_RRULE2),null!=vcalendar_element){parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_RRULE[0]=vCalendar.tplC.contentline_RRULE,vCalendar.tplM.contentline_RRULE[0]=vCalendar.tplM.contentline_RRULE[0].replace(/##:::##group_wd##:::##/g,parsed[1]);for(E=parsed[4].split(";"),D="",f=0;f<E.length;f++)-1==E[f].indexOf("FREQ=")&&-1==E[f].indexOf("COUNT=")&&-1==E[f].indexOf("UNTIL=")&&""!=E[f]&&-1==E[f].indexOf("INTERVAL=")&&-1==E[f].indexOf("BYDAY=")&&-1==E[f].indexOf("BYMONTHDAY=")&&-1==E[f].indexOf("BYMONTH=")&&-1==E[f].indexOf("WKST=")&&(D+=";"+E[f]);if(vCalendar.tplM.contentline_RRULE[0]=vCalendar.tplM.contentline_RRULE[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),vCalendar.tplM.contentline_RRULE[0]=vCalendar.tplM.contentline_RRULE[0].replace(/##:::##value##:::##/g,"##:::##value##:::##"+D),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1])for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_RRULE[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n")}if(vcalendar_element=e.vcalendar.match(RegExp("\r\n"+vCalendar.re.contentline_UID,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_UID[0]=vCalendar.tplC.contentline_UID,vCalendar.tplM.contentline_UID[0]=vCalendar.tplM.contentline_UID[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_UID[0]=vCalendar.tplM.contentline_UID[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),vCalendar.tplM.contentline_UID[0]=vCalendar.tplM.contentline_UID[0].replace(/##:::##uid##:::##/g,parsed[4]),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_UID[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=v.match(RegExp("\r\n"+vCalendar.re.contentline_CREATED,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_CREATED[M]=vCalendar.tplC.contentline_CREATED,vCalendar.tplM.contentline_CREATED[M]=vCalendar.tplM.contentline_CREATED[M].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_CREATED[M]=vCalendar.tplM.contentline_CREATED[M].replace(/##:::##params_wsc##:::##/g,parsed[3]),vCalendar.tplM.contentline_CREATED[M]=vCalendar.tplM.contentline_CREATED[M].replace(/##:::##value##:::##/g,parsed[4]),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_CREATED[M]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=v.match(RegExp("\r\n"+vCalendar.re.contentline_LM,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_LM[0]=vCalendar.tplC.contentline_LM,vCalendar.tplM.contentline_LM[0]=vCalendar.tplM.contentline_LM[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_LM[0]=vCalendar.tplM.contentline_LM[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_LM[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=v.match(RegExp("\r\n"+vCalendar.re.contentline_DTSTAMP,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_DTSTAMP[0]=vCalendar.tplC.contentline_DTSTAMP,vCalendar.tplM.contentline_DTSTAMP[0]=vCalendar.tplM.contentline_DTSTAMP[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_DTSTAMP[0]=vCalendar.tplM.contentline_DTSTAMP[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_DTSTAMP[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");0==v.indexOf("\r\n")&&(v=v.substring(2,v.length-2)),v.lastIndexOf("\r\n")!=v.length-2&&(v+="\r\n"),vCalendar.tplM.unprocessedVEVENT[M]=v}0==a.indexOf("\r\n")&&(a=a.substring(2,a.length-2)),a.lastIndexOf("\r\n")!=a.length-2&&(a+="\r\n"),vCalendar.tplM.unprocessedVTIMEZONE=d,vCalendar.tplM.unprocessed=a}function parseAlarmWeek(e){var a="",n="W",l=604800;return e=e.substring(e.indexOf("P")+1),a=e.substring(0,e.indexOf(n)),a*l*1e3+n}function parseAlarmDay(e){var a="",n="D",l=86400,r=0;return e=e.substring(e.indexOf("P")+1),a=e.substring(0,e.indexOf(n)),r=a*l*1e3,e=e.substring(e.indexOf(n+1)),-1!=e.indexOf("T")&&(a=parseAlarmTime(e),a&&(n=a.substring(a.length-1),a=a.substring(0,a.length-1),r+=a)),r+n}function parseAlarmTime(e){var a="",n="",l=0,r=0;for(e=e.substring(e.indexOf("T")+1);""!=e;)-1!=e.indexOf("H")?(n="H",l=3600):-1!=e.indexOf("M")?(n="M",l=60):-1!=e.indexOf("S")&&(n="S",l=1),a=e.substring(0,e.indexOf(n)),e=e.substring(e.indexOf(n)+1),r+=a*l;return""!=n&&1e3*r+n}function getDateFromDay(e,a,n,l){var r=e.startMonth-1,t=e.startDay,s=e.startCount,d=e.dtStart.parseComnpactISO8601(l).getHours(),c=e.dtStart.parseComnpactISO8601().getMinutes();7==t&&(t=0);var p=new Date(a.getFullYear(),r,1,23,59,0);n&&p.setFullYear(p.getFullYear()-1);var i=p.getDay();if(i!=t){var o=(1+t-i)%7;o<=0?p.setDate(o+7):p.setDate(o)}if(s>0)var v=7*(parseInt(s)-1),u=new Date(p.getFullYear(),p.getMonth(),p.getDate()+v,d,c);else{var m=21+p.getDate(),g=new Date(a.getFullYear(),r,m+7,23,59,0);if(g.getMonth()!=r)var _=m;else _=m+7;v=7*(s+1),u=new Date(p.getFullYear(),p.getMonth(),_+v,d,c)}return u>a&&!n&&(u=getDateFromDay(e,a,!0).startDate),{offsetFrom:e.tzOffsetFROM,offsetTo:e.tzOffsetTO,startDate:u}}function vcalendarToData(e,a,n){var l=a.vcalendar,r=new Array,t=l.match(vCalendar.pre.contentline_CALSCALE);if(null!=t&&(calscale=t[0].match(vCalendar.pre.contentline_parse)[4],"GREGORIAN"!=calscale))return console.log("Error:'"+a.uid+"': Unsupported calscale in:"+l),!1;var s=l.match(vCalendar.pre.contentline_VERSION);if(null!=s){var d=s[0].match(vCalendar.pre.contentline_parse)[4];if("2.0"!=d)return console.log("Error:'"+a.uid+"': Unsupported version ("+d+") in:"+l),!1}var c=l.indexOf("BEGIN:VTIMEZONE"),p=l.lastIndexOf("END:VTIMEZONE"),i=0,o=a.uid.substring(0,a.uid.lastIndexOf("/")+1),v=a.uid.substring(a.uid.lastIndexOf("/")+1,a.uid.length),u=!1,m=!1;if(!n){var g=findEventInArray(a.uid,!0);if(""!=g&&g.etag!=a.etag){for(var _=0;_<g.alertTimeOut.length;_++)clearTimeout(g.alertTimeOut[_]);if(deleteEventFromArray(a.uid),""!=$("#show").val()&&$("#show").val()==a.uid)if("true"==$("#repeatEvent").val()||""!=$("#recurrenceID").val()){var f=globalCalEvent.title;showEventForm(null,null,{title:f,id:a.uid},globalJsEvent,"show","",!0),$("#editAll").css("visibility","hidden"),$("#editFuture").css("visibility","hidden"),$("#editOnlyOne").css("visibility","hidden"),$("#repeatConfirmBoxContent").html("<b>"+f+"</b> "+localization[globalInterfaceLanguage].repeatChangeTxt),$("#repeatConfirmBoxQuestion").html(localization[globalInterfaceLanguage].repeatChangeTxtClose)}else m=!0;u=!0}}if(-1!=c&&-1!=p){for(_=p+2;_<l.length;_++)if("\n"==l.charAt(_)){i=_+1;break}vTimeZone=l.substring(c,i),le=l.substring(0,c)+l.substring(i,l.length)}for(var C=new Array;null!=l.match(vCalendar.pre.vevent);){if("\r\n"==l.substring(l.indexOf("BEGIN:VEVENT")-2,l.indexOf("BEGIN:VEVENT"))){var T=l.substring(l.indexOf("BEGIN:VEVENT")-2,l.indexOf("END:VEVENT")+"END:VEVENT".length);l=l.replace(T,"")}else{T=l.substring(l.indexOf("BEGIN:VEVENT"),l.indexOf("END:VEVENT")+"END:VEVENT".length);l=l.replace(T,""),T+="\r\n"}var E=T.match(vCalendar.pre.contentline_RECURRENCE_ID),D=T.match(vCalendar.pre.contentline_UID);null!=D&&null!=E&&(C[C.length]=E[0].match(vCalendar.pre.contentline_parse)[4]+";"+D[0].match(vCalendar.pre.contentline_parse)[4]),r[r.length]=T}0==r.length&&console.log("Error: '"+a.uid+"': unable to parse vEvent");for(var M=0;M<r.length;M++){var A="",O="",R="",b="",S="",I=!1,y="",N="",V="",x="",w="",L=!1,U=!1,Z=new Array,Y=new Array,k=new Array,F="",H=0,B="local",P="",z="",G="",W="",X="",K="",J="",Q=!0,j="",q="0",ee="",ae=new Array,ne="",le=(new Array,r[M]);j=le.match(vCalendar.pre.contentline_UID);null!=j&&(j=j[0].match(vCalendar.pre.contentline_parse)[4]);for(var re=new Array,te=null,se=new Array,de=le+"";null!=de.match(vCalendar.pre.contentline_EXDATE);)te=de.match(vCalendar.pre.contentline_EXDATE),se[se.length]=te[0],de=de.replace(te,"\r\n");if(vcalendar_element=le.match(vCalendar.pre.contentline_RRULE2),null!=vcalendar_element){parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),ae=parsed[4].split(";");ae.length>0&&(U=!0);for(_=0;_<ae.length;_++)if(-1!=ae[_].indexOf("FREQ="))y=ae[_].split("=")[1];else if(-1!=ae[_].indexOf("INTERVAL="))N=ae[_].split("=")[1];else if(-1!=ae[_].indexOf("COUNT=")){if(w=ae[_].split("=")[1],0==w){Q=!1;break}if(isNaN(w)){Q=!1;break}}else-1!=ae[_].indexOf("UNTIL=")?(L=!0,w=ae[_].split("=")[1]):-1!=ae[_].indexOf("WKST=")?(W=ae[_].split("=")[1].replace(/\d*MO/,1).replace(/\d*TU/,2).replace(/\d*WE/,3).replace(/\d*TH/,4).replace(/\d*FR/,5).replace(/\d*SA/,6).replace(/\d*SU/,0),null!=globalSettings.mozillasupport.value&&globalSettings.mozillasupport.value&&(W="")):-1!=ae[_].indexOf("BYMONTHDAY=")?V=ae[_].split("=")[1]:-1!=ae[_].indexOf("BYDAY=")&&(x=ae[_].split("=")[1],x=x.replace(/\d*MO/,1).replace(/\d*TU/,2).replace(/\d*WE/,3).replace(/\d*TH/,4).replace(/\d*FR/,5).replace(/\d*SA/,6).replace(/\d*SU/,0).split(","));if(!Q)continue;N||(N=1)}if(vcalendar_element=le.match(vCalendar.pre.contentline_DTSTART),null==vcalendar_element)return!1;parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),O=parsed[4];var ce=O;-1==ce.indexOf("T")?(ce=ce.substring(0,4)+"-"+ce.substring(4,6)+"-"+ce.substring(6,8),I=!0):(ce=ce.substring(0,4)+"-"+ce.substring(4,6)+"-"+ce.substring(6,8)+"T"+ce.substring(9,11)+":"+ce.substring(11,13)+":"+ce.substring(13,15),I=!1);var pe=$.fullCalendar.parseDate(ce);if(null==pe)return!1;if("Invalid Date"==pe.toString())return!1;if(I)B=globalSessionTimeZone;else{for(parsed_value=vcalendarSplitParam(parsed[3]),h=1;h<parsed_value.length;h++)""!=parsed_value[h]&&(ne=parsed_value[h]);if(ne=ne.split("="),"Z"==O.charAt(O.length-1)&&(B="UTC"),ne.length>1||"UTC"==B){"UTC"!=B&&(B=$.trim(ne[1]));var ie=checkTimezone(B);null!=ie&&(B=ie),globalSettings.timezonesupport.value&&B in timezones&&(F=getOffsetByTZ(B,pe),H=-1*getLocalOffset(pe)*1e3-1e3*F.getSecondsFromOffset())}else-1==processedTimezones.indexOf(B)&&(-1==timeZonesEnabled.indexOf(B)&&timeZonesEnabled.push("local"),processedTimezones.push("local"));""!=B&&"local"!=B&&-1==processedTimezones.indexOf(B)&&(-1==timeZonesEnabled.indexOf(B)&&timeZonesEnabled.push(B),processedTimezones.push(B))}if(P=$.fullCalendar.parseDate(ce),a.start=$.fullCalendar.parseDate(ce),O=$.fullCalendar.parseDate(ce),H&&(a.start.setTime(a.start.getTime()+H),O.setTime(O.getTime()+H)),null!=se)for(var oe=0;oe<se.length;oe++){var ve=(se[oe]+"\r\n").match(vCalendar.pre.contentline_parse)[4];if(-1!=ve.indexOf("T")&&-1!=ve.indexOf("Z"))var ue=ve.parseComnpactISO8601().setSeconds(-1*getLocalOffset(ve.parseComnpactISO8601()));else if(-1!=ve.indexOf("T")&&-1==ve.indexOf("Z"))ue=ve.parseComnpactISO8601();else{-1!=ce.indexOf("T")&&(ve+="T"+$.fullCalendar.formatDate(O,"HHmmss"));ue=ve.parseComnpactISO8601()}re[re.length]=new Date(ue).toString()}var me=le.match(vCalendar.pre.valarm);if(null!=me){le=le.replace(me[0],"");var ge="",_e=new Array;for(_=0;_<me[0].length;_++)"END:VALARM"==me[0].substring(_-"END:VALARM".length,_)&&(_e[_e.length]=ge+"\r\n",ge=""),ge+=me[0][_];for(oe=0;oe<_e.length;oe++)if(checkA=_e[oe].match(vCalendar.re.valarm),null!=checkA){if(action=_e[oe].match(vCalendar.pre.contentline_ACTION),null==action)break;if(parsed=action[0].match(vCalendar.pre.contentline_parse),trigger=_e[oe].match(vCalendar.pre.contentline_TRIGGER),null==trigger)break;if(parsed=(trigger[0]+"\r\n").match(vCalendar.pre.contentline_parse),null!=parsed){Le=parsed[4];var fe=Le.match(vCalendar.pre["date-time-value"]),Ce="",Te="";if(null!=fe){if(parsed[3])var Ee=parsed[3].split("=");var De=$.fullCalendar.parseDate(Le.substring(0,4)+"-"+Le.substring(4,6)+"-"+Le.substring(6,8)+"T"+Le.substring(9,11)+":"+Le.substring(11,13)+":"+Le.substring(13,15));if("Z"==Le.charAt(Le.length-1)&&(Te="UTC"),Ee.length>1||"UTC"==Te){"UTC"!=Te&&";TZID"==Ee[0]&&(Te=$.trim(Ee[1]));ie=checkTimezone(Te);if(null!=ie&&(Te=ie),globalSettings.timezonesupport.value&&Te in timezones){var he=getOffsetByTZ(Te,De);Ce=1e3*getOffsetByTZ(B,De).getSecondsFromOffset()-1e3*he.getSecondsFromOffset()}}else-1==processedTimezones.indexOf(B)&&(-1==timeZonesEnabled.indexOf(B)&&timeZonesEnabled.push("local"),processedTimezones.push("local"));""!=Te&&"local"!=Te&&-1==processedTimezones.indexOf(Te)&&(-1==timeZonesEnabled.indexOf(Te)&&timeZonesEnabled.push(Te),processedTimezones.push(Te)),""!=Ce&&De.setTime(De.getTime()+Ce),Z[oe]=$.fullCalendar.formatDate(De,"yyyy-MM-dd'T'HH:mm:ss")}else Z[oe]=0,-1!=Le.indexOf("W")?Z[oe]=parseAlarmWeek(Le):-1!=Le.indexOf("D")?Z[oe]=parseAlarmDay(Le):-1!=Le.indexOf("T")&&(Z[oe]=parseAlarmTime(Le)),"-"==parsed[4].charAt(0)?Z[oe]="-"+Z[oe]:Z[oe]="+"+Z[oe]}noteA=_e[oe].match(vCalendar.pre.contentline_NOTE),null!=noteA?(parsed=noteA[0].match(vCalendar.pre.contentline_parse),Y[oe]=parsed[4]):Y[oe]="Default note"}}vcalendar_element=le.match(vCalendar.pre.contentline_LOCATION),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),S=vcalendarUnescapeValue(parsed[4])),vcalendar_element=le.match(vCalendar.pre.contentline_NOTE),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),A=vcalendarUnescapeValue(parsed[4])),vcalendar_element=le.match(vCalendar.pre.contentline_SUMMARY),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),b=vcalendarUnescapeValue(parsed[4])),vcalendar_element=le.match(vCalendar.pre.contentline_PRIORITY),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),q=vcalendarUnescapeValue(parsed[4]));for(var Me=0,Ae=0;Ae<globalResourceCalDAVList.collections.length;Ae++)if(void 0!==globalResourceCalDAVList.collections[Ae].uid&&globalResourceCalDAVList.collections[Ae].uid==e.uid){Me=Ae;break}var Oe=Me.pad(String(globalResourceCalDAVList.collections.length).length),Re=(Oe+b).toLowerCase();if(vcalendar_element=le.match(vCalendar.pre.contentline_CLASS),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),X=vcalendarUnescapeValue(parsed[4])),vcalendar_element=le.match(vCalendar.pre.contentline_STATUS),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),ee=vcalendarUnescapeValue(parsed[4])),vcalendar_element=le.match(vCalendar.pre.contentline_TRANSP),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),K=vcalendarUnescapeValue(parsed[4])),vcalendar_element=le.match(vCalendar.pre.contentline_URL),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),J=vcalendarUnescapeValue(parsed[4])),vcalendar_element=le.match(vCalendar.pre.contentline_RECURRENCE_ID),null!=vcalendar_element){parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse);var be=parsed[4];G=be}var Se=!1,Ie=0;if(vcalendar_element=le.match(vCalendar.pre.contentline_DTEND),null!=vcalendar_element){parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),R=parsed[4];var ye=R;if(-1==ye.indexOf("T")){ye=ye.substring(0,4)+"-"+ye.substring(4,6)+"-"+ye.substring(6,8);var Ne=$.fullCalendar.parseDate(ye),Ve=new Date(Ne.getTime());-1==ce.indexOf("T")&&Ve.setDate(Ve.getDate()-1),ye=$.fullCalendar.formatDate(Ve,"yyyy-MM-dd"),I=!0,-1!=ce.indexOf("T")&&(I=!1,ye+="T00:00:00","UTC"==B&&(ye+="Z"))}else ye=ye.substring(0,4)+"-"+ye.substring(4,6)+"-"+ye.substring(6,8)+"T"+ye.substring(9,11)+":"+ye.substring(11,13)+":"+ye.substring(13,15),I=!1}else{var xe=le.match(vCalendar.pre["dur-value"]);if(null!=xe){var we=(xe[0]+"\r\n").match(vCalendar.pre.contentline_parse);if(null!=we){var Le=we[4],$e=0;-1!=Le.indexOf("W")?$e=parseAlarmWeek(Le):-1!=Le.indexOf("D")?$e=parseAlarmDay(Le):-1!=Le.indexOf("T")&&($e=parseAlarmTime(Le)),$e="-"==parsed[4].charAt(0)?"-"+$e:"+"+$e,Ie=parseInt($e.substring(1,$e.length-1),10),Se=!0}}}if(Se){var Ue="";I?(Ue=$.fullCalendar.parseDate(ce+"T00:00:00"),Ue.setMilliseconds(-1)):Ue=$.fullCalendar.parseDate(ce);var Ze=new Date(Ue.getTime()+Ie);ye=$.fullCalendar.formatDate(Ze,"yyyy-MM-dd'T'HH:mm:ss")}void 0!==ye&&""!=ye&&null!=ye||(ye=ce);var Ye=$.fullCalendar.parseDate(ye);if(null==Ye)return!1;if("Invalid Date"==Ye.toString())return!1;if(I)B=globalSessionTimeZone;else{if("Z"==R.charAt(R.length-1)&&(B="UTC"),ne.length>1||"UTC"==B){"UTC"!=B&&(B=$.trim(ne[1]));ie=checkTimezone(B);null!=ie&&(B=ie),globalSettings.timezonesupport.value&&B in timezones&&(F=getOffsetByTZ(B,Ye),H=-1*getLocalOffset(Ye)*1e3-1e3*F.getSecondsFromOffset())}else-1==processedTimezones.indexOf(B)&&(-1==timeZonesEnabled.indexOf(B)&&timeZonesEnabled.push("local"),processedTimezones.push("local"));""!=B&&"local"!=B&&-1==processedTimezones.indexOf(B)&&(-1==timeZonesEnabled.indexOf(B)&&timeZonesEnabled.push(B),processedTimezones.push(B))}if(z=$.fullCalendar.parseDate(ye),a.end=$.fullCalendar.parseDate(ye),R=$.fullCalendar.parseDate(ye),H&&(a.end.setTime(a.end.getTime()+H),R.setTime(R.getTime()+H)),-1!=globalVisibleCalDAVCollections.indexOf(o)||u||n)if(U){var ke=new Date(globalToLoadedLimit.getTime());ke.setDate(ke.getDate()+14);var Fe=le.match(vCalendar.pre.contentline_RRULE2)[0].match(vCalendar.pre.contentline_parse)[4];if(a.isRepeat=!0,P)var He=new Date(P.getTime());else He=new Date(O.getTime());if(z)var Be=new Date(z.getTime());else Be=new Date(R.getTime());var Pe=new Date(He.getTime()),ze=new Date(Be.getTime()),Ge="",We="",Xe="";if(""!==w){if(L){if(-1!=w.indexOf("T")){var Ke=w.substring(0,4)+"-"+w.substring(4,6)+"-"+w.substring(6,8)+"T"+w.substring(9,11)+":"+w.substring(11,13)+":"+w.substring(13,15),Je=$.fullCalendar.parseDate(Ke);if(null==Je)return!1;if("Invalid Date"==Je.toString())return!1;if(!I&&(globalSettings.timezonesupport.value&&B in timezones&&(F=getOffsetByTZ(B,Je)),F)){H=1e3*F.getSecondsFromOffset();Je.setTime(Je.getTime()+H)}Ge=new Date(Je.getTime())}else Ge=$.fullCalendar.parseDate(w.substring(0,4)+"-"+w.substring(4,6)+"-"+w.substring(6,8)),Ge.setHours(P.getHours()),Ge.setMinutes(P.getMinutes()),Ge.setSeconds(P.getSeconds());Xe=""}else Ge="",Xe=w;We=Ge,a.untilDate=Ge}else Ge=new Date(ke.getTime()),We="",a.untilDate="never";var Qe=0,je=0;if(!a.isDrawn){if(Z.length>0){new Date;e.ignoreAlarms||(k=setAlertTimeouts(!1,Z,O,R,{allDay:I,title:b},!0,a.uid))}je++;var qe=isInRecurrenceArray(He,j,C,B);if(re.length>0&&-1!=re.indexOf(He.toString())&&(qe=!0),!qe){Qe++;var ea=new items(a.etag,O,R,b,I,a.uid,o,v,A,a.displayValue,Z,Y,We,y,N,Xe,Pe,ze,V,Qe,je,le,S,k,B,P,z,x,G,W,X,K,J,Re,q,ee,Fe);globalEventList.displayEventsArray[o].splice(globalEventList.displayEventsArray[o].length,0,ea)}}generateRepeatInstances({untilDate:We,repeatStart:He,futureRLimit:ke,stringUID:j,recurrence_id_array:C,exDates:re,alertTime:Z,ignoreAlarms:e.ignoreAlarms,items:new items(a.etag,He,Be,b,I,a.uid,o,v,A,a.displayValue,Z,Y,We,y,N,Xe,Pe,ze,V,Qe,je,le,S,k,B,P,z,x,G,W,X,K,J,Re,q,ee,Fe)})}else{e.ignoreAlarms||(k=setAlertTimeouts(!1,Z,O,R,{allDay:I,title:b},!0,a.uid));ea=new items(a.etag,O,R,b,I,a.uid,o,v,A,a.displayValue,Z,Y,"","","","","","","","","",le,S,k,B,P,z,x,G,W,X,K,J,Re,q,ee,Fe);u&&m&&showEventForm(null,null,ea,globalJsEvent,"show",""),globalEventList.displayEventsArray[o].splice(globalEventList.displayEventsArray[o].length,0,ea)}}a.isDrawn=!0}function notRFCDataToRFCData(e){return null==e.match(RegExp("\r","m"))&&(e=e.replace(RegExp("\n","gm"),"\r\n")),e=e.replace(RegExp("(\r\n)+","gm"),"\r\n"),e=e.replace(RegExp("\r\n"+vCalendar.re.WSP,"gm"),""),"\n"!=e[e.length-1]&&(e+="\r\n"),e}function vCalendarCleanup(e){return e=notRFCDataToRFCData(e),e}String.prototype.parseComnpactISO8601=function(e){if(this.length>=15)var a=this.substring(0,4)+"/"+this.substring(4,6)+"/"+this.substring(6,8)+" "+this.substring(9,11)+":"+this.substring(11,13)+":"+this.substring(13,15);else a=this.substring(0,4)+"/"+this.substring(4,6)+"/"+this.substring(6,8)+" 00:00:00";var n=Date.parse(a);return!isNaN(n)&&new Date(n)},String.prototype.getSecondsFromOffset=function(){if(this.length>=5){var e=this.substring(1,3),a=this.substring(3,5),n="00";this.length>=7&&(n=this.substring(5,7));var l=60*parseInt(e,10)*60+60*parseInt(a,10)+parseInt(n,10);return"-"==this.charAt(0)&&(l*=-1),isNaN(l)?0:l}return 0},Array.prototype.indexElementOf=function(e){for(var a=0;a<this.length;a++)if(-1!=this[a].indexOf(e))return a;return-1};