function netVersionCheck(){$.ajax({type:"GET",url:globalVersionCheckURL,cache:!1,crossDomain:!1,timeout:3e4,beforeSend:function(e){e.setRequestHeader("X-client",globalXClientHeader)},contentType:"text/xml; charset=utf-8",processData:!0,data:"",dataType:"xml",error:function(e,l){return console.log("Error: [netVersionCheck: 'GET "+globalVersionCheckURL+"'] code: '"+e.status+"' status: '"+l+"'"),!1},success:function(e,l,t){var a=$(t.responseXML).find("updates").find(globalAppName.toLowerCase()),o=a.attr("type"),r=a.attr("homeURL"),n=a.attr("version"),s="undefined"==typeof globalEnableDevelBuilds||1!=globalEnableDevelBuilds?a.attr("build_no"):a.attr("dev_build_no");if(void 0==o||""==o||void 0==r||""==r||void 0==n||""==n||void 0==s||""==s)return!1;var i=s.match(RegExp("^([0-9]+)$"));if(null==i)return!1;if(globalBuildNo<parseInt(i[1])){var d=!1;if(0==globalNewVersionNotifyUsers.length)d=!0;else for(var c=0;c<globalAccountSettings.length;c++)if(globalNewVersionNotifyUsers.indexOf(globalAccountSettings[c].userAuth.userName)!=-1){d=!0;break}1==d&&($("div.update_h").html(localization[globalInterfaceLanguage].updateNotification.replace("%name%",globalAppName).replace("%new_ver%",'<span id="newversion" class="update_h"></span>').replace("%curr_ver%",'<span id="version" class="update_h"></span>').replace("%url%",'<span id="homeurl" class="update_h" onclick=""></span>')),$("div.update_h").find("span#version").text(globalVersion),$("div.update_h").find("span#newversion").text(n),$("div.update_h").find("span#homeurl").attr("onclick","window.open('"+r+"')"),$("div.update_h").find("span#homeurl").text(r),setTimeout(function(){var e=$("div.update_d").width();$("div.update_d").css("width","0px"),$("div.update_d").css("display",""),$("div.update_d").animate({width:"+="+e+"px"},500)},5e3))}}})}function netCheckAndCreateConfiguration(e){$.ajax({type:"PROPFIND",url:e.href,cache:!1,crossDomain:"undefined"==typeof e.crossDomain||e.crossDomain,xhrFields:{withCredentials:"undefined"!=typeof e.withCredentials&&e.withCredentials},timeout:e.timeOut,beforeSend:function(e){1!=globalSettings.usejqueryauth.value&&""!=globalLoginUsername&&""!=globalLoginPassword&&e.setRequestHeader("Authorization",basicAuth(globalLoginUsername,globalLoginPassword)),e.setRequestHeader("X-client",globalXClientHeader),e.setRequestHeader("Depth","0")},username:1==globalSettings.usejqueryauth.value?globalLoginUsername:null,password:1==globalSettings.usejqueryauth.value?globalLoginPassword:null,contentType:"text/xml; charset=utf-8",processData:!0,data:'<?xml version="1.0" encoding="utf-8"?><D:propfind xmlns:D="DAV:"><D:prop><D:current-user-principal/></D:prop></D:propfind>',dataType:"xml",error:function(l,t){return console.log("Error: [netCheckAndCreateConfiguration: 'PROPFIND "+e.href+"'] code: '"+l.status+"' status: '"+t+"'"+(0==l.status?" - see https://www.inf-it.com/"+globalAppName.toLowerCase()+"/readme.txt (cross-domain setup)":"")),$("#LoginLoader").fadeOut(1200),!1},success:function(l,t,a){var o=0;if($(a.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response").children().filterNsNode("propstat").children().filterNsNode("status").text().match(RegExp("200 OK$"))&&("undefined"==typeof globalAccountSettings&&(globalAccountSettings=[]),globalAccountSettings[globalAccountSettings.length]=$.extend({},e),globalAccountSettings[globalAccountSettings.length-1].type="network","function"==typeof globalAccountSettingsHook?globalAccountSettings[globalAccountSettings.length-1].href=globalAccountSettingsHook(e.href,globalLoginUsername):globalAccountSettings[globalAccountSettings.length-1].href=e.href+globalLoginUsername+"/",globalAccountSettings[globalAccountSettings.length-1].userAuth={userName:globalLoginUsername,userPassword:globalLoginPassword},o++,void 0!=e.additionalResources&&e.additionalResources.length>0))for(var r=0;r<e.additionalResources.length;r++)globalLoginUsername!=e.additionalResources[r]&&(globalAccountSettings[globalAccountSettings.length]=$.extend({},e),globalAccountSettings[globalAccountSettings.length-1].type="network",globalAccountSettings[globalAccountSettings.length-1].href=e.href+e.additionalResources[r]+"/",globalAccountSettings[globalAccountSettings.length-1].userAuth={userName:globalLoginUsername,userPassword:globalLoginPassword},o++);o?globalAccountSettings[0].delegation?DAVresourceDelegation(globalAccountSettings[0],0,0):(isAvaible("CardDavMATE")&&runCardDAV(),isAvaible("CalDavZAP")&&runCalDAV(),isAvaible("Projects")&&runProjects(),isAvaible("Settings")&&runSettings(),globalResourceNumber=globalAccountSettings.length,loadAllResources()):$("#LoginLoader").fadeOut(1200)}})}function netLoadConfiguration(e){$.ajax({type:"GET",url:e.href+"?browser_date="+$.datepicker.formatDate("yyyy-MM-dd",new Date)+(1==ignoreServerSettings?"&ignore_settings=1":""),cache:!1,crossDomain:"undefined"==typeof e.crossDomain||e.crossDomain,xhrFields:{withCredentials:"undefined"!=typeof e.withCredentials&&e.withCredentials},timeout:e.timeOut,beforeSend:function(e){1!=globalSettings.usejqueryauth.value&&""!=globalLoginUsername&&""!=globalLoginPassword&&e.setRequestHeader("Authorization",basicAuth(globalLoginUsername,globalLoginPassword)),e.setRequestHeader("X-client",globalXClientHeader)},username:1==globalSettings.usejqueryauth.value?globalLoginUsername:null,password:1==globalSettings.usejqueryauth.value?globalLoginPassword:null,contentType:"text/xml; charset=utf-8",processData:!0,data:"",dataType:"xml",error:function(l,t){return console.log("Error: [loadConfiguration: 'GET "+e.href+"'] code: '"+l.status+"' status: '"+t+"'"+(0==l.status?" - see https://www.inf-it.com/"+globalAppName.toLowerCase()+"/readme.txt (cross-domain setup)":"")),$("#LoginLoader").fadeOut(1200),!1},success:function(e,l,t){"undefined"==typeof globalAccountSettings&&(globalAccountSettings=[]);var a=0,o=new RegExp("^re(\\|[^:]*|):(.+)$");if($(t.responseXML).children("resources").children("resource").each(function(e,l){if(1==$(l).children().filterNsNode("type").children().filterNsNode("addressbook").length||1==$(l).children().filterNsNode("type").children().filterNsNode("calendar").length){var t=$(l).children("href").text(),r=$(l).children("hreflabel").text(),n=""!=r&&"null"!=r?r:null,s=$(l).children("userauth").children("username").text(),i=$(l).children("userauth").children("password").text(),d=$(l).children("timeout").text(),c=$(l).children("locktimeout").text(),u=new Array;1==$(l).children().filterNsNode("type").children().filterNsNode("addressbook").length&&(u[u.length]="addressbook"),1==$(l).children().filterNsNode("type").children().filterNsNode("calendar").length&&(u[u.length]="calendar");var r=$(l).children("withcredentials").text(),g="true"==r||"yes"==r||"1"==r,r=$(l).children("crossdomain").text(),p="false"!=r&&"no"!=r&&"0"!=r,r=$(l).find("settingsaccount").text(),b="true"==r||"yes"==r||"1"==r,r=$(l).find("checkcontenttype").text(),v="false"!=r&&"no"!=r&&"0"!=r,r=$(l).find("ignorebound").text(),f="true"==r||"yes"==r||"1"==r,h=null,r=$(l).children("forcereadonly");if("true"==r.text())var h=!0;else{var m=[];if(r.children("collection").each(function(e,l){null!=(matched=$(l).text().match(o))&&3==matched.length?m[m.length]=new RegExp(matched[2],matched[1].substring(matched[1].length>0?1:0)):m[m.length]=$(l).text()}),m.length>0)var h=m}var A=!1,r=$(l).children("delegation");if("true"==r.text())var A=!0;else{var C=[];if(r.children("resource").each(function(e,l){null!=(matched=$(l).text().match(o))&&3==matched.length?C[C.length]=new RegExp(matched[2],matched[1].substring(matched[1].length>0?1:0)):C[C.length]=$(l).text()}),C.length>0)var A=C}var y=!1,r=$(l).children("extendeddelegation");"true"==r.text()&&(y=!0);var D=!1,r=$(l).children("ignorealarms");if("true"==r.text())var D=!0;else{var L=[];if(r.children("collection").each(function(e,l){null!=(matched=$(l).text().match(o))&&3==matched.length?L[L.length]=new RegExp(matched[2],matched[1].substring(matched[1].length>0?1:0)):L[L.length]=$(l).text()}),L.length>0)var D=L}var S=[],r=$(l).children("backgroundcalendars");""!=r.text()&&r.children("collection").each(function(e,l){null!=(matched=$(l).text().match(o))&&3==matched.length?S[S.length]=new RegExp(matched[2],matched[1].substring(matched[1].length>0?1:0)):S[S.length]=$(l).text()}),globalAccountSettings[globalAccountSettings.length]={type:"network",href:t,hrefLabel:n,crossDomain:p,settingsAccount:b,checkContentType:v,forceReadOnly:h,withCredentials:g,userAuth:{userName:s,userPassword:i},timeOut:d,lockTimeOut:c,delegation:A,extendedDelegation:y,ignoreAlarms:D,backgroundCalendars:S,collectionTypes:u,ignoreBound:f},a++}}),a){var r=$(t.responseXML).children("resources").children("cache_data");r.length&&(globalXMLCache=r),globalAccountSettings[0].delegation?DAVresourceDelegation(globalAccountSettings[0],0,0):(isAvaible("CardDavMATE")&&runCardDAV(),isAvaible("CalDavZAP")&&runCalDAV(),isAvaible("Projects")&&runProjects(),isAvaible("Settings")&&runSettings(),globalResourceNumber=globalAccountSettings.length,loadAllResources())}else $("#LoginLoader").fadeOut(1200)}})}function netSaveProperty(e,l,t,a){var o='<?xml version="1.0" encoding="utf-8"?><D:propertyupdate xmlns:D="DAV:"><D:set><D:prop><I:'+t+' xmlns:I="'+l+'">'+a+"</I:"+t+"></D:prop></D:set></D:propertyupdate>";$.ajax({type:"PROPPATCH",url:e.url+e.href,cache:!1,crossDomain:"undefined"==typeof e.crossDomain||e.crossDomain,xhrFields:{withCredentials:"undefined"!=typeof e.withCredentials&&e.withCredentials},timeout:e.timeOut,beforeSend:function(l){1!=globalSettings.usejqueryauth.value&&""!=e.userAuth.userName&&""!=e.userAuth.userPassword&&l.setRequestHeader("Authorization",basicAuth(e.userAuth.userName,e.userAuth.userPassword)),l.setRequestHeader("X-client",globalXClientHeader),l.setRequestHeader("Depth","0")},username:1==globalSettings.usejqueryauth.value?e.userAuth.userName:null,password:1==globalSettings.usejqueryauth.value?e.userAuth.userPassword:null,contentType:"text/xml",processData:!0,data:o,dataType:"xml",error:function(l,a){return console.log("Error: [netSaveProperty: 'PROPPATCH "+e.url+e.href+"'] code: '"+l.status+"' status: '"+a+"'"+(0==l.status?" (this error code usually means network connection error, or your browser is trying to make a cross domain query, but it is not allowed by the destination server or the browser itself)":"")),"calendar-color"==t?"vevent"==e.listType?($("#ResourceCalDAVList").find('[data-id="'+e.uid+'"]').find(".resourceCalDAVColor").css("background",e.ecolor),$("#ResourceCalDAVList").find('[data-id="'+e.uid+'"]').find(".colorPicker").spectrum("set",e.ecolor)):($("#ResourceCalDAVTODOList").find('[data-id="'+e.uid+'"]').find(".resourceCalDAVColor").css("background",e.ecolor),$("#ResourceCalDAVTODOList").find('[data-id="'+e.uid+'"]').find(".colorPicker").spectrum("set",e.ecolor)):"addressbook-color"==t&&($("#ResourceCardDAVList").find('[data-id="'+e.uid+'"]').find(".resourceCardDAVColor").css("background",e.color),$("#ResourceCardDAVList").find('[data-id="'+e.uid+'"]').find(".colorPicker").spectrum("set",e.color)),!1},success:function(l,a,o){var r;if("calendar-color"==t){var n=null;"vevent"==e.listType?(r=$("#ResourceCalDAVList").find('[data-id="'+e.uid+'"]').find(".colorPicker").spectrum("get").toHexString(),null!=e.fcSource&&(e.fcSource.backgroundColor=hexToRgba(r,.9),e.fcSource.borderColor=r,e.fcSource.textColor=checkFontColor(r)),n=globalResourceCalDAVList.getTodoCollectionByUID(e.uid),null!=n&&($("#ResourceCalDAVTODOList").find('[data-id="'+e.uid+'"]').find(".resourceCalDAVColor").css("background",r),$("#ResourceCalDAVTODOList").find('[data-id="'+e.uid+'"]').find(".colorPicker").spectrum("set",r),null!=n.fcSource&&(n.fcSource.backgroundColor=hexToRgba(r,.9),n.fcSource.borderColor=r))):(r=$("#ResourceCalDAVTODOList").find('[data-id="'+e.uid+'"]').find(".colorPicker").spectrum("get").toHexString(),null!=e.fcSource&&(e.fcSource.backgroundColor=hexToRgba(r,.9),e.fcSource.borderColor=r),n=globalResourceCalDAVList.getEventCollectionByUID(e.uid),null!=n&&($("#ResourceCalDAVList").find('[data-id="'+e.uid+'"]').find(".resourceCalDAVColor").css("background",r),$("#ResourceCalDAVList").find('[data-id="'+e.uid+'"]').find(".colorPicker").spectrum("set",r),null!=n.fcSource&&(n.fcSource.backgroundColor=hexToRgba(r,.9),n.fcSource.borderColor=r,n.fcSource.textColor=checkFontColor(r)))),e.ecolor=r,null!=n&&(n.ecolor=r),"vevent"!=e.listType&&null==n||$("#calendar").fullCalendar("refetchEvents"),"vtodo"!=e.listType&&null==n||$("#todoList").fullCalendar("refetchEvents")}else if("addressbook-color"==t){r=$("#ResourceCardDAVList").find('[data-id="'+e.uid+'"]').find(".colorPicker").spectrum("get").toHexString(),e.color=r,$("#ResourceCardDAVList").find('[data-id="'+e.uid+'"]').parent().find(".contact_group").find("div[data-id]").length>0&&$("#ResourceCardDAVList").find('[data-id="'+e.uid+'"]').parent().find(".contact_group").find("div[data-id]").find(".resourceCardDAVGroupColor").css("background",r),globalAddressbookList.applyABFilter(dataGetChecked("#ResourceCardDAVList"),!1);var s=$("#vCardEditor").find('[data-attr-name="_DEST_"]').find("option:selected").attr("data-type"),i=globalResourceCardDAVList.getCollectionByUID(s);$("#ABContactColor").css("background-color",i.color)}}})}function DAVresourceDelegation(e,l,t){function a(a,o,s){"undefined"==typeof globalAccountSettings&&(globalAccountSettings=[]);var i=r[1]+r[2],d=$(s.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response").children().filterNsNode("propstat").children().filterNsNode("prop"),c=new Array;c[c.length]=$(d).children().filterNsNode("calendar-proxy-read-for"),c[c.length]=$(d).children().filterNsNode("calendar-proxy-write-for");for(var u=0;u<c.length;u++)c[u].children().filterNsNode("response").each(function(l,t){for(var a=$(t).children().filterNsNode("href").text(),o=!1,r=0;r<globalAccountSettings.length;r++)decodeURIComponent(globalAccountSettings[r].href)==i+a&&(o=!0);if(o||(globalAccountSettings[globalAccountSettings.length]=$.extend({},e),globalAccountSettings[globalAccountSettings.length-1].type=e.type,globalAccountSettings[globalAccountSettings.length-1].href=decodeURIComponent(i+a),globalAccountSettings[globalAccountSettings.length-1].userAuth={userName:e.userAuth.userName,userPassword:e.userAuth.userPassword}),"undefined"!=typeof e.extendedDelegation&&e.extendedDelegation){$(t).children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("calendar-user-address-set").children().each(function(e,l){var t=$(l).text();t.indexOf("mailto:")!=-1&&(globalAccountSettings[globalAccountSettings.length-1].principalEmail=t.split("mailto:")[1])});var s=$(t).children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("addressbook-home-set").children().filterNsNode("href").text();""==s&&(s=$(t).children().filterNsNode("href").text().replace("/principals/users/caldav.php","/caldav.php")),null!=s.match(RegExp("^https?://","i"))?globalAccountSettings[globalAccountSettings.length-1].abhref=s:globalAccountSettings[globalAccountSettings.length-1].abhref=n+s;var d=$(t).children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("calendar-home-set").children().filterNsNode("href").text();""==d&&(d=$(t).children().filterNsNode("href").text().replace("/principals/users/caldav.php","/caldav.php")),null!=d.match(RegExp("^https?://","i"))?globalAccountSettings[globalAccountSettings.length-1].cahref=d:globalAccountSettings[globalAccountSettings.length-1].cahref=n+d}});if("undefined"!=typeof e.extendedDelegation&&e.extendedDelegation&&!settingsLoaded&&e.href.indexOf(globalLoginUsername)!=-1&&e.settingsAccount&&(""==globalSettings.settingstype.value||null==globalSettings.settingstype.value||""!=globalSettings.settingstype.value&&null!=globalSettings.settingstype.value&&"principal-URL"==globalSettings.settingstype.value)){var g=$(s.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response").children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("settings").text();""!=g?ignoreServerSettings?(delete globalSettings.version.value,loadSettings(JSON.stringify(globalSettings),!1,!1),console.log("Ignoring server settings: \n"+g)):loadSettings(g,!0,!1):(delete globalSettings.version.value,loadSettings(JSON.stringify(globalSettings),!1,!1))}if("undefined"!=typeof e.extendedDelegation&&e.extendedDelegation){var p=$(s.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response");$(s.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response").children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("calendar-user-address-set").children().each(function(l,t){var a=$(t).text();a.indexOf("mailto:")!=-1&&(e.principalEmail=a.split("mailto:")[1])}),""==globalEmailAddress&&"undefined"!=typeof e.principalEmail&&(globalEmailAddress=e.principalEmail);var b=p.children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("addressbook-home-set").children().filterNsNode("href").text();""==b&&(b=p.children().filterNsNode("href").text().replace("/principals/users/caldav.php","/caldav.php")),null!=b.match(RegExp("^https?://","i"))?e.abhref=b:e.abhref=n+b;var v=p.children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("calendar-home-set").children().filterNsNode("href").text();""==v&&(v=p.children().filterNsNode("href").text().replace("/principals/users/caldav.php","/caldav.php")),null!=v.match(RegExp("^https?://","i"))?e.cahref=v:e.cahref=n+v}l==t&&(isAvaible("CardDavMATE")&&runCardDAV(),isAvaible("CalDavZAP")&&runCalDAV(),isAvaible("Projects")&&runProjects(),isAvaible("Settings")&&runSettings(),globalResourceNumber=globalAccountSettings.length,loadAllResources())}globalCalDAVResourceSync=!1;var o=new RegExp("^(https?://)([^/]+)(.*)","i"),r=e.href.match(o),n=r[1]+r[2],s=(r[1]+e.userAuth.userName+"@"+r[2],r[1]+e.userAuth.userName+"@"+r[2]+r[3]),i="",d="";"undefined"!=typeof e.extendedDelegation&&e.extendedDelegation?(e.href.indexOf(globalLoginUsername)!=-1&&e.settingsAccount&&(""==globalSettings.settingstype.value||null==globalSettings.settingstype.value||""!=globalSettings.settingstype.value&&null!=globalSettings.settingstype.value&&"principal-URL"==globalSettings.settingstype.value)&&(i='<D:property name="settings" namespace="http://inf-it.com/ns/dav/"/>'),d='<?xml version="1.0" encoding="utf-8"?><D:expand-property xmlns:D="DAV:"><D:property name="calendar-proxy-read-for" namespace="http://calendarserver.org/ns/"><D:property name="resourcetype"/><D:property name="current-user-privilege-set"/><D:property name="displayname"/><D:property name="calendar-user-address-set" namespace="urn:ietf:params:xml:ns:caldav"/><D:property name="calendar-home-set" namespace="urn:ietf:params:xml:ns:caldav"/><D:property name="addressbook-home-set" namespace="urn:ietf:params:xml:ns:carddav"/></D:property><D:property name="calendar-proxy-write-for" namespace="http://calendarserver.org/ns/"><D:property name="resourcetype"/><D:property name="current-user-privilege-set"/><D:property name="displayname"/><D:property name="calendar-user-address-set" namespace="urn:ietf:params:xml:ns:caldav"/><D:property name="calendar-home-set" namespace="urn:ietf:params:xml:ns:caldav"/><D:property name="addressbook-home-set" namespace="urn:ietf:params:xml:ns:carddav"/></D:property>'+i+'<D:property name="resourcetype"/><D:property name="current-user-privilege-set"/><D:property name="displayname"/><D:property name="calendar-user-address-set" namespace="urn:ietf:params:xml:ns:caldav"/><D:property name="calendar-home-set" namespace="urn:ietf:params:xml:ns:caldav"/><D:property name="addressbook-home-set" namespace="urn:ietf:params:xml:ns:carddav"/></D:expand-property>'):d='<?xml version="1.0" encoding="utf-8"?><A:expand-property xmlns:A="DAV:"><A:property name="calendar-proxy-read-for" namespace="http://calendarserver.org/ns/"><A:property name="email-address-set" namespace="http://calendarserver.org/ns/"/><A:property name="displayname" namespace="DAV:"/><A:property name="calendar-user-address-set" namespace="urn:ietf:params:xml:ns:caldav"/></A:property><A:property name="calendar-proxy-write-for" namespace="http://calendarserver.org/ns/"><A:property name="email-address-set" namespace="http://calendarserver.org/ns/"/><A:property name="displayname" namespace="DAV:"/><A:property name="calendar-user-address-set" namespace="urn:ietf:params:xml:ns:caldav"/></A:property></A:expand-property>';var c,u=e.href.match("^(.*/)([^/]+)/$");null!=globalXMLCache&&(c=globalXMLCache.children('davprincipaldelegation[request_url="'+jqueryEscapeSelector(u[1]+encodeURIComponent(u[2])+"/")+'"]').remove()).length?("undefined"!=typeof globalDebug&&globalDebug instanceof Array&&globalDebug.indexOf("cache")!=-1&&console.log("DBG Cache OK: "+arguments.callee.name+" url: '"+e.href+"': saved one request!"),a("","success",{responseXML:c})):("undefined"!=typeof globalDebug&&globalDebug instanceof Array&&globalDebug.indexOf("cache")!=-1&&console.log("DBG Cache ERROR: "+arguments.callee.name+" url: '"+e.href+"': spend one request!"),$.ajax({type:"REPORT",url:e.href,cache:!1,crossDomain:"undefined"==typeof e.crossDomain||e.crossDomain,xhrFields:{withCredentials:"undefined"!=typeof e.withCredentials&&e.withCredentials},timeout:e.timeOut,beforeSend:function(l){1!=globalSettings.usejqueryauth.value&&""!=e.userAuth.userName&&""!=e.userAuth.userPassword&&l.setRequestHeader("Authorization",basicAuth(e.userAuth.userName,e.userAuth.userPassword)),l.setRequestHeader("X-client",globalXClientHeader),l.setRequestHeader("Depth","0")},username:1==globalSettings.usejqueryauth.value?e.userAuth.userName:null,password:1==globalSettings.usejqueryauth.value?e.userAuth.userPassword:null,contentType:"text/xml",processData:!0,data:d,dataType:"xml",error:function(e,l){console.log("Error: [DAVresourceDelegation: 'REPORT "+s+"'] code: '"+e.status+"' status: '"+l+"'"+(0==e.status?" (this error code usually means network connection error, or your browser is trying to make a cross domain query, but it is not allowed by the destination server or the browser itself)":""))},success:a}))}function netFindResource(e,l,t,a,o){if(globalPreventLogoutSync)return logout(!0),!1;if(a<globalAccountSettings.length&&(globalResourceNumberCount++,(isAvaible("CardDavMATE")&&globalCardDAVInitLoad||isAvaible("CalDavZAP")&&globalCalDAVInitLoad||isAvaible("Projects")&&!isProjectsLoaded||isAvaible("Settings")&&!isSettingsLoaded)&&$("#MainLoaderInner").html(localization[globalInterfaceLanguage].loadingResources.replace("%act%",globalResourceNumberCount).replace("%total%",globalResourceNumber))),"undefined"!=typeof e&&"undefined"!=typeof e.collectionTypes&&null!=e.collectionTypes&&e.collectionTypes.indexOf("calendar")==-1&&e.collectionTypes.indexOf("addressbook")==-1||"undefined"!=typeof e&&"undefined"!=typeof o&&null!=o&&o.indexOf(e.href)==-1)return a++,netFindResource(globalAccountSettings[a],l,t,a,o),!1;if(a>=globalAccountSettings.length&&settingsLoaded){null==globalResourceIntervalID&&(globalResourceIntervalID=setInterval(reloadResources,globalSettings.syncresourcesinterval.value)),globalCalDAVResourceSync=!1,globalCardDAVResourceSync=!1,globalSyncSettingsSave=!1;var r=new RegExp("^(https?://)([^@/]+(?:@[^@/]+)?)@(.*)"),n=new RegExp("^(https?://)(.*)","i"),s=new RegExp("^(https?://)([^@/]+(?:@[^@/]+)?)@([^/]+)(.*/)","i");if(isAvaible("CalDavZAP")&&!isCalDAVLoaded||isAvaible("CardDavMATE")&&!isCardDAVLoaded){if(isAvaible("CalDavZAP")){if(!globalDefaultCalendarCollectionActiveAll){for(var i=0;i<globalSettings.activecalendarcollections.value.length;i++)if("undefined"!=typeof globalCrossServerSettingsURL&&null!=globalCrossServerSettingsURL&&globalCrossServerSettingsURL){var d=globalSettings.activecalendarcollections.value[i].match("^(.*/)([^/]+)/([^/]+)/$"),c=d[2]+"/"+d[3]+"/";if($('#ResourceCalDAVList input[data-id$="'+c+'"]:visible').length>0){var u=$('#ResourceCalDAVList input[data-id$="'+c+'"]');u.trigger("click"),globalVisibleCalDAVCollections.splice(globalVisibleCalDAVCollections.length,0,u.attr("data-id"))}}else{var g=globalSettings.activecalendarcollections.value[i].match(n)[1],p=globalSettings.activecalendarcollections.value[i].match(n)[2];if(""!=globalLoginUsername)var b=globalLoginUsername;else var b=globalAccountSettings[0].userAuth.userName;var v=g+b+"@"+p;$('#ResourceCalDAVList input[data-id="'+v+'"]:visible').length>0&&($('#ResourceCalDAVList input[data-id="'+v+'"]').trigger("click"),globalVisibleCalDAVCollections.splice(globalVisibleCalDAVCollections.length,0,v))}globalSettings.activecalendarcollections.value.length>0&&0==globalVisibleCalDAVCollections.length&&(globalDefaultCalendarCollectionActiveAll=!0)}if(globalDefaultCalendarCollectionActiveAll)for(var i=0;i<globalResourceCalDAVList.collections.length;i++)void 0!=globalResourceCalDAVList.collections[i].uid&&$('#ResourceCalDAVList input[data-id="'+globalResourceCalDAVList.collections[i].uid+'"]:visible').length>0&&($('#ResourceCalDAVList input[data-id="'+globalResourceCalDAVList.collections[i].uid+'"]').trigger("click"),globalVisibleCalDAVCollections.splice(globalVisibleCalDAVCollections.length,0,globalResourceCalDAVList.collections[i].uid));if(!globalDefaultTodoCalendarCollectionActiveAll){for(var i=0;i<globalSettings.activetodocollections.value.length;i++)if("undefined"!=typeof globalCrossServerSettingsURL&&null!=globalCrossServerSettingsURL&&globalCrossServerSettingsURL){var d=globalSettings.activetodocollections.value[i].match("^(.*/)([^/]+)/([^/]+)/$"),c=d[2]+"/"+d[3]+"/";if($('#ResourceCalDAVTODOList input[data-id$="'+c+'"]:visible').length>0){var u=$('#ResourceCalDAVTODOList input[data-id$="'+c+'"]');u.trigger("click"),globalVisibleCalDAVTODOCollections.splice(globalVisibleCalDAVTODOCollections.length,0,u.attr("data-id"))}}else{var g=globalSettings.activetodocollections.value[i].match(n)[1],p=globalSettings.activetodocollections.value[i].match(n)[2];if(""!=globalLoginUsername)var b=globalLoginUsername;else var b=globalAccountSettings[0].userAuth.userName;var v=g+b+"@"+p;$('#ResourceCalDAVTODOList input[data-id="'+v+'"]:visible').length>0&&($('#ResourceCalDAVTODOList input[data-id="'+v+'"]').trigger("click"),globalVisibleCalDAVTODOCollections.splice(globalVisibleCalDAVTODOCollections.length,0,v))}globalSettings.activetodocollections.value.length>0&&0==globalVisibleCalDAVTODOCollections.length&&(globalDefaultTodoCalendarCollectionActiveAll=!0)}if(globalDefaultTodoCalendarCollectionActiveAll)for(var i=0;i<globalResourceCalDAVList.TodoCollections.length;i++)void 0!=globalResourceCalDAVList.TodoCollections[i].uid&&$('#ResourceCalDAVTODOList input[data-id="'+globalResourceCalDAVList.TodoCollections[i].uid+'"]:visible').length>0&&($('#ResourceCalDAVTODOList input[data-id="'+globalResourceCalDAVList.TodoCollections[i].uid+'"]').trigger("click"),globalVisibleCalDAVTODOCollections.splice(globalVisibleCalDAVTODOCollections.length,0,globalResourceCalDAVList.TodoCollections[i].uid));if(0==$("#ResourceCalDAVList .resourceCalDAV_item[data-id]:visible").length&&globalResourceCalDAVList.collections.length>1){for(var f=new Array,h=0;h<globalResourceCalDAVList.collections.length;h++)if(void 0!=globalResourceCalDAVList.collections[h].uid){var m=globalResourceCalDAVList.collections[h].accountUID.match(s),A=m[1]+m[3]+m[4];globalAccountSettings[0].href==A&&globalAccountSettings[0].userAuth.userName==globalResourceCalDAVList.collections[h].userAuth.userName&&f.push(globalResourceCalDAVList.collections[h])}0==f.length&&f.push(globalResourceCalDAVList.collections[1]);for(var h=0;h<f.length;h++){f[h].makeLoaded=!0;var C=f[h].uid.match(r);globalSettings.loadedcalendarcollections.value.push(C[1]+C[3]);var y=$("#ResourceCalDAVList").find('.resourceCalDAV_item[data-id="'+jqueryEscapeSelector(f[h].uid)+'"]'),D=y.prevUntil(".resourceCalDAV_header").last().prev();D.length||(D=y.prev()),D.css("display","block"),y.css("display",""),y.find("input[type=checkbox]").not(".unloadCheck").trigger("click"),globalVisibleCalDAVCollections.splice(globalVisibleCalDAVCollections.length,0,f[h].uid)}}if(0==$("#ResourceCalDAVTODOList .resourceCalDAVTODO_item[data-id]:visible").length&&globalResourceCalDAVList.TodoCollections.length>1){for(var f=new Array,h=0;h<globalResourceCalDAVList.TodoCollections.length;h++)if(void 0!=globalResourceCalDAVList.TodoCollections[h].uid){var m=globalResourceCalDAVList.TodoCollections[h].accountUID.match(s),A=m[1]+m[3]+m[4];globalAccountSettings[0].href==A&&globalAccountSettings[0].userAuth.userName==globalResourceCalDAVList.TodoCollections[h].userAuth.userName&&f.push(globalResourceCalDAVList.TodoCollections[h])}0==f.length&&f.push(globalResourceCalDAVList.TodoCollections[1]);for(var h=0;h<f.length;h++){$('#ResourceCalDAVTODOList .resourceCalDAVTODO_item[data-id="'+f[h].uid+'"]').css("display","block"),f[h].makeLoaded=!0;var C=f[h].uid.match(r);globalSettings.loadedtodocollections.value.push(C[1]+C[3]);var y=$("#ResourceCalDAVTODOList").find('.resourceCalDAVTODO_item[data-id="'+jqueryEscapeSelector(f[h].uid)+'"]'),D=y.prevUntil(".resourceCalDAVTODO_header").last().prev();D.length||(D=y.prev()),D.css("display","block"),y.css("display",""),y.find("input[type=checkbox]").not(".unloadCheck").trigger("click"),globalVisibleCalDAVTODOCollections.splice(globalVisibleCalDAVTODOCollections.length,0,f[h].uid)}}$("#ResourceCalDAVList").children(".resourceCalDAV_header").each(function(){$(this).nextUntil(".resourceCalDAV_header").filter(":visible").length||$(this).css("display","none")}),$("#ResourceCalDAVTODOList").children(".resourceCalDAVTODO_header").each(function(){$(this).nextUntil(".resourceCalDAVTODO_header").filter(":visible").length||$(this).css("display","none")}),selectActiveCalendar()}if(isAvaible("CardDavMATE")){if(0==$("#ResourceCardDAVList .resourceCardDAV_item:visible").length&&globalResourceCardDAVList.collections.length>1){for(var f=new Array,h=0;h<globalResourceCardDAVList.collections.length;h++)if(void 0!=globalResourceCardDAVList.collections[h].uid){var m=globalResourceCardDAVList.collections[h].accountUID.match(s),A=m[1]+m[3]+m[4];globalAccountSettings[0].href==A&&globalAccountSettings[0].userAuth.userName==globalResourceCardDAVList.collections[h].userAuth.userName&&f.push(globalResourceCardDAVList.collections[h])}0==f.length&&f.push(globalResourceCardDAVList.collections[1]);for(var h=0;h<f.length;h++){$('#ResourceCardDAVList .resourceCardDAV_item .resourceCardDAV[data-id="'+f[h].uid+'"]').parent().css("display","block"),f[h].makeLoaded=!0;var C=f[h].uid.match(r);globalSettings.loadedaddressbookcollections.value.push(C[1]+C[3]),globalSettings.activeaddressbookcollections.value.push(C[1]+C[3])}}$("#ResourceCardDAVList").children(".resourceCardDAV_header").each(function(){$(this).nextUntil(".resourceCardDAV_header").filter(":visible").length||$(this).css("display","none")})}loadNextApplication(!0)}var L=!1,S=!1;if(isAvaible("CalDavZAP")){setCalendarNumber(!1),selectActiveCalendar();var N=globalResourceCalDAVList.TodoCollections;0==N.length||1==N.length&&"undefined"==typeof N[0].uid?($("#intCaldavTodo").css("display","none"),L=!1):($("#intCaldavTodo").css("display","block"),L=!0);for(var T=new Array,i=0;i<N.length;i++)void 0!=N[i].uid&&(T[T.length]={displayValue:N[i].displayvalue,uid:N[i].uid,permissions_read_only:N[i].permissions.read_only,makeLoaded:N[i].makeLoaded});T.sort(customResourceCompare),globalResourceCalDAVList.sortedTodoCollections=T;var N=globalResourceCalDAVList.collections;0==N.length||1==N.length&&"undefined"==typeof N[0].uid?($("#intCaldav").css("display","none"),S=!1):($("#intCaldav").css("display","block"),S=!0),T=new Array;for(var i=0;i<N.length;i++)void 0!=N[i].uid&&(T[T.length]={displayValue:N[i].displayvalue,uid:N[i].uid,permissions_read_only:N[i].permissions.read_only,makeLoaded:N[i].makeLoaded});T.sort(customResourceCompare),globalResourceCalDAVList.sortedCollections=T}var R=!1;if(isAvaible("CardDavMATE")){
selectActiveAddressbook();for(var x in globalAddressbookList.vcard_groups)globalAddressbookList.vcard_groups[x].length>0&&(extendDestSelect(),"undefined"==typeof $("#vCardEditor").attr("data-vcard-uid")&&$("#vCardEditor").find('[data-attr-name="_DEST_"]').find('optiotn[data-type$="'+$("#ResourceCardDAVList").find(".resourceCardDAV_selected").find(":input[data-id]").attr("data-id")+'"]').prop("selected",!0));var V=globalResourceCardDAVList.collections;0==V.length||1==V.length&&"undefined"==typeof V[0].uid?($("#intCarddav").css("display","none"),R=!1):(R=!0,$("#intCarddav").css("display","block"))}return(isAvaible("CalDavZAP")&&!isCalDAVLoaded||isAvaible("CardDavMATE")&&!isCardDAVLoaded)&&(isAvaible("CalDavZAP")&&("CalDavTODO"==globalActiveApp&&(L||(globalActiveApp=null)),null!=globalActiveApp&&"CalDavZAP"!=globalActiveApp||(S?globalActiveApp="CalDavZAP":globalActiveApp=null)),!isAvaible("CardDavMATE")||null!=globalActiveApp&&"CardDavMATE"!=globalActiveApp||(R?globalActiveApp="CardDavMATE":globalActiveApp=null),null!=globalActiveApp&&checkForApplication(globalActiveApp)),ifLoadCollections(),isAvaible("CalDavZAP")&&(0==$("#ResourceCalDAVList .resourceCalDAV_item:visible").not(".resourceCalDAV_item_ro").length?($("#eventFormShower").css("display","none"),$("#calendar").fullCalendar("setOptions",{selectable:!1})):($("#eventFormShower").css("display","block"),$("#calendar").fullCalendar("setOptions",{selectable:!0})),0==$("#ResourceCalDAVTODOList .resourceCalDAVTODO_item:visible").not(".resourceCalDAV_item_ro").length?$("#eventFormShowerTODO").css("display","none"):$("#eventFormShowerTODO").css("display","block")),!1}if(a>=globalAccountSettings.length&&!settingsLoaded)return console.log("Error: [netFindResource]: 'Unable to load resources'"),!1;var O=new RegExp("^(https?://)([^/]+)(.*)","i"),m=e.href.match(O),w=(m[1]+e.userAuth.userName+"@"+m[2],m[1]+e.userAuth.userName+"@"+m[2]+m[3]),E="";e.href.indexOf(globalLoginUsername)!=-1&&e.settingsAccount&&(""==globalSettings.settingstype.value||null==globalSettings.settingstype.value||""!=globalSettings.settingstype.value&&null!=globalSettings.settingstype.value&&"principal-URL"==globalSettings.settingstype.value)&&(E='<I:settings xmlns:I="http://inf-it.com/ns/dav/"/>');var I=m[1]+m[2];return"undefined"==typeof e.extendedDelegation||!e.extendedDelegation||"undefined"==typeof e.abhref&&"undefined"==typeof e.cahref?void $.ajax({type:"PROPFIND",url:e.href,cache:!1,crossDomain:"undefined"==typeof e.crossDomain||e.crossDomain,xhrFields:{withCredentials:"undefined"!=typeof e.withCredentials&&e.withCredentials},timeout:e.timeOut,beforeSend:function(r){if(1!=globalSettings.usejqueryauth.value&&""!=e.userAuth.userName&&""!=e.userAuth.userPassword&&r.setRequestHeader("Authorization",basicAuth(e.userAuth.userName,e.userAuth.userPassword)),r.setRequestHeader("X-client",globalXClientHeader),r.setRequestHeader("Depth","0"),(""!=globalSettingsSaving||isAvaible("CardDavMATE")&&!globalCardDAVInitLoad&&!globalCardDAVResourceSync||isAvaible("CalDavZAP")&&!globalCalDAVInitLoad&&!globalCalDAVResourceSync||isAvaible("Projects")&&isProjectsLoaded)&&(""!=globalSettingsSaving||isAvaible("Settings")&&"visible"==$("#SystemSettings").css("visibility")&&"setting_group_password"==$(".resourceSettings_item_selected").attr("data-type")))return a++,(isAvaible("CardDavMATE")&&globalCardDAVInitLoad||isAvaible("CalDavZAP")&&globalCalDAVInitLoad)&&a==globalAccountSettings.length&&$("#MainLoader").fadeOut(1200),netFindResource(globalAccountSettings[a],l,t,a,o),!1},username:1==globalSettings.usejqueryauth.value?e.userAuth.userName:null,password:1==globalSettings.usejqueryauth.value?e.userAuth.userPassword:null,contentType:"text/xml; charset=utf-8",processData:!0,data:'<?xml version="1.0" encoding="utf-8"?><D:propfind xmlns:D="DAV:"><D:prop>'+E+'<D:current-user-privilege-set/><D:displayname/><D:resourcetype/><L:calendar-home-set xmlns:L="urn:ietf:params:xml:ns:caldav"/><R:addressbook-home-set xmlns:R="urn:ietf:params:xml:ns:carddav"/></D:prop></D:propfind>',dataType:"xml",error:function(r,n){console.log("Error: [netFindResource: 'PROPFIND "+w+"']: code: '"+r.status+"' status: '"+n+"'"+(0==r.status?" - see https://www.inf-it.com/"+globalAppName.toLowerCase()+"/readme.txt (cross-domain setup)":"")),a++,e.errorLoaded=!0,isAvaible("CalDavZAP")&&($("#intCaldav").find(".int_error").css("display","block"),$("#intCaldavTodo").find(".int_error").css("display","block")),isAvaible("CardDavMATE")&&$("#intCarddav").find(".int_error").css("display","block");for(var s=!0,i=0;i<globalAccountSettings.length;i++)"undefined"!=typeof globalAccountSettings[i].errorLoaded&&null!=globalAccountSettings[i].errorLoaded&&globalAccountSettings[i].errorLoaded!==!1||(s=!1);return(isAvaible("CardDavMATE")&&globalCardDAVInitLoad||isAvaible(globalCalDAVInitLoad))&&a==globalAccountSettings.length&&s?$("#MainLoader").fadeOut(1200):(isAvaible("CardDavMATE")&&!globalCardDAVInitLoad||isAvaible("CalDavZAP")&&!globalCalDAVInitLoad)&&(isAvaible("CalDavZAP")&&handleCalDAVError(!0,e),isAvaible("CardDavMATE")&&handleCardDAVError(!0,e)),netFindResource(globalAccountSettings[a],l,t,a,o),!1},success:function(r,n,s){if(e.errorLoaded=!1,isAvaible("CalDavZAP")&&isEachResourceLoaded()&&($("#intCaldav").find(".int_error").css("display","none"),$("#intCaldavTodo").find(".int_error").css("display","none")),isAvaible("CardDavMATE")&&isEachResourceLoaded()&&$("#intCarddav").find(".int_error").css("display","none"),isAvaible("CalDavZAP")&&!globalCalDAVInitLoad&&handleCalDAVError(!1,e),isAvaible("CardDavMATE")&&!globalCardDAVInitLoad&&handleCardDAVError(!1,e),!settingsLoaded&&e.href.indexOf(globalLoginUsername)!=-1&&e.settingsAccount&&(""==globalSettings.settingstype.value||null==globalSettings.settingstype.value||""!=globalSettings.settingstype.value&&null!=globalSettings.settingstype.value&&"principal-URL"==globalSettings.settingstype.value)){var i=$(s.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response").children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("settings").text();""!=i?ignoreServerSettings?(delete globalSettings.version.value,loadSettings(JSON.stringify(globalSettings),!1,!1),console.log("Ignoring server settings: \n"+i)):loadSettings(i,!0,!1):(delete globalSettings.version.value,loadSettings(JSON.stringify(globalSettings),!1,!1))}else if(!globalSyncSettingsSave&&e.href.indexOf(globalLoginUsername)!=-1&&(isAvaible("CardDavMATE")&&globalCardDAVResourceSync||isAvaible("CalDavZAP")&&globalCalDAVResourceSync)){globalSyncSettingsSave=!0;var d=new Array,c=new Array,u=new Array;isAvaible("CardDavMATE")&&(u=globalSettings.loadedaddressbookcollections.value.slice()),isAvaible("CalDavZAP")&&(d=globalSettings.loadedcalendarcollections.value.slice(),c=globalSettings.loadedtodocollections.value.slice());var i=$(s.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response").children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("settings").text();"undefined"!=typeof globalPreviousSupportedSettings&&null!=globalPreviousSupportedSettings&&loadSettings(i,!0,!0),isAvaible("CardDavMATE")&&(globalSettings.loadedaddressbookcollections.value=u.slice()),isAvaible("CalDavZAP")&&(globalSettings.loadedcalendarcollections.value=d.slice(),globalSettings.loadedtodocollections.value=c.slice()),checkBeforeClose(!1)}var g=$(s.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response"),p=g.children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("addressbook-home-set").children().filterNsNode("href").text();""==p&&(p=g.children().filterNsNode("href").text().replace("/principals/users/caldav.php","/caldav.php")),null!=p.match(RegExp("^https?://","i"))?e.abhref=p:e.abhref=I+p;var b=g.children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("calendar-home-set").children().filterNsNode("href").text();""==b&&(b=g.children().filterNsNode("href").text().replace("/principals/users/caldav.php","/caldav.php")),null!=b.match(RegExp("^https?://","i"))?e.cahref=b:e.cahref=I+b,isAvaible("CardDavMATE")&&isAvaible("CalDavZAP")?e.abhref==e.cahref?netLoadResource(e,e.abhref,!1,l,t,a,o):netLoadResource(e,e.abhref,!0,l,t,a,o):isAvaible("CardDavMATE")?netLoadResource(e,e.abhref,!1,l,t,a,o):isAvaible("CalDavZAP")&&netLoadResource(e,e.cahref,!1,l,t,a,o)}}):(isAvaible("CardDavMATE")&&isAvaible("CalDavZAP")?e.abhref==e.cahref?netLoadResource(e,e.abhref,!1,l,t,a,o):netLoadResource(e,e.abhref,!0,l,t,a,o):isAvaible("CardDavMATE")?netLoadResource(e,e.abhref,!1,l,t,a,o):isAvaible("CalDavZAP")&&netLoadResource(e,e.cahref,!1,l,t,a,o),!1)}function netLoadResource(e,l,t,a,o,r,n){function s(s,i,d){e.errorLoaded=!1,isAvaible("CalDavZAP")&&isEachResourceLoaded()&&($("#intCaldav").find(".int_error").css("display","none"),$("#intCaldavTodo").find(".int_error").css("display","none")),isAvaible("CardDavMATE")&&isEachResourceLoaded()&&$("#intCarddav").find(".int_error").css("display","none"),isAvaible("CalDavZAP")&&!globalCalDAVInitLoad&&handleCalDAVError(!1,e),isAvaible("CardDavMATE")&&!globalCardDAVInitLoad&&handleCardDAVError(!1,e);var g="";isHrefSet=!1;var b=(new Date).getTime();if(!settingsLoaded&&e.href.indexOf(globalLoginUsername)!=-1&&e.settingsAccount&&""!=globalSettings.settingstype.value&&null!=globalSettings.settingstype.value){if("addressbook-home-set"==globalSettings.settingstype.value&&e.abhref==l||"calendar-home-set"==globalSettings.settingstype.value&&e.cahref==l){var v=$(d.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response").children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("settings").text();if(""!=v)ignoreServerSettings?(delete globalSettings.version.value,loadSettings(JSON.stringify(globalSettings),!1,!1),console.log("Ignoring server settings: \n"+v)):loadSettings(v,!0,!1);else{var f=$(d.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response").children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("cal-settings").text();""!=f?ignoreServerSettings?(delete globalSettings.version.value,loadSettings(JSON.stringify(globalSettings),!1,!1),console.log("Ignoring server settings: \n"+f)):loadSettings(f,!0,!1):(delete globalSettings.version.value,loadSettings(JSON.stringify(globalSettings),!1,!1))}}}else if(settingsLoaded||e.href.indexOf(globalLoginUsername)==-1){if(!globalSyncSettingsSave&&e.href.indexOf(globalLoginUsername)!=-1&&(isAvaible("CardDavMATE")&&globalCardDAVResourceSync||isAvaible("CalDavZAP")&&globalCalDAVResourceSync)){globalSyncSettingsSave=!0;var h=new Array,m=new Array,A=new Array;isAvaible("CardDavMATE")&&(A=globalSettings.loadedaddressbookcollections.value.slice()),isAvaible("CalDavZAP")&&(h=globalSettings.loadedcalendarcollections.value.slice(),m=globalSettings.loadedtodocollections.value.slice());var v=$(d.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response").children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("settings").text();"undefined"!=typeof globalPreviousSupportedSettings&&null!=globalPreviousSupportedSettings&&loadSettings(v,!0,!0),isAvaible("CardDavMATE")&&(globalSettings.loadedaddressbookcollections.value=A.slice()),isAvaible("CalDavZAP")&&(globalSettings.loadedcalendarcollections.value=h.slice(),globalSettings.loadedtodocollections.value=m.slice()),checkBeforeClose(!1)}}else delete globalSettings.version.value,loadSettings(JSON.stringify(globalSettings),!1,!1);if($(d.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response").each(function(l,t){$(t).children().filterNsNode("propstat").each(function(l,o){var n=$(o).children().filterNsNode("prop"),s="",i=new Array;if(n.children().filterNsNode("supported-calendar-component-set").children().filterNsNode("comp").each(function(e,l){i[i.length]=l.getAttribute("name").toLowerCase()}),("undefined"!=typeof e&&"undefined"!=typeof e.collectionTypes&&null!=e.collectionTypes&&e.collectionTypes.indexOf("calendar")!=-1||"undefined"==typeof e||null==e.collectionTypes)&&isAvaible("CalDavZAP")&&1==n.children().filterNsNode("resourcetype").children().filterNsNode("calendar").length&&1==n.children().filterNsNode("resourcetype").children().filterNsNode("collection").length&&(void 0==e.ignoreBound||1!=e.ignoreBound||1!=n.children().filterNsNode("resourcetype").children().filterNsNode("webdav-binding").length)){1==n.children().filterNsNode("calendar-color").length&&(s=n.children().filterNsNode("calendar-color").text(),9==s.length&&(s=s.substring(0,7)));var d=new Array;n.children().filterNsNode("current-user-privilege-set").children().filterNsNode("privilege").each(function(e,l){$(l).children().each(function(e,l){d[d.length]=$(l).prop("tagName").replace(/^[^:]+:/,"")})});var v=!1,f=$(t).children().filterNsNode("href").text();if(null!=f.match(RegExp("^https?://","i"))){var h=f.match(RegExp("^(https?://)([^/]+)(.*)","i"));null!=h&&(f=h[3])}if(d.length>0&&d.indexOf("all")==-1&&d.indexOf("write")==-1&&d.indexOf("write-content")==-1)v=!0;else if(void 0!=e.forceReadOnly&&(1==e.forceReadOnly||e.forceReadOnly instanceof Array))if(e.forceReadOnly instanceof Array)for(var m=0;m<e.forceReadOnly.length;m++)if("string"==typeof e.forceReadOnly[m]){var A=f.indexOf(e.forceReadOnly[m]);A!=-1&&f.length==A+e.forceReadOnly[m].length&&(v=!0)}else"object"==typeof e.forceReadOnly[m]&&null!=f.match(e.forceReadOnly[m])&&(v=!0);else v=!0;var C=n.children().filterNsNode("displayname").text(),y=n.children().filterNsNode("headervalue").text(),D=n.children().filterNsNode("sync-token").text(),L="",S=f.match(RegExp(".*/([^/]+)/$","i"));if(""==C&&(C=S[1]),""==s){for(var N=(u+f).split("/"),T=String(CryptoJS.SHA256(String(CryptoJS.SHA256(N[N.length-3]+"/"+N[N.length-2]+"/")))),R=T.substring(0,6);checkColorBrightness(R)>=252;)R=String(CryptoJS.SHA256(String(CryptoJS.SHA256(T)))).substring(0,6);s="#"+R}var x=!1;(u+f).split("/");if("boolean"==typeof e.ignoreAlarms&&e.ignoreAlarms)x=!0;else if(e.ignoreAlarms instanceof Array&&e.ignoreAlarms.length>0)for(var m=0;m<e.ignoreAlarms.length;m++)if("string"==typeof e.ignoreAlarms[m]){var A=f.indexOf(e.ignoreAlarms[m]);A!=-1&&f.length==A+e.ignoreAlarms[m].length&&(x=!0)}else"object"==typeof e.ignoreAlarms[m]&&null!=f.match(e.ignoreAlarms[m])&&(x=!0);var V=!1;1==n.children().filterNsNode("resourcetype").children().filterNsNode("webdav-binding").length&&(V=!0);var O=void 0==e.checkContentType||e.checkContentType,w=!0;if(i.indexOf("vevent")!=-1){var E=!1,I=globalResourceCalDAVList.getEventCollectionByUID(u+f);null!=I?I.syncToken!=D&&(E=!0):(E=!0,""==D&&(D=null));var _=(u+f).match(RegExp("^(https?://)([^@/]+(?:@[^@/]+)?)@(.*)")),k=_[1]+_[3];if(isHrefSet||(g=u+f,isHrefSet=!0),globalDefaultCalendarCollectionLoadAll){var P=!0;globalCalDAVInitLoad&&globalSettings.loadedcalendarcollections.value.push(k)}else{var P=!1;if("undefined"!=typeof globalCrossServerSettingsURL&&null!=globalCrossServerSettingsURL&&globalCrossServerSettingsURL){for(var _=(u+f).match(RegExp("/([^/]+/[^/]+/)$")),H=_[1].match("^(.*/)([^/]+)/$"),U=decodeURIComponent(H[1])+H[2]+"/",M=!1,q=0;q<globalSettings.loadedcalendarcollections.value.length;q++){var F=globalSettings.loadedcalendarcollections.value[q].match("^(.*/)([^/]+)/([^/]+)/$"),j=decodeURIComponent(F[2])+"/"+F[3]+"/";if(U==j){M=!0,globalSettings.loadedcalendarcollections.value[q]=k;break}}P=M}else P=globalSettings.loadedcalendarcollections.value.indexOf(k)!=-1}P||(L=""),globalResourceCalDAVList.insertResource({makeLoaded:P,typeList:i,listType:"vevent",ecolor:s,timestamp:b,uid:u+f,timeOut:e.timeOut,displayvalue:C,headervalue:y,userAuth:e.userAuth,resourceIndex:r,url:c,accountUID:p,href:f,hrefLabel:e.hrefLabel,permissions:{full:d,read_only:v},crossDomain:e.crossDomain,withCredentials:e.withCredentials,interval:null,waitInterval:null,displayEventsArray:new Array,pastUnloaded:"",fcSource:null,subscription:!1,newlyAdded:P,urlArray:null,ignoreAlarms:x,webdav_bind:V,syncRequired:w,checkContentType:O,syncToken:D,oldSyncToken:L,someChanged:E},r,!0),void 0!=globalAccountSettings[r]&&globalAccountSettings[r].calendarNo++,w=!1}if(i.indexOf("vtodo")!=-1){var E=!1,I=globalResourceCalDAVList.getTodoCollectionByUID(u+f);w&&null!=I?I.syncToken!=D&&(E=!0):(E=!0,""==D&&(D=null));var _=(u+f).match(RegExp("^(https?://)([^@/]+(?:@[^@/]+)?)@(.*)")),k=_[1]+_[3];if(isHrefSet||(g=u+f,isHrefSet=!0),globalDefaultTodoCalendarCollectionLoadAll){var P=!0;globalCalDAVInitLoad&&globalSettings.loadedtodocollections.value.push(k)}else{var P=!1;if("undefined"!=typeof globalCrossServerSettingsURL&&null!=globalCrossServerSettingsURL&&globalCrossServerSettingsURL){for(var _=(u+f).match(RegExp("/([^/]+/[^/]+/)$")),H=_[1].match("^(.*/)([^/]+)/$"),U=decodeURIComponent(H[1])+H[2]+"/",M=!1,q=0;q<globalSettings.loadedtodocollections.value.length;q++){var F=globalSettings.loadedtodocollections.value[q].match("^(.*/)([^/]+)/([^/]+)/$"),j=decodeURIComponent(F[2])+"/"+F[3]+"/";if(U==j){M=!0,globalSettings.loadedtodocollections.value[q]=k;break}}P=M}else P=globalSettings.loadedtodocollections.value.indexOf(k)!=-1}P||(L=""),globalResourceCalDAVList.insertResource({makeLoaded:P,typeList:i,hrefArray:new Array,listType:"vtodo",ecolor:s,timestamp:b,uid:u+f,timeOut:e.timeOut,displayvalue:C,headervalue:y,userAuth:e.userAuth,resourceIndex:r,url:c,accountUID:p,href:f,hrefLabel:e.hrefLabel,permissions:{full:d,read_only:v},crossDomain:e.crossDomain,withCredentials:e.withCredentials,interval:null,waitInterval:null,displayEventsArray:new Array,pastUnloaded:"",fcSource:null,subscription:!1,newlyAdded:P,urlArray:null,ignoreAlarms:x,webdav_bind:V,syncRequired:w,checkContentType:O,syncToken:D,oldSyncToken:L,someChanged:E},r,!1),void 0!=globalAccountSettings[r]&&globalAccountSettings[r].todoNo++}}if(("undefined"!=typeof e&&"undefined"!=typeof e.collectionTypes&&null!=e.collectionTypes&&e.collectionTypes.indexOf("addressbook")!=-1||"undefined"==typeof e||null==e.collectionTypes)&&isAvaible("CardDavMATE")&&1==n.children().filterNsNode("resourcetype").children().filterNsNode("addressbook").length&&1==n.children().filterNsNode("resourcetype").children().filterNsNode("collection").length&&(void 0==e.ignoreBound||1!=e.ignoreBound||1!=n.children().filterNsNode("resourcetype").children().filterNsNode("webdav-binding").length)){1==n.children().filterNsNode("addressbook-color").length&&(s=n.children().filterNsNode("addressbook-color").text(),9==s.length&&(s=s.substring(0,7)));var d=new Array;n.children().filterNsNode("current-user-privilege-set").children().filterNsNode("privilege").each(function(e,l){$(l).children().each(function(e,l){d[d.length]=$(l).prop("tagName").replace(/^[^:]+:/,"")})});var X=!1,z=n.children().filterNsNode("supportedlock").children().filterNsNode("lockentry").children().filterNsNode("lockscope").children().filterNsNode("exclusive");"undefined"!=typeof z&&void 0!=z.length&&0!=z.length||(X=!0);var f=$(t).children().filterNsNode("href").text();if(null!=f.match(RegExp("^https?://","i"))){var h=f.match(RegExp("^(https?://)([^/]+)(.*)","i"));null!=h&&(f=h[3])}var B=f.match(RegExp("/([^/]+)/?$")),v=!1;(("undefined"==typeof globalDisablePermissionChecking||1!=globalDisablePermissionChecking)&&d.length>0&&d.indexOf("all")==-1&&d.indexOf("write")==-1&&d.indexOf("write-content")==-1||void 0!=e.forceReadOnly&&(1==e.forceReadOnly||e.forceReadOnly instanceof Array&&e.forceReadOnly.indexOf(B[1])!=-1))&&(v=!0);var C=n.children().filterNsNode("displayname").text(),y=n.children().filterNsNode("headervalue").text(),D=n.children().filterNsNode("sync-token").text(),L="",S=f.match(RegExp(".*/([^/]+)/$","i"));if(""==C&&(C=S[1]),""==s){for(var N=(u+f).split("/"),T=String(CryptoJS.SHA256(String(CryptoJS.SHA256(N[N.length-3]+"/"+N[N.length-2]+"/")))),R=T.substring(0,6);checkColorBrightness(R)>=252;)R=String(CryptoJS.SHA256(String(CryptoJS.SHA256(T)))).substring(0,6);s="#"+R}var O=void 0==e.checkContentType||e.checkContentType,E=!1,I=globalResourceCardDAVList.getCollectionByUID(u+f);null!=I?(I.syncToken!=D&&(E=!0),"undefined"!=typeof globalForceSyncURLArray&&globalForceSyncURLArray.length>0&&globalForceSyncURLArray.indexOf(I.uid)!=-1&&(E=!0)):(E=!0,""==D&&(D=null));var _=(u+f).match(RegExp("^(https?://)([^@/]+(?:@[^@/]+)?)@(.*)")),k=_[1]+_[3];if(isHrefSet||(g=u+f,isHrefSet=!0),globalDefaultAddrCollectionLoadAll){var P=!0;globalCardDAVInitLoad&&globalSettings.loadedaddressbookcollections.value.push(k)}else{var P=!1;if("undefined"!=typeof globalCrossServerSettingsURL&&null!=globalCrossServerSettingsURL&&globalCrossServerSettingsURL){for(var _=(u+f).match(RegExp("/([^/]+/[^/]+/)$")),H=_[1].match("^(.*/)([^/]+)/$"),U=decodeURIComponent(H[1])+H[2]+"/",M=!1,q=0;q<globalSettings.loadedaddressbookcollections.value.length;q++){var F=globalSettings.loadedaddressbookcollections.value[q].match("^(.*/)([^/]+)/([^/]+)/$"),j=decodeURIComponent(F[2])+"/"+F[3]+"/";if(U==j){M=!0,globalSettings.loadedaddressbookcollections.value[q]=k;break}}P=M}else P=globalSettings.loadedaddressbookcollections.value.indexOf(k)!=-1}globalResourceCardDAVList.insertResource({makeLoaded:P,timestamp:b,uid:u+f,timeOut:e.timeOut,displayvalue:C,headervalue:y,userAuth:e.userAuth,url:c,accountUID:p,href:f,hrefLabel:e.hrefLabel,color:s,permissions:{full:d,read_only:v},crossDomain:e.crossDomain,withCredentials:e.withCredentials,checkContentType:O,isLoaded:!1,newlyAdded:P,indexResource:r,disableLocking:X,syncToken:D,oldSyncToken:L,someChanged:E},a),e.addressbookNo++}})}),""!=g){var C=g.replace(new RegExp("[^/]+/$"),"");"undefined"!=typeof globalResourceCalDAVList&&null!=globalResourceCalDAVList&&globalResourceCalDAVList.removeOldResources(C,b),"undefined"!=typeof globalResourceCardDAVList&&null!=globalResourceCardDAVList&&globalResourceCardDAVList.removeOldResources(C,b)}t?netLoadResource(e,e.cahref,!1,a,o,r,n):(r++,netFindResource(globalAccountSettings[r],a,o,r,n))}var i=new RegExp("^(https?://)([^/]+)(.*)","i");(!isAvaible("CardDavMATE")||!globalCardDAVInitLoad||globalCardDAVInitLoad&&"undefined"==typeof e.addressbookNo)&&(e.addressbookNo=0),(!isAvaible("CalDavZAP")||!globalCalDAVInitLoad||globalCalDAVInitLoad&&"undefined"==typeof e.calendarNo&&"undefined"==typeof e.todoNo)&&(e.calendarNo=0,e.todoNo=0);var d=e.abhref.match(i),c=d[1]+d[2],u=d[1]+e.userAuth.userName+"@"+d[2],g=d[1]+e.userAuth.userName+"@"+d[2]+d[3],d=e.href.match(RegExp("^(https?://)(.*)","i")),p=d[1]+e.userAuth.userName+"@"+d[2];if("undefined"!=typeof globalSubscribedCalendars&&null!=globalSubscribedCalendars&&"undefined"!=typeof e.calendars&&null!=e.calendars&&e.calendars.length>0){for(var b=e.href.match(RegExp("^(https?://)(.*)","i")),v=b[1]+e.userAuth.userName+"@"+b[2],f=(new Date).getTime(),h=0;h<globalSubscribedCalendars.calendars.length;h++){if(color=globalSubscribedCalendars.calendars[h].color,""==color){for(var m=(u+globalSubscribedCalendars.calendars[h].href).split("/"),A=String(CryptoJS.SHA256(String(CryptoJS.SHA256(m[m.length-3]+"/"+m[m.length-2]+"/")))),C=A.substring(0,6);checkColorBrightness(C)>=252;)C=String(CryptoJS.SHA256(String(CryptoJS.SHA256(A)))).substring(0,6);color="#"+C}var y=!0;(u+"/"+globalSubscribedCalendars.calendars[h].href+"/").split("/");if(globalSubscribedCalendars.calendars[h].typeList.indexOf("vevent")!=-1){var D=(u+"/"+globalSubscribedCalendars.calendars[h].href+"/").match(RegExp("^(https?://)([^@/]+(?:@[^@/]+)?)@(.*)")),L=D[1]+D[3];if(isHrefSet||(saveHref=u+href,isHrefSet=!0),globalDefaultCalendarCollectionLoadAll){globalCalDAVInitLoad&&globalSettings.loadedcalendarcollections.value.push(L);var S=!0}else{var S=!1;if("undefined"!=typeof globalCrossServerSettingsURL&&null!=globalCrossServerSettingsURL&&globalCrossServerSettingsURL){for(var D=(u+"/"+globalSubscribedCalendars.calendars[h].href+"/").match(RegExp("/([^/]+/[^/]+/)$")),N=D[1].match("^(.*/)([^/]+)/$"),T=decodeURIComponent(N[1])+N[2]+"/",R=!1,x=0;x<globalSettings.loadedcalendarcollections.value.length;x++){var V=globalSettings.loadedcalendarcollections.value[x].match("^(.*/)([^/]+)/([^/]+)/$"),O=decodeURIComponent(V[2])+"/"+V[3]+"/";if(T==O){R=!0,globalSettings.loadedcalendarcollections.value[x]=L;break}}S=R}else S=globalSettings.loadedcalendarcollections.value.indexOf(L)!=-1}globalResourceCalDAVList.insertResource({makeLoaded:S,typeList:globalSubscribedCalendars.calendars[h].typeList,listType:"vevent",syncRequired:y,ecolor:color,timestamp:f,uid:u+"/"+globalSubscribedCalendars.calendars[h].href+"/",timeOut:e.timeOut,displayvalue:globalSubscribedCalendars.calendars[h].displayName,userAuth:globalSubscribedCalendars.calendars[h].userAuth,resourceIndex:r,url:c,accountUID:v,href:globalSubscribedCalendars.calendars[h].href,hrefLabel:globalSubscribedCalendars.hrefLabel,permissions:{full:[],read_only:!0},crossDomain:e.crossDomain,withCredentials:e.withCredentials,interval:null,waitInterval:null,displayEventsArray:new Array,pastUnloaded:"",fcSource:null,subscription:!0,newlyAdded:S,urlArray:new Array,ignoreAlarms:globalSubscribedCalendars.calendars[h].ignoreAlarm,webdav_bind:!1},r,!0),void 0!=e&&e.calendarNo++,y=!1}if(globalSubscribedCalendars.calendars[h].typeList.indexOf("vtodo")!=-1){var D=(u+"/"+globalSubscribedCalendars.calendars[h].href+"/").match(RegExp("^(https?://)([^@/]+(?:@[^@/]+)?)@(.*)")),L=D[1]+D[3];if(isHrefSet||(saveHref=u+href,isHrefSet=!0),globalDefaultTodoCalendarCollectionLoadAll){var S=!0;globalCalDAVInitLoad&&globalSettings.loadedtodocollections.value.push(L)}else{var S=!1;if("undefined"!=typeof globalCrossServerSettingsURL&&null!=globalCrossServerSettingsURL&globalCrossServerSettingsURL){for(var D=(u+"/"+globalSubscribedCalendars.calendars[h].href+"/").match(RegExp("/([^/]+/[^/]+/)$")),N=D[1].match("^(.*/)([^/]+)/$"),T=decodeURIComponent(N[1])+N[2]+"/",R=!1,x=0;x<globalSettings.loadedtodocollections.value.length;x++){var V=globalSettings.loadedtodocollections.value[x].match("^(.*/)([^/]+)/([^/]+)/$"),O=decodeURIComponent(V[2])+"/"+V[3]+"/";if(T==O){R=!0,globalSettings.loadedtodocollections.value[x]=L;break}}S=R}else S=globalSettings.loadedtodocollections.value.indexOf(L)!=-1}globalResourceCalDAVList.insertResource({makeLoaded:S,typeList:globalSubscribedCalendars.calendars[h].typeList,listType:"vtodo",syncRequired:y,ecolor:color,timestamp:f,uid:u+"/"+globalSubscribedCalendars.calendars[h].href+"/",timeOut:e.timeOut,displayvalue:globalSubscribedCalendars.calendars[h].displayName,userAuth:globalSubscribedCalendars.calendars[h].userAuth,resourceIndex:r,url:c,accountUID:v,href:globalSubscribedCalendars.calendars[h].href,hrefLabel:globalSubscribedCalendars.hrefLabel,permissions:{full:[],read_only:!0},crossDomain:e.crossDomain,withCredentials:e.withCredentials,interval:null,waitInterval:null,displayEventsArray:new Array,pastUnloaded:"",fcSource:null,subscription:!0,newlyAdded:S,urlArray:new Array,ignoreAlarms:globalSubscribedCalendars.calendars[h].ignoreAlarm,webdav_bind:!1},r,!1),void 0!=e&&e.todoNo++}}return r++,netFindResource(globalAccountSettings[r],a,o,r,n),!0}var w="";e.href.indexOf(globalLoginUsername)!=-1&&e.settingsAccount&&""!=globalSettings.settingstype.value&&null!=globalSettings.settingstype.value&&("addressbook-home-set"==globalSettings.settingstype.value&&e.abhref==l||"calendar-home-set"==globalSettings.settingstype.value&&e.cahref==l||"principal-URL"==globalSettings.settingstype.value&&(isAvaible("CardDavMATE")&&globalCardDAVResourceSync||isAvaible("CalDavZAP")&&globalCalDAVResourceSync))&&(w='<I:settings xmlns:I="http://inf-it.com/ns/dav/"/>');var E;null!=globalXMLCache&&(E=globalXMLCache.children('davprincipalcollections[request_url="'+jqueryEscapeSelector(l)+'"]').remove()).length?("undefined"!=typeof globalDebug&&globalDebug instanceof Array&&globalDebug.indexOf("cache")!=-1&&console.log("DBG Cache OK: "+arguments.callee.name+" url: '"+l+"': saved one request!"),s("","success",{responseXML:E})):("undefined"!=typeof globalDebug&&globalDebug instanceof Array&&globalDebug.indexOf("cache")!=-1&&console.log("DBG Cache ERROR: "+arguments.callee.name+" url: '"+l+"': spend one request!"),$.ajax({type:"PROPFIND",url:l,cache:!1,crossDomain:"undefined"==typeof e.crossDomain||e.crossDomain,xhrFields:{withCredentials:"undefined"!=typeof e.withCredentials&&e.withCredentials},timeout:e.timeOut,beforeSend:function(l){if(1!=globalSettings.usejqueryauth.value&&""!=e.userAuth.userName&&""!=e.userAuth.userPassword&&l.setRequestHeader("Authorization",basicAuth(e.userAuth.userName,e.userAuth.userPassword)),l.setRequestHeader("X-client",globalXClientHeader),l.setRequestHeader("Depth","1"),(""!=globalSettingsSaving||isAvaible("CardDavMATE")&&!globalCardDAVInitLoad&&!globalCardDAVResourceSync||isAvaible("CalDavZAP")&&!globalCalDAVInitLoad&&!globalCalDAVResourceSync||isAvaible("Projects")&&isProjectsLoaded)&&(""!=globalSettingsSaving||isAvaible("Settings")&&"visible"==$("#SystemSettings").css("visibility")&&"setting_group_password"==$(".resourceSettings_item_selected").attr("data-type")))return r++,(isAvaible("CardDavMATE")&&globalCardDAVInitLoad||isAvaible(globalCalDAVInitLoad))&&r==globalAccountSettings.length&&$("#MainLoader").fadeOut(1200),netFindResource(globalAccountSettings[r],a,o,r,n),!1},username:1==globalSettings.usejqueryauth.value?e.userAuth.userName:null,password:1==globalSettings.usejqueryauth.value?e.userAuth.userPassword:null,contentType:"text/xml; charset=utf-8",processData:!0,data:'<?xml version="1.0" encoding="utf-8"?><D:propfind xmlns:D="DAV:"><D:prop>'+w+'<D:current-user-privilege-set/><D:displayname/><D:supportedlock/><D:resourcetype/><D:supported-report-set/><D:sync-token/><A:calendar-color xmlns:A="'+("undefined"!=typeof globalCalendarColorPropertyXmlns&&null!=globalCalendarColorPropertyXmlns&&""!=globalCalendarColorPropertyXmlns?globalCalendarColorPropertyXmlns:"http://apple.com/ns/ical/")+'"/><I:headervalue xmlns:I="http://inf-it.com/ns/dav/"/><I:addressbook-color xmlns:I="'+("undefined"!=typeof globalAddrColorPropertyXmlns&&null!=globalAddrColorPropertyXmlns&&""!=globalAddrColorPropertyXmlns?globalAddrColorPropertyXmlns:"http://inf-it.com/ns/ab/")+'"/><L:supported-calendar-component-set xmlns:L="urn:ietf:params:xml:ns:caldav"/><R:max-image-size xmlns:R="urn:ietf:params:xml:ns:carddav"/></D:prop></D:propfind>',dataType:"xml",error:function(l,s){if(console.log("Error: [netLoadResource: 'PROPFIND "+g+"']: code: '"+l.status+"' status: '"+s+"'"+(0==l.status?" - see https://www.inf-it.com/"+globalAppName.toLowerCase()+"/readme.txt (cross-domain setup)":"")),e.errorLoaded=!0,isAvaible("CalDavZAP")&&($("#intCaldav").find(".int_error").css("display","block"),$("#intCaldavTodo").find(".int_error").css("display","block")),isAvaible("CardDavMATE")&&$("#intCarddav").find(".int_error").css("display","block"),t)netLoadResource(e,e.cahref,!1,a,o,r,n);else{r++;for(var i=!0,d=0;d<globalAccountSettings.length;d++)"undefined"!=typeof globalAccountSettings[d].errorLoaded&&null!=globalAccountSettings[d].errorLoaded&&globalAccountSettings[d].errorLoaded!==!1||(i=!1);(isAvaible("CardDavMATE")&&globalCardDAVInitLoad||isAvaible("CalDavZAP")&&globalCalDAVInitLoad)&&r==globalAccountSettings.length&&i&&$("#MainLoader").fadeOut(1200),isAvaible("CalDavZAP")&&!globalCalDAVInitLoad&&handleCalDAVError(!0,e),isAvaible("CardDavMATE")&&!globalCardDAVInitLoad&&handleCardDAVError(!0,e),netFindResource(globalAccountSettings[r],a,o,r,n)}return!1},success:s}))}function netSaveSettings(e,l,t,a){var o=new RegExp("^(https?://)([^/]+)(.*)","i"),r=e.href.match(o),n=(r[1]+r[2],r[1]+e.userAuth.userName+"@"+r[2],r[1]+e.userAuth.userName+"@"+r[2]+r[3]),s=e.href,i=transformToServer(l);""!=globalSettings.settingstype.value&&null!=globalSettings.settingstype.value&&("addressbook-home-set"==globalSettings.settingstype.value?s=e.abhref:"calendar-home-set"==globalSettings.settingstype.value&&(s=e.cahref)),$.ajax({type:"PROPPATCH",url:s,cache:!1,crossDomain:"undefined"==typeof e.crossDomain||e.crossDomain,xhrFields:{withCredentials:"undefined"!=typeof e.withCredentials&&e.withCredentials
},timeout:e.timeOut,beforeSend:function(l){1!=globalSettings.usejqueryauth.value&&""!=e.userAuth.userName&&""!=e.userAuth.userPassword&&l.setRequestHeader("Authorization",basicAuth(e.userAuth.userName,e.userAuth.userPassword)),l.setRequestHeader("X-client",globalXClientHeader),l.setRequestHeader("Depth","0")},username:1==globalSettings.usejqueryauth.value?e.userAuth.userName:null,password:1==globalSettings.usejqueryauth.value?e.userAuth.userPassword:null,contentType:"text/xml",processData:!0,data:'<?xml version="1.0" encoding="utf-8"?><D:propertyupdate xmlns:D="DAV:"><D:set><D:prop><I:settings xmlns:I="http://inf-it.com/ns/dav/">'+JSON.stringify(i)+"</I:settings></D:prop></D:set></D:propertyupdate>",dataType:"xml",error:function(e,l){console.log("Error: [netSaveSettings: 'PROPPATCH "+n+"'] code: '"+e.status+"' status: '"+l+"'"+(0==e.status?" (this error code usually means network connection error, or your browser is trying to make a cross domain query, but it is not allowed by the destination server or the browser itself)":"")),isAvaible("Settings")&&show_editor_loader_messageSettings("message_error",localization[globalInterfaceLanguage].errSettingsSaved);var t=null;return"undefined"!=typeof globalSettingsSaving&&("event"==globalSettingsSaving?t=$("#CalendarLoader"):"todo"==globalSettingsSaving?t=$("#CalendarLoaderTODO"):"addressbook"==globalSettingsSaving&&(t=$("#AddressbookOverlay"))),null!=t&&(t.addClass("message_error").children(".loaderInfo").text(localization[globalInterfaceLanguage].errCollectionLoad),setTimeout(function(){t.addClass("loader_hidden").removeClass("message_error").children(".loaderInfo").text("")},globalHideInfoMessageAfter)),globalSettingsSaving="",!1},success:function(e,o,r){isAvaible("Settings")&&t?(applySettings(getChangedSettings(globalSettings,l)),globalSettings=l):a&&(checkForLoadedCollections(l),globalSettings=l)}})}function deleteVcalendarFromCollection(e,l,t){var a=e.match(vCalendar.pre.uidParts),o=(a[1]+a[2]+"@"+a[3]+a[4]+a[5],a[1]+a[3]+a[4]+a[5]+a[6]),r=a[1]+a[3]+a[4],n=a[2],s=null,i=e.substring(0,e.lastIndexOf("/")+1);if("vevent"==l)var d=globalResourceCalDAVList.collections;else var d=globalResourceCalDAVList.TodoCollections;for(var c=vCalendar.pre.accountUidParts,u=0;u<d.length;u++)if(i==d[u].uid){for(var a=d[u].accountUID.match(c),r=a[1]+a[3]+a[4],n=a[2],g=0;g<globalAccountSettings.length;g++)globalAccountSettings[g].href==r&&globalAccountSettings[g].userAuth.userName==n&&(s=globalAccountSettings[g]);break}if(null==s)return!1;if("vevent"==l)var p=localization[globalInterfaceLanguage].errUnableDeleteBeginCalDAV;else var p=localization[globalInterfaceLanguage].errUnableDeleteTodoBeginCalDAV;new Array;$.ajax({type:"DELETE",url:o,cache:!1,crossDomain:!0,xhrFields:{withCredentials:"undefined"!=typeof s.withCredentials&&s.withCredentials},timeout:s.timeOut,beforeSend:function(e){1!=globalSettings.usejqueryauth.value&&""!=s.userAuth.userName&&""!=s.userAuth.userPassword&&e.setRequestHeader("Authorization",basicAuth(s.userAuth.userName,s.userAuth.userPassword)),e.setRequestHeader("X-client",globalXClientHeader)},username:1==globalSettings.usejqueryauth.value?s.userAuth.userName:null,password:1==globalSettings.usejqueryauth.value?s.userAuth.userPassword:null,contentType:"text/calendar",processData:!0,data:"",dataType:"text",error:function(e,t){switch(console.log("Error: [deleteVcalendarFromCollection: 'DELETE "+o+"']: code: '"+e.status+"' status: '"+t+"'"+(0==e.status?" - see https://www.inf-it.com/"+globalAppName.toLowerCase()+"/readme.txt (cross-domain setup)":"")),e.status){case 401:show_editor_loader_messageCalendar(l,"message_error",p.replace("%%",localization[globalInterfaceLanguage].errHttp401));break;case 403:show_editor_loader_messageCalendar(l,"message_error",p.replace("%%",localization[globalInterfaceLanguage].errHttp403));break;case 405:show_editor_loader_messageCalendar(l,"message_error",p.replace("%%",localization[globalInterfaceLanguage].errHttp405));break;case 408:show_editor_loader_messageCalendar(l,"message_error",p.replace("%%",localization[globalInterfaceLanguage].errHttp408));break;case 410:"vevent"==l?show_editor_loader_messageCalendar(l,"message_error",p.replace("%%",localization[globalInterfaceLanguage].CalDAVerrHttp410)):show_editor_loader_messageCalendar(l,"message_error",p.replace("%%",localization[globalInterfaceLanguage].CalDAVerrTodoHttp410));break;case 500:show_editor_loader_messageCalendar(l,"message_error",p.replace("%%",localization[globalInterfaceLanguage].errHttp500));break;default:show_editor_loader_messageCalendar(l,"message_error",p.replace("%%",localization[globalInterfaceLanguage].errHttpCommon.replace("%%",e.status)))}return!1},success:function(a,o,r){return"vevent"==l?globalEventList.removeOldEvent(e,!0,!0):t&&globalEventList.removeOldEvent(e,!0,!1),!!t||void("vevent"==l?show_editor_loader_messageCalendar("vevent","message_success",localization[globalInterfaceLanguage].txtAllDeleted,function(e){$("#show").val(""),$("#CAEvent").hide(),$("#event_details_template").remove(),$("#CAEvent").append(cleanVcalendarTemplate),$("#EventDisabler").fadeOut(globalEditorFadeAnimation,function(){$("#timezonePicker").prop("disabled",!1)})}):show_editor_loader_messageCalendar("vtodo","message_success",localization[globalInterfaceLanguage].txtAllDeletedTodo,function(l){$("#showTODO").val(""),$("#TodoDisabler").fadeOut(globalEditorFadeAnimation,function(){$("#timezonePickerTODO").prop("disabled",!1)}),globalEventList.removeOldEvent(e,!0,!1)}))}})}function moveVcalendarToCollection(e,l,t,a,o,r,n,s,i){(new Date).getTime();"vtodo"==r&&(globalTodoLoaderHide=localization[globalInterfaceLanguage].txtAllSavedTodo);for(var d=(String(CryptoJS.SHA256(a+(new Date).getTime())),o.match(vCalendar.pre.uidParts)),c=l.match(vCalendar.pre.uidParts),u=c[1]+c[2]+"@"+c[3]+c[4]+c[5],g=d[1]+d[3]+d[4]+d[5]+d[6],p=c[1]+c[3]+c[4]+c[5]+c[6],b=d[4]+d[5]+d[6],v=c[4]+c[5]+c[6],f=null,d=e.match(vCalendar.pre.accountUidParts),h=d[1]+d[3]+d[4],m=d[2],A=0;A<globalAccountSettings.length;A++)globalAccountSettings[A].href==h&&globalAccountSettings[A].userAuth.userName==m&&(f=globalAccountSettings[A]);if(null==f)return!1;if("vevent"==r)var C=localization[globalInterfaceLanguage].errUnableSaveBeginCalDAV;else var C=localization[globalInterfaceLanguage].errUnableSaveTodoBeginCalDAV;var y=globalResourceCalDAVList.getEventCollectionByUID(u);null==y&&(y=globalResourceCalDAVList.getTodoCollectionByUID(u));new Array;$.ajax({type:"MOVE",url:g,cache:!1,crossDomain:"undefined"==typeof f.crossDomain||f.crossDomain,xhrFields:{withCredentials:"undefined"!=typeof f.withCredentials&&f.withCredentials},timeout:f.timeOut,beforeSend:function(e){1!=globalSettings.usejqueryauth.value&&""!=f.userAuth.userName&&""!=f.userAuth.userPassword&&e.setRequestHeader("Authorization",basicAuth(f.userAuth.userName,f.userAuth.userPassword)),e.setRequestHeader("X-client",globalXClientHeader),e.setRequestHeader("Destination",p)},username:1==globalSettings.usejqueryauth.value?f.userAuth.userName:null,password:1==globalSettings.usejqueryauth.value?f.userAuth.userPassword:null,contentType:"text/calendar",processData:!0,data:a,dataType:"text",error:function(e,l){switch(console.log("Error: [moveVcalendarToCollection: 'MOVE from: "+g+" to: "+p+"']: code: '"+e.status+"' status: '"+l+"'"+(0==e.status?" - see https://www.inf-it.com/"+globalAppName.toLowerCase()+"/readme.txt (cross-domain setup)":"")),e.status){case 401:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttp401));break;case 403:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttp403));break;case 405:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttp405));break;case 408:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttp408));break;case 412:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttp412)),netLoadCalendar(globalResourceCalDAVList.getCollectionByUID(u),[{etag:"",href:b}],void 0==y.forceSyncPROPFIND||0==y.forceSyncPROPFIND,!1,!0,!0,!0,null,null);break;case 500:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttp500));break;default:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttpCommon.replace("%%",e.status)))}return"vtodo"==r&&(globalTodoLoaderHide=""),!$("#InvitationBoxContent").is(":visible")||"vevent"!=r&&"schedule-inbox"!=r||($("#InvitationBoxHeader").find(".invitation_header_item_selected").length?filterInvitations($("#InvitationBoxHeader").find(".invitation_header_item_selected").attr("data-type")):$("#InvitationBoxHeader").find(".invitation_header_item").first().trigger("click")),!1},success:function(e,t,a){globalRevertFunction=null;if(globalWindowFocus=!1,"vevent"==r||"schedule-inbox"==r&&$("#CAEvent").is(":visible")){var i=localization[globalInterfaceLanguage].txtAllSaved;s&&(i=localization[globalInterfaceLanguage].txtAllDeleted),show_editor_loader_messageCalendar(r,"message_success",i,function(e){$("#show").val(""),1!=n&&($("#CAEvent").hide(),$("#calendar").fullCalendar("unselect"),$("#event_details_template").remove(),$("#CAEvent").append(cleanVcalendarTemplate),$("#EventDisabler").fadeOut(globalEditorFadeAnimation,function(){$("#timezonePicker").prop("disabled",!1)}))}),globalEventList.removeOldEvent(o,!0,!0)}else"vtodo"==r&&globalEventList.removeOldEvent(o,!0,!1);"vevent"==r?netLoadCalendar(globalResourceCalDAVList.getEventCollectionByUID(u),[{etag:"",href:v}],void 0==y.forceSyncPROPFIND||0==y.forceSyncPROPFIND,!1,!0,!1,!0,null,null):"vtodo"==r&&($("#showTODO").val(l),netLoadCalendar(globalResourceCalDAVList.getTodoCollectionByUID(u),[{etag:"",href:v}],void 0==y.forceSyncPROPFIND||0==y.forceSyncPROPFIND,!1,!0,!1,!0,null,null)),globalWindowFocus=!0}})}function putVcalendarToCollection(e,l,t,a,o,r,n,s,i){var d=(new Date).getTime();"vtodo"==r&&(globalTodoLoaderHide=localization[globalInterfaceLanguage].txtAllSavedTodo),a=vObjectLineFolding(a);var c=String(CryptoJS.SHA256(a+(new Date).getTime())),u=l.match(vCalendar.pre.uidParts),g=u[1]+u[2]+"@"+u[3]+u[4]+u[5];if(""!=t)var p=u[1]+u[3]+u[4]+u[5]+u[6],b=u[4]+u[5]+u[6];else if("/"!=l.charAt(l.length-1))var p=u[1]+u[3]+u[4]+u[5]+u[6],b=u[4]+u[5]+u[6];else{var v=c+".ics",p=u[1]+u[3]+u[4]+u[5]+v,b=u[4]+u[5]+v;l+=v}for(var f=null,u=e.match(vCalendar.pre.accountUidParts),h=u[1]+u[3]+u[4],m=u[2],A=0;A<globalAccountSettings.length;A++)globalAccountSettings[A].href==h&&globalAccountSettings[A].userAuth.userName==m&&(f=globalAccountSettings[A]);if(null==f)return!1;if("vevent"==r)var C=localization[globalInterfaceLanguage].errUnableSaveBeginCalDAV;else var C=localization[globalInterfaceLanguage].errUnableSaveTodoBeginCalDAV;var y=globalResourceCalDAVList.getEventCollectionByUID(g);null==y&&(y=globalResourceCalDAVList.getTodoCollectionByUID(g));new Array;$.ajax({type:"PUT",url:p,cache:!1,crossDomain:"undefined"==typeof f.crossDomain||f.crossDomain,xhrFields:{withCredentials:"undefined"!=typeof f.withCredentials&&f.withCredentials},timeout:f.timeOut,beforeSend:function(e){e.setRequestHeader("Prefer","return=representation"),1!=globalSettings.usejqueryauth.value&&""!=f.userAuth.userName&&""!=f.userAuth.userPassword&&e.setRequestHeader("Authorization",basicAuth(f.userAuth.userName,f.userAuth.userPassword)),e.setRequestHeader("X-client",globalXClientHeader),""!=t?e.setRequestHeader("If-Match",t):e.setRequestHeader("If-None-Match","*")},username:1==globalSettings.usejqueryauth.value?f.userAuth.userName:null,password:1==globalSettings.usejqueryauth.value?f.userAuth.userPassword:null,contentType:"text/calendar",processData:!0,data:a,dataType:"text",error:function(e,l){switch(console.log("Error: [putVcalendarToCollection: 'PUT "+p+"']: code: '"+e.status+"' status: '"+l+"'"+(0==e.status?" - see https://www.inf-it.com/"+globalAppName.toLowerCase()+"/readme.txt (cross-domain setup)":"")),e.status){case 401:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttp401));break;case 403:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttp403));break;case 405:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttp405));break;case 408:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttp408));break;case 412:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttp412)),netLoadCalendar(globalResourceCalDAVList.getCollectionByUID(g),[{etag:"",href:b}],void 0==y.forceSyncPROPFIND||0==y.forceSyncPROPFIND,!1,!0,!0,!0,null,null);break;case 500:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttp500));break;default:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttpCommon.replace("%%",e.status)))}return"vevent"==r&&null!=globalRevertFunction?(globalRevertFunction(),globalRevertFunction=null):"vtodo"==r&&(globalTodoLoaderHide="",n&&$("#todoList").fullCalendar("allowSelectEvent",!0)),!1},success:function(c,u,p){if(globalRevertFunction=null,""!=o&&deleteVcalendarFromCollection(o,r,!0),i.length>0){var v=i[0];i.splice(0,1),putVcalendarToCollection(e,l.substring(0,l.lastIndexOf("/")+1),"",v,o,r,n,s,i)}var f=p.getResponseHeader("Etag");if(globalWindowFocus=!1,"vevent"==r){var h=localization[globalInterfaceLanguage].txtAllSaved;s&&(h=localization[globalInterfaceLanguage].txtAllDeleted),show_editor_loader_messageCalendar(r,"message_success",h,function(e){$("#show").val(""),1!=n&&($("#CAEvent").hide(),$("#calendar").fullCalendar("unselect"),$("#event_details_template").remove(),$("#CAEvent").append(cleanVcalendarTemplate),$("#EventDisabler").fadeOut(globalEditorFadeAnimation,function(){$("#timezonePicker").prop("disabled",!1)}))})}else null!=f&&(s&&(globalTodoLoaderHide=localization[globalInterfaceLanguage].txtAllDeletedTodo),show_editor_loader_messageCalendar(r,"message_success",globalTodoLoaderHide,function(e){globalTodoLoaderHide="","vtodo"==r&&1!=n&&$("#showTODO").val(""),$("#TodoDisabler").fadeOut(globalEditorFadeAnimation,function(){$("#timezonePickerTODO").prop("disabled",!1)})}));if(null!=f){var m=l.substring(0,l.lastIndexOf("/")+1);if("vevent"==r){for(var A=globalResourceCalDAVList.collections,C=0;C<A.length;C++)if(m==A[C].uid){if(""==a)return!0;var D=a;"return=representation"==p.getResponseHeader("Preference-Applied")&&p.responseText&&(D=p.responseText);var L=vCalendarCleanup(D);globalEventList.insertEvent(!0,A[C],{isRepeat:!1,isTODO:!1,untilDate:"",sortStart:"",start:"",end:"",sortkey:"",timestamp:d,accountUID:A[C].accountUID,uid:l,displayValue:A[C].displayvalue,etag:f,vcalendar:L},!0,!0,!1);break}}else for(var A=globalResourceCalDAVList.TodoCollections,C=0;C<A.length;C++)if(m==A[C].uid){if(""==a)return!0;var D=a;"return=representation"==p.getResponseHeader("Preference-Applied")&&p.responseText&&(D=p.responseText);var L=vCalendarCleanup(D);"vtodo"==r&&1!=n&&$("#showTODO").val(l),globalEventList.insertEvent(!0,A[C],{isRepeat:!1,isTODO:!1,untilDate:"",sortStart:"",start:"",end:"",sortkey:"",timestamp:d,accountUID:A[C].accountUID,uid:l,displayValue:A[C].displayvalue,etag:f,vcalendar:L},!0,!1,!1),n&&$("#todoList").fullCalendar("allowSelectEvent",!0),(""==t||n)&&$("#todoList").fullCalendar("selectEvent",$('[data-id="'+l+'"]'));break}}else"vevent"==r?netLoadCalendar(globalResourceCalDAVList.getEventCollectionByUID(g),[{etag:"",href:b}],void 0==y.forceSyncPROPFIND||0==y.forceSyncPROPFIND,!1,!0,!1,!0,null,null):(n&&$("#todoList").fullCalendar("allowSelectEvent",!0),"vtodo"==r&&1!=n&&$("#showTODO").val(l),netLoadCalendar(globalResourceCalDAVList.getTodoCollectionByUID(g),[{etag:"",href:b}],void 0==y.forceSyncPROPFIND||0==y.forceSyncPROPFIND,!1,!0,!1,!0,null,null));return globalWindowFocus=!0,!0}})}function CalDAVnetLoadCollection(e,l,t,a,o){function r(r,n,s){$('[data-id="'+e.uid+'"]').removeClass("r_error"),"vevent"==e.listType&&0==$("#ResourceCalDAVList").find(".r_error").length&&isEachResourceLoaded()?$("#intCaldav").find(".int_error").css("display","none"):"vtodo"==e.listType&&0==$("#ResourceCalDAVTODOList").find(".r_error").length&&isEachResourceLoaded()&&$("#intCaldavTodo").find(".int_error").css("display","none");var i=e.newlyAdded;e.newlyAdded=!1;var d=new Array,c=!0;if("vtodo"==e.listType&&null!=globalSettings.todopastlimit.value||"vevent"==e.listType&&(null!=globalSettings.eventstartpastlimit.value||null!=globalSettings.eventstartfuturelimit.value)){var u=0;$(s.responseXML).children().filterNsNode("multistatus").children().filterNsNode(new RegExp("^(sync-)?response$")).children().filterNsNode("href").each(function(e,l){u++}),globalResourceCalDAVList.counterList[e.uid+" "+e.listType].collectionLength=u,globalResourceCalDAVList.counterList[e.uid+" "+e.listType].counter=0,globalResourceCalDAVList.counterList[e.uid+" "+e.listType].resourceIndex=e.resourceIndex,globalResourceCalDAVList.counterList[e.uid+" "+e.listType].listType=e.listType,globalResourceCalDAVList.counterList[e.uid+" "+e.listType].typeList=e.typeList}var g=new RegExp("200 OK$"),p=new RegExp("404 Not Found$");return $(s.responseXML).children().filterNsNode("multistatus").children().filterNsNode(new RegExp("^(sync-)?response$")).each(function(t,a){var o=$(a).children().filterNsNode("href").text(),r=$(a).children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("getetag").text(),n=!1;if(0!=e.checkContentType){var s=$(a).children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("getcontenttype").text();void 0!=s&&(contenttypeValArr=s.toLowerCase().replace(vCalendar.pre.spaceRex,"").split(";"),contenttypeValArr.indexOf("text/calendar")==-1&&contenttypeValArr.indexOf("text/x-vcalendar")==-1||(n=!0))}else n=!0;var u=$(a).find("*").filterNsNode("status").text(),b=!1;if("/"!=o[o.length-1]&&(1==n&&u.match(g)&&(d[d.length]={etag:r,href:o},b=!0),!b&&u.match(p)&&(d[d.length]={deleted:!0,etag:r,href:o})),(l||i)&&("vtodo"==e.listType&&null!=globalSettings.todopastlimit.value||"vevent"==e.listType&&(null!=globalSettings.eventstartpastlimit.value||null!=globalSettings.eventstartfuturelimit.value))){var v=(new Date).getTime();if(!$(a).children().filterNsNode("propstat").children().filterNsNode("status").text().match(RegExp("200 OK$"))){var f=e.uid+o.replace(vCalendar.pre.hrefValRex,"");return console.log("Error: '"+f+"': unable to parse vEvent or vTodo"),checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1),!0}var f=e.uid+o.replace(vCalendar.pre.hrefValRex,""),h=$(a).children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("calendar-data").text();if(""==h)return checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1),!0;c=!1;var m=vCalendarCleanup(h);if(void 0==m||null==(check=m.match(vCalendar.pre.vcalendar)))return checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1),console.log("Error: '"+f+"': unable to parse vCalendar"),!0;if(null!=(check=m.match(vCalendar.pre.vevent)))e.typeList.indexOf("vevent")!=-1?globalEventList.insertEvent(!1,e,{threadChange:"",isRepeat:!1,isDrawn:!1,isTODO:!1,untilDate:"",sortStart:"",start:"",end:"",sortkey:"",timestamp:v,accountUID:e.accountUID,uid:f,displayValue:e.displayvalue,counter:0,etag:r,vcalendar:m},!1,!0,!0):checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1);else{if(null==(check=m.match(vCalendar.pre.vtodo)))return console.log("Error: '"+f+"': unable to parse vEvent or vTodo"),checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1),!0;e.typeList.indexOf("vtodo")!=-1?globalEventList.insertEvent(!1,e,{threadChange:"",isRepeat:!1,isDrawn:!1,isTODO:!0,untilDate:"",sortStart:"",start:"",end:"",sortkey:"",timestamp:v,accountUID:e.accountUID,uid:f,displayValue:e.displayvalue,counter:0,etag:r,vcalendar:m},!1,!1,!0):checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1)}}}),!t||l||i||void 0!=e.forceSyncPROPFIND&&0!=e.forceSyncPROPFIND||(e.syncToken=$(s.responseXML).children().filterNsNode("multistatus").children().filterNsNode("sync-token").text()),("vtodo"!=e.listType||null==globalSettings.todopastlimit.value)&&("vevent"!=e.listType||null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value)||c?(("vtodo"==e.listType&&null!=globalSettings.todopastlimit.value||"vevent"==e.listType&&(null!=globalSettings.eventstartpastlimit.value||null!=globalSettings.eventstartfuturelimit.value))&&(l&&!t||i&&!globalCalDAVInitLoad)?netLoadCalendar(e,d,void 0==e.forceSyncPROPFIND||0==e.forceSyncPROPFIND,!0,l,t,!1,a,o):netLoadCalendar(e,d,void 0==e.forceSyncPROPFIND||0==e.forceSyncPROPFIND,!0,l,t,!1,a,o),d=null,void("undefined"!=typeof globalParallelAjaxCallCalDAVEnabled&&null!=globalParallelAjaxCallCalDAVEnabled&&globalParallelAjaxCallCalDAVEnabled&&o.length>0&&(a++,a>=o.length&&"undefined"!=e.uid&&"vevent"==e.listType?(a=0,(null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value||t)&&CalDAVnetLoadCollection(globalResourceCalDAVList.TodoCollections[0],l,t,0,globalResourceCalDAVList.TodoCollections)):CalDAVnetLoadCollection(o[a],l,t,a,o)))):(e.oldSyncToken=e.syncToken,e.someChanged=!1,o.length>0&&(a++,a>=o.length&&"undefined"!=e.uid&&"vevent"==e.listType?(setLoadingLimit(l,t),a=0,t&&CalDAVnetLoadCollection(globalResourceCalDAVList.TodoCollections[0],l,t,0,globalResourceCalDAVList.TodoCollections)):CalDAVnetLoadCollection(o[a],l,t,a,o),(globalOnlyCalendarNumber>0&&globalOnlyCalendarNumberCount==globalOnlyCalendarNumber||globalTodoCalendarNumber>0&&globalOnlyTodoCalendarNumberCount==globalTodoCalendarNumber)&&updateMainLoader(!0,e.listType)),!1)}if(a>=o.length)return setLoadingLimit(l,t),!globalCalDAVInitLoad&&isCalDAVLoaded&&t&&($("#SystemCalDavZAP .fc-header-center ").removeClass("r_operate_all"),loadNextApplication(!1)),!1;if(o.length>0&&(void 0!=e.uid&&e.makeLoaded&&e.newlyAdded&&""!=globalSettingsSaving&&updateMainLoaderText(e.listType),void 0==e.uid||e.subscription||!e.newlyAdded&&!e.syncRequired&&!l&&t||!e.newlyAdded&&!e.someChanged&&!globalCalDAVInitLoad&&t||("vtodo"==e.listType&&null==globalSettings.todopastlimit.value||"vevent"==e.listType&&null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value)&&!e.syncRequired))return e.subscription&&e.syncRequired&&void 0!=e.uid&&netLoadCalendarSubscription(globalAccountSettings[0],e,a,l,o),a++,a>=o.length&&"undefined"!=e.uid&&"vevent"==e.listType?(setLoadingLimit(l,t),a=0,(null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value||t)&&CalDAVnetLoadCollection(globalResourceCalDAVList.TodoCollections[0],l,t,0,globalResourceCalDAVList.TodoCollections)):CalDAVnetLoadCollection(o[a],l,t,a,o),void 0!=e.uid&&(!e.syncRequired&&globalCalDAVInitLoad?("vtodo"==e.listType?$('#ResourceCalDAVTODOList [data-id="'+e.uid+'"]').removeClass("r_operate"):$('#ResourceCalDAVList [data-id="'+e.uid+'"]').removeClass("r_operate"),"vtodo"==e.listType&&null==globalSettings.todopastlimit.value||"vevent"==e.listType&&null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value||""==globalLimitLoading&&""==globalLimitTodoLoading?(globalAccountSettings[e.resourceIndex].todoNo--,(0==globalAccountSettings[e.resourceIndex].calendarNo&&0==globalAccountSettings[e.resourceIndex].todoNo&&globalCalDAVInitLoad||!globalCalDAVInitLoad)&&updateMainLoader()):(globalOnlyCalendarNumber>0&&globalOnlyCalendarNumberCount==globalOnlyCalendarNumber||globalTodoCalendarNumber>0&&globalOnlyTodoCalendarNumberCount==globalTodoCalendarNumber)&&updateMainLoader(!0,e.listType)):globalCalDAVInitLoad||e.someChanged||("vevent"==e.listType?$('#ResourceCalDAVList [data-id="'+e.uid+'"]').removeClass("r_operate"):$('#ResourceCalDAVTODOList [data-id="'+e.uid+'"]').removeClass("r_operate"))),!1;for(var n=null,s=e.accountUID.match(vCalendar.pre.accountUidParts),i=s[1]+s[3]+s[4],d=s[2],c=0;c<globalAccountSettings.length;c++)globalAccountSettings[c].href==i&&globalAccountSettings[c].userAuth.userName==d&&(n=globalAccountSettings[c]);if(e.makeLoaded&&""==globalSettingsSaving&&updateMainLoaderText(e.listType),null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value||t||"vevent"!=e.listType||$('#ResourceCalDAVList [data-id="'+e.uid+'"]').addClass("r_operate"),!e.makeLoaded)return"vevent"==e.listType?$('#ResourceCalDAVList [data-id="'+e.uid+'"]').removeClass("r_operate"):"vtodo"==e.listType&&$('#ResourceCalDAVTODOList [data-id="'+e.uid+'"]').removeClass("r_operate"),a++,""==globalLimitLoading&&""==globalLimitTodoLoading||"vtodo"==e.listType&&null==globalSettings.todopastlimit.value||"vevent"==e.listType&&null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value?("vevent"==e.listType?globalAccountSettings[e.resourceIndex].calendarNo--:"vtodo"==e.listType&&globalAccountSettings[e.resourceIndex].todoNo--,0==globalAccountSettings[e.resourceIndex].calendarNo&&0==globalAccountSettings[e.resourceIndex].todoNo&&globalCalDAVInitLoad&&updateMainLoader()):(globalOnlyCalendarNumber>0&&globalOnlyCalendarNumberCount==globalOnlyCalendarNumber||globalTodoCalendarNumber>0&&globalOnlyTodoCalendarNumberCount==globalTodoCalendarNumber)&&updateMainLoader(!0,e.listType),a>=o.length&&"undefined"!=e.uid&&"vevent"==e.listType?(a=0,setLoadingLimit(l,t),(null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value||t)&&CalDAVnetLoadCollection(globalResourceCalDAVList.TodoCollections[0],l,t,0,globalResourceCalDAVList.TodoCollections)):CalDAVnetLoadCollection(o[a],l,t,a,o),!1;if(void 0!=e.forceSyncPROPFIND&&1==e.forceSyncPROPFIND)var u='<?xml version="1.0" encoding="utf-8"?><D:propfind xmlns:D="DAV:"><D:prop><D:getcontenttype/><D:getetag/></D:prop></D:propfind>';else if("vtodo"==e.listType&&null==globalSettings.todopastlimit.value||"vevent"==e.listType&&null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value)var u='<?xml version="1.0" encoding="utf-8"?><D:sync-collection xmlns:D="DAV:"><D:prop><D:getcontenttype/><D:getetag/></D:prop><D:sync-level>1</D:sync-level>'+(1==l||void 0==e.syncToken||""==e.syncToken?"<D:sync-token/>":"<D:sync-token>"+e.syncToken+"</D:sync-token>")+"</D:sync-collection>";else{var u="";if(l||e.newlyAdded){if("vevent"==e.listType){globalCalDAVInitLoad&&t&&(null!=globalSettings.eventstartpastlimit.value&&(globalLoadedLimit=new Date,globalLoadedLimit.setDate(1),globalLoadedLimit.setHours(0),globalLoadedLimit.setMinutes(0),globalLoadedLimit.setSeconds(0),globalLoadedLimit.setMilliseconds(0),globalLoadedLimit.setMonth(globalLoadedLimit.getMonth()-globalSettings.eventstartpastlimit.value)),null!=globalSettings.eventstartfuturelimit.value&&(globalToLoadedLimit=new Date,globalToLoadedLimit.setDate(1),globalToLoadedLimit.setHours(0),globalToLoadedLimit.setMinutes(0),globalToLoadedLimit.setSeconds(0),globalToLoadedLimit.setMilliseconds(0),globalToLoadedLimit.setMonth(globalToLoadedLimit.getMonth()+globalSettings.eventstartfuturelimit.value+1)));var g="",p="";if(!e.newlyAdded||globalCalDAVInitLoad){if(null!=globalSettings.eventstartpastlimit.value&&(t||"past"==globalLimitLoading)){var b=new Date(globalLoadedLimit.getTime());b.setDate(b.getDate()-7),g=t?' start="'+$.fullCalendar.formatDate(b,"yyyyMMdd'T'HHmmss")+'Z"':' start="'+$.fullCalendar.formatDate(b,"yyyyMMdd'T'HHmmss")+'Z" end="'+$.fullCalendar.formatDate(globalBeginPast,"yyyyMMdd'T'HHmmss")+'Z"',a==o.length-1&&(globalBeginPast=new Date(b.getTime()))}if(null!=globalSettings.eventstartfuturelimit.value&&(t||"future"==globalLimitLoading)){var v=new Date(globalToLoadedLimit.getTime());v.setDate(v.getDate()+14),p=t?' end="'+$.fullCalendar.formatDate(v,"yyyyMMdd'T'HHmmss")+'Z"':' start="'+$.fullCalendar.formatDate(globalBeginFuture,"yyyyMMdd'T'HHmmss")+'Z" end="'+$.fullCalendar.formatDate(v,"yyyyMMdd'T'HHmmss")+'Z"',a==o.length-1&&(globalBeginFuture=new Date(v.getTime()))}}else{var b=new Date(globalLoadedLimit.getTime()),v=new Date(globalToLoadedLimit.getTime());g=' start="'+$.fullCalendar.formatDate(b,"yyyyMMdd'T'HHmmss")+'Z"',p=' end="'+$.fullCalendar.formatDate(v,"yyyyMMdd'T'HHmmss")+'Z"'}u=t?'<?xml version="1.0" encoding="UTF-8"?><L:calendar-query xmlns:L="urn:ietf:params:xml:ns:caldav"><D:prop xmlns:D="DAV:"><D:getcontenttype/><D:getetag/><L:calendar-data/></D:prop><L:filter><L:comp-filter name="VCALENDAR"><L:comp-filter name="VEVENT"><L:time-range'+g+p+"/></L:comp-filter></L:comp-filter></L:filter></L:calendar-query>":'<?xml version="1.0" encoding="UTF-8"?><L:calendar-query xmlns:L="urn:ietf:params:xml:ns:caldav"><D:prop xmlns:D="DAV:"><D:getcontenttype/><D:getetag/><L:calendar-data/></D:prop><L:filter><L:comp-filter name="VCALENDAR"><L:comp-filter name="VEVENT"><L:time-range'+("past"==globalLimitLoading?g:p)+"/></L:comp-filter></L:comp-filter></L:filter></L:calendar-query>"}else if("vtodo"==e.listType){t&&(null!=globalSettings.todopastlimit.value&&(globalLoadedLimitTodo=new Date,globalLoadedLimitTodo.setDate(1),globalLoadedLimitTodo.setHours(0),globalLoadedLimitTodo.setMinutes(0),globalLoadedLimitTodo.setSeconds(0),globalLoadedLimitTodo.setMilliseconds(0),globalLoadedLimitTodo.setMonth(globalLoadedLimitTodo.getMonth()-globalSettings.todopastlimit.value)),null!=globalSettings.eventstartfuturelimit.value&&(globalToLoadedLimitTodo=new Date,globalToLoadedLimitTodo.setDate(1),globalToLoadedLimitTodo.setHours(0),globalToLoadedLimitTodo.setMinutes(0),globalToLoadedLimitTodo.setSeconds(0),globalToLoadedLimitTodo.setMilliseconds(0),globalToLoadedLimitTodo.setMonth(globalToLoadedLimitTodo.getMonth()+globalSettings.eventstartfuturelimit.value+1)));var g="",p="";!e.newlyAdded||globalCalDAVInitLoad?null==globalSettings.todopastlimit.value||!t&&"pastTodo"!=globalLimitTodoLoading||(g=t?' start="'+$.fullCalendar.formatDate(globalLoadedLimitTodo,"yyyyMMdd'T'HHmmss")+'Z"':' start="'+$.fullCalendar.formatDate(globalLoadedLimitTodo,"yyyyMMdd'T'HHmmss")+'Z" end="'+$.fullCalendar.formatDate(new Date(new Date(globalLoadedLimitTodo.getTime()).setMonth(globalLoadedLimitTodo.getMonth()+globalSettings.todopastlimit.value+1)),"yyyyMMdd'T'HHmmss")+'Z"'):g=' start="'+$.fullCalendar.formatDate(globalLoadedLimitTodo,"yyyyMMdd'T'HHmmss")+'Z"',u=t?'<?xml version="1.0" encoding="utf-8"?><L:calendar-query xmlns:L="urn:ietf:params:xml:ns:caldav"><D:prop xmlns:D="DAV:"><D:getcontenttype/><D:getetag/><L:calendar-data/></D:prop><L:filter><L:comp-filter name="VCALENDAR"><L:comp-filter name="VTODO"><L:time-range'+g+p+"/></L:comp-filter></L:comp-filter></L:filter></L:calendar-query>":'<?xml version="1.0" encoding="utf-8"?><L:calendar-query xmlns:L="urn:ietf:params:xml:ns:caldav"><D:prop xmlns:D="DAV:"><D:getcontenttype/><D:getetag/><L:calendar-data/></D:prop><L:filter><L:comp-filter name="VCALENDAR"><L:comp-filter name="VTODO"><L:time-range'+("pastTodo"==globalLimitTodoLoading?g:p)+"/></L:comp-filter></L:comp-filter></L:filter></L:calendar-query>"}}else u='<?xml version="1.0" encoding="utf-8"?><D:sync-collection xmlns:D="DAV:"><D:prop><D:getcontenttype/><D:getetag/></D:prop><D:sync-level>1</D:sync-level>'+(1==l||void 0==e.syncToken||""==e.syncToken?"<D:sync-token/>":"<D:sync-token>"+e.syncToken+"</D:sync-token>")+"</D:sync-collection>"}var f,h="";"vtodo"==e.listType?h="VTODO":"vevent"==e.listType&&(h="VEVENT"),null!=globalXMLCache&&(f=globalXMLCache.children('caldavcalendarquery[request_url="'+jqueryEscapeSelector(e.url+e.href)+'"][request_component="'+h+'"]').remove()).length?("undefined"!=typeof globalDebug&&globalDebug instanceof Array&&globalDebug.indexOf("cache")!=-1&&console.log("DBG Cache OK: "+arguments.callee.name+" component: "+h+" url: '"+e.url+e.href+"': saved one request!"),
r("","success",{responseXML:f})):("undefined"!=typeof globalDebug&&globalDebug instanceof Array&&globalDebug.indexOf("cache")!=-1&&console.log("DBG Cache ERROR: "+arguments.callee.name+" url: '"+e.url+e.href+"': spend one request!"),$.ajax({type:void 0!=e.forceSyncPROPFIND&&1==e.forceSyncPROPFIND?"PROPFIND":"REPORT",url:e.url+e.href,cache:!1,crossDomain:"undefined"==typeof e.crossDomain||e.crossDomain,xhrFields:{withCredentials:"undefined"!=typeof e.withCredentials&&e.withCredentials},timeout:e.timeOut,beforeSend:function(r){if(1!=globalSettings.usejqueryauth.value&&""!=e.userAuth.userName&&""!=e.userAuth.userPassword&&r.setRequestHeader("Authorization",basicAuth(e.userAuth.userName,e.userAuth.userPassword)),r.setRequestHeader("X-client",globalXClientHeader),r.setRequestHeader("Depth","1"),isAvaible("Settings")&&"visible"==$("#SystemSettings").css("visibility")&&"setting_group_password"==$(".resourceSettings_item_selected").attr("data-type"))return o.length>0&&(a++,a>=o.length&&"undefined"!=e.uid&&"vevent"==e.listType?(setLoadingLimit(l,t),a=0,(t||null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value)&&CalDAVnetLoadCollection(globalResourceCalDAVList.TodoCollections[0],l,t,0,globalResourceCalDAVList.TodoCollections)):CalDAVnetLoadCollection(o[a],l,t,a,o)),!1},username:1==globalSettings.usejqueryauth.value?e.userAuth.userName:null,password:1==globalSettings.usejqueryauth.value?e.userAuth.userPassword:null,contentType:"text/xml; charset=utf-8",processData:!0,data:u,dataType:"xml",error:function(r,n){return("vtodo"==e.listType&&null!=globalSettings.todopastlimit.value||"vevent"==e.listType&&(null!=globalSettings.eventstartpastlimit.value||null!=globalSettings.eventstartfuturelimit.value))&&null!=r.responseXML&&$(r.responseXML).children().filterNsNode("C:SUPPORTED-FILTER").length>0&&("vevent"==e.listType?(globalSettings.eventstartfuturelimit.value=null,globalSettings.eventstartpastlimit.value=null):globalSettings.todopastlimit.value=null,""!=globalSettingsSaving&&globalFirstHideLoader?globalLoadedCollectionsCount--:globalCalendarNumberCount--,CalDAVnetLoadCollection(o[a],l,t,a,o)),400!=r.status&&403!=r.status&&415!=r.status&&501!=r.status||1==e.forceSyncPROPFIND?(o.length>0&&(o[a].newlyAdded=!1,a++,a>=o.length&&"undefined"!=e.uid&&"vevent"==e.listType?(a=0,setLoadingLimit(l,t),(t||null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value)&&CalDAVnetLoadCollection(globalResourceCalDAVList.TodoCollections[0],l,t,0,globalResourceCalDAVList.TodoCollections)):CalDAVnetLoadCollection(o[a],l,t,a,o)),"vevent"==e.listType?($('#ResourceCalDAVList [data-id="'+e.uid+'"]').removeClass("r_operate"),$("#intCaldav").find(".int_error").css("display","block")):($('#ResourceCalDAVTODOList [data-id="'+e.uid+'"]').removeClass("r_operate"),$("#intCaldavTodo").find(".int_error").css("display","block")),$('[data-id="'+e.uid+'"]').addClass("r_error"),e.syncToken=e.oldSyncToken,""==globalLimitTodoLoading&&""==globalLimitLoading||"vtodo"==e.listType&&null==globalSettings.todopastlimit.value||"vevent"==e.listType&&null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value?("vevent"==e.listType?globalAccountSettings[e.resourceIndex].calendarNo--:"vtodo"==e.listType&&globalAccountSettings[e.resourceIndex].todoNo--,(0==globalAccountSettings[e.resourceIndex].calendarNo&&0==globalAccountSettings[e.resourceIndex].todoNo&&globalCalDAVInitLoad||!globalCalDAVInitLoad)&&updateMainLoader()):(globalOnlyCalendarNumber>0&&globalOnlyCalendarNumberCount==globalOnlyCalendarNumber||globalTodoCalendarNumber>0&&globalOnlyTodoCalendarNumberCount==globalTodoCalendarNumber)&&updateMainLoader(!0,e.listType),console.log("Error: [CalDAVnetLoadCollection: '"+(void 0!=e.forceSyncPROPFIND&&1==e.forceSyncPROPFIND?"PROPFIND":"REPORT")+" "+e.url+e.href+"'] code: '"+r.status+"' status: '"+n+"'"+(0==r.status?" - see https://www.inf-it.com/"+globalAppName.toLowerCase()+"/readme.txt (cross-domain setup)":"")),!1):(o[a].forceSyncPROPFIND=!0,o[a].syncRequired=!0,"vevent"==e.listType?(globalSettings.eventstartfuturelimit.value=null,globalSettings.eventstartpastlimit.value=null):globalSettings.todopastlimit.value=null,""!=globalSettingsSaving&&globalFirstHideLoader?globalLoadedCollectionsCount--:globalCalendarNumberCount--,CalDAVnetLoadCollection(o[a],l,t,a,o),!0)},success:r}))}function netLoadCalendar(e,l,t,a,o,r,n,s,i){var d=new Array,u=(new Date).getTime();if(e.subscription){var g=0;for(c in l)void 0!=l[c].etag&&null!=l[c].etag&&g++;globalResourceCalDAVList.counterList[e.uid+" "+e.listType].collectionLength=g,globalResourceCalDAVList.counterList[e.uid+" "+e.listType].counter=0,globalResourceCalDAVList.counterList[e.uid+" "+e.listType].resourceIndex=e.resourceIndex,globalResourceCalDAVList.counterList[e.uid+" "+e.listType].listType=e.listType,globalResourceCalDAVList.counterList[e.uid+" "+e.listType].typeList=e.typeList,0==$(".r_operate_all").length&&$("#SystemCalDavZAP .fc-header-center ").addClass("r_operate_all");for(eventUID in l)if(void 0!=l[eventUID].etag&&null!=l[eventUID]){var p=l[eventUID].etag,b=l[eventUID].href,v=l[eventUID].eventText;if(""==v)return checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1),!0;var f=vCalendarCleanup(v);null!=(check=f.match(vCalendar.pre.vevent))?e.typeList.indexOf("vevent")!=-1?globalEventList.insertEvent(n,e,{threadChange:"",isRepeat:!1,isDrawn:!1,isTODO:!1,untilDate:"",sortStart:"",start:"",end:"",sortkey:"",timestamp:u,accountUID:e.accountUID,uid:b,displayValue:e.displayvalue,counter:0,etag:p,vcalendar:"BEGIN:VCALENDAR"+f+"END:VCALENDAR\r\n"},!1,!0,!0):checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1):null!=(check=f.match(vCalendar.pre.vtodo))?e.typeList.indexOf("vtodo")!=-1?globalEventList.insertEvent(n,e,{threadChange:"",isRepeat:!1,isDrawn:!1,isTODO:!1,untilDate:"",sortStart:"",start:"",end:"",sortkey:"",timestamp:u,accountUID:e.accountUID,uid:b,displayValue:e.displayvalue,counter:0,etag:p,vcalendar:"BEGIN:VCALENDAR"+f+"END:VCALENDAR\r\n"},!1,!1,!0):checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1):(console.log("Error: '"+b+"': unable to parse vEvent or vTodo"),checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1))}return 0==g&&("vevent"==e.listType?$('#ResourceCalDAVList [data-id="'+e.uid+'"]').removeClass("r_operate"):$('#ResourceCalDAVTODOList [data-id="'+e.uid+'"]').removeClass("r_operate"),r&&""==globalLimitLoading&&""==globalLimitTodoLoading?(e.typeList.indexOf("vevent")!=-1&&globalAccountSettings[e.resourceIndex].calendarNo--,e.typeList.indexOf("vtodo")!=-1&&globalAccountSettings[e.resourceIndex].todoNo--,0==globalAccountSettings[e.resourceIndex].calendarNo&&0==globalAccountSettings[e.resourceIndex].todoNo&&globalCalDAVInitLoad?updateMainLoader():""!=globalSettingsSaving&&updateMainLoader(!0,e.listType,e.uid)):(globalOnlyCalendarNumber>0&&globalOnlyCalendarNumberCount==globalOnlyCalendarNumber||globalTodoCalendarNumber>0&&globalOnlyTodoCalendarNumberCount==globalTodoCalendarNumber)&&updateMainLoader(!0,e.listType)),!1}if(1==t){if("vevent"==e.listType)var h=!0;else var h=!1;for(var m=0;m<l.length;m++)1==l[m].deleted?globalEventList.removeOldEvent(e.uid+l[m].href.replace(vCalendar.pre.hrefValRex,""),!0,h):d[d.length]=l[m].href}else{for(var m=0;m<l.length;m++){var b=e.uid+l[m].href.replace(vCalendar.pre.hrefValRex,"");globalEventList.checkAndTouchIfExists(e.uid,b,l[m].etag,u)||(d[d.length]=l[m].href)}if("vevent"==e.listType)var h=!0;else var h=!1;globalEventList.removeOldEvents(e.uid,u,h)}if(null!=s&&void 0!=i[s]&&void 0!=i[s].pastUnloaded&&null!=i[s].pastUnloaded&&i[s].pastUnloaded.length>0&&(d=d.concat(i[s].pastUnloaded).sort().unique()),0==d.length)return e.someChanged=!1,e.oldSyncToken=e.syncToken,(o||""!=globalSettingsSaving)&&("vevent"==e.listType?$('#ResourceCalDAVList [data-id="'+e.uid+'"]').removeClass("r_operate"):$('#ResourceCalDAVTODOList [data-id="'+e.uid+'"]').removeClass("r_operate"),"vtodo"==e.listType&&null==globalSettings.todopastlimit.value||"vevent"==e.listType&&null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value||""==globalLimitLoading&&""==globalLimitTodoLoading?("vevent"==e.listType?globalAccountSettings[e.resourceIndex].calendarNo--:"vtodo"==e.listType&&globalAccountSettings[e.resourceIndex].todoNo--,0==globalAccountSettings[e.resourceIndex].calendarNo&&0==globalAccountSettings[e.resourceIndex].todoNo&&globalCalDAVInitLoad?updateMainLoader():""!=globalSettingsSaving&&updateMainLoader(!0,e.listType,e.uid)):(globalOnlyCalendarNumber>0&&globalOnlyCalendarNumberCount==globalOnlyCalendarNumber||globalTodoCalendarNumber>0&&globalOnlyTodoCalendarNumberCount==globalTodoCalendarNumber||""!=globalSettingsSaving)&&updateMainLoader(!0,e.listType)),("undefined"==typeof globalParallelAjaxCallCalDAVEnabled||null==globalParallelAjaxCallCalDAVEnabled||!globalParallelAjaxCallCalDAVEnabled)&&i.length>0&&(s++,s>=i.length&&"undefined"!=e.uid&&"vevent"==e.listType?(s=0,(null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value||r)&&CalDAVnetLoadCollection(globalResourceCalDAVList.TodoCollections[0],o,r,0,globalResourceCalDAVList.TodoCollections)):CalDAVnetLoadCollection(i[s],o,r,s,i)),!0;0==$(".r_operate_all").length&&$("#SystemCalDavZAP .fc-header-center ").addClass("r_operate_all"),multigetData='<?xml version="1.0" encoding="utf-8"?><L:calendar-multiget xmlns:D="DAV:" xmlns:L="urn:ietf:params:xml:ns:caldav"><D:prop><D:getetag/><L:calendar-data/></D:prop><D:href>'+d.join("</D:href><D:href>")+"</D:href></L:calendar-multiget>";$.ajax({type:"REPORT",url:e.url+e.href,cache:!1,crossDomain:"undefined"==typeof e.crossDomain||e.crossDomain,xhrFields:{withCredentials:"undefined"!=typeof e.withCredentials&&e.withCredentials},timeout:e.timeOut,beforeSend:function(l){1!=globalSettings.usejqueryauth.value&&""!=e.userAuth.userName&&""!=e.userAuth.userPassword&&l.setRequestHeader("Authorization",basicAuth(e.userAuth.userName,e.userAuth.userPassword)),l.setRequestHeader("X-client",globalXClientHeader)},username:1==globalSettings.usejqueryauth.value?e.userAuth.userName:null,password:1==globalSettings.usejqueryauth.value?e.userAuth.userPassword:null,contentType:"text/xml",processData:!0,data:multigetData,dataType:"xml",error:function(l,t){return null!=s&&null!=e.pastUnloaded&&void 0!=e.pastUnloaded&&(e.pastUnloaded=d),console.log("Error: [netLoadCalendar: 'REPORT "+e.url+e.href+"'] code: '"+l.status+"' status: '"+t+"'"+(0==l.status?" - see https://www.inf-it.com/"+globalAppName.toLowerCase()+"/readme.txt (cross-domain setup)":"")),"vevent"==e.listType?($('#ResourceCalDAVList [data-id="'+e.uid+'"]').removeClass("r_operate"),$("#intCaldav").find(".int_error").css("display","block")):($('#ResourceCalDAVTODOList [data-id="'+e.uid+'"]').removeClass("r_operate"),$("#intCaldavTodo").find(".int_error").css("display","block")),$('[data-id="'+e.uid+'"]').addClass("r_error"),e.syncToken=e.oldSyncToken,"vtodo"==e.listType&&null==globalSettings.todopastlimit.value||"vevent"==e.listType&&null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value||""==globalLimitLoading&&""==globalLimitTodoLoading?(e.listType.indexOf("vevent")!=-1?globalAccountSettings[e.resourceIndex].calendarNo--:e.listType.indexOf("vtodo")!=-1&&globalAccountSettings[e.resourceIndex].todoNo--,0==globalAccountSettings[e.resourceIndex].calendarNo&&0==globalAccountSettings[e.resourceIndex].todoNo&&globalCalDAVInitLoad?updateMainLoader():""!=globalSettingsSaving&&updateMainLoader(!0,e.listType,e.uid)):(globalOnlyCalendarNumber>0&&globalOnlyCalendarNumberCount==globalOnlyCalendarNumber||globalTodoCalendarNumber>0&&globalOnlyTodoCalendarNumberCount==globalTodoCalendarNumber)&&updateMainLoader(!0,e.listType),("undefined"==typeof globalParallelAjaxCallCalDAVEnabled||null==globalParallelAjaxCallCalDAVEnabled||!globalParallelAjaxCallCalDAVEnabled)&&i.length>0&&(s++,s>=i.length&&"undefined"!=e.uid&&"vevent"==e.listType?(s=0,(null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value||r)&&CalDAVnetLoadCollection(globalResourceCalDAVList.TodoCollections[0],o,r,0,globalResourceCalDAVList.TodoCollections)):CalDAVnetLoadCollection(i[s],o,r,s,i)),!1},success:function(l,t,a){e.someChanged=!1,"vevent"==e.listType&&0==$("#ResourceCalDAVList").find(".r_error").length&&isEachResourceLoaded()?$("#intCaldav").find(".int_error").css("display","none"):"vtodo"==e.listType&&0==$("#ResourceCalDAVTODOList").find(".r_error").length&&isEachResourceLoaded()&&$("#intCaldavTodo").find(".int_error").css("display","none"),e.oldSyncToken=e.syncToken,e.pastUnloaded="";var d=0;$(a.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response").children().filterNsNode("href").each(function(e,l){d++}),globalResourceCalDAVList.counterList[e.uid+" "+e.listType].collectionLength=d,globalResourceCalDAVList.counterList[e.uid+" "+e.listType].counter=0,globalResourceCalDAVList.counterList[e.uid+" "+e.listType].resourceIndex=e.resourceIndex,globalResourceCalDAVList.counterList[e.uid+" "+e.listType].listType=e.listType,globalResourceCalDAVList.counterList[e.uid+" "+e.listType].typeList=e.typeList;var c=!0,g=new RegExp("200 OK$");$(a.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response").each(function(l,t){if(!$(t).children().filterNsNode("propstat").children().filterNsNode("status").text().match(g)){var a=e.uid+$(t).children().filterNsNode("href").text().replace(vCalendar.pre.hrefValRex,"");return console.log("Error: '"+a+"': unable to parse vEvent or vTodo"),checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1),!0}c=!1;var o=$(t).children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("getetag").text(),a=e.uid+$(t).children().filterNsNode("href").text().replace(vCalendar.pre.hrefValRex,""),r=$(t).children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("calendar-data").text();if(""==r)return checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1),!0;var s=vCalendarCleanup(r);if(void 0==s||null==(check=s.match(vCalendar.pre.vcalendar)))return checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1),console.log("Error: '"+a+"': unable to parse vCalendar"),!0;if(null!=(check=s.match(vCalendar.pre.vevent)))e.typeList.indexOf("vevent")!=-1?globalEventList.insertEvent(n,e,{threadChange:"",isRepeat:!1,isDrawn:!1,isTODO:!1,untilDate:"",sortStart:"",start:"",end:"",sortkey:"",timestamp:u,accountUID:e.accountUID,uid:a,displayValue:e.displayvalue,counter:0,etag:o,vcalendar:s},!1,!0,!0):checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1);else{if(null==(check=s.match(vCalendar.pre.vtodo)))return console.log("Error: '"+a+"': unable to parse vEvent or vTodo"),checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1),!0;e.typeList.indexOf("vtodo")!=-1?globalEventList.insertEvent(n,e,{threadChange:"",isRepeat:!1,isDrawn:!1,isTODO:!1,untilDate:"",sortStart:"",start:"",end:"",sortkey:"",timestamp:u,accountUID:e.accountUID,uid:a,displayValue:e.displayvalue,counter:0,etag:o,vcalendar:s},!1,!1,!0):checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1)}}),c&&("vevent"==e.listType?$('#ResourceCalDAVList [data-id="'+e.uid+'"]').removeClass("r_operate"):$('#ResourceCalDAVTODOList [data-id="'+e.uid+'"]').removeClass("r_operate"),""==globalLimitLoading&&""==globalLimitTodoLoading?(e.typeList.indexOf("vevent")!=-1?globalAccountSettings[e.resourceIndex].calendarNo--:e.typeList.indexOf("vtodo")!=-1&&globalAccountSettings[e.resourceIndex].todoNo--,0==globalAccountSettings[e.resourceIndex].calendarNo&&0==globalAccountSettings[e.resourceIndex].todoNo&&globalCalDAVInitLoad?updateMainLoader():""!=globalSettingsSaving&&updateMainLoader(!0,e.listType,e.uid)):(globalOnlyCalendarNumber>0&&globalOnlyCalendarNumberCount==globalOnlyCalendarNumber||globalTodoCalendarNumber>0&&globalOnlyTodoCalendarNumberCount==globalTodoCalendarNumber)&&updateMainLoader(!0,e.listType)),("undefined"==typeof globalParallelAjaxCallCalDAVEnabled||null==globalParallelAjaxCallCalDAVEnabled||!globalParallelAjaxCallCalDAVEnabled)&&i.length>0&&(s++,s>=i.length&&"undefined"!=e.uid&&"vevent"==e.listType?(s=0,(null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value||r)&&CalDAVnetLoadCollection(globalResourceCalDAVList.TodoCollections[0],o,r,0,globalResourceCalDAVList.TodoCollections)):CalDAVnetLoadCollection(i[s],o,r,s,i)),""!=globalTodoLoaderHide&&show_editor_loader_messageCalendar("vtodo","message_success",globalTodoLoaderHide,function(e){globalTodoLoaderHide="",$("#showTODO").val(""),$("#TodoDisabler").fadeOut(globalEditorFadeAnimation,function(){$("#timezonePickerTODO").prop("disabled",!1)})})}})}function netLoadCalendarSubscription(e,l,t,a,o){return l.makeLoaded&&""==globalLimitLoading&&""==globalLimitTodoLoading?void $.ajax({type:"GET",url:l.href,cache:!1,crossDomain:!1,timeout:3e4,beforeSend:function(l){1!=globalSettings.usejqueryauth.value&&""!=e.userAuth.userName&&""!=e.userAuth.userPassword&&l.setRequestHeader("Authorization",basicAuth(e.userAuth.userName,e.userAuth.userPassword))},username:1==globalSettings.usejqueryauth.value?e.userAuth.userName:null,password:1==globalSettings.usejqueryauth.value?e.userAuth.userPassword:null,contentType:"text/plain",processData:!0,data:"",dataType:"text",error:function(e,t){return console.log("Error: [netLoadCalendarSubscription: 'GET "+l.href+"'] code: '"+e.status+"' status: '"+t+"'"),"vevent"==l.listType?($('#ResourceCalDAVList [data-id="'+l.uid+'"]').removeClass("r_operate"),$("#intCaldav").find(".int_error").css("display","block")):($('#ResourceCalDAVTODOList [data-id="'+l.uid+'"]').removeClass("r_operate"),$("#intCaldavTodo").find(".int_error").css("display","block")),$('[data-id="'+l.uid+'"]').addClass("r_error"),""==globalLimitLoading&&""==globalLimitTodoLoading&&(l.typeList.indexOf("vevent")!=-1?globalAccountSettings[l.resourceIndex].calendarNo--:l.typeList.indexOf("vtodo")!=-1&&globalAccountSettings[l.resourceIndex].todoNo--,(0==globalAccountSettings[l.resourceIndex].calendarNo&&0==globalAccountSettings[l.resourceIndex].todoNo&&globalCalDAVInitLoad||!globalCalDAVInitLoad)&&updateMainLoader()),!1},success:function(e,r,n){"vevent"==l.listType&&0==$("#ResourceCalDAVList").find(".r_error").length&&isEachResourceLoaded()?$("#intCaldav").find(".int_error").css("display","none"):"vtodo"==l.listType&&0==$("#ResourceCalDAVTODOList").find(".r_error").length&&isEachResourceLoaded()&&$("#intCaldavTodo").find(".int_error").css("display","none");var s=vCalendarCleanup(n.responseText);if(l.urlArray={},l.newlyAdded=!1,l.typeList.indexOf("vevent")!=-1){var i=0,d=!1;for(null!=s.match(vCalendar.pre.vevent)&&(d=!0);null!=s.match(vCalendar.pre.vevent);){var c=s.substring(s.indexOf("BEGIN:VEVENT")-2,s.indexOf("END:VEVENT")+"END:VEVENT".length),u=c.match(vCalendar.pre.contentline_UID);null!=u&&(u=u[0].match(vCalendar.pre.contentline_parse)[4],u=u.replace("/",""));var g=String(CryptoJS.SHA256(c));null!=l.urlArray&&(null!=l.urlArray[l.uid+u+".ics"]&&void 0!=l.urlArray[l.uid+u+".ics"]?l.urlArray[l.uid+u+".ics"].eventText+=c+"\r\n":l.urlArray[l.uid+u+".ics"]={etag:g,href:l.uid+u+".ics",eventText:c+"\r\n"}),s=s.replace(c,""),i++}0==i&&d&&("undefined"==typeof u||null==u?console.log("Error: '"+l.uid+"': unable to parse subscribed vEvent"):console.log("Error: '"+l.uid+u+".ics': unable to parse subscribed vEvent"))}if(l.typeList.indexOf("vtodo")!=-1){var i=0,p=!1;for(null!=s.match(vCalendar.pre.vtodo)&&(p=!0);null!=s.match(vCalendar.pre.vtodo);){var c=s.substring(s.indexOf("BEGIN:VTODO")-2,s.indexOf("END:VTODO")+"END:VTODO".length),u=c.match(vCalendar.pre.contentline_UID);null!=u&&(u=u[0].match(vCalendar.pre.contentline_parse)[4],u=u.replace("/",""));var g=String(CryptoJS.SHA256(c));null!=l.urlArray&&(null!=l.urlArray[l.uid+u+".ics"]&&void 0!=l.urlArray[l.uid+u+".ics"]?l.urlArray[l.uid+u+".ics"].eventText+=c+"\r\n":l.urlArray[l.uid+u+".ics"]={etag:g,href:l.uid+u+".ics",eventText:c+"\r\n"}),s=s.replace(c,""),i++}0==i&&p&&("undefined"==typeof u||null==u?console.log("Error: '"+l.uid+"': unable to parse subscribed vTodo"):console.log("Error: '"+l.uid+u+".ics': unable to parse subscribed vTodo"))}if("undefined"!=typeof globalEventList.events[l.uid])for(event in globalEventList.events[l.uid])void 0!=l.urlArray[event]&&null!=l.urlArray[event]||globalEventList.removeOldEvent(event,!0,!0);else for(event in globalEventList.todos[l.uid])void 0!=l.urlArray[event]&&null!=l.urlArray[event]||globalEventList.removeOldEvent(event,!0,!1);netLoadCalendar(l,l.urlArray,void 0==l.forceSyncPROPFIND||0==l.forceSyncPROPFIND,!0,a,!0,!1,t,o)}}):(l.makeLoaded&&updateMainLoaderText(l.listType),"vevent"==l.listType?$('#ResourceCalDAVList [data-id="'+l.uid+'"]').removeClass("r_operate"):$('#ResourceCalDAVTODOList [data-id="'+l.uid+'"]').removeClass("r_operate"),""==globalLimitLoading&&""==globalLimitTodoLoading?(l.typeList.indexOf("vevent")!=-1?globalAccountSettings[l.resourceIndex].calendarNo--:l.typeList.indexOf("vtodo")!=-1&&globalAccountSettings[l.resourceIndex].todoNo--,(0==globalAccountSettings[l.resourceIndex].calendarNo&&0==globalAccountSettings[l.resourceIndex].todoNo&&globalCalDAVInitLoad||!globalCalDAVInitLoad)&&updateMainLoader()):""==globalLimitLoading&&""==globalLimitTodoLoading||updateMainLoader(),!1)}