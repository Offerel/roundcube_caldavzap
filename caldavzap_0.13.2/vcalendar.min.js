function EventList(){this.events={},this.todos={},this.displayEventsArray={},this.displayTodosArray={},this.repeatable={},this.repeatableTodo={},this.reset=function(){this.events={},this.todos={},this.repeatable={},this.repeatableTodo={},this.displayEventsArray={},this.displayTodosArray={}},this.getNewUID=function(){var e=null;return e=generateUID()},this.getSortKey=function(e){var t=("\r\n"+e).match(RegExp("\r\n"+vCalendar.re.contentline_N,"m"));if(null!=t&&1==t.length){var l=t[0].match(RegExp("\r\n"+vCalendar.re.contentline_parse,"m")),o=vcalendarSplitValue(l[4],";");if(""!=o[0]||""!=o[1]){var i=o[0];""!=i&&""!=o[1]&&(i+=" "),i+=o[1]}else{var a=("\r\n"+e).match(RegExp("\r\n"+vCalendar.re.contentline_FN,"m"));if(null!=a&&1==a.length)var l=a[0].match(RegExp("\r\n"+vCalendar.re.contentline_parse,"m")),i=l[4]}return i}return!1},this.insertEvent=function(e,t,l,o,i,a){makeActive=null;var n=l.uid.substring(0,l.uid.lastIndexOf("/")+1),s={};if(s=i?globalEventList.events:globalEventList.todos,void 0!=s[n][l.uid]){if(s[n][l.uid].etag==l.etag)return checkEventLoader(globalResourceCalDAVList.counterList[t.uid+" "+t.listType],!1),0;this.removeOldEvent(l.uid,!1,i),makeActive=l.uid}if(i){var d=getvCalendarstart(l);if(0==d||d==-1||void 0==d||null==d)return console.log("Error: '"+l.uid+"': unable to parse vEvent"),checkEventLoader(globalResourceCalDAVList.counterList[t.uid+" "+t.listType],!0),!1;l.sortStart=d,globalEventList.events[n][l.uid]=l}else globalEventList.todos[n][l.uid]=l;if(null!=makeActive)return globalEventList.loadEventByUID(makeActive,i,a),0;var v=l.uid;if(n=v.substring(0,v.lastIndexOf("/")+1),i?0==vcalendarToData(t,l,!0)&&console.log("Error: '"+l.uid+"': unable to parse vEvent"):0==vcalendarTodoData(t,l,!0)&&console.log("Error: '"+l.uid+"': unable to parse vTodo"),i){if(void 0==l.counter)if(globalVisibleCalDAVCollections.indexOf(n)!=-1||globalSettings.displayhiddenevents.value)refetchCalendarEvents();else{var r=$("#main").width()-$("#calendar").width();$("#calendar").fullCalendar("removeEvents","fooUID");var c=$("#main").width()-$("#calendar").width();rerenderCalendar(r!=c)}}else void 0==l.counter&&(globalVisibleCalDAVTODOCollections.indexOf(n)!=-1||globalSettings.displayhiddenevents.value)&&refetchTodoEvents();void 0!=l.counter&&checkEventLoader(globalResourceCalDAVList.counterList[t.uid+" "+t.listType],!0),e&&!i&&$("#todoList").fullCalendar("selectEvent",$('[data-id="'+l.uid+'"]'))},this.checkAndTouchIfExists=function(e,t,l,o){return void 0!=globalEventList.events[e]&&void 0!=globalEventList.events[e][t]?(globalEventList.events[e][t].timestamp=o,globalEventList.events[e][t].etag==l):void 0!=globalEventList.todos[e]&&void 0!=globalEventList.todos[e][t]&&(globalEventList.todos[e][t].timestamp=o,globalEventList.todos[e][t].etag==l)},this.removeOldEvents=function(e,t,l){if(l){for(var o=0;o<globalResourceCalDAVList.collections.length;o++)if(void 0!=globalResourceCalDAVList.collections[o].uid)for(var i in globalEventList.events[globalResourceCalDAVList.collections[o].uid]){var a=globalEventList.events[globalResourceCalDAVList.collections[o].uid][i];void 0!=a.timestamp&&0==a.uid.indexOf(e)&&a.timestamp<t&&globalEventList.removeOldEvent(a.uid,!0,l)}}else for(var o=0;o<globalResourceCalDAVList.TodoCollections.length;o++)if(void 0!=globalResourceCalDAVList.TodoCollections[o].uid)for(var i in globalEventList.todos[globalResourceCalDAVList.TodoCollections[o].uid]){var a=globalEventList.todos[globalResourceCalDAVList.TodoCollections[o].uid][i];void 0!=a.timestamp&&0==a.uid.indexOf(e)&&a.timestamp<t&&globalEventList.removeOldEvent(a.uid,!0,l)}},this.removeOldEvent=function(e,t,l){var o=e.substring(0,e.lastIndexOf("/")+1),i=null,l=!0;if(void 0!=globalEventList.events[o]&&void 0!=globalEventList.events[o][e]?(i=e,delete globalEventList.events[o][e],l=!0):void 0!=globalEventList.todos[o]&&void 0!=globalEventList.todos[o][e]&&(i=e,delete globalEventList.todos[o][e],l=!1),null!=i){if(t)if(deleteEventFromArray(i),l)refetchCalendarEvents();else{var a="";null!=globalCalTodo&&(a=$(".fc-view-todo .fc-list-day").find(".fc-event:visible").index($('[data-repeat-hash="'+globalCalTodo.repeatHash+'"]'))),refetchTodoEvents(),a!=-1&&$(".fc-view-todo .fc-list-day").find(".fc-event:visible").length>0&&a>$(".fc-view-todo .fc-list-day").find(".fc-event:visible").length-1?$("#todoList").fullCalendar("selectEvent",$($(".fc-view-todo .fc-list-day").find(".fc-event:visible").get($(".fc-view-todo .fc-list-day").find(".fc-event:visible").length-1))):a!=-1&&$(".fc-view-todo .fc-list-day").find(".fc-event:visible").length>0&&a<=$(".fc-view-todo .fc-list-day").find(".fc-event:visible").length-1?$("#todoList").fullCalendar("selectEvent",$($(".fc-view-todo .fc-list-day").find(".fc-event:visible").get(a))):$("#CATodo").attr("style","display:none")}l?delete globalEventList.repeatable[e]:delete globalEventList.repeatableTodo[e]}},this.loadEventByUID=function(e,t,l){var o="";if("/"!=e.charAt(e.length-1))if(o=e.substring(0,e.lastIndexOf("/")+1),t){if(void 0!=globalEventList.events[o][e].uid){var i="";globalCalDAVInitLoad||(i=findEventInArray(globalEventList.events[o][e].uid,t)),""!=i&&i.etag!=globalEventList.events[o][e].etag&&(vcalendarToData(globalResourceCalDAVList.getCollectionByUID(o),globalEventList.events[o][e],!1),l||globalVisibleCalDAVCollections.indexOf(o)==-1&&!globalSettings.displayhiddenevents.value?l&&checkEventLoader(globalResourceCalDAVList.counterList[o+" "+globalResourceCalDAVList.getCollectionByUID(o).listType],!0):refetchCalendarEvents())}}else if(void 0!=globalEventList.todos[o][e].uid){var i="";if(globalCalDAVInitLoad||(i=findEventInArray(globalEventList.todos[o][e].uid,t)),""!=i&&i.etag!=globalEventList.todos[o][e].etag&&(vcalendarTodoData(globalResourceCalDAVList.getCollectionByUID(o),globalEventList.todos[o][e],!1),globalVisibleCalDAVTODOCollections.indexOf(o)!=-1||globalSettings.displayhiddenevents.value))if($("#todoList").fullCalendar("allowSelectEvent",!1),refetchTodoEvents(),$("#todoList").fullCalendar("allowSelectEvent",!0),$("#showTODO").val()==e){var a=findEventInArray(globalEventList.todos[o][e].uid,!1,null!=globalCalTodo?globalCalTodo.repeatHash:null);if(""!=a){if(null!=globalCalTodo)if(!l||$("#showTODO").val()!=e||"true"!=$("#repeatTodo").val()&&""==$("#recurrenceIDTODO").val())$($(".fc-view-todo .fc-list-day").find('.fc-event[data-repeat-hash="'+$("#todoList").fullCalendar("getView").selectedElement+'"]')).length>0?$("#todoList").fullCalendar("selectEvent",$($(".fc-view-todo .fc-list-day").find('.fc-event[data-repeat-hash="'+$("#todoList").fullCalendar("getView").selectedElement+'"]'))):showTodoForm(globalCalTodo,"show");else if(globalCalTodo.repeatHash!=a.repeatHash){var n=globalCalTodo.title;showTodoForm({title:n,id:e},"show","",!0),$("#editAllTODO").css("visibility","hidden"),$("#editFutureTODO").css("visibility","hidden"),$("#editOnlyOneTODO").css("visibility","hidden"),$("#repeatConfirmBoxContentTODO").html("<b>"+n+"</b> "+localization[globalInterfaceLanguage].repeatChangeTxt),$("#repeatConfirmBoxQuestionTODO").html(localization[globalInterfaceLanguage].repeatTodoChangeTxtClose)}else $("#todoList").fullCalendar("selectEvent")}else $("#CATodo").attr("style","display:none")}else $("#todoList").fullCalendar("selectEvent",null,!0)}}}